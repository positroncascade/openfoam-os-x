 .gitignore                                         |    1 +
 Allwmake                                           |   27 +-
 applications/Allwmake                              |   14 +-
 .../solvers/combustion/reactingFoam/Allwmake       |    2 +-
 .../solvers/compressible/rhoCentralFoam/Allwclean  |    2 +-
 .../solvers/compressible/rhoCentralFoam/Allwmake   |    2 +-
 .../solvers/compressible/rhoPimpleFoam/Allwmake    |    2 +-
 .../solvers/compressible/rhoSimpleFoam/Allwclean   |    2 +-
 .../solvers/compressible/rhoSimpleFoam/Allwmake    |    2 +-
 .../solvers/compressible/sonicFoam/Allwmake        |    2 +-
 .../heatTransfer/chtMultiRegionFoam/Allwclean      |    2 +-
 .../heatTransfer/chtMultiRegionFoam/Allwmake       |    2 +-
 .../solvers/incompressible/pimpleFoam/Allwmake     |    2 +-
 .../solvers/incompressible/simpleFoam/Allwmake     |    2 +-
 applications/solvers/lagrangian/DPMFoam/Allwclean  |    2 +-
 applications/solvers/lagrangian/DPMFoam/Allwmake   |    2 +-
 .../icoUncoupledKinematicParcelFoam/Allwmake       |    2 +-
 .../solvers/lagrangian/reactingParcelFoam/Allwmake |    2 +-
 applications/solvers/lagrangian/sprayFoam/Allwmake |    2 +-
 .../solvers/multiphase/cavitatingFoam/Allwclean    |    2 +-
 .../solvers/multiphase/cavitatingFoam/Allwmake     |    2 +-
 .../multiphase/compressibleInterFoam/Allwclean     |    2 +-
 .../multiphase/compressibleInterFoam/Allwmake      |    2 +-
 .../compressibleTwoPhaseEulerFoam/Allwclean        |    2 +-
 .../compressibleTwoPhaseEulerFoam/Allwmake         |    2 +-
 .../solvers/multiphase/interFoam/Allwclean         |    2 +-
 applications/solvers/multiphase/interFoam/Allwmake |    2 +-
 .../threePhaseMixture.C                            |    2 +-
 .../threePhaseMixture.H                            |    2 +-
 .../multiphase/interPhaseChangeFoam/Allwclean      |    2 +-
 .../multiphase/interPhaseChangeFoam/Allwmake       |    2 +-
 .../multiphase/multiphaseEulerFoam/Allwclean       |    2 +-
 .../multiphase/multiphaseEulerFoam/Allwmake        |    2 +-
 .../multiphase/multiphaseInterFoam/Allwclean       |    2 +-
 .../multiphase/multiphaseInterFoam/Allwmake        |    2 +-
 .../solvers/multiphase/twoPhaseEulerFoam/Allwclean |    2 +-
 .../solvers/multiphase/twoPhaseEulerFoam/Allwmake  |    2 +-
 .../utilities/mesh/conversion/Optional/Allwmake    |    2 +-
 .../mesh/conversion/kivaToFoam/readKivaGrid.H      |    2 +-
 applications/utilities/mesh/generation/Allwmake    |    2 +-
 .../utilities/mesh/generation/extrude/Allwclean    |    2 +-
 .../utilities/mesh/generation/extrude/Allwmake     |    2 +-
 .../mesh/generation/extrude2DMesh/Allwclean        |    2 +-
 .../mesh/generation/extrude2DMesh/Allwmake         |    2 +-
 .../mesh/generation/snappyHexMesh/Make/options     |    1 -
 .../mesh/manipulation/renumberMesh/Allwmake        |   11 +-
 .../mesh/manipulation/renumberMesh/Make/options    |    1 -
 .../miscellaneous/foamDebugSwitches/Make/options   |    2 -
 .../dataConversion/foamToEnsight/Make/options      |    1 -
 .../dataConversion/foamToVTK/surfaceMeshWriter.C   |    1 -
 .../dataConversion/foamToVTK/surfaceMeshWriter.H   |    2 +-
 .../postProcessing/graphics/PV3Readers/Allwclean   |    2 +-
 .../postProcessing/graphics/PV3Readers/Allwmake    |    7 +-
 .../graphics/PV3Readers/PV3FoamReader/Allwclean    |    2 +-
 .../graphics/PV3Readers/PV3FoamReader/Allwmake     |    2 +-
 .../PV3Readers/PV3blockMeshReader/Allwclean        |    2 +-
 .../PV3Readers/PV3blockMeshReader/Allwmake         |    2 +-
 .../preProcessing/wallFunctionTable/Allwmake       |    2 +-
 .../surface/surfaceFeatureExtract/Allwmake         |   43 +-
 .../surface/surfaceFeatureExtract/Make/options     |    1 +
 .../surfaceFeatureExtract/surfaceFeatureExtract.C  |   16 +-
 bin/foamEtcFile                                    |    3 +
 bin/foamInstallationTest                           |   37 +-
 bin/foamJob                                        |    8 +
 bin/paraFoam                                       |   10 +-
 bin/tools/RunFunctions                             |  121 ++-
 bin/tools/replaceAllShellSun                       |    2 +-
 doc/Allwmake                                       |    2 +-
 doc/Doxygen/Allwmake                               |    2 +-
 etc/bashrc                                         |  135 ++-
 etc/config/paraview-osx.sh                         |   15 +
 etc/config/scotch.sh                               |   14 +-
 etc/config/settings.sh                             |   83 +-
 src/Allwmake                                       |   16 +-
 src/OSspecific/POSIX/POSIX.C                       |   37 +
 src/OSspecific/POSIX/clockTime/clockTime.H         |    3 +
 src/OSspecific/POSIX/fileStat.C                    |    2 +
 src/OSspecific/POSIX/printStack.C                  |  332 +++----
 src/OSspecific/POSIX/signals/sigFpe.C              |   87 +-
 src/OSspecific/POSIX/signals/sigFpe.H              |   20 +-
 .../Lists/CompactListList/CompactListListI.H       |    2 +-
 .../containers/Lists/FixedList/FixedListI.H        |    2 +-
 src/OpenFOAM/containers/Lists/List/ListI.H         |    2 +-
 src/OpenFOAM/containers/Lists/SubList/SubListI.H   |    2 +-
 src/OpenFOAM/containers/Lists/UList/UList.H        |    1 +
 src/OpenFOAM/containers/Lists/UList/UListI.H       |    2 +-
 src/OpenFOAM/db/IOobject/IOobject.H                |    2 +-
 src/OpenFOAM/db/IOobject/IOobjectI.H               |   18 +-
 src/OpenFOAM/db/IOobject/IOobjectWriteHeader.C     |    1 +
 src/OpenFOAM/db/IOstreams/Pstreams/gatherScatter.C |    3 +
 .../functionEntries/codeStream/codeStream.C        |    3 +
 .../db/dynamicLibrary/dynamicCode/dynamicCode.C    |    4 +
 .../db/dynamicLibrary/dynamicCode/dynamicCode.H    |    4 +
 .../db/objectRegistry/objectRegistryTemplates.C    |    2 +-
 .../DimensionedField/DimensionedFieldI.H           |    2 +-
 .../DimensionedField/SubDimensionedFieldI.H        |    2 +-
 src/OpenFOAM/fields/Fields/Field/Field.C           |    4 +-
 src/OpenFOAM/fields/Fields/Field/Field.H           |    2 +-
 src/OpenFOAM/fields/Fields/Field/SubFieldI.H       |    2 +-
 .../GeometricField/GeometricFieldI.H               |    2 +-
 src/OpenFOAM/global/foamDoc.H                      |    2 +-
 src/OpenFOAM/global/global.Cver                    |    2 +
 src/OpenFOAM/matrices/Matrix/MatrixI.H             |    2 +-
 src/OpenFOAM/memory/Xfer/XferI.H                   |    4 +-
 .../meshes/meshShapes/cellShape/cellShapeIO.C      |    2 +-
 src/OpenFOAM/meshes/polyMesh/polyMesh.C            |    8 +-
 src/OpenFOAM/primitives/Scalar/doubleFloat.H       |    9 +
 src/OpenFOAM/primitives/nullObject/nullObject.C    |   34 +
 src/OpenFOAM/primitives/nullObject/nullObject.H    |  110 +++
 src/OpenFOAM/primitives/nullObject/nullObjectI.H   |   65 ++
 .../primitives/ranges/labelRange/labelRangeI.H     |    4 +-
 .../primitives/ranges/labelRange/labelRangesI.H    |    2 +-
 src/Pstream/Allwmake                               |   16 +-
 src/Pstream/mpi/Make/options                       |    4 +
 src/conversion/Allwmake                            |    2 +-
 src/conversion/ensight/part/ensightPartCells.C     |    6 +-
 src/conversion/ensight/part/ensightPartIO.C        |    2 +-
 src/dummyThirdParty/Allwmake                       |    2 +-
 src/dummyThirdParty/metisDecomp/metis.h            |   18 +-
 src/edgeMesh/edgeMesh.C                            |    4 +-
 .../DarcyForchheimer/DarcyForchheimer.C            |    4 +-
 .../DarcyForchheimer/DarcyForchheimer.H            |    2 +-
 .../general/porosityModel/fixedCoeff/fixedCoeff.C  |    4 +-
 .../general/porosityModel/fixedCoeff/fixedCoeff.H  |    2 +-
 .../porosityModel/porosityModel/porosityModel.C    |    2 +-
 .../porosityModel/porosityModelList.C              |    2 +-
 .../general/porosityModel/powerLaw/powerLaw.C      |    4 +-
 .../general/porosityModel/powerLaw/powerLaw.H      |    2 +-
 .../fixedGradient/fixedGradientFvPatchField.H      |    2 +-
 .../flowRateInletVelocityFvPatchVectorField.H      |    2 +-
 ...inletOutletTotalTemperatureFvPatchScalarField.H |    2 +-
 .../mappedFixedValueFvPatchField.H                 |    4 +-
 ...essureDirectedInletVelocityFvPatchVectorField.H |    2 +-
 ...PressureInletOutletVelocityFvPatchVectorField.H |    4 +-
 .../rotatingTotalPressureFvPatchScalarField.H      |    4 +-
 .../rotatingWallVelocityFvPatchVectorField.H       |    4 +-
 .../supersonicFreestreamFvPatchVectorField.H       |    2 +-
 .../fvPatchFields/fvPatchField/fvPatchField.C      |    6 +-
 src/fvAgglomerationMethods/Allwmake                |   19 +-
 .../MGridGenGamgAgglomeration/Make/options         |   10 +
 src/fvOptions/Make/options                         |    1 -
 src/lagrangian/Allwmake                            |    2 +-
 .../COxidationHurtMitchell.H                       |    2 +-
 .../distributionModels/uniform/uniform.C           |    3 +-
 .../distributionModels/uniform/uniform.H           |    2 +-
 .../InjectionModel/InjectionModelList.H            |    2 +-
 src/lagrangian/molecularDynamics/Allwmake          |    2 +-
 .../BreakupModel/PilchErdman/PilchErdman.H         |    2 +-
 src/mesh/Allwmake                                  |    2 +-
 .../edgeFaceCirculator/edgeFaceCirculator.C        |    2 +-
 .../momentOfInertia/volumeIntegration/volInt.c     |   28 +-
 src/parallel/Allwmake                              |    2 +-
 src/parallel/decompose/Allwmake                    |   26 +-
 src/parallel/decompose/AllwmakeLnInclude           |    2 +-
 src/parallel/decompose/ptscotchDecomp/Make/options |   10 +-
 src/parallel/decompose/scotchDecomp/Make/options   |    8 +-
 src/parallel/reconstruct/Allwmake                  |    2 +-
 src/postProcessing/Allwmake                        |    2 +-
 src/postProcessing/functionObjects/Allwmake        |    2 +-
 .../field/fieldValues/faceSource/faceSource.H      |    4 +-
 src/regionModels/Allwclean                         |    2 +-
 src/regionModels/Allwmake                          |    2 +-
 .../pyrolysisModel/pyrolysisModelCollection.C      |    2 +-
 .../pyrolysisModel/pyrolysisModelNew.C             |    2 +-
 .../thermalBaffleModels/noThermo/noThermo.C        |    2 +-
 src/renumber/Allwmake                              |   26 +-
 src/renumber/SloanRenumber/Make/options            |    9 +-
 src/sampling/cuttingPlane/cuttingPlane.C           |    6 +-
 .../sampledSurface/sampledPatch/sampledPatch.C     |    2 +-
 .../writers/nastran/nastranSurfaceWriter.C         |    2 +-
 src/surfMesh/MeshedSurface/MeshedSurface.C         |   20 +-
 src/surfMesh/MeshedSurface/MeshedSurface.H         |    2 +-
 .../MeshedSurfaceIOAllocator.C                     |    8 +-
 .../UnsortedMeshedSurface/UnsortedMeshedSurface.C  |    6 +-
 src/surfMesh/surfMesh/surfMesh.C                   |    2 +-
 src/thermophysicalModels/Allwmake                  |    2 +-
 src/thermophysicalModels/properties/Allwmake       |    2 +-
 src/thermophysicalModels/reactionThermo/Make/files |    2 +-
 .../chemistryReaders/chemkinReader/chemkinReader.C |    9 +
 .../specie/reaction/Reactions/Reaction/Reaction.C  |    6 +-
 src/transportModels/Allwmake                       |    2 +-
 src/turbulenceModels/Allwmake                      |    2 +-
 src/turbulenceModels/LES/Allwmake                  |    2 +-
 src/turbulenceModels/compressible/Allwmake         |    2 +-
 .../compressible/LES/DESModel/DESModelDoc.H        |    2 +-
 .../compressible/LES/GenEddyVisc/GenEddyVisc.H     |    2 +-
 .../compressible/LES/GenSGSStress/GenSGSStress.H   |    4 +-
 .../compressible/LES/LESModel/LESModelDoc.H        |    2 +-
 .../compressible/RAS/RASModel/RASModelDoc.H        |    2 +-
 ...gLengthDissipationRateInletFvPatchScalarField.H |    2 +-
 ...tMixingLengthFrequencyInletFvPatchScalarField.H |    2 +-
 .../turbulenceModel/turbulenceModelDoc.H           |    2 +-
 src/turbulenceModels/incompressible/Allwmake       |    2 +-
 .../incompressible/LES/DESModel/DESModelDoc.H      |    2 +-
 .../incompressible/LES/GenEddyVisc/GenEddyVisc.H   |    2 +-
 .../incompressible/LES/GenSGSStress/GenSGSStress.H |    6 +-
 .../incompressible/LES/LESModel/LESModelDoc.H      |    2 +-
 .../incompressible/RAS/RASModel/RASModelDoc.H      |    2 +-
 ...tmBoundaryLayerInletEpsilonFvPatchScalarField.H |    2 +-
 ...urbulentHeatFluxTemperatureFvPatchScalarField.H |    2 +-
 ...gLengthDissipationRateInletFvPatchScalarField.H |    2 +-
 ...tMixingLengthFrequencyInletFvPatchScalarField.H |    2 +-
 .../turbulenceModel/turbulenceModelDoc.H           |    2 +-
 wmake/MakefileOptions                              |   54 --
 wmake/makeWmake                                    |   65 --
 wmake/{MakefileApps => makefiles/apps}             |   15 +-
 wmake/{MakefileFiles => makefiles/files}           |   67 +-
 wmake/{Makefile => makefiles/general}              |  172 ++--
 wmake/rules/General/CGAL                           |    8 +-
 wmake/rules/General/X                              |    2 +
 wmake/rules/General/bison                          |   20 +-
 wmake/rules/General/btyacc                         |   13 +-
 wmake/rules/General/btyacc++                       |    8 +-
 wmake/rules/General/byacc                          |   13 +-
 wmake/rules/General/coco-cpp                       |   15 -
 wmake/rules/General/flex                           |   11 +-
 wmake/rules/General/flex++                         |   11 +-
 wmake/rules/General/general                        |   46 +-
 wmake/rules/General/moc                            |   11 +-
 wmake/rules/General/mplib                          |    2 +
 wmake/rules/General/mplibGAMMA                     |    3 -
 wmake/rules/General/mplibMPICH                     |    4 +-
 wmake/rules/General/mplibMPICH-GM                  |    4 +-
 wmake/rules/General/mplibOPENMPI                   |    3 +-
 wmake/rules/General/mplibQSMPI                     |    3 +-
 wmake/rules/General/mplibSGIMPI                    |    4 +-
 wmake/rules/General/mplibSYSTEMMPI                 |    7 +
 wmake/rules/General/mplibSYSTEMOPENMPI             |    2 +
 wmake/rules/General/sourceToDep                    |   24 -
 wmake/rules/General/standard                       |    9 +-
 wmake/rules/General/transform                      |   17 +
 wmake/rules/General/version                        |   21 +-
 wmake/rules/General/yacc                           |   24 +-
 wmake/rules/SiCortex64Gcc/c                        |   17 -
 wmake/rules/SiCortex64Gcc/c++                      |   22 -
 wmake/rules/SiCortex64Gcc/c++Opt                   |    4 -
 wmake/rules/SiCortex64Gcc/general                  |   10 -
 wmake/rules/SiCortex64Gcc/mplibMPI                 |    3 -
 wmake/rules/SunOS64Gcc/c++                         |   21 -
 wmake/rules/SunOS64Gcc/c++Opt                      |    2 -
 wmake/rules/darwin64Clang/c                        |   23 +
 wmake/rules/darwin64Clang/c++                      |   35 +
 wmake/rules/darwin64Clang/c++Debug                 |    4 +
 wmake/rules/darwin64Clang/c++Opt                   |    5 +
 wmake/rules/darwin64Clang/c++Prof                  |    4 +
 wmake/rules/darwin64Clang/cDebug                   |    4 +
 wmake/rules/darwin64Clang/cOpt                     |    4 +
 wmake/rules/darwin64Clang/cProf                    |    4 +
 wmake/rules/darwin64Clang/general                  |   12 +
 wmake/rules/linux64Clang/c                         |    8 +-
 wmake/rules/linux64Clang/c++                       |   16 +-
 wmake/rules/linux64Clang/c++Debug                  |    2 +
 wmake/rules/linux64Clang/c++Opt                    |    3 +-
 wmake/rules/linux64Clang/c++Prof                   |    2 +
 wmake/rules/linux64Clang/cDebug                    |    2 +
 wmake/rules/linux64Clang/cOpt                      |    2 +
 wmake/rules/linux64Clang/cProf                     |    2 +
 wmake/rules/linux64Clang/general                   |    6 +-
 wmake/rules/linux64Clang/mplibHPMPI                |    4 +-
 wmake/rules/linux64Clang/mplibINTELMPI             |    4 +-
 wmake/rules/linux64Gcc++0x/c++Opt                  |    3 -
 wmake/rules/linux64Gcc++0x/general                 |    8 -
 wmake/rules/linux64Gcc++0x/mplibHPMPI              |    3 -
 wmake/rules/linux64Gcc/c                           |    8 +-
 wmake/rules/linux64Gcc/c++                         |   15 +-
 wmake/rules/linux64Gcc/c++Debug                    |    2 +
 wmake/rules/linux64Gcc/c++Opt                      |    5 +-
 wmake/rules/linux64Gcc/c++Prof                     |    2 +
 wmake/rules/linux64Gcc/cDebug                      |    2 +
 wmake/rules/linux64Gcc/cOpt                        |    3 +-
 wmake/rules/linux64Gcc/cProf                       |    2 +
 wmake/rules/linux64Gcc/general                     |    6 +-
 wmake/rules/linux64Gcc/mplibHPMPI                  |    4 +-
 wmake/rules/linux64Gcc/mplibINTELMPI               |    4 +-
 wmake/rules/linux64Gcc43/c                         |   16 -
 wmake/rules/linux64Gcc43/c++                       |   21 -
 wmake/rules/linux64Gcc43/c++Debug                  |    2 -
 wmake/rules/linux64Gcc43/c++Opt                    |    4 -
 wmake/rules/linux64Gcc43/cDebug                    |    2 -
 wmake/rules/linux64Gcc43/cOpt                      |    2 -
 wmake/rules/linux64Gcc44/c++                       |   21 -
 wmake/rules/linux64Gcc44/c++Debug                  |    2 -
 wmake/rules/linux64Gcc44/c++Opt                    |    4 -
 wmake/rules/linux64Gcc44/c++Prof                   |    2 -
 wmake/rules/linux64Gcc44/cDebug                    |    2 -
 wmake/rules/linux64Gcc44/cOpt                      |    2 -
 wmake/rules/linux64Gcc44/cProf                     |    2 -
 wmake/rules/linux64Gcc44/mplibINTELMPI             |    3 -
 wmake/rules/linux64Gcc45/c                         |   16 -
 wmake/rules/linux64Gcc45/c++                       |   21 -
 wmake/rules/linux64Gcc45/c++Debug                  |    2 -
 wmake/rules/linux64Gcc45/c++Opt                    |    4 -
 wmake/rules/linux64Gcc45/c++Prof                   |    2 -
 wmake/rules/linux64Gcc45/cDebug                    |    2 -
 wmake/rules/linux64Gcc45/cOpt                      |    2 -
 wmake/rules/linux64Gcc45/cProf                     |    2 -
 wmake/rules/linux64Gcc45/general                   |    8 -
 wmake/rules/linux64Gcc45/mplibINTELMPI             |    3 -
 wmake/rules/linux64Gcc46/c                         |   16 -
 wmake/rules/linux64Gcc46/c++                       |   21 -
 wmake/rules/linux64Gcc46/c++Debug                  |    2 -
 wmake/rules/linux64Gcc46/c++Opt                    |    4 -
 wmake/rules/linux64Gcc46/c++Prof                   |    2 -
 wmake/rules/linux64Gcc46/cDebug                    |    2 -
 wmake/rules/linux64Gcc46/cOpt                      |    2 -
 wmake/rules/linux64Gcc46/cProf                     |    2 -
 wmake/rules/linux64Gcc46/general                   |    8 -
 wmake/rules/linux64Gcc46/mplibHPMPI                |    3 -
 wmake/rules/linux64Gcc46/mplibINTELMPI             |    3 -
 wmake/rules/linux64Gcc47/c                         |   16 -
 wmake/rules/linux64Gcc47/c++Debug                  |    2 -
 wmake/rules/linux64Gcc47/c++Opt                    |    2 -
 wmake/rules/linux64Gcc47/c++Prof                   |    2 -
 wmake/rules/linux64Gcc47/cDebug                    |    2 -
 wmake/rules/linux64Gcc47/cOpt                      |    2 -
 wmake/rules/linux64Gcc47/cProf                     |    2 -
 wmake/rules/linux64Gcc47/general                   |    8 -
 wmake/rules/linux64Gcc47/mplibHPMPI                |    3 -
 wmake/rules/linux64Gcc47/mplibINTELMPI             |    3 -
 wmake/rules/{linux64Gcc44 => linux64GccKNL}/c      |    8 +-
 wmake/rules/linux64GccKNL/c++                      |   24 +
 .../{SiCortex64Gcc => linux64GccKNL}/c++Debug      |    0
 wmake/rules/linux64GccKNL/c++Opt                   |    4 +
 .../rules/{SiCortex64Gcc => linux64GccKNL}/c++Prof |    0
 .../rules/{SiCortex64Gcc => linux64GccKNL}/cDebug  |    0
 wmake/rules/{SiCortex64Gcc => linux64GccKNL}/cOpt  |    0
 wmake/rules/{SiCortex64Gcc => linux64GccKNL}/cProf |    0
 .../rules/{linux64Gcc43 => linux64GccKNL}/general  |    4 +-
 .../{linux64Gcc45 => linux64GccKNL}/mplibHPMPI     |    2 +-
 .../mplibINTELMPI                                  |    2 +-
 wmake/rules/linux64Icc/c                           |    6 +-
 wmake/rules/linux64Icc/c++                         |   14 +-
 wmake/rules/linux64Icc/c++Opt                      |    2 +-
 wmake/rules/linux64Icc/cOpt                        |    2 +-
 wmake/rules/linux64Icc/general                     |    4 +-
 wmake/rules/linux64Icc/mplibHPMPI                  |    2 +-
 wmake/rules/linux64Icc/mplibINTELMPI               |    2 +-
 wmake/rules/linux64IccKNL/c                        |   16 +
 wmake/rules/linux64IccKNL/c++                      |   25 +
 wmake/rules/linux64IccKNL/c++Debug                 |    2 +
 wmake/rules/linux64IccKNL/c++Opt                   |    2 +
 wmake/rules/{SunOS64Gcc => linux64IccKNL}/c++Prof  |    0
 wmake/rules/linux64IccKNL/cDebug                   |    2 +
 wmake/rules/linux64IccKNL/cOpt                     |    2 +
 wmake/rules/{SunOS64Gcc => linux64IccKNL}/cProf    |    0
 wmake/rules/linux64IccKNL/general                  |    8 +
 .../{linux64Gcc44 => linux64IccKNL}/mplibHPMPI     |    2 +-
 .../{linux64Gcc43 => linux64IccKNL}/mplibINTELMPI  |    2 +-
 wmake/rules/linuxARM7Gcc/c                         |    6 +-
 wmake/rules/linuxARM7Gcc/c++                       |   13 +-
 wmake/rules/linuxARM7Gcc/c++Opt                    |    2 +
 wmake/rules/linuxARM7Gcc/general                   |    4 +-
 wmake/rules/linuxARM7Gcc/mplibHPMPI                |    2 +-
 wmake/rules/linuxClang/c                           |    6 +-
 wmake/rules/linuxClang/c++                         |   14 +-
 wmake/rules/linuxClang/general                     |    4 +-
 wmake/rules/linuxClang/mplibHPMPI                  |    2 +-
 wmake/rules/linuxGcc/c                             |    6 +-
 wmake/rules/linuxGcc/c++                           |   13 +-
 wmake/rules/linuxGcc/c++Opt                        |    2 +
 wmake/rules/linuxGcc/general                       |    4 +-
 wmake/rules/linuxGcc/mplibHPMPI                    |    2 +-
 wmake/rules/linuxGcc43/c                           |   16 -
 wmake/rules/linuxGcc43/c++                         |   21 -
 wmake/rules/linuxGcc43/c++Debug                    |    2 -
 wmake/rules/linuxGcc43/c++Opt                      |    2 -
 wmake/rules/linuxGcc43/c++Prof                     |    2 -
 wmake/rules/linuxGcc43/cDebug                      |    2 -
 wmake/rules/linuxGcc43/cOpt                        |    2 -
 wmake/rules/linuxGcc43/cProf                       |    2 -
 wmake/rules/linuxGcc43/general                     |    9 -
 wmake/rules/linuxGcc43/mplibHPMPI                  |    3 -
 wmake/rules/linuxGcc44/c                           |   16 -
 wmake/rules/linuxGcc44/c++                         |   21 -
 wmake/rules/linuxGcc44/c++Debug                    |    2 -
 wmake/rules/linuxGcc44/c++Opt                      |    2 -
 wmake/rules/linuxGcc44/c++Prof                     |    2 -
 wmake/rules/linuxGcc44/cDebug                      |    2 -
 wmake/rules/linuxGcc44/cOpt                        |    2 -
 wmake/rules/linuxGcc44/cProf                       |    2 -
 wmake/rules/linuxGcc44/general                     |    9 -
 wmake/rules/linuxGcc44/mplibHPMPI                  |    3 -
 wmake/rules/linuxGcc45/c                           |   16 -
 wmake/rules/linuxGcc45/c++                         |   21 -
 wmake/rules/linuxGcc45/c++Debug                    |    2 -
 wmake/rules/linuxGcc45/c++Opt                      |    2 -
 wmake/rules/linuxGcc45/c++Prof                     |    2 -
 wmake/rules/linuxGcc45/cDebug                      |    2 -
 wmake/rules/linuxGcc45/cOpt                        |    2 -
 wmake/rules/linuxGcc45/cProf                       |    2 -
 wmake/rules/linuxGcc45/general                     |    9 -
 wmake/rules/linuxGcc45/mplibHPMPI                  |    3 -
 wmake/rules/linuxGcc46/c                           |   16 -
 wmake/rules/linuxGcc46/c++                         |   21 -
 wmake/rules/linuxGcc46/c++Debug                    |    2 -
 wmake/rules/linuxGcc46/c++Opt                      |    2 -
 wmake/rules/linuxGcc46/c++Prof                     |    2 -
 wmake/rules/linuxGcc46/cDebug                      |    2 -
 wmake/rules/linuxGcc46/cOpt                        |    2 -
 wmake/rules/linuxGcc46/cProf                       |    2 -
 wmake/rules/linuxGcc46/general                     |    9 -
 wmake/rules/linuxGcc46/mplibHPMPI                  |    3 -
 wmake/rules/linuxGcc47/c                           |   16 -
 wmake/rules/linuxGcc47/c++                         |   21 -
 wmake/rules/linuxGcc47/c++Debug                    |    2 -
 wmake/rules/linuxGcc47/c++Opt                      |    2 -
 wmake/rules/linuxGcc47/c++Prof                     |    2 -
 wmake/rules/linuxGcc47/cDebug                      |    2 -
 wmake/rules/linuxGcc47/cOpt                        |    2 -
 wmake/rules/linuxGcc47/cProf                       |    2 -
 wmake/rules/linuxGcc47/general                     |    9 -
 wmake/rules/linuxGcc47/mplibHPMPI                  |    3 -
 wmake/rules/linuxIA64Gcc/c                         |    6 +-
 wmake/rules/linuxIA64Gcc/c++                       |   13 +-
 wmake/rules/linuxIA64Gcc/general                   |    6 +-
 wmake/rules/linuxIA64Gcc/mplibHPMPI                |    2 +-
 wmake/rules/linuxIA64Icc/c                         |    6 +-
 wmake/rules/linuxIA64Icc/c++                       |   14 +-
 wmake/rules/linuxIA64Icc/general                   |    6 +-
 wmake/rules/linuxIA64Icc/mplibHPMPI                |    2 +-
 wmake/rules/linuxIA64Icc/mplibINTELMPI             |    2 +-
 wmake/rules/linuxIcc/c                             |    6 +-
 wmake/rules/linuxIcc/c++                           |   16 +-
 wmake/rules/linuxIcc/c++Opt                        |    2 +-
 wmake/rules/linuxIcc/cOpt                          |    2 +-
 wmake/rules/linuxIcc/general                       |    4 +-
 wmake/rules/linuxIcc/mplibHPMPI                    |    2 +-
 wmake/rules/linuxPPC64Gcc/c                        |    6 +-
 wmake/rules/linuxPPC64Gcc/c++                      |   13 +-
 wmake/rules/linuxPPC64Gcc/c++Opt                   |    2 +
 wmake/rules/linuxPPC64Gcc/general                  |    6 +-
 wmake/rules/linuxPPC64Gcc/mplibHPMPI               |    2 +-
 wmake/rules/{SiCortex64Gcc => linuxPPC64leGcc}/X   |    0
 wmake/rules/{SunOS64Gcc => linuxPPC64leGcc}/c      |    8 +-
 wmake/rules/{linux64Gcc47 => linuxPPC64leGcc}/c++  |   13 +-
 .../rules/{SunOS64Gcc => linuxPPC64leGcc}/c++Debug |    0
 wmake/rules/linuxPPC64leGcc/c++Opt                 |    4 +
 .../{linux64Gcc++0x => linuxPPC64leGcc}/c++Prof    |    0
 wmake/rules/{SunOS64Gcc => linuxPPC64leGcc}/cDebug |    0
 wmake/rules/{SunOS64Gcc => linuxPPC64leGcc}/cOpt   |    0
 .../{linux64Gcc++0x => linuxPPC64leGcc}/cProf      |    0
 .../{linux64Gcc44 => linuxPPC64leGcc}/general      |    6 +-
 .../{linux64Gcc43 => linuxPPC64leGcc}/mplibHPMPI   |    2 +-
 wmake/rules/{SunOS64Gcc => solaris64Gcc}/X         |    0
 wmake/rules/{linux64Gcc++0x => solaris64Gcc}/c     |    6 +-
 wmake/rules/{linux64Gcc++0x => solaris64Gcc}/c++   |   13 +-
 .../{linux64Gcc++0x => solaris64Gcc}/c++Debug      |    0
 wmake/rules/solaris64Gcc/c++Opt                    |    4 +
 wmake/rules/{linux64Gcc43 => solaris64Gcc}/c++Prof |    0
 .../rules/{linux64Gcc++0x => solaris64Gcc}/cDebug  |    0
 wmake/rules/{linux64Gcc++0x => solaris64Gcc}/cOpt  |    0
 wmake/rules/{linux64Gcc43 => solaris64Gcc}/cProf   |    0
 wmake/rules/{SunOS64Gcc => solaris64Gcc}/general   |    6 +-
 .../rules/{SunOS64Gcc => solaris64Gcc}/mplibFJMPI  |    2 +-
 wmake/rules/solarisGcc/c                           |    6 +-
 wmake/rules/solarisGcc/c++                         |   13 +-
 wmake/rules/solarisGcc/c++Opt                      |    6 +-
 wmake/rules/solarisGcc/general                     |    6 +-
 wmake/rules/solarisGcc/mplibMPI                    |    2 +-
 wmake/rules/solarisGcc/mplibMPICH                  |    2 +-
 wmake/scripts/AllwmakeParseArguments               |  184 ++++
 wmake/scripts/addCompile                           |   64 --
 wmake/scripts/makeDerivedFiles                     |  133 ---
 wmake/scripts/makeDir                              |   40 -
 wmake/scripts/makeFiles                            |    4 +-
 wmake/scripts/wmakeFunctions                       |  113 +++
 wmake/src/Makefile                                 |   43 +-
 wmake/src/makeParserCode                           |   54 --
 wmake/src/wmkdep.l                                 |  197 ++--
 wmake/src/wmkdepend.cpp                            |  176 ----
 wmake/src/wmkdependParser.atg                      |  366 -------
 wmake/src/wmkdependParser.cpp                      |  575 -----------
 wmake/src/wmkdependParser.h                        |  176 ----
 wmake/src/wmkdependScanner.cpp                     | 1021 --------------------
 wmake/src/wmkdependScanner.h                       |  476 ---------
 wmake/wclean                                       |  180 +++-
 wmake/wcleanAll                                    |   80 --
 wmake/wcleanLnIncludeAll                           |   30 +-
 wmake/wcleanMachine                                |   80 --
 wmake/wcleanPlatform                               |  127 +++
 wmake/wdep                                         |  118 +++
 wmake/wmake                                        |  299 ++++--
 wmake/wmakeCheckPwd                                |   49 +-
 wmake/wmakeFilesAndOptions                         |   33 +-
 wmake/wmakeFindEmptyMake                           |   87 --
 wmake/wmakeLnInclude                               |   80 +-
 wmake/wmakeLnIncludeAll                            |   38 +-
 wmake/wmakePrintBuild                              |   82 +-
 wmake/wmakeScheduler                               |   71 +-
 wmake/wmakeSchedulerUptime                         |   70 +-
 wmake/wrmdep                                       |  230 +++++
 wmake/wrmo                                         |  116 +++
 492 files changed, 3662 insertions(+), 5539 deletions(-)

diff --git a/.gitignore b/.gitignore
index 7c8bce03..039c3703 100644
--- a/.gitignore
+++ b/.gitignore
@@ -42,6 +42,7 @@ linuxming*/
 SiCortex*Gcc*/
 solaris*Gcc*/
 SunOS*Gcc*/
+darwin*Clang*/
 platforms/
 
 # reinstate wmake/rules that might look like build folders
diff --git a/Allwmake b/Allwmake
index 16edfd1f..0f3e419d 100755
--- a/Allwmake
+++ b/Allwmake
@@ -2,17 +2,19 @@
 cd ${0%/*} || exit 1    # run from this directory
 
 wmakeCheckPwd "$WM_PROJECT_DIR" || {
-    echo "Error: Current directory is not \$WM_PROJECT_DIR"
-    echo "    The environment variables are inconsistent with the installation."
-    echo "    Check the OpenFOAM entries in your dot-files and source them."
-    exit 1
+	echo "Error: Current directory is not \$WM_PROJECT_DIR"
+	echo "    The environment variables are inconsistent with the installation."
+	echo "    Check the OpenFOAM entries in your dot-files and source them."
+	exit 1
 }
 
-[ -n "$FOAM_EXT_LIBBIN" ] || {
-    echo "Error: FOAM_EXT_LIBBIN not set"
-    echo "    Check the OpenFOAM entries in your dot-files and source them."
-    exit 1
-}
+if [ "$(uname -s)" != "Darwin" ]; then
+	[ -n "$FOAM_EXT_LIBBIN" ] || {
+		echo "Error: FOAM_EXT_LIBBIN not set"
+		echo "    Check the OpenFOAM entries in your dot-files and source them."
+		exit 1
+	}
+fi
 
 # wmake is required for subsequent targets
 ( cd wmake/src && make )
@@ -20,9 +22,10 @@ wmakeCheckPwd "$WM_PROJECT_DIR" || {
 # build ThirdParty sources
 if [ -d "$WM_THIRD_PARTY_DIR" ]
 then
-    $WM_THIRD_PARTY_DIR/Allwmake
+	$WM_THIRD_PARTY_DIR/Allwmake
 else
-    echo "no ThirdParty sources found - skipping"
+	[ "$(uname -s)" != "Darwin" ] \
+		&& echo "no ThirdParty sources found - skipping"
 fi
 
 # build OpenFOAM libraries and applications
@@ -31,7 +34,7 @@ applications/Allwmake
 
 if [ "$1" = doc ]
 then
-    doc/Allwmake
+	doc/Allwmake
 fi
 
 # ----------------------------------------------------------------- end-of-file
diff --git a/applications/Allwmake b/applications/Allwmake
index 00bc3266..112e2a3d 100755
--- a/applications/Allwmake
+++ b/applications/Allwmake
@@ -8,13 +8,15 @@ wmakeCheckPwd "$WM_PROJECT_DIR/applications" || {
     exit 1
 }
 
-[ -n "$FOAM_EXT_LIBBIN" ] || {
-    echo "Error: FOAM_EXT_LIBBIN not set"
-    echo "    Check the OpenFOAM entries in your dot-files and source them."
-    exit 1
-}
+if [ "$(uname -s)" != "Darwin" ]; then
+	[ -n "$FOAM_EXT_LIBBIN" ] || {
+		echo "Error: FOAM_EXT_LIBBIN not set"
+		echo "    Check the OpenFOAM entries in your dot-files and source them."
+		exit 1
+	}
+fi
 
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake all utilities
 wmake all solvers
diff --git a/applications/solvers/combustion/reactingFoam/Allwmake b/applications/solvers/combustion/reactingFoam/Allwmake
index 0512e534..6346914d 100755
--- a/applications/solvers/combustion/reactingFoam/Allwmake
+++ b/applications/solvers/combustion/reactingFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake rhoReactingFoam
diff --git a/applications/solvers/compressible/rhoCentralFoam/Allwclean b/applications/solvers/compressible/rhoCentralFoam/Allwclean
index cc5398c0..83011c5e 100755
--- a/applications/solvers/compressible/rhoCentralFoam/Allwclean
+++ b/applications/solvers/compressible/rhoCentralFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso BCs
 wclean
diff --git a/applications/solvers/compressible/rhoCentralFoam/Allwmake b/applications/solvers/compressible/rhoCentralFoam/Allwmake
index 33e08e10..eae5225a 100755
--- a/applications/solvers/compressible/rhoCentralFoam/Allwmake
+++ b/applications/solvers/compressible/rhoCentralFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 (wmake libso BCs && wmake && wmake rhoCentralDyMFoam)
 
diff --git a/applications/solvers/compressible/rhoPimpleFoam/Allwmake b/applications/solvers/compressible/rhoPimpleFoam/Allwmake
index 1b272c17..967f701a 100755
--- a/applications/solvers/compressible/rhoPimpleFoam/Allwmake
+++ b/applications/solvers/compressible/rhoPimpleFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake rhoPimplecFoam
diff --git a/applications/solvers/compressible/rhoSimpleFoam/Allwclean b/applications/solvers/compressible/rhoSimpleFoam/Allwclean
index a1fd479e..a12d86a2 100755
--- a/applications/solvers/compressible/rhoSimpleFoam/Allwclean
+++ b/applications/solvers/compressible/rhoSimpleFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean
 wclean rhoPorousSimpleFoam
diff --git a/applications/solvers/compressible/rhoSimpleFoam/Allwmake b/applications/solvers/compressible/rhoSimpleFoam/Allwmake
index dc0fd648..39a2e0e9 100755
--- a/applications/solvers/compressible/rhoSimpleFoam/Allwmake
+++ b/applications/solvers/compressible/rhoSimpleFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake rhoPorousSimpleFoam
diff --git a/applications/solvers/compressible/sonicFoam/Allwmake b/applications/solvers/compressible/sonicFoam/Allwmake
index 27c1194e..84ffc478 100755
--- a/applications/solvers/compressible/sonicFoam/Allwmake
+++ b/applications/solvers/compressible/sonicFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake sonicDyMFoam
diff --git a/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwclean b/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwclean
index c583a8de..411f1c2b 100755
--- a/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwclean
+++ b/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean
 wclean chtMultiRegionSimpleFoam
diff --git a/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwmake b/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwmake
index f65ba118..e929be82 100755
--- a/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwmake
+++ b/applications/solvers/heatTransfer/chtMultiRegionFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake chtMultiRegionSimpleFoam
diff --git a/applications/solvers/incompressible/pimpleFoam/Allwmake b/applications/solvers/incompressible/pimpleFoam/Allwmake
index 8727bdb2..15edf19c 100755
--- a/applications/solvers/incompressible/pimpleFoam/Allwmake
+++ b/applications/solvers/incompressible/pimpleFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake SRFPimpleFoam
diff --git a/applications/solvers/incompressible/simpleFoam/Allwmake b/applications/solvers/incompressible/simpleFoam/Allwmake
index 801fd3b7..6d19cb31 100755
--- a/applications/solvers/incompressible/simpleFoam/Allwmake
+++ b/applications/solvers/incompressible/simpleFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 
diff --git a/applications/solvers/lagrangian/DPMFoam/Allwclean b/applications/solvers/lagrangian/DPMFoam/Allwclean
index ed697d99..684c898b 100755
--- a/applications/solvers/lagrangian/DPMFoam/Allwclean
+++ b/applications/solvers/lagrangian/DPMFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean dragModels
 wclean
diff --git a/applications/solvers/lagrangian/DPMFoam/Allwmake b/applications/solvers/lagrangian/DPMFoam/Allwmake
index 17722925..55121e54 100755
--- a/applications/solvers/lagrangian/DPMFoam/Allwmake
+++ b/applications/solvers/lagrangian/DPMFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake dragModels
 wmake
diff --git a/applications/solvers/lagrangian/icoUncoupledKinematicParcelFoam/Allwmake b/applications/solvers/lagrangian/icoUncoupledKinematicParcelFoam/Allwmake
index 845cebd7..69d13764 100755
--- a/applications/solvers/lagrangian/icoUncoupledKinematicParcelFoam/Allwmake
+++ b/applications/solvers/lagrangian/icoUncoupledKinematicParcelFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake icoUncoupledKinematicParcelDyMFoam
diff --git a/applications/solvers/lagrangian/reactingParcelFoam/Allwmake b/applications/solvers/lagrangian/reactingParcelFoam/Allwmake
index f615df21..b24f69b7 100755
--- a/applications/solvers/lagrangian/reactingParcelFoam/Allwmake
+++ b/applications/solvers/lagrangian/reactingParcelFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake simpleReactingParcelFoam
diff --git a/applications/solvers/lagrangian/sprayFoam/Allwmake b/applications/solvers/lagrangian/sprayFoam/Allwmake
index 542509db..b62792e4 100755
--- a/applications/solvers/lagrangian/sprayFoam/Allwmake
+++ b/applications/solvers/lagrangian/sprayFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 
diff --git a/applications/solvers/multiphase/cavitatingFoam/Allwclean b/applications/solvers/multiphase/cavitatingFoam/Allwclean
index 62548246..a06cc1f0 100755
--- a/applications/solvers/multiphase/cavitatingFoam/Allwclean
+++ b/applications/solvers/multiphase/cavitatingFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean
 wclean cavitatingDyMFoam
diff --git a/applications/solvers/multiphase/cavitatingFoam/Allwmake b/applications/solvers/multiphase/cavitatingFoam/Allwmake
index 211c1978..2d4eaa83 100755
--- a/applications/solvers/multiphase/cavitatingFoam/Allwmake
+++ b/applications/solvers/multiphase/cavitatingFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake cavitatingDyMFoam
diff --git a/applications/solvers/multiphase/compressibleInterFoam/Allwclean b/applications/solvers/multiphase/compressibleInterFoam/Allwclean
index aa0f3c01..2ce4befb 100755
--- a/applications/solvers/multiphase/compressibleInterFoam/Allwclean
+++ b/applications/solvers/multiphase/compressibleInterFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso twoPhaseMixtureThermo
 wclean
diff --git a/applications/solvers/multiphase/compressibleInterFoam/Allwmake b/applications/solvers/multiphase/compressibleInterFoam/Allwmake
index a93da26c..7a20e329 100755
--- a/applications/solvers/multiphase/compressibleInterFoam/Allwmake
+++ b/applications/solvers/multiphase/compressibleInterFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso twoPhaseMixtureThermo
 wmake
diff --git a/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwclean b/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwclean
index cc138bc0..42d8d983 100755
--- a/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwclean
+++ b/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso phaseModel
 wclean libso interfacialModels
diff --git a/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwmake b/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwmake
index 29294d16..aca0b8d7 100755
--- a/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwmake
+++ b/applications/solvers/multiphase/compressibleTwoPhaseEulerFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso phaseModel
 wmake libso interfacialModels
diff --git a/applications/solvers/multiphase/interFoam/Allwclean b/applications/solvers/multiphase/interFoam/Allwclean
index 8b080006..39e9c740 100755
--- a/applications/solvers/multiphase/interFoam/Allwclean
+++ b/applications/solvers/multiphase/interFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean
 wclean interDyMFoam
diff --git a/applications/solvers/multiphase/interFoam/Allwmake b/applications/solvers/multiphase/interFoam/Allwmake
index cc883614..a0b8cea1 100755
--- a/applications/solvers/multiphase/interFoam/Allwmake
+++ b/applications/solvers/multiphase/interFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake
 wmake interDyMFoam
diff --git a/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.C b/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.C
index 4d8ead85..6c7cd896 100644
--- a/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.C
+++ b/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.C
@@ -92,7 +92,7 @@ Foam::threePhaseMixture::threePhaseMixture
     rho3_(nuModel3_->viscosityProperties().lookup("rho")),
 
     U_(U),
-    phi_(phi),
+    // phi_(phi),
 
     alpha1_(U_.db().lookupObject<const volScalarField> ("alpha1")),
     alpha2_(U_.db().lookupObject<const volScalarField> ("alpha2")),
diff --git a/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.H b/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.H
index 67743ad2..e72c0e17 100644
--- a/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.H
+++ b/applications/solvers/multiphase/interFoam/interMixingFoam/incompressibleThreePhaseMixture/threePhaseMixture.H
@@ -67,7 +67,7 @@ class threePhaseMixture
         dimensionedScalar rho3_;
 
         const volVectorField& U_;
-        const surfaceScalarField& phi_;
+        // const surfaceScalarField& phi_;
 
         const volScalarField& alpha1_;
         const volScalarField& alpha2_;
diff --git a/applications/solvers/multiphase/interPhaseChangeFoam/Allwclean b/applications/solvers/multiphase/interPhaseChangeFoam/Allwclean
index 99c52e59..e17cd5aa 100755
--- a/applications/solvers/multiphase/interPhaseChangeFoam/Allwclean
+++ b/applications/solvers/multiphase/interPhaseChangeFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso phaseChangeTwoPhaseMixtures
 wclean
diff --git a/applications/solvers/multiphase/interPhaseChangeFoam/Allwmake b/applications/solvers/multiphase/interPhaseChangeFoam/Allwmake
index 414ed904..6c35a136 100755
--- a/applications/solvers/multiphase/interPhaseChangeFoam/Allwmake
+++ b/applications/solvers/multiphase/interPhaseChangeFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso phaseChangeTwoPhaseMixtures
 wmake
diff --git a/applications/solvers/multiphase/multiphaseEulerFoam/Allwclean b/applications/solvers/multiphase/multiphaseEulerFoam/Allwclean
index a1a5b83b..79f4af9e 100755
--- a/applications/solvers/multiphase/multiphaseEulerFoam/Allwclean
+++ b/applications/solvers/multiphase/multiphaseEulerFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso phaseModel
 wclean libso multiphaseSystem
diff --git a/applications/solvers/multiphase/multiphaseEulerFoam/Allwmake b/applications/solvers/multiphase/multiphaseEulerFoam/Allwmake
index 4ab7ebbf..12d6884a 100755
--- a/applications/solvers/multiphase/multiphaseEulerFoam/Allwmake
+++ b/applications/solvers/multiphase/multiphaseEulerFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso phaseModel
 wmake libso interfacialModels
diff --git a/applications/solvers/multiphase/multiphaseInterFoam/Allwclean b/applications/solvers/multiphase/multiphaseInterFoam/Allwclean
index 6f55580c..2b7313d3 100755
--- a/applications/solvers/multiphase/multiphaseInterFoam/Allwclean
+++ b/applications/solvers/multiphase/multiphaseInterFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean
 wclean MRFMultiphaseInterFoam
diff --git a/applications/solvers/multiphase/multiphaseInterFoam/Allwmake b/applications/solvers/multiphase/multiphaseInterFoam/Allwmake
index 6e47f91d..9b0ba460 100755
--- a/applications/solvers/multiphase/multiphaseInterFoam/Allwmake
+++ b/applications/solvers/multiphase/multiphaseInterFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso multiphaseMixture
 wmake
diff --git a/applications/solvers/multiphase/twoPhaseEulerFoam/Allwclean b/applications/solvers/multiphase/twoPhaseEulerFoam/Allwclean
index cc138bc0..42d8d983 100755
--- a/applications/solvers/multiphase/twoPhaseEulerFoam/Allwclean
+++ b/applications/solvers/multiphase/twoPhaseEulerFoam/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso phaseModel
 wclean libso interfacialModels
diff --git a/applications/solvers/multiphase/twoPhaseEulerFoam/Allwmake b/applications/solvers/multiphase/twoPhaseEulerFoam/Allwmake
index 29294d16..aca0b8d7 100755
--- a/applications/solvers/multiphase/twoPhaseEulerFoam/Allwmake
+++ b/applications/solvers/multiphase/twoPhaseEulerFoam/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso phaseModel
 wmake libso interfacialModels
diff --git a/applications/utilities/mesh/conversion/Optional/Allwmake b/applications/utilities/mesh/conversion/Optional/Allwmake
index 25800377..1afa0291 100755
--- a/applications/utilities/mesh/conversion/Optional/Allwmake
+++ b/applications/utilities/mesh/conversion/Optional/Allwmake
@@ -3,7 +3,7 @@
 # Build optional components (eg, may depend on third-party libraries)
 # -----------------------------------------------------------------------------
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 # build libccmio and create lnInclude directory
 $WM_THIRD_PARTY_DIR/AllwmakeLibccmio
diff --git a/applications/utilities/mesh/conversion/kivaToFoam/readKivaGrid.H b/applications/utilities/mesh/conversion/kivaToFoam/readKivaGrid.H
index 1a559559..075f2135 100644
--- a/applications/utilities/mesh/conversion/kivaToFoam/readKivaGrid.H
+++ b/applications/utilities/mesh/conversion/kivaToFoam/readKivaGrid.H
@@ -426,7 +426,7 @@ if (pFaces[WEDGE].size() && pFaces[WEDGE][0].size())
         for
         (
             ;
-            iterf != pFaces[WEDGE][0].end(), iterb != pFaces[WEDGE][1].end();
+            iterb != pFaces[WEDGE][1].end();
             ++iterf, ++iterb
         )
         {
diff --git a/applications/utilities/mesh/generation/Allwmake b/applications/utilities/mesh/generation/Allwmake
index d557fa34..fabc2db9 100755
--- a/applications/utilities/mesh/generation/Allwmake
+++ b/applications/utilities/mesh/generation/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake blockMesh
 wmake all extrude
diff --git a/applications/utilities/mesh/generation/extrude/Allwclean b/applications/utilities/mesh/generation/extrude/Allwclean
index 253b4b4d..b4ece2d7 100755
--- a/applications/utilities/mesh/generation/extrude/Allwclean
+++ b/applications/utilities/mesh/generation/extrude/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean extrudeMesh
 wclean extrudeToRegionMesh
diff --git a/applications/utilities/mesh/generation/extrude/Allwmake b/applications/utilities/mesh/generation/extrude/Allwmake
index 3fd3d231..1b22d901 100755
--- a/applications/utilities/mesh/generation/extrude/Allwmake
+++ b/applications/utilities/mesh/generation/extrude/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake extrudeMesh
 wmake extrudeToRegionMesh
diff --git a/applications/utilities/mesh/generation/extrude2DMesh/Allwclean b/applications/utilities/mesh/generation/extrude2DMesh/Allwclean
index 44537ed6..75594be1 100755
--- a/applications/utilities/mesh/generation/extrude2DMesh/Allwclean
+++ b/applications/utilities/mesh/generation/extrude2DMesh/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso extrude2DMesh
 wclean
diff --git a/applications/utilities/mesh/generation/extrude2DMesh/Allwmake b/applications/utilities/mesh/generation/extrude2DMesh/Allwmake
index 6f54612f..d731c1e2 100755
--- a/applications/utilities/mesh/generation/extrude2DMesh/Allwmake
+++ b/applications/utilities/mesh/generation/extrude2DMesh/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso extrude2DMesh
 wmake
diff --git a/applications/utilities/mesh/generation/snappyHexMesh/Make/options b/applications/utilities/mesh/generation/snappyHexMesh/Make/options
index af056ec7..77451ed0 100644
--- a/applications/utilities/mesh/generation/snappyHexMesh/Make/options
+++ b/applications/utilities/mesh/generation/snappyHexMesh/Make/options
@@ -1,5 +1,4 @@
 EXE_INC = \
-    /* -g -DFULLDEBUG -O0 */ \
     -I$(LIB_SRC)/parallel/decompose/decompositionMethods/lnInclude \
     -I$(LIB_SRC)/mesh/autoMesh/lnInclude \
     -I$(LIB_SRC)/meshTools/lnInclude \
diff --git a/applications/utilities/mesh/manipulation/renumberMesh/Allwmake b/applications/utilities/mesh/manipulation/renumberMesh/Allwmake
index 25091457..7af63875 100755
--- a/applications/utilities/mesh/manipulation/renumberMesh/Allwmake
+++ b/applications/utilities/mesh/manipulation/renumberMesh/Allwmake
@@ -4,15 +4,18 @@ cd ${0%/*} || exit 1    # run from this directory
 export COMPILE_FLAGS=''
 export LINK_FLAGS=''
 
-if [ -f "${FOAM_LIBBIN}/libSloanRenumber.so" ]
+DYLIB_EXT="so"
+[ "$(uname -s)" == "Darwin" ] && DYLIB_EXT="dylib"
+
+if [ -f "${FOAM_LIBBIN}/libSloanRenumber.$DYLIB_EXT" ]
 then
-    echo "Found libSloanRenumber.so  --  enabling Sloan renumbering support."
+	echo "Found libSloanRenumber.$DYLIB_EXT  --  enabling Sloan renumbering support."
     export LINK_FLAGS="${LINK_FLAGS} -lSloanRenumber"
 fi
 
-if [ "${ZOLTAN_ARCH_PATH}/lib/libzoltan.a" -a -f "${FOAM_LIBBIN}/libzoltanRenumber.so" ]
+if [ "${ZOLTAN_ARCH_PATH}/lib/libzoltan.a" -a -f "${FOAM_LIBBIN}/libzoltanRenumber.$DYLIB_EXT" ]
 then
-    echo "Found libzoltanRenumber.so  --  enabling zoltan renumbering support."
+    echo "Found libzoltanRenumber.$DYLIB_EXT  --  enabling zoltan renumbering support."
     export COMPILE_FLAGS="-DFOAM_USE_ZOLTAN"
     export LINK_FLAGS="${LINK_FLAGS} -lzoltanRenumber -L${ZOLTAN_ARCH_PATH}/lib -lzoltan"
 fi
diff --git a/applications/utilities/mesh/manipulation/renumberMesh/Make/options b/applications/utilities/mesh/manipulation/renumberMesh/Make/options
index 49a1c3d2..882d1e43 100644
--- a/applications/utilities/mesh/manipulation/renumberMesh/Make/options
+++ b/applications/utilities/mesh/manipulation/renumberMesh/Make/options
@@ -1,5 +1,4 @@
 EXE_INC = \
-    /* -DFULLDEBUG -g -O0 */ \
     ${COMPILE_FLAGS} \
     -I$(LIB_SRC)/meshTools/lnInclude \
     -I$(LIB_SRC)/dynamicMesh/lnInclude \
diff --git a/applications/utilities/miscellaneous/foamDebugSwitches/Make/options b/applications/utilities/miscellaneous/foamDebugSwitches/Make/options
index 43f0c24c..262b4c35 100644
--- a/applications/utilities/miscellaneous/foamDebugSwitches/Make/options
+++ b/applications/utilities/miscellaneous/foamDebugSwitches/Make/options
@@ -42,10 +42,8 @@ EXE_LIBS = \
     -lmeshTools \
     -lmolecularMeasurements \
     -lmolecule \
-/*    -lmultiphaseInterFoam  */ \
     -lODE \
     -lOpenFOAM \
-/*    -lphaseModel  */ \
     -lpotential \
     -lradiationModels \
     -lrandomProcesses \
diff --git a/applications/utilities/postProcessing/dataConversion/foamToEnsight/Make/options b/applications/utilities/postProcessing/dataConversion/foamToEnsight/Make/options
index 77992428..b4382c4d 100644
--- a/applications/utilities/postProcessing/dataConversion/foamToEnsight/Make/options
+++ b/applications/utilities/postProcessing/dataConversion/foamToEnsight/Make/options
@@ -1,5 +1,4 @@
 EXE_INC = \
-    /* -DFULLDEBUG -g -O0 */ \
     -I$(LIB_SRC)/finiteVolume/lnInclude \
     -I$(LIB_SRC)/meshTools/lnInclude \
     -I$(LIB_SRC)/sampling/lnInclude \
diff --git a/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.C b/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.C
index dc37b02d..cffc6cc4 100644
--- a/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.C
+++ b/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.C
@@ -37,7 +37,6 @@ Foam::surfaceMeshWriter::surfaceMeshWriter
     const fileName& fName
 )
 :
-    vMesh_(vMesh),
     binary_(binary),
     pp_(pp),
     fName_(fName),
diff --git a/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.H b/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.H
index 66bfbdb9..651c5280 100644
--- a/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.H
+++ b/applications/utilities/postProcessing/dataConversion/foamToVTK/surfaceMeshWriter.H
@@ -58,7 +58,7 @@ class volPointInterpolation;
 
 class surfaceMeshWriter
 {
-    const vtkMesh& vMesh_;
+    // const vtkMesh& vMesh_;
 
     const bool binary_;
 
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/Allwclean b/applications/utilities/postProcessing/graphics/PV3Readers/Allwclean
index b867e563..d1668b19 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/Allwclean
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean libso vtkPV3Readers
 PV3blockMeshReader/Allwclean
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/Allwmake b/applications/utilities/postProcessing/graphics/PV3Readers/Allwmake
index 1568f8af..450409f9 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/Allwmake
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/Allwmake
@@ -1,6 +1,11 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-#set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
+
+[ "$(uname -s)" = "Darwin" ] && {
+echo "Skipping PV3Readers on OS X"
+exit 0
+}
 
 if [ -d "$ParaView_DIR" -a -r "$ParaView_DIR" ]
 then
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwclean b/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwclean
index c5f41ab9..c6f5b870 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwclean
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 # deal with client/server vs combined plugins
 rm -f $FOAM_LIBBIN/libPV3FoamReader* 2>/dev/null
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwmake b/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwmake
index c99e05fd..6b8e6ede 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwmake
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/PV3FoamReader/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 if [ -d "$ParaView_DIR" -a -r "$ParaView_DIR" ]
 then
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwclean b/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwclean
index d2c85df0..eaf225ca 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwclean
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwclean
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 # deal with client/server vs combined plugins
 rm -f $FOAM_LIBBIN/libPV3blockMeshReader*  2>/dev/null
diff --git a/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwmake b/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwmake
index 4f055b3c..bd68d579 100755
--- a/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwmake
+++ b/applications/utilities/postProcessing/graphics/PV3Readers/PV3blockMeshReader/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 if [ -d "$ParaView_DIR" -a -r "$ParaView_DIR" ]
 then
diff --git a/applications/utilities/preProcessing/wallFunctionTable/Allwmake b/applications/utilities/preProcessing/wallFunctionTable/Allwmake
index 55a6cbd3..b37a733b 100755
--- a/applications/utilities/preProcessing/wallFunctionTable/Allwmake
+++ b/applications/utilities/preProcessing/wallFunctionTable/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libso tabulatedWallFunction
 wmake
diff --git a/applications/utilities/surface/surfaceFeatureExtract/Allwmake b/applications/utilities/surface/surfaceFeatureExtract/Allwmake
index 2b9a927d..1b169428 100755
--- a/applications/utilities/surface/surfaceFeatureExtract/Allwmake
+++ b/applications/utilities/surface/surfaceFeatureExtract/Allwmake
@@ -1,27 +1,48 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
-if [ -n "$CGAL_ARCH_PATH" ]
+if [ -n "$CGAL_ARCH_PATH" -a -d "$EIGEN_ARCH_PATH/include/eigen3" ]
 then
+    [ -n "$WM_SILENT_RULES" ] || {
     echo
     echo "Compiling surfaceFeatureExtract with CGAL curvature support"
     echo
+    }
 
-    wmake "ENABLE_CURVATURE=-DENABLE_CURVATURE \
-           EXE_FROUNDING_MATH=-frounding-math \
-           USE_F2C=-DCGAL_USE_F2C \
-           CGAL_LIBDIR=-L$CGAL_ARCH_PATH/lib \
-           LAPACK_LIB=-llapack \
-           BLAS_LIB=-lblas \
-           CGAL_LIB=-lCGAL \
-           CGAL_BOOST_LIB=-lboost_thread \
-           CGAL_MPFR_LIB=-lmpfr"
+	if [ "$(uname -s)" = "Darwin" ]
+    then
+		WM_FLAGS="ENABLE_CURVATURE=-DENABLE_CURVATURE \
+            EXE_FROUNDING_MATH= \
+			USE_F2C=-DCGAL_USE_F2C \
+			CGAL_LIBDIR=-L$CGAL_ARCH_PATH/lib \
+            EIGEN3_LIBDIR=-L$EIGEN_ARCH_PATH/lib \
+			LAPACK_LIB=-llapack \
+			BLAS_LIB=-lblas \
+			CGAL_LIB=-lCGAL \
+			CGAL_BOOST_LIB=-lboost_thread-mt \
+			CGAL_MPFR_LIB=-lmpfr"
+        [ -d "$CGAL_ARCH_PATH/include/CGAL/Lapack" ] \
+            && WM_FLAGS="$WM_FLAGS -DCGAL_HAS_LAPACK"
+        wmake "$WM_FLAGS"
+	else
+		wmake "ENABLE_CURVATURE=-DENABLE_CURVATURE \
+			EXE_FROUNDING_MATH=-frounding-math \
+			USE_F2C=-DCGAL_USE_F2C \
+			CGAL_LIBDIR=-L$CGAL_ARCH_PATH/lib \
+			LAPACK_LIB=-llapack \
+			BLAS_LIB=-lblas \
+			CGAL_LIB=-lCGAL \
+			CGAL_BOOST_LIB=-lboost_thread \
+			CGAL_MPFR_LIB=-lmpfr"
+	fi
 else
+    [ -n "$WM_SILENT_RULES" ] || {
     echo
     echo "Compiling surfaceFeatureExtract without CGAL curvature support"
     echo
+    }
 
     wmake
 fi
diff --git a/applications/utilities/surface/surfaceFeatureExtract/Make/options b/applications/utilities/surface/surfaceFeatureExtract/Make/options
index 461cec9f..8b635eee 100644
--- a/applications/utilities/surface/surfaceFeatureExtract/Make/options
+++ b/applications/utilities/surface/surfaceFeatureExtract/Make/options
@@ -5,6 +5,7 @@ EXE_INC = \
     ${EXE_FROUNDING_MATH} \
     ${USE_F2C} \
     ${CGAL_INC} \
+    -I$(EIGEN_ARCH_PATH)/include/eigen3 \
     -ICGALPolyhedron \
     -I$(LIB_SRC)/finiteVolume/lnInclude \
     -I$(LIB_SRC)/meshTools/lnInclude \
diff --git a/applications/utilities/surface/surfaceFeatureExtract/surfaceFeatureExtract.C b/applications/utilities/surface/surfaceFeatureExtract/surfaceFeatureExtract.C
index 87350c4c..74d0f584 100644
--- a/applications/utilities/surface/surfaceFeatureExtract/surfaceFeatureExtract.C
+++ b/applications/utilities/surface/surfaceFeatureExtract/surfaceFeatureExtract.C
@@ -48,11 +48,14 @@ Description
 #include "plane.H"
 
 #ifdef ENABLE_CURVATURE
-#include "buildCGALPolyhedron.H"
-#include "CGALPolyhedronRings.H"
-#include <CGAL/Monge_via_jet_fitting.h>
-#include <CGAL/Lapack/Linear_algebra_lapack.h>
-#include <CGAL/property_map.h>
+#   include "buildCGALPolyhedron.H"
+#   include "CGALPolyhedronRings.H"
+#   define CGAL_EIGEN3_ENABLED
+#   include <CGAL/Monge_via_jet_fitting.h>
+#   ifdef CGAL_HAS_LAPACK
+#       include <CGAL/Lapack/Linear_algebra_lapack.h>
+#   endif
+#   include <CGAL/property_map.h>
 #endif
 
 using namespace Foam;
@@ -82,7 +85,8 @@ scalarField calcCurvature(const triSurface& surf)
         Vertex_PM_type;
     typedef T_PolyhedralSurf_rings<Polyhedron, Vertex_PM_type > Poly_rings;
 
-    typedef CGAL::Monge_via_jet_fitting<Kernel>         Monge_via_jet_fitting;
+#   define CGAL_EIGEN3_ENABLED
+    typedef CGAL::Monge_via_jet_fitting<Kernel> Monge_via_jet_fitting;
     typedef Monge_via_jet_fitting::Monge_form           Monge_form;
 
     std::vector<Point_3> in_points;  //container for data points
diff --git a/bin/foamEtcFile b/bin/foamEtcFile
index a0816714..daf64671 100755
--- a/bin/foamEtcFile
+++ b/bin/foamEtcFile
@@ -120,6 +120,9 @@ openfoam[0-9]*)     # debian naming convention 'openfoam<VERSION>'
         ;;
     esac
     ;;
+[0-9][0-9]* | [0-9][0-9]*.[0-9][0-9]*)  # version naming scheme
+    version="$projectDirName"
+    ;;
 
 *)
     echo "Error : unknown/unsupported naming convention"
diff --git a/bin/foamInstallationTest b/bin/foamInstallationTest
index fe72e8ce..9870a35d 100755
--- a/bin/foamInstallationTest
+++ b/bin/foamInstallationTest
@@ -42,8 +42,8 @@ fatalError=0
 criticalError=0
 
 # System variables
-HOST=`uname -n`
-OSTYPE=`uname -s`
+HOST=$(uname -n)
+OSTYPE=$(uname -s)
 USER_NAME=$LOGNAME
 : ${USER_NAME:=$USER}
 
@@ -249,6 +249,9 @@ reportExecutable()
         VERSION=`$1 --version /dev/null 2>&1      \
             | sed -ne 's/flex \([0-9][0-9.]*\).*/\1/p' `
         ;;
+	clang)
+		VERSION=$($1 --version 2>&1 | sed -ne 's/.*clang-\([0-9.]*\)/\1/p')
+		;;
     gcc)
         VERSION=`$1 -v 2>&1 \
             | sed -ne 's/^gcc version \([0-9][0-9.]*\).*/\1/p' `
@@ -264,9 +267,9 @@ reportExecutable()
 
         gccOK=""
         pass=""
-        if [ $V1 -lt $MINV1 ]; then
+        if [ "$V1" -lt "$MINV1" ]; then
             gccOk="ERROR"
-        elif [ $V1 -gt $MINV1 ]; then
+        elif [ "$V1" -gt "$MINV1" ]; then
             pass="yes"
         fi
 
@@ -298,13 +301,23 @@ reportExecutable()
         VERSION=`$APP_PATH --version | head -1`
         ;;
     tar)
-        VERSION=`$APP_PATH --version | head -1 | cut -d" " -f4`
+		case "$OSTYPE" in
+		Darwin)
+			VERSION=$($APP_PATH --version | head -1 | cut -d" " -f2)
+			;;
+		*)
+			VERSION=`$APP_PATH --version | head -1 | cut -d" " -f4`
+			;;
+		esac
         ;;
     gzip)
         case "$OSTYPE" in
         SunOS)
             VERSION=`$1 --version 2>&1 | grep gzip | cut -d" " -f2`
             ;;
+		Darwin)
+			VERSION=$($1 --version 2>&1)
+			;;
         *)
             VERSION=`$1 --version | head -1 | cut -d" " -f2`
             ;;
@@ -332,7 +345,8 @@ reportExecutable()
 
 checkOpenFOAMEnvironment()
 {
-    [ -d "$WM_PROJECT_INST_DIR" ] && [ -d "$WM_THIRD_PARTY_DIR" ] || {
+    [ -d "$WM_PROJECT_INST_DIR" ] \
+		&& [ -d "$WM_THIRD_PARTY_DIR" -o "$(uname -s)" = "Darwin" ] || {
         echo ""
         echo "FATAL ERROR: OpenFOAM environment not configured."
         echo ""
@@ -380,7 +394,7 @@ checkHostName()
 checkOS()
 {
     case "$OSTYPE" in
-    Linux | LinuxAMD64 | SunOS )
+    Linux | LinuxAMD64 | SunOS | Darwin )
         echo "`fixlen OS: $WIDTH` $OSTYPE version $(uname -r)"
         ;;
     *)
@@ -457,9 +471,14 @@ hline
 echo "$COL1 $COL2 $COL3"
 hline
 reportExecutable flex
-reportExecutable gcc
+if [ "$OSTYPE" = "Darwin" ]
+then
+	reportExecutable clang
+else
+	reportExecutable gcc
+fi
 reportExecutable gzip
-if [ "$OSTYPE" = Linux ]
+if [ "$OSTYPE" = Linux -o "$OSTYPE" = "Darwin" ]
 then
     reportExecutable tar
 else
diff --git a/bin/foamJob b/bin/foamJob
index 20793c3d..d0d129df 100755
--- a/bin/foamJob
+++ b/bin/foamJob
@@ -247,6 +247,14 @@ then
     fi
 
 else
+	# Check if we are on El Capitan
+    if test "$(uname -s)" = "Darwin" && \
+        { test "$(uname -r | cut -d. -f1)" -gt "15"; }
+    then
+        # Using foamExec workaround to reexport (DY)LD_LIBRARY_PATH variables
+        APPLICATION="foamExec $APPLICATION"
+    fi
+
     #
     # run (on single processor)
     #
diff --git a/bin/paraFoam b/bin/paraFoam
index d288e3fb..6e46cdd1 100755
--- a/bin/paraFoam
+++ b/bin/paraFoam
@@ -68,9 +68,15 @@ unset regionName optTouch
 export LC_ALL=C
 
 # reader extension
-extension=OpenFOAM
+if [ "$(uname -s)" == "Darwin" ]; then
+	extension=foam
 
-requirePV=1
+	requirePV=0
+else
+	extension=OpenFOAM
+
+	requirePV=1
+fi
 
 # parse options
 while [ "$#" -gt 0 ]
diff --git a/bin/tools/RunFunctions b/bin/tools/RunFunctions
index 3632a62d..bc33826b 100644
--- a/bin/tools/RunFunctions
+++ b/bin/tools/RunFunctions
@@ -28,75 +28,142 @@
 #     Miscellaneous functions for running tutorial cases
 #------------------------------------------------------------------------------
 
+isSIPEnabled()
+{
+    $(which -s csrutil) && {
+    [ $(csrutil status | awk '{print $5}' | tr -d ".") = "enabled" ] \
+        && return 0
+    }
+    return 1
+}
+
+# Workaround for cleared DYLD_LIBRARY_PATH
+[ "$(uname -s)" = "Darwin" ] && isSIPEnabled && . $WM_PROJECT_DIR/etc/bashrc
+
 getNumberOfProcessors()
 {
-    sed -ne 's/^numberOfSubdomains *\(.*\);/\1/p' system/decomposeParDict
+    grep numberOfSubdomains system/decomposeParDict \
+        | awk '{print $2}' \
+        | tr -d ";"
 }
 
 getApplication()
 {
-    sed -ne 's/^ *application *\([a-zA-Z]*\) *;.*$/\1/p' system/controlDict
+    grep application system/controlDict \
+        | awk '{print $2}' \
+        | tr -d ";"
 }
 
 runApplication()
 {
-    APP_RUN=$1
-    APP_NAME=${1##*/}
+    local force=
+    local append=
+
+    local app_run="$1"
+    while [ "$(echo $app_run | cut -c1)" = "-" ]; do
+        case $app_run in
+        -f|--force|-force|-overwrite)
+            force=y
+            ;;
+        -a|--append|-append)
+            append=y
+            ;;
+        esac
+        shift
+        app_run="$1"
+    done
     shift
+    local app_name=${app_run##*/}
+
+    [ -x "$(which $app_run)" ] || {
+    echo "Application $app_run does not exist or is not executable."
+    exit 1
+    }
+
+    [ "$force" = "y" ] && rm -f "log.$app_name"
 
-    if [ -f log.$APP_NAME ]
+    if [ -f "log.$app_name" ]
     then
-        echo "$APP_NAME already run on $PWD: remove log file to re-run"
+        if [ "$append" = "y" ]
+        then
+            echo "Running $app_run on $PWD (appending to log.$app_name)"
+            $app_run "$@" >> "log.$app_name" 2>&1
+        else
+            echo "$app_name already run on $PWD: remove log file to re-run"
+        fi
     else
-        echo "Running $APP_RUN on $PWD"
-        $APP_RUN "$@" > log.$APP_NAME 2>&1
+        echo "Running $app_run on $PWD"
+        $app_run "$@" > "log.$app_name" 2>&1
     fi
 }
 
 runParallel()
 {
-    APP_RUN=$1
-    APP_NAME=${1##*/}
+    local force=
+    local append=
+
+    local app_run="$1"
+    while [ "$(echo $app_run | cut -c1)" = "-" ]; do
+        case $app_run in
+        -f|--force)
+            force=y
+            ;;
+        -a|--append)
+            append=y
+            ;;
+        esac
+        shift
+        app_run="$1"
+    done
+    shift
+    local app_name=${app_run##*/}
+
+    [ -x "$(which $app_run)" ] || {
+    echo "Application $app_run does not exist or is not executable."
+    exit 1
+    }
+
+    [ "$force" = "y" ] && rm -f "log.$app_name"
+
+    local n_procs="$1"
     shift
 
-    if [ -f log.$APP_NAME ]
+    if [ -f "log.$app_name" ]
     then
-        echo "$APP_NAME already run on $PWD: remove log file to re-run"
+        if [ "$append" = "y" ]
+        then
+            echo
+        else
+            echo "$app_name already run on $PWD: remove log file to re-run"
+        fi
     else
-        nProcs=$1
-        shift
-        echo "Running $APP_RUN in parallel on $PWD using $nProcs processes"
-
-        #if [ "$WM_SCHEDULER" ]
-        #then
-        #    echo "$PWD: $WM_SCHEDULER -np $nProcs" 1>&2
-        #    $WM_SCHEDULER -np $nProcs "( mpirun -np $nProcs $APP_RUN -parallel "$@" < /dev/null > log.$APP_NAME 2>&1 )"
-        #else
-            ( mpirun -np $nProcs $APP_RUN -parallel "$@" < /dev/null > log.$APP_NAME 2>&1 )
-        #fi
+        echo "Running $app_run in parallel on $PWD using $n_procs processes"
+
+        ( mpirun -np "$n_procs" $app_run -parallel "$@" < /dev/null > "log.$app_name" 2>&1 )
     fi
 }
 
 compileApplication()
 {
     echo "Compiling $1 application"
-    wmake $1
+    wmake "$1"
 }
 
 cloneCase()
 {
-    if [ -d $2 ]
+    if [ -d "$2" ]
     then
         echo "Case already cloned: remove case directory $2 to clone"
     else
         echo "Cloning $2 case from $1"
-        mkdir $2
+        mkdir "$2"
         cpfiles="0 system constant"
         for f in $cpfiles
         do
-            cp -r $1/$f $2
+            cp -r "$1/$f" "$2"
         done
     fi
 }
 
+# vim: set ft=sh:
 #------------------------------------------------------------------------------
diff --git a/bin/tools/replaceAllShellSun b/bin/tools/replaceAllShellSun
index d5a0d8db..b57271e8 100755
--- a/bin/tools/replaceAllShellSun
+++ b/bin/tools/replaceAllShellSun
@@ -1,6 +1,6 @@
 #!/usr/xpg4/bin/sh
 
-# Replace all shell script headers with 
+# Replace all shell script headers with
 if [ $# -ne 1 -o ! -d "$1" ]
 then
     echo "Usage: ${0##*/} <dir>"
diff --git a/doc/Allwmake b/doc/Allwmake
index 5d8ed9c5..dff41f26 100755
--- a/doc/Allwmake
+++ b/doc/Allwmake
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 # fix permissions (NB: '+X' and not '+x'!)
 chmod a+rX $WM_PROJECT_DIR $WM_PROJECT_DIR/doc Doxygen
diff --git a/doc/Doxygen/Allwmake b/doc/Doxygen/Allwmake
index fbc20d93..fde5e5cc 100755
--- a/doc/Doxygen/Allwmake
+++ b/doc/Doxygen/Allwmake
@@ -8,7 +8,7 @@ cd ${0%/*} || exit 1    # run from this directory
     exit 1
 }
 
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 rm -rf latex man
 
diff --git a/etc/bashrc b/etc/bashrc
index 0f0ff507..d400eb71 100644
--- a/etc/bashrc
+++ b/etc/bashrc
@@ -81,7 +81,7 @@ export WM_COMPILE_OPTION=Opt
 #- MPI implementation:
 #    WM_MPLIB = SYSTEMOPENMPI | OPENMPI | MPICH | MPICH-GM | HPMPI
 #               | GAMMA | MPI | QSMPI | SGIMPI
-export WM_MPLIB=OPENMPI
+export WM_MPLIB=SYSTEMOPENMPI
 
 #- Operating System:
 #    WM_OSTYPE = POSIX | ???
@@ -104,7 +104,7 @@ export FOAM_SIGFPE=
 foamOldDirs="$FOAM_INST_DIR $WM_PROJECT_SITE $HOME/$WM_PROJECT/$USER"
 if [ "$WM_PROJECT_INST_DIR" != "$FOAM_INST_DIR" ]
 then
-    foamOldDirs="$WM_PROJECT_INST_DIR $foamOldDirs"
+	foamOldDirs="$WM_PROJECT_INST_DIR $foamOldDirs"
 fi
 
 
@@ -115,16 +115,17 @@ export WM_PROJECT_DIR=$WM_PROJECT_INST_DIR/$WM_PROJECT-$WM_PROJECT_VERSION
 
 # Location of third-party software
 # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-export WM_THIRD_PARTY_DIR=$WM_PROJECT_INST_DIR/ThirdParty-$WM_PROJECT_VERSION
+[ "$(uname -s)" = "Darwin" ] \
+	|| export WM_THIRD_PARTY_DIR=$WM_PROJECT_INST_DIR/ThirdParty-$WM_PROJECT_VERSION
 
 # Location of site-specific templates etc
 # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 # unset is equivalent to $WM_PROJECT_INST_DIR/site
 if [ -d "$WM_PROJECT_SITE" ]
 then
-    export WM_PROJECT_SITE
+	export WM_PROJECT_SITE
 else
-    unset WM_PROJECT_SITE
+	unset WM_PROJECT_SITE
 fi
 
 # Location of user files
@@ -135,46 +136,46 @@ export WM_PROJECT_USER_DIR=$HOME/$WM_PROJECT/$USER-$WM_PROJECT_VERSION
 # Source files, possibly with some verbosity
 _foamSource()
 {
-    while [ $# -ge 1 ]
-    do
-        [ "$FOAM_VERBOSE" -a "$PS1" ] && echo "Sourcing: $1" 1>&2
-        . $1
-       shift
-    done
+	while [ $# -ge 1 ]
+	do
+		[ "$FOAM_VERBOSE" -a "$PS1" ] && echo "Sourcing: $1" 1>&2
+		. $1
+		shift
+	done
 }
 
 # Evaluate command-line parameters
 _foamEval()
 {
-    while [ $# -gt 0 ]
-    do
-        case "$1" in
-        -*)
-            # stray option (not meant for us here) -> get out
-            break
-            ;;
-        *=)
-            # name=       -> unset name
-            [ "$FOAM_VERBOSE" -a "$PS1" ] && echo "unset ${1%=}" 1>&2
-            eval "unset ${1%=}"
-            ;;
-        *=*)
-            # name=value  -> export name=value
-            [ "$FOAM_VERBOSE" -a "$PS1" ] && echo "export $1" 1>&2
-            eval "export $1"
-            ;;
-        *)
-            # filename: source it
-            if [ -f "$1" ]
-            then
-                _foamSource "$1"
-            else
-                _foamSource `$WM_PROJECT_DIR/bin/foamEtcFile -silent "$1"`
-            fi
-            ;;
-        esac
-        shift
-    done
+	while [ $# -gt 0 ]
+	do
+		case "$1" in
+		-*)
+			# stray option (not meant for us here) -> get out
+			break
+			;;
+		*=)
+			# name=       -> unset name
+			[ "$FOAM_VERBOSE" -a "$PS1" ] && echo "unset ${1%=}" 1>&2
+			eval "unset ${1%=}"
+			;;
+		*=*)
+			# name=value  -> export name=value
+			[ "$FOAM_VERBOSE" -a "$PS1" ] && echo "export $1" 1>&2
+			eval "export $1"
+			;;
+		*)
+			# filename: source it
+			if [ -f "$1" ]
+			then
+				_foamSource "$1"
+			else
+				_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile -silent "$1"`
+			fi
+			;;
+		esac
+		shift
+	done
 }
 
 
@@ -193,15 +194,28 @@ foamClean=$WM_PROJECT_DIR/bin/foamCleanPath
 #- Clean PATH
 cleaned=`$foamClean "$PATH" "$foamOldDirs"` && PATH="$cleaned"
 
-#- Clean LD_LIBRARY_PATH
-cleaned=`$foamClean "$LD_LIBRARY_PATH" "$foamOldDirs"` \
-    && LD_LIBRARY_PATH="$cleaned"
+if [ "$(uname -s)" = "Darwin" ]
+then
+    #- Clean DYLD_LIBRARY_PATH on OS X
+	cleaned=`$foamClean "$DYLD_LIBRARY_PATH" "$foamOldDirs"` \
+		&& DYLD_LIBRARY_PATH="$cleaned"
+else
+    #- Clean LD_LIBRARY_PATH
+    cleaned=`$foamClean "$LD_LIBRARY_PATH" "$foamOldDirs"` \
+        && LD_LIBRARY_PATH="$cleaned"
+fi
 
 #- Clean MANPATH
 cleaned=`$foamClean "$MANPATH" "$foamOldDirs"` && MANPATH="$cleaned"
 
-export PATH LD_LIBRARY_PATH MANPATH
+export PATH MANPATH
 
+if [ "$(uname -s)" = "Darwin" ]
+then
+    export DYLD_LIBRARY_PATH
+else
+    export LD_LIBRARY_PATH
+fi
 
 # Source project setup files
 # ~~~~~~~~~~~~~~~~~~~~~~~~~~
@@ -211,9 +225,13 @@ _foamSource $WM_PROJECT_DIR/etc/config/aliases.sh
 
 # Source user setup files for optional packages
 # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/paraview.sh`
-_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/ensight.sh`
-_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/gperftools.sh`
+if [ "$(uname -s)" = "Darwin" ]; then
+	_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/paraview-osx.sh`
+else
+	_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/paraview.sh`
+	_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/ensight.sh`
+	_foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/gperftools.sh`
+fi
 
 
 # Clean environment paths again. Only remove duplicates
@@ -221,19 +239,32 @@ _foamSource `$WM_PROJECT_DIR/bin/foamEtcFile config/gperftools.sh`
 #- Clean PATH
 cleaned=`$foamClean "$PATH"` && PATH="$cleaned"
 
-#- Clean LD_LIBRARY_PATH
-cleaned=`$foamClean "$LD_LIBRARY_PATH"` && LD_LIBRARY_PATH="$cleaned"
+if [ "$(uname -s)" = "Darwin" ]
+then
+    #- Clean DYLD_LIBRARY_PATH on OS X
+	cleaned=`$foamClean "$DYLD_LIBRARY_PATH"` && DYLD_LIBRARY_PATH="$cleaned"
+else
+    #- Clean LD_LIBRARY_PATH
+    cleaned=`$foamClean "$LD_LIBRARY_PATH"` && LD_LIBRARY_PATH="$cleaned"
+fi
 
 #- Clean MANPATH (trailing ':' to find system pages)
 cleaned=`$foamClean "$MANPATH"`: && MANPATH="$cleaned"
 
-export PATH LD_LIBRARY_PATH MANPATH
+export PATH MANPATH
+
+if [ "$(uname -s)" = "Darwin" ]
+then
+    export DYLD_LIBRARY_PATH
+else
+    export LD_LIBRARY_PATH
+fi
 
 #- Clean LD_PRELOAD
 if [ -n "$LD_PRELOAD" ]
 then
-    cleaned=`$foamClean "$LD_PRELOAD"` && LD_PRELOAD="$cleaned"
-    export LD_PRELOAD
+	cleaned=`$foamClean "$LD_PRELOAD"` && LD_PRELOAD="$cleaned"
+	export LD_PRELOAD
 fi
 
 
diff --git a/etc/config/paraview-osx.sh b/etc/config/paraview-osx.sh
new file mode 100644
index 00000000..c01149b5
--- /dev/null
+++ b/etc/config/paraview-osx.sh
@@ -0,0 +1,15 @@
+if [ -d /Applications/[Pp][Aa][Rr][Aa][Vv][Ii][Ee][Ww]*.app ]; then
+	[ "$FOAM_VERBOSE" -a "$PS1" ] && echo Using /Applications/[Pp][Aa][Rr][Aa][Vv][Ii][Ee][Ww]*.app
+
+	paraview () {
+		/Applications/[Pp][Aa][Rr][Aa][Vv][Ii][Ee][Ww]*.app/Contents/MacOS/paraview "$@"
+	}
+
+	export -f paraview
+else
+	echo
+	echo "Please download binary Paraview release from"
+	echo "http://paraview.org and install it in /Applications"
+	echo "folder."
+	echo
+fi
diff --git a/etc/config/scotch.sh b/etc/config/scotch.sh
index 1ee06e80..d1aed11f 100644
--- a/etc/config/scotch.sh
+++ b/etc/config/scotch.sh
@@ -33,7 +33,17 @@
 #     during the wmake process
 #------------------------------------------------------------------------------
 
-export SCOTCH_VERSION=scotch_6.0.0
-export SCOTCH_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$SCOTCH_VERSION
+if [ "$(uname -s)" = "Darwin" ]
+then
+    _scotch_path="$(brew --prefix)/opt/scotch"
+
+	export SCOTCH_VERSION="scotch_$(basename $(readlink "$_scotch_path"))"
+	export SCOTCH_ARCH_PATH="$_scotch_path"
+
+    unset _scotch_path
+else
+	export SCOTCH_VERSION=scotch_6.0.0
+	export SCOTCH_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$SCOTCH_VERSION
+fi
 
 # -----------------------------------------------------------------------------
diff --git a/etc/config/settings.sh b/etc/config/settings.sh
index 5a77479b..bc7be6da 100644
--- a/etc/config/settings.sh
+++ b/etc/config/settings.sh
@@ -45,7 +45,12 @@ _foamAddLib()
 {
     while [ $# -ge 1 ]
     do
-        export LD_LIBRARY_PATH=$1:$LD_LIBRARY_PATH
+        if [ "$(uname -s)" = "Darwin" ]
+        then
+            export DYLD_LIBRARY_PATH=$1:$DYLD_LIBRARY_PATH
+        else
+            export LD_LIBRARY_PATH=$1:$LD_LIBRARY_PATH
+        fi
         shift
     done
 }
@@ -60,6 +65,31 @@ _foamAddMan()
     done
 }
 
+# get formula version
+_brew_formula_version()
+{
+    if [ "$#" -lt 1 ]
+    then
+        echo "-1"
+    else
+        local brew_prefix="$(brew --prefix)"
+        local formula_link_path="$brew_prefix/opt/$1"
+        local formula_cellar_path="$(readlink "$formula_link_path")"
+        echo "$(basename "$formula_cellar_path")"
+    fi
+}
+
+_brew_formula_path()
+{
+    if [ "$#" -lt 1 ]
+    then
+        echo ""
+    else
+        local brew_prefix="$(brew --prefix)"
+        echo "$brew_prefix/opt/$1"
+    fi
+}
+
 #------------------------------------------------------------------------------
 # Set environment variables according to system type
 export WM_ARCH=`uname -s`
@@ -151,6 +181,12 @@ SunOS)
     export WM_LDFLAGS='-mabi=64 -G0'
     ;;
 
+Darwin)
+    WM_ARCH=darwin64
+    export WM_CC='clang'
+    export WM_CXX='clang++'
+    ;;
+
 *)    # an unsupported operating system
     /bin/cat <<USAGE 1>&2
 
@@ -177,7 +213,8 @@ export FOAM_APPBIN=$WM_PROJECT_DIR/platforms/$WM_OPTIONS/bin
 export FOAM_LIBBIN=$WM_PROJECT_DIR/platforms/$WM_OPTIONS/lib
 
 # external (ThirdParty) libraries
-export FOAM_EXT_LIBBIN=$WM_THIRD_PARTY_DIR/platforms/$WM_OPTIONS/lib
+[ "$(uname -s)" = "Darwin" ] \
+    || export FOAM_EXT_LIBBIN=$WM_THIRD_PARTY_DIR/platforms/$WM_OPTIONS/lib
 
 # site-specific directory
 siteDir="${WM_PROJECT_SITE:-$WM_PROJECT_INST_DIR/site}"
@@ -221,7 +258,11 @@ unset siteDir
 
 _foamAddPath $FOAM_USER_APPBIN:$FOAM_SITE_APPBIN:$FOAM_APPBIN
 # Make sure to pick up dummy versions of external libraries last
-_foamAddLib  $FOAM_USER_LIBBIN:$FOAM_SITE_LIBBIN:$FOAM_LIBBIN:$FOAM_EXT_LIBBIN:$FOAM_LIBBIN/dummy
+if [ "$(uname -s)" = "Darwin" ]; then
+    _foamAddLib $FOAM_USER_LIBBIN:$FOAM_SITE_LIBBIN:$FOAM_LIBBIN:$FOAM_LIBBIN/dummy
+else
+    _foamAddLib $FOAM_USER_LIBBIN:$FOAM_SITE_LIBBIN:$FOAM_LIBBIN:$FOAM_EXT_LIBBIN:$FOAM_LIBBIN/dummy
+fi
 
 # Compiler settings
 # ~~~~~~~~~~~~~~~~~
@@ -362,11 +403,22 @@ fi
 # boost and CGAL
 # ~~~~~~~~~~~~~~
 
-boost_version=boost_1_45_0
-cgal_version=CGAL-4.0
+if [ "$(uname -s)" = "Darwin" ]; then
+    boost_version="boost-$(_brew_formula_version boost)"
+    cgal_version="CGAL-$(_brew_formula_version cgal)"
 
-export BOOST_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$boost_version
-export CGAL_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$cgal_version
+    export BOOST_ARCH_PATH="$(_brew_formula_path boost)"
+    export CGAL_ARCH_PATH="$(_brew_formula_path cgal)"
+    export GMP_ARCH_PATH="$(_brew_formula_path gmp)"
+    export MPFR_ARCH_PATH="$(_brew_formula_path mpfr)"
+    export EIGEN_ARCH_PATH="$(_brew_formula_path eigen)"
+else
+    boost_version=boost_1_45_0
+    cgal_version=CGAL-4.0
+
+    export BOOST_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$boost_version
+    export CGAL_ARCH_PATH=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/$cgal_version
+fi
 
 # enabled if CGAL is available
 if [ "$FOAM_VERBOSE" -a "$PS1" ]
@@ -380,11 +432,11 @@ if [ -d "$CGAL_ARCH_PATH" ]
 then
     if [ -d "$BOOST_ARCH_PATH" ]
     then
-        _foamAddLib $BOOST_ARCH_PATH/lib
+        _foamAddLib "$BOOST_ARCH_PATH/lib"
     else
         unset BOOST_ARCH_PATH
     fi
-    _foamAddLib $CGAL_ARCH_PATH/lib
+    _foamAddLib "$CGAL_ARCH_PATH/lib"
 else
     unset BOOST_ARCH_PATH CGAL_ARCH_PATH MPFR_ARCH_PATH GMP_ARCH_PATH
 fi
@@ -572,7 +624,8 @@ esac
 # dummy MPI already added to LD_LIBRARY_PATH and has no external libraries
 if [ "$FOAM_MPI" != dummy ]
 then
-    _foamAddLib $FOAM_LIBBIN/$FOAM_MPI:$FOAM_EXT_LIBBIN/$FOAM_MPI
+    [ "$(uname -s)" = "Darwin" ] || _foamAddLib $FOAM_EXT_LIBBIN/$FOAM_MPI
+    _foamAddLib $FOAM_LIBBIN/$FOAM_MPI
 fi
 
 
@@ -587,9 +640,19 @@ then
 fi
 export MPI_BUFFER_SIZE
 
+_increase_maxfiles ()
+{
+    local maxfiles=4096
+    [ "$(ulimit -n)" -lt $maxfiles ] \
+        && ulimit -n $maxfiles > /dev/null 2>&1
+}
+
+# Increase max open files for lnInclude
+[ "$(uname -s)" = "Darwin" ] && _increase_maxfiles
 
 # cleanup environment:
 # ~~~~~~~~~~~~~~~~~~~~
 unset _foamAddPath _foamAddLib _foamAddMan foamCompiler minBufferSize
+unset _increase_maxfiles _brew_formula_version _brew_formula_version
 
 # ----------------------------------------------------------------- end-of-file
diff --git a/src/Allwmake b/src/Allwmake
index 55b8981c..a12f14f6 100755
--- a/src/Allwmake
+++ b/src/Allwmake
@@ -9,13 +9,15 @@ wmakeCheckPwd "$WM_PROJECT_DIR/src" || {
     exit 1
 }
 
-[ -n "$FOAM_EXT_LIBBIN" ] || {
-    echo "Error: FOAM_EXT_LIBBIN not set"
-    echo "    Check the OpenFOAM entries in your dot-files and source them."
-    exit 1
-}
-
-set -x
+if [ "$(uname -s)" != "Darwin" ]; then
+	[ -n "$FOAM_EXT_LIBBIN" ] || {
+		echo "Error: FOAM_EXT_LIBBIN not set"
+		echo "    Check the OpenFOAM entries in your dot-files and source them."
+		exit 1
+	}
+fi
+
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 # update OpenFOAM version strings if required
 wmakePrintBuild -check || /bin/rm -f OpenFOAM/Make/*/global.? 2>/dev/null
diff --git a/src/OSspecific/POSIX/POSIX.C b/src/OSspecific/POSIX/POSIX.C
index 92077811..4afd9b12 100644
--- a/src/OSspecific/POSIX/POSIX.C
+++ b/src/OSspecific/POSIX/POSIX.C
@@ -53,7 +53,11 @@ Description
 #include <sys/socket.h>
 #include <netdb.h>
 #include <dlfcn.h>
+#if defined(darwin64)
+#include <mach-o/dyld.h>
+#else
 #include <link.h>
+#endif
 
 #include <netinet/in.h>
 
@@ -1173,6 +1177,20 @@ void* Foam::dlOpen(const fileName& lib, const bool check)
             << " : dlopen of " << lib << std::endl;
     }
     void* handle = ::dlopen(lib.c_str(), RTLD_LAZY|RTLD_GLOBAL);
+#if defined(darwin64)
+    if (!handle && lib.ext() == "so")
+    {
+        fileName fallback_lib = lib.lessExt() + ".dylib";
+        if (check)
+        {
+            WarningIn("dlOpen(const fileName&, const bool)")
+                << "dlopen: using fallback library name "
+                << fallback_lib
+                << endl;
+        }
+        handle = ::dlopen(fallback_lib.c_str(), RTLD_LAZY|RTLD_GLOBAL);
+    }
+#endif
 
     if (!handle && check)
     {
@@ -1260,6 +1278,24 @@ bool Foam::dlSymFound(void* handle, const std::string& symbol)
 }
 
 
+#if defined(darwin64)
+Foam::fileNameList Foam::dlLoaded()
+{
+    DynamicList<fileName> libs;
+    for(uint32_t cnt = 0; cnt < _dyld_image_count(); ++cnt)
+    {
+        libs.append(_dyld_get_image_name(cnt));
+    }
+
+    if (POSIX::debug)
+    {
+        std::cout
+            << "dlLoaded()"
+            << " : determined loaded libraries :" << libs.size() << std::endl;
+    }
+    return libs;
+}
+#else
 static int collectLibsCallback
 (
     struct dl_phdr_info *info,
@@ -1286,6 +1322,7 @@ Foam::fileNameList Foam::dlLoaded()
     }
     return libs;
 }
+#endif
 
 
 void Foam::osRandomSeed(const label seed)
diff --git a/src/OSspecific/POSIX/clockTime/clockTime.H b/src/OSspecific/POSIX/clockTime/clockTime.H
index 8708ba94..65f046c1 100644
--- a/src/OSspecific/POSIX/clockTime/clockTime.H
+++ b/src/OSspecific/POSIX/clockTime/clockTime.H
@@ -37,6 +37,9 @@ SourceFiles
 #define clockTime_H
 
 #include <sys/types.h>
+#if defined(darwin64)
+#include <sys/time.h>
+#endif
 
 // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
diff --git a/src/OSspecific/POSIX/fileStat.C b/src/OSspecific/POSIX/fileStat.C
index bf04835f..8a3c7967 100644
--- a/src/OSspecific/POSIX/fileStat.C
+++ b/src/OSspecific/POSIX/fileStat.C
@@ -29,7 +29,9 @@ License
 
 #include <signal.h>
 #include <unistd.h>
+#if ! defined(darwin64)
 #include <sys/sysmacros.h>
+#endif
 
 // * * * * * * * * * * * * * * * * Constructors  * * * * * * * * * * * * * * //
 
diff --git a/src/OSspecific/POSIX/printStack.C b/src/OSspecific/POSIX/printStack.C
index 4a3859dc..506e72cd 100644
--- a/src/OSspecific/POSIX/printStack.C
+++ b/src/OSspecific/POSIX/printStack.C
@@ -2,7 +2,7 @@
   =========                 |
   \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
    \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011-2012 OpenFOAM Foundation
+    \\  /    A nd           | Copyright (C) 2011-2015 OpenFOAM Foundation
      \\/     M anipulation  |
 -------------------------------------------------------------------------------
 License
@@ -23,16 +23,22 @@ License
 
 \*---------------------------------------------------------------------------*/
 
+#if defined(darwin64)
+#include "ulong.H"
+#endif
 #include "error.H"
-#include "IStringStream.H"
 #include "OStringStream.H"
 #include "OSspecific.H"
 #include "IFstream.H"
-#include "readHexLabel.H"
 
+#include <inttypes.h>
 #include <cxxabi.h>
 #include <execinfo.h>
 #include <dlfcn.h>
+#if defined(darwin64)
+// To parse lldb output
+#include <regex.h>
+#endif
 
 // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
@@ -43,90 +49,140 @@ namespace Foam
 
 string pOpen(const string &cmd, label line=0)
 {
-    const int MAX = 1000;
+    string res = "\n";
 
     FILE *cmdPipe = popen(cmd.c_str(), "r");
 
     if (cmdPipe)
     {
+        char *buf = NULL;
+
         // Read line number of lines
         for (label cnt = 0; cnt <= line; cnt++)
         {
-            char buffer[MAX];
-            char* s = fgets(buffer, MAX-1, cmdPipe);
+            size_t linecap = 0;
+            ssize_t linelen;
+            linelen = getline(&buf, &linecap, cmdPipe);
 
-            if (s == NULL)
+            if (linelen < 0)
             {
-                return "";
+                break;
             }
 
             if (cnt == line)
             {
-                string str(buffer);
-                return str.substr(0, str.size()-1);
+                res = string(buf);
+                break;
             }
         }
+
+        if (buf != NULL)
+        {
+            free(buf);
+        }
+
         pclose(cmdPipe);
     }
 
-    return "";
+    return res.substr(0, res.size() - 1);
 }
 
 
-// use popen to call addr2line (using bfd.h directly would have
-// meant relinking everything)
+inline word addressToWord(const uintptr_t addr)
+{
+    OStringStream nStream;
+    nStream << "0x" << hex << addr;
+    return nStream.str();
+}
+
 
 void printSourceFileAndLine
 (
     Ostream& os,
-    const HashTable<label, fileName>& addressMap,
     const fileName& filename,
-    const word& address
+    Dl_info *info,
+    void *addr
 )
 {
-    word myAddress = address;
+    uintptr_t address = uintptr_t(addr);
+    word myAddress = addressToWord(address);
 
+#if ! defined(darwin64)
     if (filename.ext() == "so")
     {
-        // Convert offset into .so into offset into executable.
-
-        void *addr;
-        sscanf(myAddress.c_str(), "%p",&addr);
-
-        Dl_info info;
-
-        dladdr(addr, &info);
-
-        unsigned long offset = ulong(info.dli_fbase);
-
-        IStringStream addressStr(address.substr(2));
-        label addressValue = readHexLabel(addressStr);
-        label relativeAddress = addressValue-offset;
-
-        // Reconstruct hex word from address
-        OStringStream nStream;
-        nStream << "0x" << hex << relativeAddress;
-        myAddress = nStream.str();
+        // Convert address into offset into dynamic library
+        uintptr_t offset = uintptr_t(info->dli_fbase);
+        intptr_t relativeAddress = address - offset;
+        myAddress = addressToWord(relativeAddress);
     }
+#endif
 
     if (filename[0] == '/')
     {
         string line = pOpen
         (
+#if ! defined(darwin64)
             "addr2line -f --demangle=auto --exe "
           + filename
           + " "
           + myAddress,
             1
+#else
+            "echo 'image lookup -a "
+          + myAddress
+          + " "
+          + filename
+          + "'"
+          + " | xcrun lldb "
+          + "-O 'target create --no-dependents -a x86_64 "
+          + filename
+          + "' -o '"
+          + "target modules load -f "
+          + filename
+          + " __TEXT "
+          + addressToWord(reinterpret_cast<const uintptr_t>(info->dli_fbase))
+          + "' 2> /dev/null"
+          + " | tail -1"
+#endif
         );
 
+#if defined(darwin64)
+        {
+            const char *buf = line.c_str();
+            regex_t re;
+            regmatch_t mt[3];
+            int st;
+
+            regcomp(&re, ".\\+at \\(.\\+\\):\\(\\d\\+\\)", REG_ENHANCED);
+            st = regexec(&re, buf, 3, mt, 0);
+
+            if (st == REG_NOMATCH)
+            {
+                line = "??:0";
+            }
+            else
+            {
+                size_t len = mt[1].rm_eo - mt[1].rm_so;
+                string fname(buf + mt[1].rm_so, len);
+                len = mt[2].rm_eo - mt[2].rm_so;
+                string lnum(buf + mt[2].rm_so, len);
+                line = fname + ":" + lnum;
+            }
+            regfree(&re);
+        }
+#endif
+
         if (line == "")
         {
             os  << " addr2line failed";
         }
         else if (line == "??:0")
         {
-            os  << " in " << filename;
+            line = filename;
+            string cwdLine(line.replaceAll(cwd() + '/', ""));
+            string homeLine(cwdLine.replaceAll(home(), '~'));
+
+            os  << " in " << homeLine;
         }
         else
         {
@@ -139,83 +195,59 @@ void printSourceFileAndLine
 }
 
 
-void getSymbolForRaw
-(
-    Ostream& os,
-    const string& raw,
-    const fileName& filename,
-    const word& address
-)
+fileName absolutePath(const char* fn)
 {
-    if (filename.size() && filename[0] == '/')
+    fileName fname(fn);
+
+    if (fname[0] != '/' && fname[0] != '~')
     {
-        string fcnt = pOpen
-        (
-            "addr2line -f --demangle=auto --exe "
-          + filename
-          + " "
-          + address
-        );
+        string tmp = pOpen("which " + fname);
 
-        if (fcnt != "")
+        if (tmp[0] == '/' || tmp[0] == '~')
         {
-            os  << fcnt.c_str();
-            return;
+            fname = tmp;
         }
     }
-    os  << "Uninterpreted: " << raw.c_str();
+
+    return fname;
 }
 
 
-void error::safePrintStack(std::ostream& os)
+string demangleSymbol(const char* sn)
 {
-    // Get raw stack symbols
-    void *array[100];
-    size_t size = backtrace(array, 100);
-    char **strings = backtrace_symbols(array, size);
-
-    // See if they contain function between () e.g. "(__libc_start_main+0xd0)"
-    // and see if cplus_demangle can make sense of part before +
-    for (size_t i = 0; i < size; i++)
+    string res;
+    int st;
+    char* cxx_sname = abi::__cxa_demangle
+    (
+        sn,
+        NULL,
+        0,
+        &st
+    );
+
+    if (st == 0 && cxx_sname)
     {
-        string msg(strings[i]);
-        fileName programFile;
-        word address;
-
-        os  << '#' << label(i) << '\t' << msg << std::endl;
+        res = string(cxx_sname);
+        free(cxx_sname);
+    }
+    else
+    {
+        res = string(sn);
     }
-}
 
+    return res;
+}
 
-void error::printStack(Ostream& os)
-{
-    // Reads the starting addresses for the dynamically linked libraries
-    // from the /proc/pid/maps-file
-    // I'm afraid this works only for Linux 2.6-Kernels (may work on 2.4)
-    // Note2: the filenames in here will have softlinks resolved so will
-    // go wrong when having e.g. OpenFOAM installed under a softlink.
 
-    HashTable<label, fileName> addressMap;
-    {
-        IFstream is("/proc/" + name(pid()) + "/maps");
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
-        while (is.good())
-        {
-            string line;
-            is.getLine(line);
+} // End namespace Foam
 
-            string::size_type space = line.rfind(' ') + 1;
-            fileName libPath = line.substr(space, line.size()-space);
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
-            if (libPath.size() && libPath[0] == '/')
-            {
-                string offsetString(line.substr(0, line.find('-')));
-                IStringStream offsetStr(offsetString);
-                addressMap.insert(libPath, readHexLabel(offsetStr));
-            }
-        }
-    }
 
+void Foam::error::safePrintStack(std::ostream& os)
+{
     // Get raw stack symbols
     void *array[100];
     size_t size = backtrace(array, 100);
@@ -229,101 +261,51 @@ void error::printStack(Ostream& os)
         fileName programFile;
         word address;
 
-        os  << '#' << label(i) << "  ";
-        //os  << "Raw   : " << msg << "\n\t";
-        {
-            string::size_type lPos = msg.find('[');
-            string::size_type rPos = msg.find(']');
+        os  << '#' << label(i) << '\t' << msg << std::endl;
+    }
+}
 
-            if (lPos != string::npos && rPos != string::npos && lPos < rPos)
-            {
-                address = msg.substr(lPos+1, rPos-lPos-1);
-                msg = msg.substr(0, lPos);
-            }
 
-            string::size_type bracketPos = msg.find('(');
-            string::size_type spacePos = msg.find(' ');
-            if (bracketPos != string::npos || spacePos != string::npos)
-            {
-                programFile = msg.substr(0, min(spacePos, bracketPos));
-
-                // not an absolute path
-                if (programFile[0] != '/')
-                {
-                    string tmp = pOpen("which " + programFile);
-                    if (tmp[0] == '/' || tmp[0] == '~')
-                    {
-                        programFile = tmp;
-                    }
-                }
-            }
-        }
+void Foam::error::printStack(Ostream& os)
+{
+    // Get raw stack symbols
+    const size_t CALLSTACK_SIZE = 128;
 
-        string::size_type bracketPos = msg.find('(');
+    void *callstack[CALLSTACK_SIZE];
+    size_t size = backtrace(callstack, CALLSTACK_SIZE);
 
-        if (bracketPos != string::npos)
-        {
-            string::size_type start = bracketPos+1;
+    Dl_info *info = new Dl_info;
 
-            string::size_type plusPos = msg.find('+', start);
+    fileName fname = "???";
+    word address;
 
-            if (plusPos != string::npos)
-            {
-                string cName(msg.substr(start, plusPos-start));
-
-                int status;
-                char* cplusNamePtr = abi::__cxa_demangle
-                (
-                    cName.c_str(),
-                    NULL,                   // have it malloc itself
-                    0,
-                    &status
-                );
-
-                if (status == 0 && cplusNamePtr)
-                {
-                    os  << cplusNamePtr;
-                    free(cplusNamePtr);
-                }
-                else
-                {
-                    os  << cName.c_str();
-                }
-            }
-            else
-            {
-                string::size_type endBracketPos = msg.find(')', start);
-
-                if (endBracketPos != string::npos)
-                {
-                    string fullName(msg.substr(start, endBracketPos-start));
-
-                    os  << fullName.c_str() << nl;
-                }
-                else
-                {
-                    // Print raw message
-                    getSymbolForRaw(os, msg, programFile, address);
-                }
-            }
+    for(size_t i=0; i<size; i++)
+    {
+        int st = dladdr(callstack[i], info);
+
+        os << '#' << label(i) << "  ";
+        if (st != 0 && info->dli_fname != NULL && info->dli_fname[0] != '\0')
+        {
+            fname = absolutePath(info->dli_fname);
+
+            os <<
+            (
+                (info->dli_sname != NULL)
+              ? demangleSymbol(info->dli_sname)
+              : "?"
+            );
         }
         else
         {
-            // Print raw message
-            getSymbolForRaw(os, msg, programFile, address);
+            os << "?";
         }
 
-        printSourceFileAndLine(os, addressMap, programFile, address);
-
-        os  << nl;
+        printSourceFileAndLine(os, fname, info, callstack[i]);
+        os << nl;
     }
 
-    free(strings);
+    delete info;
 }
 
 
-// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
-
-} // End namespace Foam
-
 // ************************************************************************* //
diff --git a/src/OSspecific/POSIX/signals/sigFpe.C b/src/OSspecific/POSIX/signals/sigFpe.C
index 501ff95c..8f503d60 100644
--- a/src/OSspecific/POSIX/signals/sigFpe.C
+++ b/src/OSspecific/POSIX/signals/sigFpe.C
@@ -44,12 +44,43 @@ License
 
 #endif
 
+#if defined(__APPLE__)
+#include <xmmintrin.h>
+#include <malloc/malloc.h>
+#include <sys/mman.h>
+#include <unistd.h>
+#endif
+
 #include <stdint.h>
+#include <limits>
 
 // * * * * * * * * * * * * * * Static Data Members * * * * * * * * * * * * * //
 
 struct sigaction Foam::sigFpe::oldAction_;
 
+#if defined(__APPLE__)
+void *(*Foam::sigFpe::oldMallocHook_)
+(
+    struct _malloc_zone_t *zone,
+    size_t size
+) = NULL;
+
+void *Foam::sigFpe::nanMallocHook_
+(
+    struct _malloc_zone_t *zone,
+    size_t size
+)
+{
+    void *result;
+
+    result = oldMallocHook_(zone, size);
+
+    UList<scalar> lst(reinterpret_cast<scalar*>(result), size/sizeof(scalar));
+    lst = std::numeric_limits<scalar>::signaling_NaN();
+
+    return result;
+}
+#endif
 
 #ifdef LINUX
 
@@ -94,7 +125,7 @@ void* Foam::sigFpe::nanMallocHook_(size_t size, const void *caller)
 #endif
 
 
-#ifdef LINUX_GNUC
+#if defined(LINUX_GNUC) || defined(__APPLE__)
 
 void Foam::sigFpe::sigHandler(int)
 {
@@ -134,10 +165,14 @@ Foam::sigFpe::~sigFpe()
 {
     if (env("FOAM_SIGFPE"))
     {
-#       ifdef LINUX_GNUC
+#       if defined(LINUX_GNUC) || defined(__APPLE__)
 
         // Reset signal
+#       if defined(__APPLE__)
+        if (oldAction_.sa_handler && sigaction(SIGFPE, NULL, NULL) < 0)
+#       else
         if (oldAction_.sa_handler && sigaction(SIGFPE, &oldAction_, NULL) < 0)
+#       endif
         {
             FatalErrorIn
             (
@@ -160,6 +195,20 @@ Foam::sigFpe::~sigFpe()
         }
 
 #       endif
+
+#       if defined(__APPLE__)
+        // Restoring old malloc handler
+        if (oldMallocHook_ != NULL) {
+            malloc_zone_t *zone = malloc_default_zone();
+
+            if (zone != NULL)
+            {
+                mprotect(zone, getpagesize(), PROT_READ | PROT_WRITE);
+                zone->malloc = oldMallocHook_;
+                mprotect(zone, getpagesize(), PROT_READ);
+            }
+        }
+#       endif
     }
 }
 
@@ -181,21 +230,31 @@ void Foam::sigFpe::set(const bool verbose)
     {
         bool supported = false;
 
-#       ifdef LINUX_GNUC
+#       if defined(LINUX_GNUC) || defined(__APPLE__)
         supported = true;
 
+#       if defined(LINUX_GNUC)
         feenableexcept
         (
             FE_DIVBYZERO
           | FE_INVALID
           | FE_OVERFLOW
         );
+#       endif
+#       if defined(__APPLE__)
+        _mm_setcsr(_MM_MASK_MASK &~
+                   (_MM_MASK_OVERFLOW|_MM_MASK_INVALID|_MM_MASK_DIV_ZERO));
+#       endif
 
         struct sigaction newAction;
         newAction.sa_handler = sigHandler;
         newAction.sa_flags = SA_NODEFER;
         sigemptyset(&newAction.sa_mask);
+#       if defined(__APPLE__)
+        if (sigaction(SIGFPE, &newAction, NULL) < 0)
+#       else
         if (sigaction(SIGFPE, &newAction, &oldAction_) < 0)
+#       endif
         {
             FatalErrorIn
             (
@@ -258,6 +317,28 @@ void Foam::sigFpe::set(const bool verbose)
 
 #       endif
 
+#       if defined(__APPLE__)
+        malloc_zone_t *zone = malloc_default_zone();
+
+        if (zone != NULL)
+        {
+            oldMallocHook_ = zone->malloc;
+            if
+            (
+                mprotect(zone, getpagesize(), PROT_READ | PROT_WRITE) == 0
+            )
+            {
+                zone->malloc = nanMallocHook_;
+                if
+                (
+                    mprotect(zone, getpagesize(), PROT_READ) == 0
+                )
+                {
+                    supported = true;
+                }
+            }
+        }
+#       endif
 
         if (verbose)
         {
diff --git a/src/OSspecific/POSIX/signals/sigFpe.H b/src/OSspecific/POSIX/signals/sigFpe.H
index b7fdec8d..c36885b6 100644
--- a/src/OSspecific/POSIX/signals/sigFpe.H
+++ b/src/OSspecific/POSIX/signals/sigFpe.H
@@ -53,6 +53,10 @@ SourceFiles
 #    define LINUX_GNUC
 #endif
 
+#if defined(__APPLE__)
+#include <malloc/malloc.h>
+#endif
+
 // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
 namespace Foam
@@ -79,10 +83,24 @@ class sigFpe
 
 #       endif
 
+#       if defined(__APPLE__)
+            static void *(*oldMallocHook_)
+            (
+                struct _malloc_zone_t *zone,
+                size_t size
+            );
+
+            static void *nanMallocHook_
+            (
+                struct _malloc_zone_t *zone,
+                size_t size
+            );
+#       endif
+
 
     // Static data members
 
-#   ifdef LINUX_GNUC
+#   if defined(LINUX_GNUC) || defined(__APPLE__)
 
         //- Handler for caught signals
         static void sigHandler(int);
diff --git a/src/OpenFOAM/containers/Lists/CompactListList/CompactListListI.H b/src/OpenFOAM/containers/Lists/CompactListList/CompactListListI.H
index 91987aca..9691c490 100644
--- a/src/OpenFOAM/containers/Lists/CompactListList/CompactListListI.H
+++ b/src/OpenFOAM/containers/Lists/CompactListList/CompactListListI.H
@@ -79,7 +79,7 @@ template<class T, class Container>
 inline const Foam::CompactListList<T, Container>&
 Foam::CompactListList<T, Container>::null()
 {
-    return *reinterpret_cast< CompactListList<T, Container>* >(0);
+    return NullObjectRef<CompactListList<T, Container> >();
 }
 
 
diff --git a/src/OpenFOAM/containers/Lists/FixedList/FixedListI.H b/src/OpenFOAM/containers/Lists/FixedList/FixedListI.H
index 65383193..af877eba 100644
--- a/src/OpenFOAM/containers/Lists/FixedList/FixedListI.H
+++ b/src/OpenFOAM/containers/Lists/FixedList/FixedListI.H
@@ -107,7 +107,7 @@ Foam::FixedList<T, Size>::clone() const
 template<class T, unsigned Size>
 inline const Foam::FixedList<T, Size>& Foam::FixedList<T, Size>::null()
 {
-    return *reinterpret_cast< FixedList<T, Size>* >(0);
+    return NullObjectRef<FixedList<T, Size> >();
 }
 
 
diff --git a/src/OpenFOAM/containers/Lists/List/ListI.H b/src/OpenFOAM/containers/Lists/List/ListI.H
index 26c65bd3..2c759b4d 100644
--- a/src/OpenFOAM/containers/Lists/List/ListI.H
+++ b/src/OpenFOAM/containers/Lists/List/ListI.H
@@ -42,7 +42,7 @@ inline Foam::autoPtr<Foam::List<T> > Foam::List<T>::clone() const
 template<class T>
 inline const Foam::List<T>& Foam::List<T>::null()
 {
-    return *reinterpret_cast< List<T>* >(0);
+    return NullObjectRef<List<T> >();
 }
 
 
diff --git a/src/OpenFOAM/containers/Lists/SubList/SubListI.H b/src/OpenFOAM/containers/Lists/SubList/SubListI.H
index 36fc5a4a..09b40d86 100644
--- a/src/OpenFOAM/containers/Lists/SubList/SubListI.H
+++ b/src/OpenFOAM/containers/Lists/SubList/SubListI.H
@@ -74,7 +74,7 @@ inline Foam::SubList<T>::SubList
 template<class T>
 inline const Foam::SubList<T>& Foam::SubList<T>::null()
 {
-    return *reinterpret_cast< SubList<T>* >(0);
+    return NullObjectRef<SubList<T> >();
 }
 
 
diff --git a/src/OpenFOAM/containers/Lists/UList/UList.H b/src/OpenFOAM/containers/Lists/UList/UList.H
index 06ef4cbb..1e782e01 100644
--- a/src/OpenFOAM/containers/Lists/UList/UList.H
+++ b/src/OpenFOAM/containers/Lists/UList/UList.H
@@ -42,6 +42,7 @@ SourceFiles
 #ifndef UList_H
 #define UList_H
 
+#include "nullObject.H"
 #include "bool.H"
 #include "label.H"
 #include "uLabel.H"
diff --git a/src/OpenFOAM/containers/Lists/UList/UListI.H b/src/OpenFOAM/containers/Lists/UList/UListI.H
index 3994b3de..a1c92bcd 100644
--- a/src/OpenFOAM/containers/Lists/UList/UListI.H
+++ b/src/OpenFOAM/containers/Lists/UList/UListI.H
@@ -50,7 +50,7 @@ inline Foam::UList<T>::UList(T* __restrict__ v, label size)
 template<class T>
 inline const Foam::UList<T>& Foam::UList<T>::null()
 {
-    return *reinterpret_cast< UList<T>* >(0);
+    return NullObjectRef<UList<T> >();
 }
 
 
diff --git a/src/OpenFOAM/db/IOobject/IOobject.H b/src/OpenFOAM/db/IOobject/IOobject.H
index 7b9d73ee..4a13ed9f 100644
--- a/src/OpenFOAM/db/IOobject/IOobject.H
+++ b/src/OpenFOAM/db/IOobject/IOobject.H
@@ -375,7 +375,7 @@ public:
 
             //- Write the standard end file divider
             template<class Stream>
-            static inline Stream& writeEndDivider(Stream& os);
+            static inline Stream& writeEndDivider(Stream& os, bool noHint=false);
 
             //- Write header
             bool writeHeader(Ostream&) const;
diff --git a/src/OpenFOAM/db/IOobject/IOobjectI.H b/src/OpenFOAM/db/IOobject/IOobjectI.H
index ea0d6550..bfe402fe 100644
--- a/src/OpenFOAM/db/IOobject/IOobjectI.H
+++ b/src/OpenFOAM/db/IOobject/IOobjectI.H
@@ -91,14 +91,22 @@ inline Stream& Foam::IOobject::writeDivider(Stream& os)
 }
 
 template<class Stream>
-inline Stream& Foam::IOobject::writeEndDivider(Stream& os)
+inline Stream& Foam::IOobject::writeEndDivider(Stream& os, bool noHint)
 {
-    os  << "\n\n"
-        "// *****************************************"
-        "******************************** //\n";
+    if (noHint)
+    {
+        os  << "\n\n"
+            "// *****************************************"
+            "******************************** //\n";
+    }
+    else
+    {
+        os  << "\n\n"
+            "// **************************** vi: set ft=foam: "
+            "*************************** //\n";
+    }
 
     return os;
 }
 
-
 // ************************************************************************* //
diff --git a/src/OpenFOAM/db/IOobject/IOobjectWriteHeader.C b/src/OpenFOAM/db/IOobject/IOobjectWriteHeader.C
index 638d3e20..2c471649 100644
--- a/src/OpenFOAM/db/IOobject/IOobjectWriteHeader.C
+++ b/src/OpenFOAM/db/IOobject/IOobjectWriteHeader.C
@@ -45,6 +45,7 @@ bool Foam::IOobject::writeHeader(Ostream& os, const word& type) const
     writeBanner(os)
         << "FoamFile\n{\n"
         << "    version     " << os.version() << ";\n"
+        << "    foamVersion \"" << FOAMversion << "\";\n"
         << "    format      " << os.format() << ";\n"
         << "    class       " << type << ";\n";
 
diff --git a/src/OpenFOAM/db/IOstreams/Pstreams/gatherScatter.C b/src/OpenFOAM/db/IOstreams/Pstreams/gatherScatter.C
index 33c7581f..5fd597ef 100644
--- a/src/OpenFOAM/db/IOstreams/Pstreams/gatherScatter.C
+++ b/src/OpenFOAM/db/IOstreams/Pstreams/gatherScatter.C
@@ -29,6 +29,9 @@ Description
 
 \*---------------------------------------------------------------------------*/
 
+#if defined(darwin64)
+#include "longLong.H"
+#endif
 #include "UOPstream.H"
 #include "OPstream.H"
 #include "UIPstream.H"
diff --git a/src/OpenFOAM/db/dictionary/functionEntries/codeStream/codeStream.C b/src/OpenFOAM/db/dictionary/functionEntries/codeStream/codeStream.C
index 1c774c35..bdc7b8b9 100644
--- a/src/OpenFOAM/db/dictionary/functionEntries/codeStream/codeStream.C
+++ b/src/OpenFOAM/db/dictionary/functionEntries/codeStream/codeStream.C
@@ -24,6 +24,9 @@ License
 \*---------------------------------------------------------------------------*/
 
 #include "codeStream.H"
+#if defined(darwin64)
+#include "longLong.H"
+#endif
 #include "addToMemberFunctionSelectionTable.H"
 #include "IStringStream.H"
 #include "OStringStream.H"
diff --git a/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.C b/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.C
index 2f975771..026519c2 100644
--- a/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.C
+++ b/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.C
@@ -334,7 +334,11 @@ Foam::fileName Foam::dynamicCode::codeRelPath() const
 
 Foam::fileName Foam::dynamicCode::libRelPath() const
 {
+#if defined(darwin64)
+    return codeRelPath()/libSubDir_/"lib" + codeName_ + ".dylib";
+#else
     return codeRelPath()/libSubDir_/"lib" + codeName_ + ".so";
+#endif
 }
 
 
diff --git a/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.H b/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.H
index 852ba6d9..cecf678c 100644
--- a/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.H
+++ b/src/OpenFOAM/db/dynamicLibrary/dynamicCode/dynamicCode.H
@@ -221,7 +221,11 @@ public:
         //  Corresponds to codeRoot()/libSubDir()/lib\<codeName\>.so
         fileName libPath() const
         {
+#if defined(darwin64)
+            return codeRoot_/libSubDir_/"lib" + codeName_ + ".dylib";
+#else
             return codeRoot_/libSubDir_/"lib" + codeName_ + ".so";
+#endif
         }
 
         //- Path for specified code name relative to \$FOAM_CASE
diff --git a/src/OpenFOAM/db/objectRegistry/objectRegistryTemplates.C b/src/OpenFOAM/db/objectRegistry/objectRegistryTemplates.C
index 483e1c24..3d495af6 100644
--- a/src/OpenFOAM/db/objectRegistry/objectRegistryTemplates.C
+++ b/src/OpenFOAM/db/objectRegistry/objectRegistryTemplates.C
@@ -170,7 +170,7 @@ const Type& Foam::objectRegistry::lookupObject(const word& name) const
             << abort(FatalError);
     }
 
-    return *reinterpret_cast< const Type* >(0);
+    return NullObjectRef<Type>();
 }
 
 
diff --git a/src/OpenFOAM/fields/DimensionedFields/DimensionedField/DimensionedFieldI.H b/src/OpenFOAM/fields/DimensionedFields/DimensionedField/DimensionedFieldI.H
index 05a8a311..6d3c9a1c 100644
--- a/src/OpenFOAM/fields/DimensionedFields/DimensionedField/DimensionedFieldI.H
+++ b/src/OpenFOAM/fields/DimensionedFields/DimensionedField/DimensionedFieldI.H
@@ -34,7 +34,7 @@ template<class Type, class GeoMesh>
 inline const DimensionedField<Type, GeoMesh>&
 DimensionedField<Type, GeoMesh>::null()
 {
-    return *reinterpret_cast< DimensionedField<Type, GeoMesh>* >(0);
+    return NullObjectRef<DimensionedField<Type, GeoMesh> >();
 }
 
 
diff --git a/src/OpenFOAM/fields/DimensionedFields/DimensionedField/SubDimensionedFieldI.H b/src/OpenFOAM/fields/DimensionedFields/DimensionedField/SubDimensionedFieldI.H
index 7cfdc972..9f75b5fb 100644
--- a/src/OpenFOAM/fields/DimensionedFields/DimensionedField/SubDimensionedFieldI.H
+++ b/src/OpenFOAM/fields/DimensionedFields/DimensionedField/SubDimensionedFieldI.H
@@ -80,7 +80,7 @@ template<class Type, class GeoMesh>
 inline const SubDimensionedField<Type, GeoMesh>&
 SubDimensionedField<Type, GeoMesh>::null()
 {
-    return *reinterpret_cast< SubDimensionedField<Type, GeoMesh>* >(0);
+    return NullObjectRef<SubDimensionedField<Type, GeoMesh> >();
 }
 
 
diff --git a/src/OpenFOAM/fields/Fields/Field/Field.C b/src/OpenFOAM/fields/Fields/Field/Field.C
index 334eba8e..3e7d1dd6 100644
--- a/src/OpenFOAM/fields/Fields/Field/Field.C
+++ b/src/OpenFOAM/fields/Fields/Field/Field.C
@@ -402,7 +402,7 @@ void Foam::Field<Type>::map
     if
     (
         mapper.direct()
-     && &mapper.directAddressing()
+     && notNull(mapper.directAddressing())
      && mapper.directAddressing().size()
     )
     {
@@ -437,7 +437,7 @@ void Foam::Field<Type>::autoMap
     (
         (
             mapper.direct()
-         && &mapper.directAddressing()
+         && notNull(mapper.directAddressing())
          && mapper.directAddressing().size()
         )
      || (!mapper.direct() && mapper.addressing().size())
diff --git a/src/OpenFOAM/fields/Fields/Field/Field.H b/src/OpenFOAM/fields/Fields/Field/Field.H
index 9b4088a4..f56170ea 100644
--- a/src/OpenFOAM/fields/Fields/Field/Field.H
+++ b/src/OpenFOAM/fields/Fields/Field/Field.H
@@ -100,7 +100,7 @@ public:
         //- Return a null field
         inline static const Field<Type>& null()
         {
-            return *reinterpret_cast< Field<Type>* >(0);
+            return NullObjectRef<Field<Type> >();
         }
 
 
diff --git a/src/OpenFOAM/fields/Fields/Field/SubFieldI.H b/src/OpenFOAM/fields/Fields/Field/SubFieldI.H
index d6c28d07..e2326cc2 100644
--- a/src/OpenFOAM/fields/Fields/Field/SubFieldI.H
+++ b/src/OpenFOAM/fields/Fields/Field/SubFieldI.H
@@ -84,7 +84,7 @@ inline Foam::SubField<Type>::SubField
 template<class Type>
 inline const Foam::SubField<Type>& Foam::SubField<Type>::null()
 {
-    return *reinterpret_cast< SubField<Type>* >(0);
+    return NullObjectRef<SubField<Type> >();
 }
 
 
diff --git a/src/OpenFOAM/fields/GeometricFields/GeometricField/GeometricFieldI.H b/src/OpenFOAM/fields/GeometricFields/GeometricField/GeometricFieldI.H
index 49fd3c85..12ce96ab 100644
--- a/src/OpenFOAM/fields/GeometricFields/GeometricField/GeometricFieldI.H
+++ b/src/OpenFOAM/fields/GeometricFields/GeometricField/GeometricFieldI.H
@@ -29,7 +29,7 @@ template<class Type, template<class> class PatchField, class GeoMesh>
 inline const Foam::GeometricField<Type, PatchField, GeoMesh>&
 Foam::GeometricField<Type, PatchField, GeoMesh>::null()
 {
-    return *reinterpret_cast< GeometricField<Type, PatchField, GeoMesh>* >(0);
+    return NullObjectRef<GeometricField<Type, PatchField, GeoMesh> >();
 }
 
 
diff --git a/src/OpenFOAM/global/foamDoc.H b/src/OpenFOAM/global/foamDoc.H
index 1dbd19ff..f3b4b280 100644
--- a/src/OpenFOAM/global/foamDoc.H
+++ b/src/OpenFOAM/global/foamDoc.H
@@ -46,7 +46,7 @@ License
     - applications:
         collections of library functionality wrapped up into applications,
         such as solvers and utilities
-        
+
     - tutorials:
         a suite of test cases that highlight a broad cross-section of
         OpenFOAM's capabilities
diff --git a/src/OpenFOAM/global/global.Cver b/src/OpenFOAM/global/global.Cver
index ea711ef8..b898715f 100644
--- a/src/OpenFOAM/global/global.Cver
+++ b/src/OpenFOAM/global/global.Cver
@@ -42,6 +42,8 @@ const char* const Foam::FOAMbuild = "BUILD_STRING";
 
 #include "new.C"
 
+#include "nullObject.C"
+
 // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 // Global IO streams
 
diff --git a/src/OpenFOAM/matrices/Matrix/MatrixI.H b/src/OpenFOAM/matrices/Matrix/MatrixI.H
index a3604b27..49aa369f 100644
--- a/src/OpenFOAM/matrices/Matrix/MatrixI.H
+++ b/src/OpenFOAM/matrices/Matrix/MatrixI.H
@@ -47,7 +47,7 @@ clone() const
 template<class Form, class Type>
 inline const Foam::Matrix<Form, Type>& Foam::Matrix<Form, Type>::null()
 {
-    return *reinterpret_cast< Matrix<Form, Type>* >(0);
+    return NullObjectRef<Matrix<Form, Type> >();
 }
 
 
diff --git a/src/OpenFOAM/memory/Xfer/XferI.H b/src/OpenFOAM/memory/Xfer/XferI.H
index 3cb50772..490ee69f 100644
--- a/src/OpenFOAM/memory/Xfer/XferI.H
+++ b/src/OpenFOAM/memory/Xfer/XferI.H
@@ -23,12 +23,14 @@ License
 
 \*---------------------------------------------------------------------------*/
 
+#include "nullObject.H"
+
 // * * * * * * * * * * * * Static Member Functions * * * * * * * * * * * * * //
 
 template<class T>
 inline const Foam::Xfer<T>& Foam::Xfer<T>::null()
 {
-    return *reinterpret_cast< Xfer<T>* >(0);
+    return NullObjectRef<Xfer<T> >();
 }
 
 
diff --git a/src/OpenFOAM/meshes/meshShapes/cellShape/cellShapeIO.C b/src/OpenFOAM/meshes/meshShapes/cellShape/cellShapeIO.C
index 27332911..25528fcf 100644
--- a/src/OpenFOAM/meshes/meshShapes/cellShape/cellShapeIO.C
+++ b/src/OpenFOAM/meshes/meshShapes/cellShape/cellShapeIO.C
@@ -128,7 +128,7 @@ Ostream& operator<<(Ostream& os, const InfoProxy<cellShape>& ip)
 {
     const cellShape& cs = ip.t_;
 
-    if (!(&cs.model()))
+    if (isNull(cs.model()))
     {
         os  << "    cellShape has no model!\n";
     }
diff --git a/src/OpenFOAM/meshes/polyMesh/polyMesh.C b/src/OpenFOAM/meshes/polyMesh/polyMesh.C
index 9b0d11ac..aad77293 100644
--- a/src/OpenFOAM/meshes/polyMesh/polyMesh.C
+++ b/src/OpenFOAM/meshes/polyMesh/polyMesh.C
@@ -675,23 +675,23 @@ void Foam::polyMesh::resetPrimitives
 
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&points)
+    if (notNull(points))
     {
         points_.transfer(points());
         bounds_ = boundBox(points_, validBoundary);
     }
 
-    if (&faces)
+    if (notNull(faces))
     {
         faces_.transfer(faces());
     }
 
-    if (&owner)
+    if (notNull(owner))
     {
         owner_.transfer(owner());
     }
 
-    if (&neighbour)
+    if (notNull(neighbour))
     {
         neighbour_.transfer(neighbour());
     }
diff --git a/src/OpenFOAM/primitives/Scalar/doubleFloat.H b/src/OpenFOAM/primitives/Scalar/doubleFloat.H
index 57373e0b..69ce1a5f 100644
--- a/src/OpenFOAM/primitives/Scalar/doubleFloat.H
+++ b/src/OpenFOAM/primitives/Scalar/doubleFloat.H
@@ -31,6 +31,15 @@ License
 
 #include <cmath>
 
+#if defined(darwin64)
+inline float j0f(float x) { return float(j0(double(x)));}
+inline float j1f(float x) { return float(j1(double(x)));}
+inline float y0f(float x) { return float(y0(double(x)));}
+inline float y1f(float x) { return float(y1(double(x)));}
+inline float jnf(const int n, const float s) { return float(jn(n, double(s))); }
+inline float ynf(const int n, const float s) { return float(yn(n, double(s))); }
+#endif
+
 // * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
 
 namespace Foam
diff --git a/src/OpenFOAM/primitives/nullObject/nullObject.C b/src/OpenFOAM/primitives/nullObject/nullObject.C
new file mode 100644
index 00000000..cfcbfdf1
--- /dev/null
+++ b/src/OpenFOAM/primitives/nullObject/nullObject.C
@@ -0,0 +1,34 @@
+/*---------------------------------------------------------------------------*\
+  =========                 |
+  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+   \\    /   O peration     |
+    \\  /    A nd           | Copyright (C) 2014 OpenFOAM Foundation
+     \\/     M anipulation  |
+-------------------------------------------------------------------------------
+License
+    This file is part of OpenFOAM.
+
+    OpenFOAM is free software: you can redistribute it and/or modify it
+    under the terms of the GNU General Public License as published by
+    the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+    for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+
+\*---------------------------------------------------------------------------*/
+
+#include "nullObject.H"
+
+// * * * * * * * * * * * * * * Static Data Members * * * * * * * * * * * * * //
+
+const Foam::NullObject Foam::NullObject::nullObject;
+const Foam::NullObject* Foam::nullObjectPtr = &Foam::NullObject::nullObject;
+
+
+// ************************************************************************* //
diff --git a/src/OpenFOAM/primitives/nullObject/nullObject.H b/src/OpenFOAM/primitives/nullObject/nullObject.H
new file mode 100644
index 00000000..d324a925
--- /dev/null
+++ b/src/OpenFOAM/primitives/nullObject/nullObject.H
@@ -0,0 +1,110 @@
+/*---------------------------------------------------------------------------*\
+  =========                 |
+  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+   \\    /   O peration     |
+    \\  /    A nd           | Copyright (C) 2014 OpenFOAM Foundation
+     \\/     M anipulation  |
+-------------------------------------------------------------------------------
+License
+    This file is part of OpenFOAM.
+
+    OpenFOAM is free software: you can redistribute it and/or modify it
+    under the terms of the GNU General Public License as published by
+    the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+    for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+
+Class
+    Foam::nullObject
+
+Description
+    Singleton null-object class and instance
+
+SourceFiles
+    nullObjectI.H
+    nullObject.C
+
+\*---------------------------------------------------------------------------*/
+
+#ifndef nullObject_H
+#define nullObject_H
+
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
+
+namespace Foam
+{
+
+/*---------------------------------------------------------------------------*\
+                         Class nullObject Declaration
+\*---------------------------------------------------------------------------*/
+
+class NullObject
+{
+    //- Private constructor
+    NullObject()
+    {}
+
+    //- Prevent copy-construction
+    NullObject(const NullObject&);
+
+    //- Prevent assignment
+    NullObject& operator=(const NullObject&);
+
+public:
+
+    //- The unique null object
+    static const NullObject nullObject;
+};
+
+
+//- Pointer to the unique nullObject
+extern const NullObject* nullObjectPtr;
+
+
+//- Return reference to the nullObject of type T
+template <class T>
+inline const T& NullObjectRef();
+
+//- Return pointer to the nullObject of type T
+template <class T>
+inline const T* NullObjectPtr();
+
+
+//- Return true if t is a reference to the nullObject of type T
+template <class T>
+inline bool isNull(const T& t);
+
+//- Return true if t is not a reference to the nullObject of type T
+template <class T>
+inline bool notNull(const T& t);
+
+
+//- Return true if t is a pointer to the nullObject of type T
+template <class T>
+inline bool isNull(const T* t);
+
+//- Return true if t is not a pointer to the nullObject of type T
+template <class T>
+inline bool notNull(const T* t);
+
+
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
+
+} // End namespace Foam
+
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
+
+#include "nullObjectI.H"
+
+// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
+
+#endif
+
+// ************************************************************************* //
diff --git a/src/OpenFOAM/primitives/nullObject/nullObjectI.H b/src/OpenFOAM/primitives/nullObject/nullObjectI.H
new file mode 100644
index 00000000..4f8fbc1f
--- /dev/null
+++ b/src/OpenFOAM/primitives/nullObject/nullObjectI.H
@@ -0,0 +1,65 @@
+/*---------------------------------------------------------------------------*\
+  =========                 |
+  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+   \\    /   O peration     |
+    \\  /    A nd           | Copyright (C) 2014 OpenFOAM Foundation
+     \\/     M anipulation  |
+-------------------------------------------------------------------------------
+License
+    This file is part of OpenFOAM.
+
+    OpenFOAM is free software: you can redistribute it and/or modify it
+    under the terms of the GNU General Public License as published by
+    the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+    for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+
+\*---------------------------------------------------------------------------*/
+
+template <class T>
+inline const T& Foam::NullObjectRef()
+{
+    return *reinterpret_cast<const T*>(nullObjectPtr);
+}
+
+template <class T>
+inline const T* Foam::NullObjectPtr()
+{
+    return reinterpret_cast<const T*>(nullObjectPtr);
+}
+
+
+template <class T>
+inline bool Foam::isNull(const T& t)
+{
+    return &t == NullObjectPtr<T>();
+}
+
+template <class T>
+inline bool Foam::notNull(const T& t)
+{
+    return &t != NullObjectPtr<T>();
+}
+
+
+template <class T>
+inline bool Foam::isNull(const T* t)
+{
+    return t == NullObjectPtr<T>();
+}
+
+template <class T>
+inline bool Foam::notNull(const T* t)
+{
+    return t != NullObjectPtr<T>();
+}
+
+
+// ************************************************************************* //
diff --git a/src/OpenFOAM/primitives/ranges/labelRange/labelRangeI.H b/src/OpenFOAM/primitives/ranges/labelRange/labelRangeI.H
index eaafd563..f5d3079b 100644
--- a/src/OpenFOAM/primitives/ranges/labelRange/labelRangeI.H
+++ b/src/OpenFOAM/primitives/ranges/labelRange/labelRangeI.H
@@ -23,6 +23,8 @@ License
 
 \*---------------------------------------------------------------------------*/
 
+#include "nullObject.H"
+
 
 // * * * * * * * * * * * * * * * * Constructors  * * * * * * * * * * * * * * //
 
@@ -50,7 +52,7 @@ inline Foam::labelRange::labelRange(const label start, const label size)
 
 inline Foam::labelRange::const_iterator::const_iterator()
 :
-   range_(*reinterpret_cast< Foam::labelRange* >(0)),
+   range_(NullObjectRef<Foam::labelRange>()),
    index_(-1)
 {}
 
diff --git a/src/OpenFOAM/primitives/ranges/labelRange/labelRangesI.H b/src/OpenFOAM/primitives/ranges/labelRange/labelRangesI.H
index 2c6f75ae..3a91d64c 100644
--- a/src/OpenFOAM/primitives/ranges/labelRange/labelRangesI.H
+++ b/src/OpenFOAM/primitives/ranges/labelRange/labelRangesI.H
@@ -42,7 +42,7 @@ inline Foam::labelRanges::labelRanges(const label nElem)
 
 inline Foam::labelRanges::const_iterator::const_iterator()
 :
-   list_(*reinterpret_cast< Foam::labelRanges* >(0)),
+   list_(NullObjectRef<Foam::labelRanges>()),
    index_(-1),
    subIndex_(-1)
 {}
diff --git a/src/Pstream/Allwmake b/src/Pstream/Allwmake
index 50ccb5fe..3c7de703 100755
--- a/src/Pstream/Allwmake
+++ b/src/Pstream/Allwmake
@@ -10,30 +10,32 @@ makeType=${1:-libso}
 #
 wmakeMpiLib()
 {
-    set +x
+    [ -z "$WM_SILENT_RULES" ] && set +x
     for libName
     do
     (
         WM_OPTIONS="$WM_OPTIONS$WM_MPLIB"
-        whichmpi="$libName/Make/$WM_OPTIONS/using:$FOAM_MPI"
+        whichmpi="$WM_PROJECT_DIR/platforms/$WM_OPTIONS/src/Pstream/$libName/using:$FOAM_MPI"
         [ -e "$whichmpi" ] || wclean $libName
-        echo "wmake $makeType $libName"
-        wmake $makeType $libName
+        [ -z "$WM_SILENT_RULES" ] && echo "wmake $makeType $libName"
+        wmake $makeType $libName 2>/dev/null
         touch "$whichmpi"
     )
     done
-    set -x
+    [ -z "$WM_SILENT_RULES" ] && set -x
 }
 
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 wmake $makeType dummy
 
 case "$WM_MPLIB" in
 *MPI*)
-    set +x
+    [ -z "$WM_SILENT_RULES" ] && set +x
+    [ -z "$WM_SILENT_RULES" ] && {
     echo
     echo "Note: ignore spurious warnings about missing mpicxx.h headers"
     echo
+    }
     wmakeMpiLib mpi
     ;;
 
diff --git a/src/Pstream/mpi/Make/options b/src/Pstream/mpi/Make/options
index 74b66596..60bb85af 100644
--- a/src/Pstream/mpi/Make/options
+++ b/src/Pstream/mpi/Make/options
@@ -1,5 +1,9 @@
 sinclude $(GENERAL_RULES)/mplib$(WM_MPLIB)
 sinclude $(RULES)/mplib$(WM_MPLIB)
 
+ifneq ($(WM_SILENT_RULES),)
+c++FLAGS += -w
+endif
+
 EXE_INC  = $(PFLAGS) $(PINC)
 LIB_LIBS = $(PLIBS)
diff --git a/src/conversion/Allwmake b/src/conversion/Allwmake
index 014885de..0137b992 100755
--- a/src/conversion/Allwmake
+++ b/src/conversion/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType
 
diff --git a/src/conversion/ensight/part/ensightPartCells.C b/src/conversion/ensight/part/ensightPartCells.C
index 80f0cdc4..f92a916c 100644
--- a/src/conversion/ensight/part/ensightPartCells.C
+++ b/src/conversion/ensight/part/ensightPartCells.C
@@ -67,7 +67,7 @@ void Foam::ensightPartCells::classify
     size_ = mesh.nCells();
 
     bool limited = false;
-    if (&idList)
+    if (notNull(idList))
     {
         limited = true;
         size_ = idList.size();
@@ -182,7 +182,7 @@ Foam::ensightPartCells::ensightPartCells
 )
 :
     ensightPart(partNumber, partDescription),
-    mesh_(*reinterpret_cast<polyMesh*>(0))
+    mesh_(NullObjectRef<polyMesh>())
 {}
 
 
@@ -237,7 +237,7 @@ Foam::ensightPartCells::ensightPartCells(const ensightPartCells& part)
 Foam::ensightPartCells::ensightPartCells(Istream& is)
 :
     ensightPart(),
-    mesh_(*reinterpret_cast<polyMesh*>(0))
+    mesh_(NullObjectRef<polyMesh>())
 {
     reconstruct(is);
 }
diff --git a/src/conversion/ensight/part/ensightPartIO.C b/src/conversion/ensight/part/ensightPartIO.C
index 7fe2e6ea..6d827d7e 100644
--- a/src/conversion/ensight/part/ensightPartIO.C
+++ b/src/conversion/ensight/part/ensightPartIO.C
@@ -59,7 +59,7 @@ void Foam::ensightPart::writeFieldList
     const labelUList& idList
 ) const
 {
-    if (&idList)
+    if (notNull(idList))
     {
         forAll(idList, i)
         {
diff --git a/src/dummyThirdParty/Allwmake b/src/dummyThirdParty/Allwmake
index d747a472..938d1691 100755
--- a/src/dummyThirdParty/Allwmake
+++ b/src/dummyThirdParty/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType scotchDecomp
 wmake $makeType ptscotchDecomp
diff --git a/src/dummyThirdParty/metisDecomp/metis.h b/src/dummyThirdParty/metisDecomp/metis.h
index 7b6ca31f..c5adaad0 100644
--- a/src/dummyThirdParty/metisDecomp/metis.h
+++ b/src/dummyThirdParty/metisDecomp/metis.h
@@ -11,7 +11,7 @@
 #define IDXTYPEWIDTH 32
 
 /*------------------------------------------------------------------------
-* Undefine the following #define in order to use short idxtype as the idxtype 
+* Undefine the following #define in order to use short idxtype as the idxtype
 *-------------------------------------------------------------------------*/
 #if IDXTYPEWIDTH == 32
   #define SCNIDX  SCNd32
@@ -29,17 +29,17 @@
 
 
 void METIS_WPartGraphRecursive(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt,
-                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, float *tpwgts, 
+                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, float *tpwgts,
                    idxtype *options, idxtype *edgecut, idxtype *part);
 void METIS_PartGraphRecursive(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt,
-                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, idxtype *options, 
+                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, idxtype *options,
+                   idxtype *edgecut, idxtype *part);
+void METIS_WPartGraphKway(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt,
+                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, float *tpwgts,
+                   idxtype *options, idxtype *edgecut, idxtype *part);
+void METIS_PartGraphKway(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt,
+                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, idxtype *options,
                    idxtype *edgecut, idxtype *part);
-void METIS_WPartGraphKway(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt, 
-                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, float *tpwgts, 
-                   idxtype *options, idxtype *edgecut, idxtype *part); 
-void METIS_PartGraphKway(idxtype *nvtxs, idxtype *xadj, idxtype *adjncy, idxtype *vwgt, 
-                   idxtype *adjwgt, idxtype *wgtflag, idxtype *numflag, idxtype *nparts, idxtype *options, 
-                   idxtype *edgecut, idxtype *part); 
 
 
 
diff --git a/src/edgeMesh/edgeMesh.C b/src/edgeMesh/edgeMesh.C
index 7e2a3972..fa00fe7a 100644
--- a/src/edgeMesh/edgeMesh.C
+++ b/src/edgeMesh/edgeMesh.C
@@ -182,12 +182,12 @@ void Foam::edgeMesh::reset
 {
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&pointLst)
+    if (notNull(pointLst))
     {
         points_.transfer(pointLst());
     }
 
-    if (&edgeLst)
+    if (notNull(edgeLst))
     {
         edges_.transfer(edgeLst());
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.C b/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.C
index d70c040c..0374f953 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.C
+++ b/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.C
@@ -150,7 +150,7 @@ void Foam::porosityModels::DarcyForchheimer::correct
     const scalarField& V = mesh_.V();
     scalarField& Udiag = UEqn.diag();
     vectorField& Usource = UEqn.source();
- 
+
     if (UEqn.dimensions() == dimForce)
     {
         const volScalarField& rho =
@@ -181,7 +181,7 @@ void Foam::porosityModels::DarcyForchheimer::correct
     const scalarField& V = mesh_.V();
     scalarField& Udiag = UEqn.diag();
     vectorField& Usource = UEqn.source();
- 
+
     apply(Udiag, Usource, V, rho, mu, U);
 }
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.H b/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.H
index 51107928..2f6f00b2 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.H
+++ b/src/finiteVolume/cfdTools/general/porosityModel/DarcyForchheimer/DarcyForchheimer.H
@@ -170,7 +170,7 @@ public:
         virtual void correct
         (
             const fvVectorMatrix& UEqn,
-            volTensorField& AU            
+            volTensorField& AU
         ) const;
 
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.C b/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.C
index bcc8554d..e63b2031 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.C
+++ b/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.C
@@ -202,7 +202,7 @@ void Foam::porosityModels::fixedCoeff::correct
     const scalarField& V = mesh_.V();
     scalarField& Udiag = UEqn.diag();
     vectorField& Usource = UEqn.source();
- 
+
     scalar rho = 1.0;
     if (UEqn.dimensions() == dimForce)
     {
@@ -230,7 +230,7 @@ void Foam::porosityModels::fixedCoeff::correct
     {
         coeffs_.lookup("rhoRef") >> rho;
     }
- 
+
     apply(Udiag, Usource, V, U, rho);
 }
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.H b/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.H
index 15813183..345f0b6c 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.H
+++ b/src/finiteVolume/cfdTools/general/porosityModel/fixedCoeff/fixedCoeff.H
@@ -147,7 +147,7 @@ public:
         virtual void correct
         (
             const fvVectorMatrix& UEqn,
-            volTensorField& AU            
+            volTensorField& AU
         ) const;
 
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModel.C b/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModel.C
index f940ff2c..5aacf6fc 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModel.C
+++ b/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModel.C
@@ -187,7 +187,7 @@ void Foam::porosityModel::addResistance
 (
     const fvVectorMatrix& UEqn,
     volTensorField& AU,
-    bool correctAUprocBC         
+    bool correctAUprocBC
 ) const
 {
     if (cellZoneIds_.empty())
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModelList.C b/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModelList.C
index df302854..ca382557 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModelList.C
+++ b/src/finiteVolume/cfdTools/general/porosityModel/porosityModel/porosityModelList.C
@@ -153,7 +153,7 @@ void Foam::porosityModelList::addResistance
 (
     const fvVectorMatrix& UEqn,
     volTensorField& AU,
-    bool correctAUprocBC         
+    bool correctAUprocBC
 ) const
 {
     forAll(*this, i)
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.C b/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.C
index 485f0beb..b3134ecd 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.C
+++ b/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.C
@@ -91,7 +91,7 @@ void Foam::porosityModels::powerLaw::correct
     const vectorField& U = UEqn.psi();
     const scalarField& V = mesh_.V();
     scalarField& Udiag = UEqn.diag();
- 
+
     if (UEqn.dimensions() == dimForce)
     {
         const volScalarField& rho =
@@ -116,7 +116,7 @@ void Foam::porosityModels::powerLaw::correct
     const vectorField& U = UEqn.psi();
     const scalarField& V = mesh_.V();
     scalarField& Udiag = UEqn.diag();
- 
+
     apply(Udiag, V, rho, U);
 }
 
diff --git a/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.H b/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.H
index 299335b7..64fe5ff2 100644
--- a/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.H
+++ b/src/finiteVolume/cfdTools/general/porosityModel/powerLaw/powerLaw.H
@@ -151,7 +151,7 @@ public:
         virtual void correct
         (
             const fvVectorMatrix& UEqn,
-            volTensorField& AU            
+            volTensorField& AU
         ) const;
 
 
diff --git a/src/finiteVolume/fields/fvPatchFields/basic/fixedGradient/fixedGradientFvPatchField.H b/src/finiteVolume/fields/fvPatchFields/basic/fixedGradient/fixedGradientFvPatchField.H
index 3d007354..6b9d2a5d 100644
--- a/src/finiteVolume/fields/fvPatchFields/basic/fixedGradient/fixedGradientFvPatchField.H
+++ b/src/finiteVolume/fields/fvPatchFields/basic/fixedGradient/fixedGradientFvPatchField.H
@@ -47,7 +47,7 @@ Description
 
     \table
         Property     | Description             | Required    | Default value
-        gradient     | gradient                | yes         | 
+        gradient     | gradient                | yes         |
     \endtable
 
     Example of the boundary condition specification:
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/flowRateInletVelocity/flowRateInletVelocityFvPatchVectorField.H b/src/finiteVolume/fields/fvPatchFields/derived/flowRateInletVelocity/flowRateInletVelocityFvPatchVectorField.H
index 80512611..de5e29dd 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/flowRateInletVelocity/flowRateInletVelocityFvPatchVectorField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/flowRateInletVelocity/flowRateInletVelocityFvPatchVectorField.H
@@ -71,7 +71,7 @@ Description
         rhoInlet            1.0;
     }
     \endverbatim
-    
+
     The \c flowRate entry is a \c DataEntry type, meaning that it can be
     specified as constant, a polynomial fuction of time, and ...
 
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/inletOutletTotalTemperature/inletOutletTotalTemperatureFvPatchScalarField.H b/src/finiteVolume/fields/fvPatchFields/derived/inletOutletTotalTemperature/inletOutletTotalTemperatureFvPatchScalarField.H
index 430ee1e5..a0923e05 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/inletOutletTotalTemperature/inletOutletTotalTemperatureFvPatchScalarField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/inletOutletTotalTemperature/inletOutletTotalTemperatureFvPatchScalarField.H
@@ -58,7 +58,7 @@ Description
         value           uniform 0;
     }
     \endverbatim
-   
+
 SeeAlso
     Foam::inletOutletFvPatchField
 
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/mappedFixedValue/mappedFixedValueFvPatchField.H b/src/finiteVolume/fields/fvPatchFields/derived/mappedFixedValue/mappedFixedValueFvPatchField.H
index 011ec5b2..fdf1caa2 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/mappedFixedValue/mappedFixedValueFvPatchField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/mappedFixedValue/mappedFixedValueFvPatchField.H
@@ -29,11 +29,11 @@ Group
 
 Description
     This boundary condition maps the value at a set of cells or patch faces
-    back to *this.  
+    back to *this.
 
     The sample mode is set by the underlying mapping engine, provided by the
     mappedPatchBase class.
-    
+
     \heading Patch usage
 
     \table
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/pressureDirectedInletVelocity/pressureDirectedInletVelocityFvPatchVectorField.H b/src/finiteVolume/fields/fvPatchFields/derived/pressureDirectedInletVelocity/pressureDirectedInletVelocityFvPatchVectorField.H
index c98ad304..de652495 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/pressureDirectedInletVelocity/pressureDirectedInletVelocityFvPatchVectorField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/pressureDirectedInletVelocity/pressureDirectedInletVelocityFvPatchVectorField.H
@@ -54,7 +54,7 @@ Description
     \endverbatim
 
 Note
-    If reverse flow is possible or expected use the 
+    If reverse flow is possible or expected use the
     pressureDirectedInletOutletVelocityFvPatchVectorField condition instead.
 
 
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/rotatingPressureInletOutletVelocity/rotatingPressureInletOutletVelocityFvPatchVectorField.H b/src/finiteVolume/fields/fvPatchFields/derived/rotatingPressureInletOutletVelocity/rotatingPressureInletOutletVelocityFvPatchVectorField.H
index cc114d7c..5bb40741 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/rotatingPressureInletOutletVelocity/rotatingPressureInletOutletVelocityFvPatchVectorField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/rotatingPressureInletOutletVelocity/rotatingPressureInletOutletVelocityFvPatchVectorField.H
@@ -39,7 +39,7 @@ Description
         Property     | Description             | Required    | Default value
         phi          | flux field name         | no          | phi
         tangentialVelocity | tangential velocity field | no  |
-        omega        | angular velocty of the frame [rad/s] | yes    | 
+        omega        | angular velocty of the frame [rad/s] | yes    |
     \endtable
 
     Example of the boundary condition specification:
@@ -49,7 +49,7 @@ Description
         type            rotatingPressureInletOutletVelocity;
         phi             phi;
         tangentialVelocity uniform (0 0 0);
-        omega           100;        
+        omega           100;
     }
     \endverbatim
 
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/rotatingTotalPressure/rotatingTotalPressureFvPatchScalarField.H b/src/finiteVolume/fields/fvPatchFields/derived/rotatingTotalPressure/rotatingTotalPressureFvPatchScalarField.H
index 22d806c3..53f16ffe 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/rotatingTotalPressure/rotatingTotalPressureFvPatchScalarField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/rotatingTotalPressure/rotatingTotalPressureFvPatchScalarField.H
@@ -41,7 +41,7 @@ Description
         psi          | compressibility field name | no       | none
         gamma        | ratio of specific heats (Cp/Cv) | yes |
         p0           | static pressure reference | yes       |
-        omega        | angular velocty of the frame [rad/s] | yes    | 
+        omega        | angular velocty of the frame [rad/s] | yes    |
     \endtable
 
     Example of the boundary condition specification:
@@ -55,7 +55,7 @@ Description
         psi             psi;
         gamma           1.4;
         p0              uniform 1e5;
-        omega           100;        
+        omega           100;
     }
     \endverbatim
 
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/rotatingWallVelocity/rotatingWallVelocityFvPatchVectorField.H b/src/finiteVolume/fields/fvPatchFields/derived/rotatingWallVelocity/rotatingWallVelocityFvPatchVectorField.H
index a3d5d568..cba0050c 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/rotatingWallVelocity/rotatingWallVelocityFvPatchVectorField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/rotatingWallVelocity/rotatingWallVelocityFvPatchVectorField.H
@@ -36,7 +36,7 @@ Description
         Property     | Description             | Required    | Default value
         origin       | origin of rotation in Cartesian co-ordinates | yes|
         axis         | axis of rotation        | yes         |
-        omega        | angular velocty of the frame [rad/s] | yes    | 
+        omega        | angular velocty of the frame [rad/s] | yes    |
     \endtable
 
     Example of the boundary condition specification:
@@ -52,7 +52,7 @@ Description
 
     The \c omega entry is a DataEntry type, able to describe time varying
     functions.
-    
+
 SeeAlso
     Foam::DataEntry
     Foam::fixedValueFvPatchField
diff --git a/src/finiteVolume/fields/fvPatchFields/derived/supersonicFreestream/supersonicFreestreamFvPatchVectorField.H b/src/finiteVolume/fields/fvPatchFields/derived/supersonicFreestream/supersonicFreestreamFvPatchVectorField.H
index 6f6ea27b..a00814c9 100644
--- a/src/finiteVolume/fields/fvPatchFields/derived/supersonicFreestream/supersonicFreestreamFvPatchVectorField.H
+++ b/src/finiteVolume/fields/fvPatchFields/derived/supersonicFreestream/supersonicFreestreamFvPatchVectorField.H
@@ -46,7 +46,7 @@ Description
         UInf         | free-stream velocity    | yes         |
         pInf         | free-stream pressure    | yes         |
         TInf         | free-stream temperature | yes         |
-        gamma        | heat capacity ratio (cp/Cv) | yes     | 
+        gamma        | heat capacity ratio (cp/Cv) | yes     |
     \endtable
 
     Example of the boundary condition specification:
diff --git a/src/finiteVolume/fields/fvPatchFields/fvPatchField/fvPatchField.C b/src/finiteVolume/fields/fvPatchFields/fvPatchField/fvPatchField.C
index e9c57903..17844397 100644
--- a/src/finiteVolume/fields/fvPatchFields/fvPatchField/fvPatchField.C
+++ b/src/finiteVolume/fields/fvPatchFields/fvPatchField/fvPatchField.C
@@ -78,14 +78,14 @@ Foam::fvPatchField<Type>::fvPatchField
     patchType_(ptf.patchType_)
 {
     // For unmapped faces set to internal field value (zero-gradient)
-    if (&iF && iF.size())
+    if (reinterpret_cast<const void*>(&iF) && iF.size())
     {
         Field<Type>& f = *this;
 
         if
         (
             mapper.direct()
-         && &mapper.directAddressing()
+         && reinterpret_cast<const void*>(&mapper.directAddressing())
          && mapper.directAddressing().size()
         )
         {
@@ -262,7 +262,7 @@ void Foam::fvPatchField<Type>::autoMap
         if
         (
             mapper.direct()
-         && &mapper.directAddressing()
+         && reinterpret_cast<const void*>(&mapper.directAddressing())
          && mapper.directAddressing().size()
         )
         {
diff --git a/src/fvAgglomerationMethods/Allwmake b/src/fvAgglomerationMethods/Allwmake
index abbcf466..de88ae3e 100755
--- a/src/fvAgglomerationMethods/Allwmake
+++ b/src/fvAgglomerationMethods/Allwmake
@@ -1,13 +1,22 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
-export ParMGridGen=$WM_THIRD_PARTY_DIR/ParMGridGen-1.0
+if [ "$(uname -s)" != "Darwin" ]; then
+	export ParMGridGen=$WM_THIRD_PARTY_DIR/ParMGridGen-1.0
 
-if [ -e "$FOAM_LIBBIN/libMGridGen.so" ]
-then
-    wmake $makeType MGridGenGamgAgglomeration
+	if [ -e "$FOAM_LIBBIN/libMGridGen.so" ]
+	then
+		wmake $makeType MGridGenGamgAgglomeration
+	fi
+else
+	export ParMGridGen=/usr/local/opt/parmgridgen
+
+	if [ -e "$ParMGridGen/lib/libmgrid.a" ]
+	then
+		wmake $makeType MGridGenGamgAgglomeration
+	fi
 fi
 
 wmake $makeType pairPatchAgglomeration
diff --git a/src/fvAgglomerationMethods/MGridGenGamgAgglomeration/Make/options b/src/fvAgglomerationMethods/MGridGenGamgAgglomeration/Make/options
index a58b65fb..44bbdcb6 100644
--- a/src/fvAgglomerationMethods/MGridGenGamgAgglomeration/Make/options
+++ b/src/fvAgglomerationMethods/MGridGenGamgAgglomeration/Make/options
@@ -5,6 +5,15 @@ TYPE_REAL=
 TYPE_REAL=-DTYPE_REAL
 #endif
 
+#if defined(darwin64)
+EXE_INC = \
+    -I$(LIB_SRC)/finiteVolume/lnInclude \
+    -I$(ParMGridGen)/include \
+    $(TYPE_REAL)
+
+LIB_LIBS = \
+    -L$(ParMGridGen)/lib -lmgrid
+#else
 EXE_INC = \
     -I$(LIB_SRC)/finiteVolume/lnInclude \
     -I$(ParMGridGen)/MGridGen/Lib/lnInclude \
@@ -13,3 +22,4 @@ EXE_INC = \
 
 LIB_LIBS = \
     -L$(FOAM_EXT_LIBBIN) -lMGridGen
+#endif
diff --git a/src/fvOptions/Make/options b/src/fvOptions/Make/options
index a98e673d..e8de5c7a 100644
--- a/src/fvOptions/Make/options
+++ b/src/fvOptions/Make/options
@@ -13,5 +13,4 @@ LIB_LIBS = \
     -lfiniteVolume \
     -lsampling \
     -lmeshTools \
-    /*-lsolidThermo*/ \
     -lcompressibleTurbulenceModel
diff --git a/src/lagrangian/Allwmake b/src/lagrangian/Allwmake
index a4be0856..ad73243a 100755
--- a/src/lagrangian/Allwmake
+++ b/src/lagrangian/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType distributionModels
 wmake $makeType basic
diff --git a/src/lagrangian/coalCombustion/submodels/surfaceReactionModel/COxidationHurtMitchell/COxidationHurtMitchell.H b/src/lagrangian/coalCombustion/submodels/surfaceReactionModel/COxidationHurtMitchell/COxidationHurtMitchell.H
index cd780032..dcf71cc2 100644
--- a/src/lagrangian/coalCombustion/submodels/surfaceReactionModel/COxidationHurtMitchell/COxidationHurtMitchell.H
+++ b/src/lagrangian/coalCombustion/submodels/surfaceReactionModel/COxidationHurtMitchell/COxidationHurtMitchell.H
@@ -41,7 +41,7 @@ Description
     Model validity:
         Gas temperature: Tc > 1500 K
         Particle sizes:  75 um -> 200 um
-        Pox > 0.3 atm        
+        Pox > 0.3 atm
 
 \*---------------------------------------------------------------------------*/
 
diff --git a/src/lagrangian/distributionModels/uniform/uniform.C b/src/lagrangian/distributionModels/uniform/uniform.C
index 4d1504b6..c2681665 100644
--- a/src/lagrangian/distributionModels/uniform/uniform.C
+++ b/src/lagrangian/distributionModels/uniform/uniform.C
@@ -47,8 +47,7 @@ Foam::distributionModels::uniform::uniform
 :
     distributionModel(typeName, dict, rndGen),
     minValue_(readScalar(distributionModelDict_.lookup("minValue"))),
-    maxValue_(readScalar(distributionModelDict_.lookup("maxValue"))),
-    range_(maxValue_ - minValue_)
+    maxValue_(readScalar(distributionModelDict_.lookup("maxValue")))
 {
     check();
 }
diff --git a/src/lagrangian/distributionModels/uniform/uniform.H b/src/lagrangian/distributionModels/uniform/uniform.H
index 5a8f6650..524a86fc 100644
--- a/src/lagrangian/distributionModels/uniform/uniform.H
+++ b/src/lagrangian/distributionModels/uniform/uniform.H
@@ -61,7 +61,7 @@ class uniform
         scalar maxValue_;
 
         //- Distribution range
-        scalar range_;
+        // scalar range_;
 
 
 public:
diff --git a/src/lagrangian/intermediate/submodels/Kinematic/InjectionModel/InjectionModel/InjectionModelList.H b/src/lagrangian/intermediate/submodels/Kinematic/InjectionModel/InjectionModel/InjectionModelList.H
index 22213e20..68757790 100644
--- a/src/lagrangian/intermediate/submodels/Kinematic/InjectionModel/InjectionModel/InjectionModelList.H
+++ b/src/lagrangian/intermediate/submodels/Kinematic/InjectionModel/InjectionModel/InjectionModelList.H
@@ -89,7 +89,7 @@ public:
 
             //- Return the maximum end-of-injection time
             scalar timeEnd() const;
- 
+
             //- Volume of parcels to introduce relative to SOI
             scalar volumeToInject(const scalar time0, const scalar time1);
 
diff --git a/src/lagrangian/molecularDynamics/Allwmake b/src/lagrangian/molecularDynamics/Allwmake
index 7c17819a..0dbfb47a 100755
--- a/src/lagrangian/molecularDynamics/Allwmake
+++ b/src/lagrangian/molecularDynamics/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType potential
 wmake $makeType molecularMeasurements
diff --git a/src/lagrangian/spray/submodels/BreakupModel/PilchErdman/PilchErdman.H b/src/lagrangian/spray/submodels/BreakupModel/PilchErdman/PilchErdman.H
index 69190de1..09d1f3fe 100644
--- a/src/lagrangian/spray/submodels/BreakupModel/PilchErdman/PilchErdman.H
+++ b/src/lagrangian/spray/submodels/BreakupModel/PilchErdman/PilchErdman.H
@@ -51,7 +51,7 @@ Description
     The authors suggest that:
         compressible flow   : B1 = 0.75*1.0; B2 = 3*0.116
         incompressible flow : B1 = 0.75*0.5; B2 = 3*0.0758
-        
+
 
 \*---------------------------------------------------------------------------*/
 
diff --git a/src/mesh/Allwmake b/src/mesh/Allwmake
index 4653b1d3..abb01b19 100755
--- a/src/mesh/Allwmake
+++ b/src/mesh/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType autoMesh
 wmake $makeType blockMesh
diff --git a/src/meshTools/edgeFaceCirculator/edgeFaceCirculator.C b/src/meshTools/edgeFaceCirculator/edgeFaceCirculator.C
index 9149eaf9..e9a4ff6e 100644
--- a/src/meshTools/edgeFaceCirculator/edgeFaceCirculator.C
+++ b/src/meshTools/edgeFaceCirculator/edgeFaceCirculator.C
@@ -30,7 +30,7 @@ License
 
 const Foam::edgeFaceCirculator Foam::edgeFaceCirculator::endConstIter
 (
-    *reinterpret_cast<primitiveMesh*>(0),       // primitiveMesh
+    NullObjectRef<primitiveMesh>(),             // primitiveMesh
     -1,                                         // faceLabel
     false,                                      // ownerSide
     -1,                                         // index
diff --git a/src/meshTools/momentOfInertia/volumeIntegration/volInt.c b/src/meshTools/momentOfInertia/volumeIntegration/volInt.c
index 76016554..9e8db568 100644
--- a/src/meshTools/momentOfInertia/volumeIntegration/volInt.c
+++ b/src/meshTools/momentOfInertia/volumeIntegration/volInt.c
@@ -34,8 +34,8 @@
 			Thanks to Zoran Popovic for catching this one.
 
 	27 May 1997     Corrected sign error in translation of inertia
-	                product terms to center of mass frame.  Changes 
-			confined to function main().  Thanks to 
+	                product terms to center of mass frame.  Changes
+			confined to function main().  Thanks to
 			Chris Hecker.
 */
 
@@ -123,16 +123,16 @@ void readPolyhedron(char *name, POLYHEDRON *p)
   double dx1, dy1, dz1, dx2, dy2, dz2, nx, ny, nz, len;
   FACE *f;
 
-  
+
   if (!(fp = fopen(name, "r"))) {
     printf("i/o error\n");
     exit(1);
   }
-  
+
   fscanf(fp, "%d", &p->numVerts);
   printf("Reading in %d vertices\n", p->numVerts);
   for (i = 0; i < p->numVerts; i++)
-    fscanf(fp, "%lf %lf %lf", 
+    fscanf(fp, "%lf %lf %lf",
 	   &p->verts[i][X], &p->verts[i][Y], &p->verts[i][Z]);
 
   fscanf(fp, "%d", &p->numFaces);
@@ -196,7 +196,7 @@ void compProjectionIntegrals(FACE *f)
     db = b1 - b0;
     a0_2 = a0 * a0; a0_3 = a0_2 * a0; a0_4 = a0_3 * a0;
     b0_2 = b0 * b0; b0_3 = b0_2 * b0; b0_4 = b0_3 * b0;
-    a1_2 = a1 * a1; a1_3 = a1_2 * a1; 
+    a1_2 = a1 * a1; a1_3 = a1_2 * a1;
     b1_2 = b1 * b1; b1_3 = b1_2 * b1;
 
     C1 = a1 + a0;
@@ -253,7 +253,7 @@ compFaceIntegrals(FACE *f)
 
   Faaa = k1 * Paaa;
   Fbbb = k1 * Pbbb;
-  Fccc = -k4 * (CUBE(n[A])*Paaa + 3*SQR(n[A])*n[B]*Paab 
+  Fccc = -k4 * (CUBE(n[A])*Paaa + 3*SQR(n[A])*n[B]*Paab
 	   + 3*n[A]*SQR(n[B])*Pabb + CUBE(n[B])*Pbbb
 	   + 3*w*(SQR(n[A])*Paa + 2*n[A]*n[B]*Pab + SQR(n[B])*Pbb)
 	   + w*w*(3*(n[A]*Pa + n[B]*Pb) + w*P1));
@@ -270,8 +270,8 @@ void compVolumeIntegrals(POLYHEDRON *p)
   double nx, ny, nz;
   int i;
 
-  T0 = T1[X] = T1[Y] = T1[Z] 
-     = T2[X] = T2[Y] = T2[Z] 
+  T0 = T1[X] = T1[Y] = T1[Z]
+     = T2[X] = T2[Y] = T2[Z]
      = TP[X] = TP[Y] = TP[Z] = 0;
 
   for (i = 0; i < p->numFaces; i++) {
@@ -336,7 +336,7 @@ int main(int argc, char *argv[])
   printf("Tx =   %+20.6f\n", T1[X]);
   printf("Ty =   %+20.6f\n", T1[Y]);
   printf("Tz =   %+20.6f\n\n", T1[Z]);
-  
+
   printf("Txx =  %+20.6f\n", T2[X]);
   printf("Tyy =  %+20.6f\n", T2[Y]);
   printf("Tzz =  %+20.6f\n\n", T2[Z]);
@@ -366,9 +366,9 @@ int main(int argc, char *argv[])
   J[X][X] -= mass * (r[Y]*r[Y] + r[Z]*r[Z]);
   J[Y][Y] -= mass * (r[Z]*r[Z] + r[X]*r[X]);
   J[Z][Z] -= mass * (r[X]*r[X] + r[Y]*r[Y]);
-  J[X][Y] = J[Y][X] += mass * r[X] * r[Y]; 
-  J[Y][Z] = J[Z][Y] += mass * r[Y] * r[Z]; 
-  J[Z][X] = J[X][Z] += mass * r[Z] * r[X]; 
+  J[X][Y] = J[Y][X] += mass * r[X] * r[Y];
+  J[Y][Z] = J[Z][Y] += mass * r[Y] * r[Z];
+  J[Z][X] = J[X][Z] += mass * r[Z] * r[X];
 
   printf("center of mass:  (%+12.6f,%+12.6f,%+12.6f)\n\n", r[X], r[Y], r[Z]);
 
@@ -376,5 +376,5 @@ int main(int argc, char *argv[])
   printf("%+15.6f  %+15.6f  %+15.6f\n", J[X][X], J[X][Y], J[X][Z]);
   printf("%+15.6f  %+15.6f  %+15.6f\n", J[Y][X], J[Y][Y], J[Y][Z]);
   printf("%+15.6f  %+15.6f  %+15.6f\n\n", J[Z][X], J[Z][Y], J[Z][Z]);
-  
+
 }
diff --git a/src/parallel/Allwmake b/src/parallel/Allwmake
index ab84e5b7..2b8df74b 100755
--- a/src/parallel/Allwmake
+++ b/src/parallel/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 decompose/Allwmake $*
 reconstruct/Allwmake $*
diff --git a/src/parallel/decompose/Allwmake b/src/parallel/decompose/Allwmake
index 5cea1fbd..ea30c70a 100755
--- a/src/parallel/decompose/Allwmake
+++ b/src/parallel/decompose/Allwmake
@@ -6,11 +6,15 @@ makeType=${1:-libso}
 if settings=`$WM_PROJECT_DIR/bin/foamEtcFile config/scotch.sh`
 then
     . $settings
+    [ -z "$WM_SILENT_RULES" ] && {
     echo "using SCOTCH_ARCH_PATH=$SCOTCH_ARCH_PATH"
+    }
 else
+    [ -z "$WM_SILENT_RULES" ] && {
     echo
     echo "Error: no config/scotch.sh settings"
     echo
+    }
 fi
 
 
@@ -21,23 +25,23 @@ fi
 #
 wmakeMpiLib()
 {
-    set +x
+    [ -z "$WM_SILENT_RULES" ] && set +x
     for libName
     do
     (
         WM_OPTIONS="$WM_OPTIONS$WM_MPLIB"
-        whichmpi="$libName/Make/$WM_OPTIONS/using:$FOAM_MPI"
-        whichscotch="$libName/Make/$WM_OPTIONS/using:$SCOTCH_VERSION"
+        whichmpi="$WM_PROJECT_DIR/platforms/$WM_OPTIONS/src/parallel/decompose/$libName/using:$FOAM_MPI"
+        whichscotch="$WM_PROJECT_DIR/platforms/$WM_OPTIONS/src/parallel/decompose/$libName/using:$SCOTCH_VERSION"
         [ -e "$whichmpi" -a -e "$whichscotch" ] || wclean $libName
-        echo "wmake $makeType $libName"
+        [ -z "$WM_SILENT_RULES" ] && echo "wmake $makeType $libName"
         wmake $makeType $libName
         touch "$whichmpi" "$whichscotch"
     )
     done
-    set -x
+    [ -z "$WM_SILENT_RULES" ] && set -x
 }
 
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmakeLnInclude decompositionMethods
 
@@ -47,19 +51,15 @@ then
 
     if [ -d "$FOAM_LIBBIN/$FOAM_MPI" ]
     then
-        #- Bit of a hack: ptscotch 6 requires scotch linked as well as. Can be
-        #  removed once ptscotch declares dependency on scotch itself.
-        if [ "$SCOTCH_VERSION" = "scotch_6.0.0" ]
-        then
-            export LINK_FLAGS="-lscotch"
-        fi
-
+		export LINK_FLAGS="-lscotch"
         wmakeMpiLib ptscotchDecomp
     fi
 else
+    [ -z "$WM_SILENT_RULES" ] && {
     echo
     echo "Skipping scotchDecomp (ptscotchDecomp)"
     echo
+    }
 fi
 
 wmake $makeType decompositionMethods
diff --git a/src/parallel/decompose/AllwmakeLnInclude b/src/parallel/decompose/AllwmakeLnInclude
index c6a537aa..9dbb195f 100755
--- a/src/parallel/decompose/AllwmakeLnInclude
+++ b/src/parallel/decompose/AllwmakeLnInclude
@@ -1,6 +1,6 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmakeLnInclude decompositionMethods
 wmakeLnInclude metisDecomp
diff --git a/src/parallel/decompose/ptscotchDecomp/Make/options b/src/parallel/decompose/ptscotchDecomp/Make/options
index acdebd89..b40b7201 100644
--- a/src/parallel/decompose/ptscotchDecomp/Make/options
+++ b/src/parallel/decompose/ptscotchDecomp/Make/options
@@ -3,10 +3,12 @@ sinclude $(RULES)/mplib$(WM_MPLIB)
 
 EXE_INC = \
     $(PFLAGS) $(PINC) \
-    -I$(SCOTCH_ROOT)/include \
-    -I$(SCOTCH_ARCH_PATH)/include/$(FOAM_MPI) \
-    -I/usr/include/scotch \
+    -I$(SCOTCH_ARCH_PATH)/include \
     -I../decompositionMethods/lnInclude
 
 LIB_LIBS = \
-    -L$(SCOTCH_ROOT)/lib -L$(FOAM_EXT_LIBBIN)/$(FOAM_MPI) -lptscotch -lptscotcherrexit ${LINK_FLAGS} -lrt
+    -L$(SCOTCH_ARCH_PATH)/lib -lptscotch -lptscotcherrexit ${LINK_FLAGS}
+
+ifneq ($(shell uname -s),Darwin)
+LIB_LIBS += -lrt
+endif
diff --git a/src/parallel/decompose/scotchDecomp/Make/options b/src/parallel/decompose/scotchDecomp/Make/options
index 3bb11fba..23701f5d 100644
--- a/src/parallel/decompose/scotchDecomp/Make/options
+++ b/src/parallel/decompose/scotchDecomp/Make/options
@@ -7,10 +7,12 @@ sinclude $(RULES)/mplib$(WM_MPLIB)
 
 EXE_INC = \
     $(PFLAGS) $(PINC) \
-    -I$(SCOTCH_ROOT)/include \
     -I$(SCOTCH_ARCH_PATH)/include \
-    -I/usr/include/scotch \
     -I../decompositionMethods/lnInclude
 
 LIB_LIBS = \
-    -L$(SCOTCH_ROOT)/lib -L$(FOAM_EXT_LIBBIN) -lscotch -lscotcherrexit -lrt
+    -L$(SCOTCH_ARCH_PATH)/lib -lscotch -lscotcherrexit
+
+ifneq ($(shell uname -s),Darwin)
+LIB_LIBS += -lrt
+endif
diff --git a/src/parallel/reconstruct/Allwmake b/src/parallel/reconstruct/Allwmake
index 85e8e972..277117f0 100755
--- a/src/parallel/reconstruct/Allwmake
+++ b/src/parallel/reconstruct/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType reconstruct
 
diff --git a/src/postProcessing/Allwmake b/src/postProcessing/Allwmake
index 24b764c4..a5e7dada 100755
--- a/src/postProcessing/Allwmake
+++ b/src/postProcessing/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake libo postCalc
 wmake $makeType foamCalcFunctions
diff --git a/src/postProcessing/functionObjects/Allwmake b/src/postProcessing/functionObjects/Allwmake
index 178a1a3c..b8193d41 100755
--- a/src/postProcessing/functionObjects/Allwmake
+++ b/src/postProcessing/functionObjects/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType cloud
 wmake $makeType field
diff --git a/src/postProcessing/functionObjects/field/fieldValues/faceSource/faceSource.H b/src/postProcessing/functionObjects/field/fieldValues/faceSource/faceSource.H
index 15efc230..785fcd08 100644
--- a/src/postProcessing/functionObjects/field/fieldValues/faceSource/faceSource.H
+++ b/src/postProcessing/functionObjects/field/fieldValues/faceSource/faceSource.H
@@ -211,14 +211,14 @@ private:
         //- Set faces according to sampledSurface
         void sampledSurfaceFaces(const dictionary&);
 
-        //- Combine mesh faces and points from multiple processors 
+        //- Combine mesh faces and points from multiple processors
         void combineMeshGeometry
         (
             faceList& faces,
             pointField& points
         ) const;
 
-        //- Combine surface faces and points from multiple processors 
+        //- Combine surface faces and points from multiple processors
         void combineSurfaceGeometry
         (
             faceList& faces,
diff --git a/src/regionModels/Allwclean b/src/regionModels/Allwclean
index f95d816a..a6e0038e 100755
--- a/src/regionModels/Allwclean
+++ b/src/regionModels/Allwclean
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wclean $makeType regionModel
 wclean $makeType pyrolysisModels
diff --git a/src/regionModels/Allwmake b/src/regionModels/Allwmake
index 0ca6e633..509ae2e8 100755
--- a/src/regionModels/Allwmake
+++ b/src/regionModels/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType regionModel
 wmake $makeType pyrolysisModels
diff --git a/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelCollection.C b/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelCollection.C
index d11f2d1a..6d0a1487 100644
--- a/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelCollection.C
+++ b/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelCollection.C
@@ -53,7 +53,7 @@ namespace pyrolysisModels
 pyrolysisModelCollection::pyrolysisModelCollection(const fvMesh& mesh)
 :
     PtrList<pyrolysisModel>()
-    
+
 {
     IOdictionary pyrolysisZonesDict
     (
diff --git a/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelNew.C b/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelNew.C
index 0e1a5076..223405f2 100644
--- a/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelNew.C
+++ b/src/regionModels/pyrolysisModels/pyrolysisModel/pyrolysisModelNew.C
@@ -115,7 +115,7 @@ autoPtr<pyrolysisModel> pyrolysisModel::New
     (
         cstrIter()
         (
-            modelType, 
+            modelType,
             mesh,
             dict,
             regionType
diff --git a/src/regionModels/thermalBaffleModels/noThermo/noThermo.C b/src/regionModels/thermalBaffleModels/noThermo/noThermo.C
index e5205db4..d603203f 100644
--- a/src/regionModels/thermalBaffleModels/noThermo/noThermo.C
+++ b/src/regionModels/thermalBaffleModels/noThermo/noThermo.C
@@ -151,7 +151,7 @@ const solidThermo& noThermo::thermo() const
     FatalErrorIn("const volScalarField& noThermo::T() const")
         << "T field not available for " << type()
         << abort(FatalError);
-    return *reinterpret_cast<const solidThermo*>(NULL);
+    return NullObjectRef<solidThermo>();
 }
 
 
diff --git a/src/renumber/Allwmake b/src/renumber/Allwmake
index d7f72d93..b232945e 100755
--- a/src/renumber/Allwmake
+++ b/src/renumber/Allwmake
@@ -2,19 +2,7 @@
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
 
-## get ZOLTAN_ARCH_PATH
-#if settings=`$WM_PROJECT_DIR/bin/foamEtcFile config/zoltan.sh`
-#then
-#    . $settings
-#    echo "using ZOLTAN_ARCH_PATH=$ZOLTAN_ARCH_PATH"
-#else
-#    echo
-#    echo "Error: no config/zoltan.sh settings"
-#    echo
-#fi
-
-
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType renumberMethods
 
@@ -22,19 +10,11 @@ if [ -n "$BOOST_ARCH_PATH" ]
 then
     wmake $makeType SloanRenumber
 else
+    [ -z "$WM_SILENT_RULES" ] && {
     echo
     echo "Skipping SloanRenumber"
     echo
-fi
-
-
-if [ -n "$ZOLTAN_ARCH_PATH" ]
-then
-    wmake $makeType zoltanRenumber
-else
-    echo
-    echo "Skipping zoltanRenumber"
-    echo
+    }
 fi
 
 # ----------------------------------------------------------------- end-of-file
diff --git a/src/renumber/SloanRenumber/Make/options b/src/renumber/SloanRenumber/Make/options
index 492a3ae1..f22a1e6c 100644
--- a/src/renumber/SloanRenumber/Make/options
+++ b/src/renumber/SloanRenumber/Make/options
@@ -1,12 +1,17 @@
 EXE_INC = \
-    /* -DFULLDEBUG -g -O0 */ \
     -I$(BOOST_ARCH_PATH)/include \
     -I$(LIB_SRC)/meshTools/lnInclude \
     -I$(LIB_SRC)/parallel/decompose/decompositionMethods/lnInclude \
     -I$(LIB_SRC)/renumber/renumberMethods/lnInclude
 
 LIB_LIBS = \
-    -L$(BOOST_ARCH_PATH)/lib -lboost_thread \
+    -L$(BOOST_ARCH_PATH)/lib \
     -lmeshTools \
     -ldecompositionMethods \
     -lrenumberMethods
+
+ifneq ("$(wildcard $(BOOST_ARCH_PATH)/lib/libboost_thread-mt.dylib)","")
+LIB_LIBS += -lboost_thread-mt
+else
+LIB_LIBS += -lboost_thread
+endif
diff --git a/src/sampling/cuttingPlane/cuttingPlane.C b/src/sampling/cuttingPlane/cuttingPlane.C
index 87f004a0..03f29dd2 100644
--- a/src/sampling/cuttingPlane/cuttingPlane.C
+++ b/src/sampling/cuttingPlane/cuttingPlane.C
@@ -51,7 +51,7 @@ void Foam::cuttingPlane::calcCutCells
     const edgeList& edges = mesh.edges();
 
     label listSize = cellEdges.size();
-    if (&cellIdLabels)
+    if (notNull(cellIdLabels))
     {
         listSize = cellIdLabels.size();
     }
@@ -64,7 +64,7 @@ void Foam::cuttingPlane::calcCutCells
     for (label listI = 0; listI < listSize; ++listI)
     {
         label cellI = listI;
-        if (&cellIdLabels)
+        if (notNull(cellIdLabels))
         {
             cellI = cellIdLabels[listI];
         }
@@ -400,7 +400,7 @@ void Foam::cuttingPlane::remapFaces
 )
 {
     // recalculate the cells cut
-    if (&faceMap && faceMap.size())
+    if (notNull(faceMap) && faceMap.size())
     {
         MeshStorage::remapFaces(faceMap);
 
diff --git a/src/sampling/sampledSurface/sampledPatch/sampledPatch.C b/src/sampling/sampledSurface/sampledPatch/sampledPatch.C
index da2d90c9..bbf62902 100644
--- a/src/sampling/sampledSurface/sampledPatch/sampledPatch.C
+++ b/src/sampling/sampledSurface/sampledPatch/sampledPatch.C
@@ -203,7 +203,7 @@ bool Foam::sampledPatch::update()
 void Foam::sampledPatch::remapFaces(const labelUList& faceMap)
 {
     // recalculate the cells cut
-    if (&faceMap && faceMap.size())
+    if (notNull(faceMap) && faceMap.size())
     {
         MeshStorage::remapFaces(faceMap);
         patchFaceLabels_ = labelList
diff --git a/src/sampling/sampledSurface/writers/nastran/nastranSurfaceWriter.C b/src/sampling/sampledSurface/writers/nastran/nastranSurfaceWriter.C
index eaa16feb..f18c8f12 100644
--- a/src/sampling/sampledSurface/writers/nastran/nastranSurfaceWriter.C
+++ b/src/sampling/sampledSurface/writers/nastran/nastranSurfaceWriter.C
@@ -111,7 +111,7 @@ void Foam::nastranSurfaceWriter::writeCoord
             os.unsetf(ios_base::left);
             os.setf(ios_base::right);
             os  << setw(8) << pointI + 1
-                << "        " 
+                << "        "
                 << setw(8) << p.x()
                 << setw(8) << p.y()
                 << setw(8) << p.z()
diff --git a/src/surfMesh/MeshedSurface/MeshedSurface.C b/src/surfMesh/MeshedSurface/MeshedSurface.C
index 43719de2..c0536623 100644
--- a/src/surfMesh/MeshedSurface/MeshedSurface.C
+++ b/src/surfMesh/MeshedSurface/MeshedSurface.C
@@ -433,7 +433,7 @@ void Foam::MeshedSurface<Face>::remapFaces
 )
 {
     // recalculate the zone start/size
-    if (&faceMap && faceMap.size())
+    if (notNull(faceMap) && faceMap.size())
     {
         surfZoneList& zones = storedZones();
 
@@ -526,17 +526,17 @@ void Foam::MeshedSurface<Face>::reset
 
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&pointLst)
+    if (notNull(pointLst))
     {
         storedPoints().transfer(pointLst());
     }
 
-    if (&faceLst)
+    if (notNull(faceLst))
     {
         storedFaces().transfer(faceLst());
     }
 
-    if (&zoneLst)
+    if (notNull(zoneLst))
     {
         storedZones().transfer(zoneLst());
     }
@@ -555,17 +555,17 @@ void Foam::MeshedSurface<Face>::reset
 
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&pointLst)
+    if (notNull(pointLst))
     {
         storedPoints().transfer(pointLst());
     }
 
-    if (&faceLst)
+    if (notNull(faceLst))
     {
         storedFaces().transfer(faceLst());
     }
 
-    if (&zoneLst)
+    if (notNull(zoneLst))
     {
         storedZones().transfer(zoneLst());
     }
@@ -860,7 +860,7 @@ Foam::label Foam::MeshedSurface<Face>::triangulate
     // nothing to do
     if (nTri <= faceLst.size())
     {
-        if (&faceMapOut)
+        if (reinterpret_cast<const void*>(&faceMapOut))
         {
             faceMapOut.clear();
         }
@@ -871,7 +871,7 @@ Foam::label Foam::MeshedSurface<Face>::triangulate
     List<label> faceMap;
 
     // reuse storage from optional faceMap
-    if (&faceMapOut)
+    if (reinterpret_cast<const void*>(&faceMapOut))
     {
         faceMap.transfer(faceMapOut);
     }
@@ -928,7 +928,7 @@ Foam::label Foam::MeshedSurface<Face>::triangulate
     remapFaces(faceMap);
 
     // optionally return the faceMap
-    if (&faceMapOut)
+    if (reinterpret_cast<const void*>(&faceMapOut))
     {
         faceMapOut.transfer(faceMap);
     }
diff --git a/src/surfMesh/MeshedSurface/MeshedSurface.H b/src/surfMesh/MeshedSurface/MeshedSurface.H
index 2170781d..f52ca824 100644
--- a/src/surfMesh/MeshedSurface/MeshedSurface.H
+++ b/src/surfMesh/MeshedSurface/MeshedSurface.H
@@ -469,7 +469,7 @@ inline label MeshedSurface<triFace>::triangulate()
 template<>
 inline label MeshedSurface<triFace>::triangulate(List<label>& faceMap)
 {
-    if (&faceMap)
+    if (notNull(faceMap))
     {
         faceMap.clear();
     }
diff --git a/src/surfMesh/MeshedSurfaceAllocator/MeshedSurfaceIOAllocator.C b/src/surfMesh/MeshedSurfaceAllocator/MeshedSurfaceIOAllocator.C
index 1a97d5d3..c8ca9b79 100644
--- a/src/surfMesh/MeshedSurfaceAllocator/MeshedSurfaceIOAllocator.C
+++ b/src/surfMesh/MeshedSurfaceAllocator/MeshedSurfaceIOAllocator.C
@@ -88,12 +88,12 @@ void Foam::MeshedSurfaceIOAllocator::resetFaces
     const Xfer<surfZoneList>& zones
 )
 {
-    if (&faces)
+    if (notNull(faces))
     {
         faces_.transfer(faces());
     }
 
-    if (&zones)
+    if (notNull(zones))
     {
         zones_.transfer(zones());
     }
@@ -109,7 +109,7 @@ void Foam::MeshedSurfaceIOAllocator::reset
 {
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&points)
+    if (notNull(points))
     {
         points_.transfer(points());
     }
@@ -127,7 +127,7 @@ void Foam::MeshedSurfaceIOAllocator::reset
 {
     // Take over new primitive data.
     // Optimized to avoid overwriting data at all
-    if (&points)
+    if (notNull(points))
     {
         points_.transfer(points());
     }
diff --git a/src/surfMesh/UnsortedMeshedSurface/UnsortedMeshedSurface.C b/src/surfMesh/UnsortedMeshedSurface/UnsortedMeshedSurface.C
index 7f6de730..8c562ef5 100644
--- a/src/surfMesh/UnsortedMeshedSurface/UnsortedMeshedSurface.C
+++ b/src/surfMesh/UnsortedMeshedSurface/UnsortedMeshedSurface.C
@@ -401,7 +401,7 @@ void Foam::UnsortedMeshedSurface<Face>::remapFaces
 )
 {
     // re-assign the zone Ids
-    if (&faceMap && faceMap.size())
+    if (notNull(faceMap) && faceMap.size())
     {
         if (zoneToc_.empty())
         {
@@ -612,7 +612,7 @@ void Foam::UnsortedMeshedSurface<Face>::reset
         Xfer<surfZoneList>()
     );
 
-    if (&zoneIds)
+    if (notNull(zoneIds))
     {
         zoneIds_.transfer(zoneIds());
     }
@@ -634,7 +634,7 @@ void Foam::UnsortedMeshedSurface<Face>::reset
         Xfer<surfZoneList>()
     );
 
-    if (&zoneIds)
+    if (notNull(zoneIds))
     {
         zoneIds_.transfer(zoneIds());
     }
diff --git a/src/surfMesh/surfMesh/surfMesh.C b/src/surfMesh/surfMesh/surfMesh.C
index 88a74271..4740948e 100644
--- a/src/surfMesh/surfMesh/surfMesh.C
+++ b/src/surfMesh/surfMesh/surfMesh.C
@@ -209,7 +209,7 @@ Foam::surfMesh::surfMesh
     }
 
     // We can also send Xfer<..>::null just to initialize without allocating
-    if (&surf)
+    if (notNull(surf))
     {
         transfer(surf());
     }
diff --git a/src/thermophysicalModels/Allwmake b/src/thermophysicalModels/Allwmake
index dbd8310a..7f97ad67 100755
--- a/src/thermophysicalModels/Allwmake
+++ b/src/thermophysicalModels/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType specie
 wmake $makeType solidSpecie
diff --git a/src/thermophysicalModels/properties/Allwmake b/src/thermophysicalModels/properties/Allwmake
index f088d140..eaa7559a 100755
--- a/src/thermophysicalModels/properties/Allwmake
+++ b/src/thermophysicalModels/properties/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType liquidProperties
 wmake $makeType liquidMixtureProperties
diff --git a/src/thermophysicalModels/reactionThermo/Make/files b/src/thermophysicalModels/reactionThermo/Make/files
index e4e8c49e..879c82ba 100644
--- a/src/thermophysicalModels/reactionThermo/Make/files
+++ b/src/thermophysicalModels/reactionThermo/Make/files
@@ -1,5 +1,5 @@
 chemistryReaders/chemkinReader/chemkinReader.C
-chemistryReaders/chemkinReader/chemkinLexer.C
+chemistryReaders/chemkinReader/chemkinLexer.L
 chemistryReaders/chemistryReader/makeChemistryReaders.C
 
 mixtures/basicMultiComponentMixture/basicMultiComponentMixture.C
diff --git a/src/thermophysicalModels/reactionThermo/chemistryReaders/chemkinReader/chemkinReader.C b/src/thermophysicalModels/reactionThermo/chemistryReaders/chemkinReader/chemkinReader.C
index 63dd057f..f18daf08 100644
--- a/src/thermophysicalModels/reactionThermo/chemistryReaders/chemkinReader/chemkinReader.C
+++ b/src/thermophysicalModels/reactionThermo/chemistryReaders/chemkinReader/chemkinReader.C
@@ -400,6 +400,14 @@ void Foam::chemkinReader::addPressureDependentReaction
 
         default:
         {
+            FatalErrorIn("chemkinReader::addPressureDependentReaction")
+                << "Fall-off function type "
+                << fallOffFunctionNames[fofType]
+                << " on line " << lineNo_-1
+                << " not implemented"
+                << exit(FatalError);
+
+            /*
             if (fofType < 4)
             {
                 FatalErrorIn("chemkinReader::addPressureDependentReaction")
@@ -416,6 +424,7 @@ void Foam::chemkinReader::addPressureDependentReaction
                     << " on line " << lineNo_-1
                     << exit(FatalError);
             }
+            */
         }
     }
 }
diff --git a/src/thermophysicalModels/specie/reaction/Reactions/Reaction/Reaction.C b/src/thermophysicalModels/specie/reaction/Reactions/Reaction/Reaction.C
index 2a8a5ca1..16df3ae9 100644
--- a/src/thermophysicalModels/specie/reaction/Reactions/Reaction/Reaction.C
+++ b/src/thermophysicalModels/specie/reaction/Reactions/Reaction/Reaction.C
@@ -503,7 +503,7 @@ const Foam::speciesTable& Foam::Reaction<ReactionThermo>::gasSpecies() const
         "const speciesTable& gasSpecies() const"
         " for this reaction"
     );
-    return *reinterpret_cast<speciesTable*>(0);
+    return NullObjectRef<speciesTable>();
 }
 
 
@@ -516,7 +516,7 @@ Foam::Reaction<ReactionThermo>::glhs() const
         "inline const List<typename Reaction<ReactionThermo>::specieCoeffs>&"
         "Reaction<ReactionThermo>::glhs()"
     );
-    return *reinterpret_cast<List<specieCoeffs>*>(0);
+    return NullObjectRef<List<specieCoeffs> >();
 }
 
 
@@ -529,7 +529,7 @@ Foam::Reaction<ReactionThermo>::grhs() const
         "inline const List<typename Reaction<ReactionThermo>::specieCoeffs>&"
         "Reaction<ReactionThermo>::grhs()"
     );
-    return *reinterpret_cast<List<specieCoeffs>*>(0);
+    return NullObjectRef<List<specieCoeffs> >();
 }
 
 // ************************************************************************* //
diff --git a/src/transportModels/Allwmake b/src/transportModels/Allwmake
index 120dfae7..c5110bb3 100755
--- a/src/transportModels/Allwmake
+++ b/src/transportModels/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType twoPhaseMixture
 wmake $makeType interfaceProperties
diff --git a/src/turbulenceModels/Allwmake b/src/turbulenceModels/Allwmake
index 3cba27ed..ffdcf0a2 100755
--- a/src/turbulenceModels/Allwmake
+++ b/src/turbulenceModels/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 LES/Allwmake $*
 incompressible/Allwmake $*
diff --git a/src/turbulenceModels/LES/Allwmake b/src/turbulenceModels/LES/Allwmake
index 6ee54e6c..fa0bae8c 100755
--- a/src/turbulenceModels/LES/Allwmake
+++ b/src/turbulenceModels/LES/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmakeLnInclude ../incompressible/LES
 
diff --git a/src/turbulenceModels/compressible/Allwmake b/src/turbulenceModels/compressible/Allwmake
index 6e230c01..2b61363b 100755
--- a/src/turbulenceModels/compressible/Allwmake
+++ b/src/turbulenceModels/compressible/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType turbulenceModel
 wmake $makeType RAS
diff --git a/src/turbulenceModels/compressible/LES/DESModel/DESModelDoc.H b/src/turbulenceModels/compressible/LES/DESModel/DESModelDoc.H
index e9deb320..e7bb541a 100644
--- a/src/turbulenceModels/compressible/LES/DESModel/DESModelDoc.H
+++ b/src/turbulenceModels/compressible/LES/DESModel/DESModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpCmpTurbulence
     This group contains compressible DES models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/compressible/LES/GenEddyVisc/GenEddyVisc.H b/src/turbulenceModels/compressible/LES/GenEddyVisc/GenEddyVisc.H
index d4af6e5e..68ce924c 100644
--- a/src/turbulenceModels/compressible/LES/GenEddyVisc/GenEddyVisc.H
+++ b/src/turbulenceModels/compressible/LES/GenEddyVisc/GenEddyVisc.H
@@ -116,7 +116,7 @@ public:
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "epsilon",
                         runTime_.timeName(),
                         mesh_,
diff --git a/src/turbulenceModels/compressible/LES/GenSGSStress/GenSGSStress.H b/src/turbulenceModels/compressible/LES/GenSGSStress/GenSGSStress.H
index 44eef6da..1e84390f 100644
--- a/src/turbulenceModels/compressible/LES/GenSGSStress/GenSGSStress.H
+++ b/src/turbulenceModels/compressible/LES/GenSGSStress/GenSGSStress.H
@@ -117,7 +117,7 @@ public:
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "k",
                         runTime_.timeName(),
                         mesh_,
@@ -139,7 +139,7 @@ public:
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "epsilon",
                         runTime_.timeName(),
                         mesh_,
diff --git a/src/turbulenceModels/compressible/LES/LESModel/LESModelDoc.H b/src/turbulenceModels/compressible/LES/LESModel/LESModelDoc.H
index ac8c52e3..3f1d1c10 100644
--- a/src/turbulenceModels/compressible/LES/LESModel/LESModelDoc.H
+++ b/src/turbulenceModels/compressible/LES/LESModel/LESModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpCmpTurbulence
     This group contains compressible LES models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/compressible/RAS/RASModel/RASModelDoc.H b/src/turbulenceModels/compressible/RAS/RASModel/RASModelDoc.H
index 53757f81..300be13d 100644
--- a/src/turbulenceModels/compressible/RAS/RASModel/RASModelDoc.H
+++ b/src/turbulenceModels/compressible/RAS/RASModel/RASModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpCmpTurbulence
     This group contains compressible RAS models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H b/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
index 63aa24b8..4d0d5f32 100644
--- a/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
+++ b/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
@@ -36,7 +36,7 @@ Description
         \f[
             \epsilon_p = \frac{C_{\mu}^{0.75} k^{1.5}}{L}
         \f]
-   
+
     where
 
     \vartable
diff --git a/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H b/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
index cafd2d9d..0f3484c7 100644
--- a/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
+++ b/src/turbulenceModels/compressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
@@ -35,7 +35,7 @@ Description
         \f[
             \omega_p = \frac{k^{0.5}}{C_{\mu}^{0.25} L}
         \f]
-   
+
     where
 
     \vartable
diff --git a/src/turbulenceModels/compressible/turbulenceModel/turbulenceModelDoc.H b/src/turbulenceModels/compressible/turbulenceModel/turbulenceModelDoc.H
index 17bc2109..b3bd0519 100644
--- a/src/turbulenceModels/compressible/turbulenceModel/turbulenceModelDoc.H
+++ b/src/turbulenceModels/compressible/turbulenceModel/turbulenceModelDoc.H
@@ -27,5 +27,5 @@ License
 @{
     This group contains compressible turbulence models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/incompressible/Allwmake b/src/turbulenceModels/incompressible/Allwmake
index 6e230c01..2b61363b 100755
--- a/src/turbulenceModels/incompressible/Allwmake
+++ b/src/turbulenceModels/incompressible/Allwmake
@@ -1,7 +1,7 @@
 #!/bin/sh
 cd ${0%/*} || exit 1    # run from this directory
 makeType=${1:-libso}
-set -x
+[ -z "$WM_SILENT_RULES" ] && set -x
 
 wmake $makeType turbulenceModel
 wmake $makeType RAS
diff --git a/src/turbulenceModels/incompressible/LES/DESModel/DESModelDoc.H b/src/turbulenceModels/incompressible/LES/DESModel/DESModelDoc.H
index 5311d09d..d100318d 100644
--- a/src/turbulenceModels/incompressible/LES/DESModel/DESModelDoc.H
+++ b/src/turbulenceModels/incompressible/LES/DESModel/DESModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpIcoTurbulence
     This group contains incompressible DES models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/incompressible/LES/GenEddyVisc/GenEddyVisc.H b/src/turbulenceModels/incompressible/LES/GenEddyVisc/GenEddyVisc.H
index e1dc9c2b..0cd340a3 100644
--- a/src/turbulenceModels/incompressible/LES/GenEddyVisc/GenEddyVisc.H
+++ b/src/turbulenceModels/incompressible/LES/GenEddyVisc/GenEddyVisc.H
@@ -112,7 +112,7 @@ public:
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "epsilon",
                         runTime_.timeName(),
                         mesh_,
diff --git a/src/turbulenceModels/incompressible/LES/GenSGSStress/GenSGSStress.H b/src/turbulenceModels/incompressible/LES/GenSGSStress/GenSGSStress.H
index 4f24f791..8d94ed19 100644
--- a/src/turbulenceModels/incompressible/LES/GenSGSStress/GenSGSStress.H
+++ b/src/turbulenceModels/incompressible/LES/GenSGSStress/GenSGSStress.H
@@ -112,7 +112,7 @@ public:
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "k",
                         runTime_.timeName(),
                         mesh_,
@@ -128,13 +128,13 @@ public:
         virtual tmp<volScalarField> epsilon() const
         {
             const volScalarField K(k());
-            
+
             return tmp<volScalarField>
             (
                 new volScalarField
                 (
                     IOobject
-                    (   
+                    (
                         "epsilon",
                         runTime_.timeName(),
                         mesh_,
diff --git a/src/turbulenceModels/incompressible/LES/LESModel/LESModelDoc.H b/src/turbulenceModels/incompressible/LES/LESModel/LESModelDoc.H
index 9b400e23..87845454 100644
--- a/src/turbulenceModels/incompressible/LES/LESModel/LESModelDoc.H
+++ b/src/turbulenceModels/incompressible/LES/LESModel/LESModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpIcoTurbulence
     This group contains incompressible LES models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/incompressible/RAS/RASModel/RASModelDoc.H b/src/turbulenceModels/incompressible/RAS/RASModel/RASModelDoc.H
index 21616566..f1bd133d 100644
--- a/src/turbulenceModels/incompressible/RAS/RASModel/RASModelDoc.H
+++ b/src/turbulenceModels/incompressible/RAS/RASModel/RASModelDoc.H
@@ -28,5 +28,5 @@ License
     \ingroup grpIcoTurbulence
     This group contains incompressible RAS models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/atmBoundaryLayerInletEpsilon/atmBoundaryLayerInletEpsilonFvPatchScalarField.H b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/atmBoundaryLayerInletEpsilon/atmBoundaryLayerInletEpsilonFvPatchScalarField.H
index b94500ae..b5f7c71a 100644
--- a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/atmBoundaryLayerInletEpsilon/atmBoundaryLayerInletEpsilonFvPatchScalarField.H
+++ b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/atmBoundaryLayerInletEpsilon/atmBoundaryLayerInletEpsilonFvPatchScalarField.H
@@ -45,7 +45,7 @@ Description
         z_0     | surface roughness length [m]
         z_g     | minimum vlaue in z direction [m]
     \endvartable
- 
+
     and:
 
         \f[
diff --git a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentHeatFluxTemperature/turbulentHeatFluxTemperatureFvPatchScalarField.H b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentHeatFluxTemperature/turbulentHeatFluxTemperatureFvPatchScalarField.H
index 59b8106d..68b6b2c0 100644
--- a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentHeatFluxTemperature/turbulentHeatFluxTemperatureFvPatchScalarField.H
+++ b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentHeatFluxTemperature/turbulentHeatFluxTemperatureFvPatchScalarField.H
@@ -57,7 +57,7 @@ Note
     - it is assumed that the units of \c alphaEff are [kg/m/s]
     - the specific heat capcaity is read from the transport dictionary entry
       \c Cp0
-    
+
 SourceFiles
     turbulentHeatFluxTemperatureFvPatchScalarField.C
 
diff --git a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
index 13496315..db0e8655 100644
--- a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
+++ b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthDissipationRateInlet/turbulentMixingLengthDissipationRateInletFvPatchScalarField.H
@@ -36,7 +36,7 @@ Description
         \f[
             \epsilon_p = \frac{C_{\mu}^{0.75} k^{1.5}}{L}
         \f]
-   
+
     where
 
     \vartable
diff --git a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
index 9fdff8d9..249e3afb 100644
--- a/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
+++ b/src/turbulenceModels/incompressible/RAS/derivedFvPatchFields/turbulentMixingLengthFrequencyInlet/turbulentMixingLengthFrequencyInletFvPatchScalarField.H
@@ -35,7 +35,7 @@ Description
         \f[
             \omega_p = \frac{k^{0.5}}{C_{\mu}^{0.25} L}
         \f]
-   
+
     where
 
     \vartable
diff --git a/src/turbulenceModels/incompressible/turbulenceModel/turbulenceModelDoc.H b/src/turbulenceModels/incompressible/turbulenceModel/turbulenceModelDoc.H
index f9751dc5..739af738 100644
--- a/src/turbulenceModels/incompressible/turbulenceModel/turbulenceModelDoc.H
+++ b/src/turbulenceModels/incompressible/turbulenceModel/turbulenceModelDoc.H
@@ -27,5 +27,5 @@ License
 @{
     This group contains incompressible turbulence models.
 @}
-    
+
 \*---------------------------------------------------------------------------*/
diff --git a/wmake/MakefileOptions b/wmake/MakefileOptions
deleted file mode 100644
index eee4fec8..00000000
--- a/wmake/MakefileOptions
+++ /dev/null
@@ -1,54 +0,0 @@
-#-------------------------------*- makefile -*---------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# File
-#     MakefileOptions
-#
-# Description
-#     A Makefile for the 'options', used by wmake
-#
-#------------------------------------------------------------------------------
-
-GENERAL_RULES = $(WM_DIR)/rules/General
-RULES         = $(WM_DIR)/rules/$(WM_ARCH)$(WM_COMPILER)
-WM_SCRIPTS    = $(WM_DIR)/scripts
-
-include $(GENERAL_RULES)/general
-include $(RULES)/general
-
-#------------------------------------------------------------------------------
-# declare names of make system control files derived from file 'options'
-#------------------------------------------------------------------------------
-
-OPTIONS = $(WM_OPTIONS)/options
-
-#------------------------------------------------------------------------------
-# Declare dependency of all make system files on OPTIONS
-# Causes all derived files to be remade if any are changed or missing
-#------------------------------------------------------------------------------
-
-$(OPTIONS) : options
-	@$(WM_SCRIPTS)/makeDir $(WM_OPTIONS) ; $(CPP) $(GFLAGS) options | sed -e 's@   *@ @g' > $(OPTIONS)
-
-
-#------------------------------------------------------------------------------
diff --git a/wmake/makeWmake b/wmake/makeWmake
deleted file mode 100755
index 6c162acc..00000000
--- a/wmake/makeWmake
+++ /dev/null
@@ -1,65 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     makeWmake
-#
-# Description
-#     Build platform-specific parts of wmake
-#
-#------------------------------------------------------------------------------
-usage() {
-    exec 1>&2
-    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
-    cat<<USAGE
-usage: ${0##*/}
-
-  Build platform-specific parts of wmake
-
-USAGE
-    exit 1
-}
-
-case "$1" in
--h | -help)
-    usage
-    ;;
-esac
-
-
-echo ========================================
-echo Build platform-specific parts of wmake
-echo
-(
-    set -x
-    cd ${0%/*}/src && make $@
-    # or simply:  make -C ${0%/*}/src $@
-)
-echo
-echo ========================================
-echo Done building wmake
-echo ========================================
-echo
-
-#------------------------------------------------------------------------------
diff --git a/wmake/MakefileApps b/wmake/makefiles/apps
similarity index 83%
rename from wmake/MakefileApps
rename to wmake/makefiles/apps
index 848fbe20..38837a3a 100644
--- a/wmake/MakefileApps
+++ b/wmake/makefiles/apps
@@ -2,7 +2,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2015 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #------------------------------------------------------------------------------
 # License
@@ -22,21 +22,20 @@
 #     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
 #
 # File
-#     MakefileApps
+#     wmake/makefiles/apps
 #
 # Description
 #     Makefile used by
-#         wmake all
+#         wmake -all
 #     to make the applications in the subdirectories of the current directory
 #
 #------------------------------------------------------------------------------
 
-.PHONY: application $(FOAM_APPS)
-
+.PHONY: application
 application: $(FOAM_APPS)
 
+.PHONY: $(FOAM_APPS)
 $(FOAM_APPS):
-	+@wmake all $@
-
+	+@wmake -all $(TARGET) $@
 
-#------------------------------------------------------------------------------
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/MakefileFiles b/wmake/makefiles/files
similarity index 52%
rename from wmake/MakefileFiles
rename to wmake/makefiles/files
index 472a72e4..bd121240 100644
--- a/wmake/MakefileFiles
+++ b/wmake/makefiles/files
@@ -2,7 +2,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #------------------------------------------------------------------------------
 # License
@@ -22,55 +22,56 @@
 #     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
 #
 # File
-#     MakefileFiles
+#     wmake/makefiles/files
 #
 # Description
-#     A Makefile for the 'files', used by wmake
+#     A Makefile for the 'options' and 'files' files, used by wmake
 #
 #------------------------------------------------------------------------------
 
-GENERAL_RULES = $(WM_DIR)/rules/General
-RULES         = $(WM_DIR)/rules/$(WM_ARCH)$(WM_COMPILER)
-WM_SCRIPTS    = $(WM_DIR)/scripts
-OBJECTS_DIR   = $(WM_OPTIONS)
-FFLAGS        =
-
+GENERAL_RULES   = $(WM_DIR)/rules/General
 include $(GENERAL_RULES)/general
-include $(RULES)/general
-include $(OBJECTS_DIR)/options
+
 
 #------------------------------------------------------------------------------
-# declare names of make system control files derived from file 'files'
+# Declare names of make system control files derived from file 'files'
 #------------------------------------------------------------------------------
 
-FILES   = $(WM_OPTIONS)/files
+OBJECTS_DIR     = $(MAKE_DIR)/$(WM_OPTIONS)
+OPTIONS         = $(OBJECTS_DIR)/options
+FILES           = $(OBJECTS_DIR)/files
+VARS            = $(OBJECTS_DIR)/variables
+SFILES          = $(OBJECTS_DIR)/sourceFiles
+
+-include $(OPTIONS)
 
-SFILES  = $(WM_OPTIONS)/sourceFiles
-OFILES  = $(WM_OPTIONS)/objectFiles
-DFILES  = $(WM_OPTIONS)/dependencyFiles
-IFILES  = $(WM_OPTIONS)/includeDeps
 
 #------------------------------------------------------------------------------
-# Declare dependecy of all make system files on FILES
+# Declare dependency of all make system files on FILES
 # Causes all derived files to be remade if any are changed or missing
 #------------------------------------------------------------------------------
 
-allFiles : $(FILES) $(SFILES) $(OFILES) $(DFILES) $(IFILES)
-
-$(FILES) : files
-	@$(CPP) $(GFLAGS) $(FFLAGS) files | sed -e 's@   *@ @g' > $(FILES)
+all : $(OPTIONS) $(SFILES) $(VARS)
 
-$(SFILES): files
-	@$(WM_SCRIPTS)/makeDerivedFiles
+$(OPTIONS) : $(MAKE_DIR)/options
+	@$(CPP) $(GFLAGS) $(MAKE_DIR)/options | sed -e 's@   *@ @g' > $(OPTIONS)
 
-$(OFILES): files
-	@$(WM_SCRIPTS)/makeDerivedFiles
+$(SFILES): $(MAKE_DIR)/files
+	@$(CPP) $(GFLAGS) $(MAKE_DIR)/files | sed -e 's@   *@ @g' > $(FILES)
+	# Find all macro definitions in the files
+	@grep --colour=never "=" $(FILES) > $(VARS)
+	echo "SOURCE = " > $(SFILES)
+	# Remove all macro definitions from the files list
+	@grep --colour=never -v "=" $(FILES) >> $(SFILES)
+	@rm -f $(FILES)
+	# Add a newline to files to ensure the last line is followed by a newline
+	@echo "" >> $(SFILES)
+	# Remove commented lines, blank lines, and trailing blanks from files
+	@sed -i~ -e '/^#/ d' -e '/^[ \t]*$$/ d' -e 's,[ \t]*$$,,' $(SFILES)
+	# Add backslashes
+	@sed -i~ -e 's,$$, \\,' -e '$$s,\\,,' $(SFILES)
+	@rm $(SFILES)~
 
-$(DFILES): files
-	@$(WM_SCRIPTS)/makeDerivedFiles
+$(VARS): $(SFILES)
 
-$(IFILES): files
-	@$(WM_SCRIPTS)/makeDerivedFiles
-
-
-#------------------------------------------------------------------------------
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/Makefile b/wmake/makefiles/general
similarity index 56%
rename from wmake/Makefile
rename to wmake/makefiles/general
index 96e18853..767b6a57 100644
--- a/wmake/Makefile
+++ b/wmake/makefiles/general
@@ -2,7 +2,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #------------------------------------------------------------------------------
 # License
@@ -22,10 +22,10 @@
 #     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
 #
 # File
-#     Makefile
+#     wmake/makefiles/general
 #
 # Description
-#     A generic Makefile, used by wmake
+#     Makefile used by wmake to make dependency files and libs and applications
 #
 #------------------------------------------------------------------------------
 
@@ -33,65 +33,58 @@
 # The Makefile uses a POSIX shell
 #------------------------------------------------------------------------------
 
-SHELL      = /bin/sh
+SHELL           = /bin/sh
 
 
 #------------------------------------------------------------------------------
-# Initialise suffices list
+# Unset suffices list (suffix rules are not used)
 #------------------------------------------------------------------------------
 
 .SUFFIXES:
-.SUFFIXES: .o
 
 
 #------------------------------------------------------------------------------
 # Set the directory containing the wmake scripts
 #------------------------------------------------------------------------------
 
-WM_SCRIPTS   = $(WM_DIR)/scripts
+WM_SCRIPTS      = $(WM_DIR)/scripts
 
 
 #------------------------------------------------------------------------------
-# declare default paths
+# Declare default paths
 #------------------------------------------------------------------------------
 
-LIB_SRC            = $(WM_PROJECT_DIR)/src
-LIB_PLATFORMS      = $(WM_PROJECT_DIR)/platforms/$(WM_OPTIONS)/lib
-OBJECTS_DIR        = $(MAKE_DIR)/$(WM_OPTIONS)
-CLASSES_DIR        = $(MAKE_DIR)/classes
+LIB_SRC         = $(WM_PROJECT_DIR)/src
+LIB_PLATFORMS   = $(WM_PROJECT_DIR)/platforms/$(WM_OPTIONS)/lib
+OBJECTS_DIR     = $(MAKE_DIR)/$(WM_OPTIONS)
 
-SYS_INC            =
-SYS_LIBS           =
+SYS_INC         =
+SYS_LIBS        =
 
-PROJECT_INC        = -I$(LIB_SRC)/$(WM_PROJECT)/lnInclude -I$(LIB_SRC)/OSspecific/$(WM_OSTYPE)/lnInclude
-PROJECT_LIBS       = -l$(WM_PROJECT)
-##
-## unused:
-## PROJECT_VERSION    = $(shell printf -- "-DPROJECT_VERSION=%d%03d%03d" $$(echo $(WM_PROJECT_VERSION) | sed -e 's/\./ /g'))
-##
+PROJECT_INC     = -I$(LIB_SRC)/$(WM_PROJECT)/lnInclude \
+		     -I$(LIB_SRC)/OSspecific/$(WM_OSTYPE)/lnInclude
 
-EXE_INC            =
-EXE_LIBS           =
+PROJECT_LIBS    = -l$(WM_PROJECT)
 
-LIB_LIBS           =
+EXE_INC         =
+EXE_LIBS        =
 
-
-#------------------------------------------------------------------------------
-# declare all .o files depend on $(OBJECTS_DIR)/options
-#------------------------------------------------------------------------------
-
-EXE_DEP         = $(OBJECTS_DIR)/options
+LIB_LIBS        =
 
 
 #------------------------------------------------------------------------------
-# declare default name of libraries and executables
+# Declare default name of libraries and executables
 #------------------------------------------------------------------------------
 
 # Library
 LIB             = libNULL
 
 # Shared library extension
+ifeq ($(shell uname -s),Darwin)
+SO		= dylib
+else
 SO              = so
+endif
 
 # Project executable
 EXE             = $(WM_PROJECT).out
@@ -99,37 +92,30 @@ EXE             = $(WM_PROJECT).out
 # Standalone executable
 SEXE            = a.out
 
-
 #------------------------------------------------------------------------------
-# set compilation and dependency building rules
+# Set compilation and dependency building rules
 #------------------------------------------------------------------------------
 
 GENERAL_RULES = $(WM_DIR)/rules/General
-RULES         = $(WM_DIR)/rules/$(WM_ARCH)$(WM_COMPILER)
-WMAKE_BIN     = $(WM_DIR)/platforms/$(WM_ARCH)$(WM_COMPILER)
-
 include $(GENERAL_RULES)/general
-include $(RULES)/general
-include $(RULES)/$(WM_LINK_LANGUAGE)
-
-MAKE_DEP   = @$(MKDEP) $< | $(WM_SCRIPTS)/addCompile $<
 
 
 #------------------------------------------------------------------------------
 # Include PROJECT directory tree file and
 # source, object and dependency list files.
-# These are constructed by scripts/makeDerivedFiles
+# These are constructed by MakefileFiles
 #------------------------------------------------------------------------------
 
 include $(OBJECTS_DIR)/options
-include $(OBJECTS_DIR)/filesMacros
+include $(OBJECTS_DIR)/variables
 include $(OBJECTS_DIR)/sourceFiles
-include $(OBJECTS_DIR)/objectFiles
-include $(OBJECTS_DIR)/localObjectFiles
-include $(OBJECTS_DIR)/dependencyFiles
+DEPENDENCIES=$(SOURCE:%=$(OBJECTS_DIR)/%.dep)
+BASENAMES=$(basename $(SOURCE))
+OBJECTS=$(BASENAMES:%=$(OBJECTS_DIR)/%.o)
+
 
 #------------------------------------------------------------------------------
-# set header file include paths
+# Set header file include paths
 #------------------------------------------------------------------------------
 
 LIB_HEADER_DIRS = \
@@ -142,78 +128,88 @@ LIB_HEADER_DIRS = \
 
 
 #------------------------------------------------------------------------------
-# define link statements for executables
+# Define link statements for executables
 #------------------------------------------------------------------------------
 
-$(EXE):  $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(EXE)
-	     $(LINKEXE) $(OBJECTS) -L$(LIB_PLATFORMS) \
-	     $(EXE_LIBS) $(PROJECT_LIBS) $(SYS_LIBS) $(LINK_LIBS) $(GLIBS) -o $(EXE)
+$(EXE): $(OBJECTS)
+	@$(WM_SCRIPTS)/makeTargetDir $(EXE)
+	$(call WM_MESSAGE,LD,$(notdir $(EXE)))
+	$(AT)$(LINKEXE) $(OBJECTS) -L$(LIB_PLATFORMS) \
+		$(EXE_LIBS) $(PROJECT_LIBS) $(SYS_LIBS) \
+		$(LINK_LIBS) $(GLIBS) -o $(EXE)
 
-exe:     $(SEXE)
-	     @echo \'$(SEXE)\' is up to date.
-
-$(SEXE): $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(SEXE)
-	     $(LINKEXE) $(OBJECTS) $(EXE_LIBS) \
-         $(SYS_LIBS) $(LINK_LIBS) $(GLIBS) -o $(SEXE)
+exe:    $(SEXE)
+	$(call WM_REPORT,$(SEXE))
 
+$(SEXE):$(OBJECTS)
+	@$(WM_SCRIPTS)/makeTargetDir $(SEXE)
+	$(call WM_MESSAGE,LD,$(notdir $(EXE)))
+	$(AT)$(LINKEXE) $(OBJECTS) $(EXE_LIBS) \
+		$(SYS_LIBS) $(LINK_LIBS) $(GLIBS) -o $(SEXE)
 
 #------------------------------------------------------------------------------
-# define link statements for libraries
+# Define link statements for libraries
 #------------------------------------------------------------------------------
 
 objects: $(OBJECTS)
 
-libso:   $(LIB).$(SO)
-	     @echo \'$(LIB).$(SO)\' is up to date.
+libso:  $(LIB).$(SO)
+	$(call WM_REPORT,$(LIB).$(SO))
 
 $(LIB).$(SO): $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(LIB)
-	     @rm -f so_locations
-	     @cd $(OBJECTS_DIR) ; \
-	     $(LINKLIBSO) $(LOCAL_OBJECTS) -L$(LIB_PLATFORMS) $(LIB_LIBS) $(GLIB_LIBS) -o $(LIB).$(SO)
+	@$(WM_SCRIPTS)/makeTargetDir $(LIB)
+	$(call WM_MESSAGE,LD,$(notdir $(LIB).$(SO)))
+	$(AT)$(LINKLIBSO) $(OBJECTS) -L$(LIB_PLATFORMS) \
+		$(LIB_LIBS) $(GLIB_LIBS) -o $(LIB).$(SO)
 
-lib:     $(LIB).a
-	     @echo \'$(LIB).a\' is up to date.
+lib:    $(LIB).a
+	$(call WM_REPORT,$(LIB).a)
 
 $(LIB).a: $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(LIB)
-	     @rm -f $(LIB).a
-	     $(AR) $(ARFLAGS) $(LIB).a $(OBJECTS)
-	     $(RANLIB) $(LIB).a
+	@$(WM_SCRIPTS)/makeTargetDir $(LIB)
+	@rm -f $(LIB).a
+	$(call WM_MESSAGE,AR,$(notdir $(LIB)))
+	$(AT)$(AR) $(ARFLAGS) $(notdir $(LIB)).a $(OBJECTS)
+	$(call WM_MESSAGE,RANLIB,$(notdir $(LIB)))
+	$(AT)$(RANLIB) $(LIB).a
 
-libo:    $(LIB).o
-	     @echo \'$(LIB).o\' is up to date.
+libo:   $(LIB).o
+	$(call WM_REPORT,$(LIB).o)
 
 $(LIB).o: $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(LIB)
-	     @rm -f $(LIB).o
-	     $(LD) -r -o $(LIB).o $(OBJECTS)
+	@$(WM_SCRIPTS)/makeTargetDir $(LIB)
+	@rm -f $(LIB).o
+	$(call WM_MESSAGE,LD,$(notdir $(LIB).o))
+	$(AT)$(LD) -r -o $(LIB).o $(OBJECTS)
+
+#------------------------------------------------------------------------------
+# Set rule to create the include directory for libraries
+#------------------------------------------------------------------------------
 
-jar:     $(LIB).jar
-	     @echo \'$(LIB).jar\' is up to date.
+lnInclude: $(MAKE_DIR)/files $(MAKE_DIR)/options
+	@rm -rf lnInclude ; wmakeLnInclude .
 
-$(LIB).jar: $(OBJECTS)
-	     @$(WM_SCRIPTS)/makeTargetDir $(LIB)
-	     jar cfm $(LIB).jar $(LIB_LIBS) -C $(CLASSES_DIR) .
 
 #------------------------------------------------------------------------------
-# Set rule to create the include directory for libraries
+# Declare all object files depend on $(OBJECTS_DIR)/options
 #------------------------------------------------------------------------------
 
-lnInclude/uptodate: $(MAKE_DIR)/files $(MAKE_DIR)/options
-	     @rm -rf lnInclude ; wmakeLnInclude . ; touch lnInclude/uptodate
+$(OBJECTS) : $(OBJECTS_DIR)/options
+$(foreach S,$(SOURCE),$(eval $(OBJECTS_DIR)/$(basename $S).o : $(OBJECTS_DIR)/$S.dep))
 
 
 #------------------------------------------------------------------------------
-# Set depedency rule and include dependency lists
+# Set dependency rule and include dependency lists
 #------------------------------------------------------------------------------
 
-$(OBJECTS_DIR)/dependencies: $(DEPENDENCIES)
-	@echo dependencies up to date > $(OBJECTS_DIR)/dependencies
+.PHONY: dep updatedep
+dep: $(DEPENDENCIES)
 
-include $(INCLUDE_DEPS)
+updatedep: dep
 
+ifeq ($(findstring lnInclude,$(MAKECMDGOALS))$(findstring updatedep,$(MAKECMDGOALS)),)
+-include $(DEPENDENCIES)
+endif
 
-#------------------------------------------------------------------------------
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/CGAL b/wmake/rules/General/CGAL
index 167a420a..16425295 100644
--- a/wmake/rules/General/CGAL
+++ b/wmake/rules/General/CGAL
@@ -1,5 +1,4 @@
 CGAL_INC = \
-    -Wno-old-style-cast \
     -I$(CGAL_ARCH_PATH)/include \
     -I$(MPFR_ARCH_PATH)/include \
     -I$(GMP_ARCH_PATH)/include \
@@ -8,4 +7,9 @@ CGAL_INC = \
 CGAL_LIBS = \
     -L$(MPFR_ARCH_PATH)/lib \
     -L$(GMP_ARCH_PATH)/lib \
-    -L$(BOOST_ARCH_PATH)/lib
+    -L$(BOOST_ARCH_PATH)/lib \
+    -L$(CGAL_ARCH_PATH)/lib \
+    -lCGAL \
+    -lmpfr
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/X b/wmake/rules/General/X
index f55fa8b3..01e1df85 100644
--- a/wmake/rules/General/X
+++ b/wmake/rules/General/X
@@ -3,3 +3,5 @@
 XFLAGS     =
 XINC       = $(XFLAGS) -I/usr/include/X11
 XLIBS      = -lXext -lX11
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/bison b/wmake/rules/General/bison
index dd02dbd7..834a3127 100644
--- a/wmake/rules/General/bison
+++ b/wmake/rules/General/bison
@@ -1,11 +1,15 @@
-.SUFFIXES: .y .Y
+SUFFIXES += .y .Y
 
-ytoo = bison -v -d -y $$SOURCE ; mv y.tab.c $*.c ; mv y.tab.h $*.h ; $(cc) $(cFLAGS) -c $*.c -o $@
+define ytoo
+$(call WM_MESSAGE,yy,$<)
+$(AT)bison -v -d -y $< ; mv y.tab.c $(@D)/$(<F).c ; mv y.tab.h $(@D)/$(<F).h ; \
+	$(cc) $(cFLAGS) -c  $(@D)/$(<F).c -o $@
+endef
 
-Ytoo = bison -v -d -y $$SOURCE ; mv y.tab.c $*.C ; mv y.tab.h $*.H ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define Ytoo
+$(call WM_MESSAGE,YY,$<)
+$(AT)bison -v -d -y $< ; mv y.tab.c $(@D)/$(<F).C ; mv y.tab.h $(@D)/$(<F).H ; \
+	$(CC) $(c++FLAGS) -c  $(@D)/$(<F).C -o $@
+endef
 
-.y.dep:
-	$(MAKE_DEP)
-
-.Y.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/btyacc b/wmake/rules/General/btyacc
index aaec4406..78d1c85b 100644
--- a/wmake/rules/General/btyacc
+++ b/wmake/rules/General/btyacc
@@ -1,6 +1,11 @@
-.SUFFIXES: .y
+SUFFIXES += .y
 
-ytoo = btyacc -v -d $(SKELETON) $$SOURCE ; mv y_tab.c $*.C ; mv y_tab.h $*.H ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define ytoo
+$(call WM_MESSAGE,yy,$<)
+$(AT)btyacc -v -d $(SKELETON) $<
+$(AT)mv y_tab.c $(@D)/$(<F).C
+$(AT)mv y_tab.h $(@D)/$(<F).H
+$(AT)$(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
+endef
 
-.y.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/btyacc++ b/wmake/rules/General/btyacc++
index 0d2bd33e..de7550ad 100644
--- a/wmake/rules/General/btyacc++
+++ b/wmake/rules/General/btyacc++
@@ -1,6 +1,6 @@
-.SUFFIXES: .Y
+SUFFIXES += .Y
 
-Ytoo = btyacc++ -v -d $(SKELETON) $$SOURCE ; mv y_tab.c $*.C ; mv y_tab.h $*.H ; $(CC) $(c++FLAGS) -c $*.C -o $@
+Ytoo = $(call WM_MESSAGE,YY,$<); $(AT)btyacc++ -v -d $(SKELETON) $< ; mv y_tab.c $(@D)/$(<F).C ; mv y_tab.h $(@D)/$(<F).H ; \
+     $(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
 
-.Y.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/byacc b/wmake/rules/General/byacc
index e3393ee7..1f33ffbd 100644
--- a/wmake/rules/General/byacc
+++ b/wmake/rules/General/byacc
@@ -1,6 +1,11 @@
-.SUFFIXES: .y
+SUFFIXES += .y
 
-ytoo = byacc -v $(YYPREFIX) -d $$SOURCE ; mv y.tab.c $*.C ; mv y.tab.h $*.H ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define ytoo
+$(call WM_MESSAGE,yy,$(notdir $<))
+$(AT)byacc -v $(YYPREFIX) -d $<
+$(AT)mv y.tab.c $(@D)/$(<F).C
+$(AT)mv y.tab.h $(@D)/$(<F).H
+$(AT)$(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
+endef
 
-.y.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/coco-cpp b/wmake/rules/General/coco-cpp
deleted file mode 100644
index 94264971..00000000
--- a/wmake/rules/General/coco-cpp
+++ /dev/null
@@ -1,15 +0,0 @@
-# handle Coco/R attributed grammars written for the C++ version
-#     http://www.ssw.uni-linz.ac.at/Coco/
-#     http://github.com/olesenm/coco-cpp/
-#
-
-.SUFFIXES: .atg
-
-atgtoo =  \
-    $(WM_THIRD_PARTY_DIR)/platforms/$(WM_ARCH)$(WM_COMPILER)/coco-cpp/bin/coco-cpp \
-    -single \
-    $$SOURCE -o $(OBJECTS_DIR) && \
-    $(CC) $(c++FLAGS) -c $*.cpp -o $@
-
-.atg.dep:
-	$(MAKE_DEP)
diff --git a/wmake/rules/General/flex b/wmake/rules/General/flex
index 853780e1..fef4fa50 100644
--- a/wmake/rules/General/flex
+++ b/wmake/rules/General/flex
@@ -1,6 +1,9 @@
-.SUFFIXES: .l
+SUFFIXES += .l
 
-ltoo = flex -o$*.c $$SOURCE ; $(cc) $(cFLAGS) -c $*.c -o $@
+define ltoo
+$(call WM_MESSAGE,ll,$<)
+$(AT)flex -o $(@D)/$(<F).c $(notdir $<)
+$(AT)$(cc) $(cFLAGS) -c  $(@D)/$(<F).c -o $@
+endef
 
-.l.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/flex++ b/wmake/rules/General/flex++
index cf829e09..d638d249 100644
--- a/wmake/rules/General/flex++
+++ b/wmake/rules/General/flex++
@@ -1,6 +1,9 @@
-.SUFFIXES: .L
+SUFFIXES += .L
 
-Ltoo = flex -+ -o$*.C -f $$SOURCE ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define Ltoo
+$(call WM_MESSAGE,LL,$(notdir $<))
+$(AT)flex -+ -o$(@D)/$(<F).C -f $<
+$(AT)$(CC) $(c++FLAGS) $(c++LESSWARN) -c $(@D)/$(<F).C -o $@
+endef
 
-.L.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/general b/wmake/rules/General/general
index d0253e80..7d7552f5 100644
--- a/wmake/rules/General/general
+++ b/wmake/rules/General/general
@@ -1,10 +1,44 @@
-AR         = ar
-ARFLAGS    = cr
-RANLIB     = ranlib
-CPP        = cpp
-LD         = ld
+#-------------------------------*- makefile -*---------------------------------
 
-GFLAGS     = -D$(WM_ARCH) -DWM_$(WM_PRECISION_OPTION)
+ifeq ("$(V)","0")
+WM_MESSAGE = @echo "  $1	$2"
+MESSAGE = echo "  $1	$2"
+WM_REPORT = @echo ">> $(notdir $1)"
+AT = @
+else
+MESSAGE = true
+WM_MESSAGE =
+WM_REPORT = @echo \'$1\' is up to date.
+AT =
+endif
+
+XCRUN =
+ifeq ("$(shell uname -s)","Darwin")
+XCRUN = xcrun
+endif
+
+AR         = $(XCRUN) ar
+ARFLAGS    = $(XCRUN) cr
+RANLIB     = $(XCRUN) ranlib
+CPP        = $(XCRUN) cpp
+LD         = $(XCRUN) ld
+
+GFLAGS     = -D$(WM_ARCH) -DWM_ARCH_OPTION=$(WM_ARCH_OPTION) \
+             -DWM_$(WM_PRECISION_OPTION) -DWM_LABEL_SIZE=$(WM_LABEL_SIZE)
 GINC       =
 GLIBS      = -lm
 GLIB_LIBS  =
+
+
+COMPILER_TYPE   = $(shell echo $(WM_COMPILER) | tr -d [:digit:])
+DEFAULT_RULES   = $(WM_DIR)/rules/$(WM_ARCH)$(COMPILER_TYPE)
+RULES           = $(WM_DIR)/rules/$(WM_ARCH)$(WM_COMPILER)
+WMAKE_BIN       = $(WM_DIR)/platforms/$(WM_ARCH)$(WM_COMPILER)
+
+include $(DEFAULT_RULES)/general
+include $(DEFAULT_RULES)/$(WM_LINK_LANGUAGE)
+-include $(RULES)/general
+-include $(RULES)/$(WM_LINK_LANGUAGE)
+include $(GENERAL_RULES)/transform
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/moc b/wmake/rules/General/moc
index f47f586a..98981258 100644
--- a/wmake/rules/General/moc
+++ b/wmake/rules/General/moc
@@ -1,6 +1,9 @@
-.SUFFIXES: .qt
+SUFFIXES += .qt
 
-qttoo = $(QTDIR)/bin/moc -f $$SOURCE -o $*.C ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define qttoo
+$(call WM_MESSAGE,MOC,$(notdir $<))
+$(AT)$(QTDIR)/bin/moc -f $< -o $(@D)/$(<F).C
+$(AT)$(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
+endef
 
-.qt.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplib b/wmake/rules/General/mplib
index 294bd861..8ccb07f1 100644
--- a/wmake/rules/General/mplib
+++ b/wmake/rules/General/mplib
@@ -1,3 +1,5 @@
 PFLAGS     =
 PINC       =
 PLIBS      =
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibGAMMA b/wmake/rules/General/mplibGAMMA
deleted file mode 100644
index 11606f29..00000000
--- a/wmake/rules/General/mplibGAMMA
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include
-PLIBS      = -L$(MPI_ARCH_PATH)/lib -lgamma
diff --git a/wmake/rules/General/mplibMPICH b/wmake/rules/General/mplibMPICH
index 0abee120..9bf21ec3 100644
--- a/wmake/rules/General/mplibMPICH
+++ b/wmake/rules/General/mplibMPICH
@@ -1,3 +1,5 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib$(WM_COMPILER_LIB_ARCH) -L$(MPI_ARCH_PATH)/lib -lmpich -lrt
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibMPICH-GM b/wmake/rules/General/mplibMPICH-GM
index 4c97ec85..6c569ec5 100644
--- a/wmake/rules/General/mplibMPICH-GM
+++ b/wmake/rules/General/mplibMPICH-GM
@@ -1,3 +1,5 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib$(WM_COMPILER_LIB_ARCH) -L$(MPI_ARCH_PATH)/lib -lmpich -L$(GM_LIB_PATH) -lgm
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibOPENMPI b/wmake/rules/General/mplibOPENMPI
index c888c385..216ce560 100644
--- a/wmake/rules/General/mplibOPENMPI
+++ b/wmake/rules/General/mplibOPENMPI
@@ -1,3 +1,4 @@
 PFLAGS     = -DOMPI_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib$(WM_COMPILER_LIB_ARCH) -L$(MPI_ARCH_PATH)/lib -lmpi
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibQSMPI b/wmake/rules/General/mplibQSMPI
index 95ea3273..d54766dd 100644
--- a/wmake/rules/General/mplibQSMPI
+++ b/wmake/rules/General/mplibQSMPI
@@ -1,4 +1,5 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib -lmpi
 
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibSGIMPI b/wmake/rules/General/mplibSGIMPI
index 85952646..4fda8eeb 100644
--- a/wmake/rules/General/mplibSGIMPI
+++ b/wmake/rules/General/mplibSGIMPI
@@ -1,3 +1,5 @@
 PFLAGS     = -DSGIMPI -DMPI_NO_CPPBIND
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib -lmpi
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibSYSTEMMPI b/wmake/rules/General/mplibSYSTEMMPI
new file mode 100644
index 00000000..112530e3
--- /dev/null
+++ b/wmake/rules/General/mplibSYSTEMMPI
@@ -0,0 +1,7 @@
+# Use the system installed mpi - depends on specific environment variables
+
+PFLAGS     = $(MPI_ARCH_FLAGS)
+PINC       = $(MPI_ARCH_INC)
+PLIBS      = $(MPI_ARCH_LIBS)
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/mplibSYSTEMOPENMPI b/wmake/rules/General/mplibSYSTEMOPENMPI
index 639c8ce2..c0854b73 100644
--- a/wmake/rules/General/mplibSYSTEMOPENMPI
+++ b/wmake/rules/General/mplibSYSTEMOPENMPI
@@ -3,3 +3,5 @@
 PFLAGS     = -DOMPI_SKIP_MPICXX
 PINC       = $(shell mpicc --showme:compile)
 PLIBS      = $(shell mpicc --showme:link)
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/sourceToDep b/wmake/rules/General/sourceToDep
deleted file mode 100644
index 329e7f40..00000000
--- a/wmake/rules/General/sourceToDep
+++ /dev/null
@@ -1,24 +0,0 @@
-.SUFFIXES: .c .cc .cxx .cpp .C .F .f .dep
-
-MKDEP       = $(WMAKE_BIN)/wmkdep -I$(*D) $(LIB_HEADER_DIRS)
-
-.c.dep:
-	$(MAKE_DEP)
-
-.cc.dep:
-	$(MAKE_DEP)
-
-.cxx.dep:
-	$(MAKE_DEP)
-
-.cpp.dep:
-	$(MAKE_DEP)
-
-.C.dep:
-	$(MAKE_DEP)
-
-.F.dep:
-	$(MAKE_DEP)
-
-.f.dep:
-	$(MAKE_DEP)
diff --git a/wmake/rules/General/standard b/wmake/rules/General/standard
index d3e977df..25343453 100644
--- a/wmake/rules/General/standard
+++ b/wmake/rules/General/standard
@@ -1,13 +1,14 @@
-include $(GENERAL_RULES)/version
+#-------------------------------*- makefile -*---------------------------------
 
-include $(GENERAL_RULES)/sourceToDep
+SUFFIXES=
 
+include $(GENERAL_RULES)/version
 include $(GENERAL_RULES)/flex
 include $(GENERAL_RULES)/flex++
-## include $(GENERAL_RULES)/coco-cpp
 ## include $(GENERAL_RULES)/byacc
 ## include $(GENERAL_RULES)/btyacc++
 include $(GENERAL_RULES)/bison
 include $(GENERAL_RULES)/moc
-
 include $(GENERAL_RULES)/X
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/transform b/wmake/rules/General/transform
new file mode 100644
index 00000000..5e06256e
--- /dev/null
+++ b/wmake/rules/General/transform
@@ -0,0 +1,17 @@
+#-------------------------------*- makefile -*---------------------------------
+
+define DEFINE_TRANSFORM
+$(OBJECTS_DIR)/%.o : %$1
+	$(call WM_MESSAGE,CC,$(value <F))
+	$(AT)$$($(subst .,,$(1))too)
+endef
+
+$(foreach s,$(SUFFIXES),$(eval $(call DEFINE_TRANSFORM,$(s))))
+
+$(OBJECTS_DIR)/%.dep : %
+	@$(WM_SCRIPTS)/makeTargetDir $@
+	$(call WM_MESSAGE,DEP,$(notdir $<))
+	@$(WMAKE_BIN)/wmkdep -I$(*D) $(LIB_HEADER_DIRS) $< | \
+	    sed 's,$(WM_PROJECT_DIR),$$(WM_PROJECT_DIR),' > $@
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/version b/wmake/rules/General/version
index 19633ffc..911ab5d4 100644
--- a/wmake/rules/General/version
+++ b/wmake/rules/General/version
@@ -1,13 +1,12 @@
-.SUFFIXES: .Cver
+#-------------------------------*- makefile -*---------------------------------
 
-#
-# update version strings in C++ file and in $WM_PROJECT_DIR/.build file
-#
-Cvertoo = \
-    sed -e 's!VERSION_STRING!$(shell wmakePrintBuild -major)!' \
-        -e 's!BUILD_STRING!$(shell wmakePrintBuild -update)!' \
-        $$SOURCE > $*.C; \
-    $(CC) $(c++FLAGS) -c $*.C -o $@
+SUFFIXES += .Cver
 
-.Cver.dep:
-	$(MAKE_DEP)
+# Update version strings in C++ file and in $WM_PROJECT_DIR/.build file
+Cvertoo = sed -e 's!VERSION_STRING!$(shell wmakePrintBuild -major)!' \
+	  -e 's!BUILD_STRING!$(shell wmakePrintBuild -update)!' \
+	  $< > $(@D)/$(<F).C; \
+	  $(call MESSAGE,CC,$(notdir $(@D)/$(<F).C)); \
+	  $(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/General/yacc b/wmake/rules/General/yacc
index 959d4297..91a54638 100644
--- a/wmake/rules/General/yacc
+++ b/wmake/rules/General/yacc
@@ -1,11 +1,19 @@
-.SUFFIXES: .y .Y
+SUFFIXES += .y .Y
 
-ytoo = yacc -v -d $$SOURCE ; mv y.tab.c $*.c ; mv y.tab.h $(@D)/parser.h ; $(CC) $(c++FLAGS) -c $*.c -o $@
+define ytoo
+$(call WM_MESSAGE,YY,$(notdir $<))
+$(AT)yacc -v -d $<
+$(AT)mv y.tab.c $(@D)/$(<F).c
+$(AT)mv y.tab.h $(@D)/parser.h
+$(AT)$(CC) $(c++FLAGS) -c $(@D)/$(<F).c -o $@
+endef
 
-Ytoo = yacc -v -d $$SOURCE ; mv y.tab.c $*.C ; mv y.tab.h $(@D)/parser.H ; $(CC) $(c++FLAGS) -c $*.C -o $@
+define Ytoo
+$(call WM_MESSAGE,YY,$(notdir $<))
+$(AT)yacc -v -d $<
+$(AT)mv y.tab.c $(@D)/$(<F).C
+$(AT)mv y.tab.h $(@D)/parser.H
+$(AT)$(CC) $(c++FLAGS) -c $(@D)/$(<F).C -o $@
+endef
 
-.y.dep:
-	$(MAKE_DEP)
-
-.Y.dep:
-	$(MAKE_DEP)
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/SiCortex64Gcc/c b/wmake/rules/SiCortex64Gcc/c
deleted file mode 100644
index 02ea2548..00000000
--- a/wmake/rules/SiCortex64Gcc/c
+++ /dev/null
@@ -1,17 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -mabi=64
-#cc          = scgcc -mabi=64
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = -G0 $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/SiCortex64Gcc/c++ b/wmake/rules/SiCortex64Gcc/c++
deleted file mode 100644
index f6d7be55..00000000
--- a/wmake/rules/SiCortex64Gcc/c++
+++ /dev/null
@@ -1,22 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -mabi=64
-#CC          = scg++ -mabi=64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = -G0 $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/SiCortex64Gcc/c++Opt b/wmake/rules/SiCortex64Gcc/c++Opt
deleted file mode 100644
index e37b9ee6..00000000
--- a/wmake/rules/SiCortex64Gcc/c++Opt
+++ /dev/null
@@ -1,4 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
-#c++OPT      = -O3
-# -ftree-vectorize -ftree-vectorizer-verbose=3
diff --git a/wmake/rules/SiCortex64Gcc/general b/wmake/rules/SiCortex64Gcc/general
deleted file mode 100644
index c0c59a72..00000000
--- a/wmake/rules/SiCortex64Gcc/general
+++ /dev/null
@@ -1,10 +0,0 @@
-CPP        = cpp -traditional-cpp $(GFLAGS)
-LD         = ld -A64
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/SiCortex64Gcc/mplibMPI b/wmake/rules/SiCortex64Gcc/mplibMPI
deleted file mode 100644
index 1fb55dd9..00000000
--- a/wmake/rules/SiCortex64Gcc/mplibMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       =
-PLIBS      = -lscmpi
diff --git a/wmake/rules/SunOS64Gcc/c++ b/wmake/rules/SunOS64Gcc/c++
deleted file mode 100644
index 3ca193e2..00000000
--- a/wmake/rules/SunOS64Gcc/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/SunOS64Gcc/c++Opt b/wmake/rules/SunOS64Gcc/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/SunOS64Gcc/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/darwin64Clang/c b/wmake/rules/darwin64Clang/c
new file mode 100644
index 00000000..5aeb7e52
--- /dev/null
+++ b/wmake/rules/darwin64Clang/c
@@ -0,0 +1,23 @@
+SUFFIXES += .c
+
+cWARN        = -Wall
+
+cc          = xcrun cc -arch x86_64
+
+include $(RULES)/c$(WM_COMPILE_OPTION)
+
+cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
+
+ifneq ("$(OSX_SDK_PATH)","")
+cFLAGS += -isysroot $(OSX_SDK_PATH)
+endif
+
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
+
+LINK_LIBS   = $(cDBUG)
+
+LINKLIBSO   = $(cc) -Wl,-dylib,-undefined,dynamic_lookup
+
+LINKEXE     = $(cc) -Wl,-execute,-undefined,dynamic_lookup
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/c++ b/wmake/rules/darwin64Clang/c++
new file mode 100644
index 00000000..817522da
--- /dev/null
+++ b/wmake/rules/darwin64Clang/c++
@@ -0,0 +1,35 @@
+SUFFIXES += .C
+SUFFIXES += .cxx
+SUFFIXES += .cc
+SUFFIXES += .cpp
+
+c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wno-overloaded-virtual \
+              -Wno-unused-variable -Wno-unused-local-typedef -Wno-invalid-offsetof \
+	      -Wno-deprecated-register -Wno-undefined-var-template
+
+c++LESSWARN = -Wno-shift-negative-value
+
+CC          = xcrun c++ -arch x86_64 -std=c++14
+
+include $(RULES)/c++$(WM_COMPILE_OPTION)
+
+ptFLAGS     = -DNoRepository -ftemplate-depth-100
+
+c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
+
+ifneq ("$(OSX_SDK_PATH)","")
+c++FLAGS += -isysroot $(OSX_SDK_PATH)
+endif
+
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
+cxxtoo      = $(Ctoo)
+cctoo       = $(Ctoo)
+cpptoo      = $(Ctoo)
+
+LINK_LIBS   = $(c++DBUG)
+
+LINKLIBSO   = $(CC) $(c++FLAGS) -Wl,-dylib,-undefined,dynamic_lookup
+
+LINKEXE     = $(CC) $(c++FLAGS) -Wl,-execute,-undefined,dynamic_lookup
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/c++Debug b/wmake/rules/darwin64Clang/c++Debug
new file mode 100644
index 00000000..0ed0af6c
--- /dev/null
+++ b/wmake/rules/darwin64Clang/c++Debug
@@ -0,0 +1,4 @@
+c++DBUG    = -g -DFULLDEBUG
+c++OPT      = -O0
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/c++Opt b/wmake/rules/darwin64Clang/c++Opt
new file mode 100644
index 00000000..db785436
--- /dev/null
+++ b/wmake/rules/darwin64Clang/c++Opt
@@ -0,0 +1,5 @@
+#c++DBUG     = -O0 -DFULLDEBUG -g
+c++DBUG     =
+c++OPT      = -O3
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/c++Prof b/wmake/rules/darwin64Clang/c++Prof
new file mode 100644
index 00000000..f86e0d9f
--- /dev/null
+++ b/wmake/rules/darwin64Clang/c++Prof
@@ -0,0 +1,4 @@
+c++DBUG    = -gline-tables-only
+c++OPT     = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/cDebug b/wmake/rules/darwin64Clang/cDebug
new file mode 100644
index 00000000..d4559895
--- /dev/null
+++ b/wmake/rules/darwin64Clang/cDebug
@@ -0,0 +1,4 @@
+cDBUG       = -g -DFULLDEBUG
+cOPT        = -O0
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/cOpt b/wmake/rules/darwin64Clang/cOpt
new file mode 100644
index 00000000..0c2e03c5
--- /dev/null
+++ b/wmake/rules/darwin64Clang/cOpt
@@ -0,0 +1,4 @@
+cDBUG       =
+cOPT        = -O3
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/cProf b/wmake/rules/darwin64Clang/cProf
new file mode 100644
index 00000000..864f043d
--- /dev/null
+++ b/wmake/rules/darwin64Clang/cProf
@@ -0,0 +1,4 @@
+cDBUG       = -pg
+cOPT        = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/darwin64Clang/general b/wmake/rules/darwin64Clang/general
new file mode 100644
index 00000000..9de78f27
--- /dev/null
+++ b/wmake/rules/darwin64Clang/general
@@ -0,0 +1,12 @@
+CPP        = xcrun cpp -traditional-cpp $(GFLAGS)
+
+PROJECT_LIBS = -l$(WM_PROJECT) -ldl
+
+OSX_SDK_PATH = $(shell xcrun --show-sdk-path)
+
+include $(GENERAL_RULES)/standard
+
+include $(RULES)/c
+include $(RULES)/c++
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/c b/wmake/rules/linux64Clang/c
index 7d7d4f61..fdaa0720 100644
--- a/wmake/rules/linux64Clang/c
+++ b/wmake/rules/linux64Clang/c
@@ -1,16 +1,18 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = clang -m64
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
 LINKLIBSO   = $(cc) -shared
 LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/c++ b/wmake/rules/linux64Clang/c++
index 1f78395a..4bb059bb 100644
--- a/wmake/rules/linux64Clang/c++
+++ b/wmake/rules/linux64Clang/c++
@@ -1,17 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-# -Woverloaded-virtual may produce spurious warnings, disable for now
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast -Wnon-virtual-dtor -Wno-overloaded-virtual -Wno-unused-comparison
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof -Wno-c++11-extensions
 
-CC          = clang++ -m64
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-tautological-undefined-compare -Wno-shift-negative-value
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = clang++ -std=c++0x -m64
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
@@ -20,3 +22,5 @@ LINK_LIBS   = $(c++DBUG)
 
 LINKLIBSO   = $(CC) $(c++FLAGS) -shared
 LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/c++Debug b/wmake/rules/linux64Clang/c++Debug
index 1c63335a..0ed0af6c 100644
--- a/wmake/rules/linux64Clang/c++Debug
+++ b/wmake/rules/linux64Clang/c++Debug
@@ -1,2 +1,4 @@
 c++DBUG    = -g -DFULLDEBUG
 c++OPT      = -O0
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/c++Opt b/wmake/rules/linux64Clang/c++Opt
index 3363be80..a741879a 100644
--- a/wmake/rules/linux64Clang/c++Opt
+++ b/wmake/rules/linux64Clang/c++Opt
@@ -1,3 +1,4 @@
-#c++DBUG     = -O0 -DFULLDEBUG -g
 c++DBUG     =
 c++OPT      = -O3
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/c++Prof b/wmake/rules/linux64Clang/c++Prof
index 3bda4dad..e2b16ef3 100644
--- a/wmake/rules/linux64Clang/c++Prof
+++ b/wmake/rules/linux64Clang/c++Prof
@@ -1,2 +1,4 @@
 c++DBUG    = -pg
 c++OPT     = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/cDebug b/wmake/rules/linux64Clang/cDebug
index 7b7adf10..d4559895 100644
--- a/wmake/rules/linux64Clang/cDebug
+++ b/wmake/rules/linux64Clang/cDebug
@@ -1,2 +1,4 @@
 cDBUG       = -g -DFULLDEBUG
 cOPT        = -O0
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/cOpt b/wmake/rules/linux64Clang/cOpt
index 17318709..0c2e03c5 100644
--- a/wmake/rules/linux64Clang/cOpt
+++ b/wmake/rules/linux64Clang/cOpt
@@ -1,2 +1,4 @@
 cDBUG       =
 cOPT        = -O3
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/cProf b/wmake/rules/linux64Clang/cProf
index ca3ac9bf..864f043d 100644
--- a/wmake/rules/linux64Clang/cProf
+++ b/wmake/rules/linux64Clang/cProf
@@ -1,2 +1,4 @@
 cDBUG       = -pg
 cOPT        = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/general b/wmake/rules/linux64Clang/general
index 243cb7d8..6065b130 100644
--- a/wmake/rules/linux64Clang/general
+++ b/wmake/rules/linux64Clang/general
@@ -4,5 +4,7 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/mplibHPMPI b/wmake/rules/linux64Clang/mplibHPMPI
index 574492a2..57cba69c 100644
--- a/wmake/rules/linux64Clang/mplibHPMPI
+++ b/wmake/rules/linux64Clang/mplibHPMPI
@@ -1,3 +1,5 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Clang/mplibINTELMPI b/wmake/rules/linux64Clang/mplibINTELMPI
index cf80ec2e..634628d1 100644
--- a/wmake/rules/linux64Clang/mplibINTELMPI
+++ b/wmake/rules/linux64Clang/mplibINTELMPI
@@ -1,3 +1,5 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc++0x/c++Opt b/wmake/rules/linux64Gcc++0x/c++Opt
deleted file mode 100644
index 3363be80..00000000
--- a/wmake/rules/linux64Gcc++0x/c++Opt
+++ /dev/null
@@ -1,3 +0,0 @@
-#c++DBUG     = -O0 -DFULLDEBUG -g
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linux64Gcc++0x/general b/wmake/rules/linux64Gcc++0x/general
deleted file mode 100644
index 243cb7d8..00000000
--- a/wmake/rules/linux64Gcc++0x/general
+++ /dev/null
@@ -1,8 +0,0 @@
-CPP        = cpp -traditional-cpp $(GFLAGS)
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linux64Gcc++0x/mplibHPMPI b/wmake/rules/linux64Gcc++0x/mplibHPMPI
deleted file mode 100644
index 574492a2..00000000
--- a/wmake/rules/linux64Gcc++0x/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Gcc/c b/wmake/rules/linux64Gcc/c
index f4114be3..6dd2f9ac 100644
--- a/wmake/rules/linux64Gcc/c
+++ b/wmake/rules/linux64Gcc/c
@@ -1,16 +1,18 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc -m64
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
 LINKLIBSO   = $(cc) -shared
 LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/c++ b/wmake/rules/linux64Gcc/c++
index 3dfb0333..a4a0c0d7 100644
--- a/wmake/rules/linux64Gcc/c++
+++ b/wmake/rules/linux64Gcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast -Wnon-virtual-dtor
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++ -m64
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x -m64
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
@@ -19,3 +22,5 @@ LINK_LIBS   = $(c++DBUG)
 
 LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
 LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/c++Debug b/wmake/rules/linux64Gcc/c++Debug
index 19bdb9c3..bcc9059e 100644
--- a/wmake/rules/linux64Gcc/c++Debug
+++ b/wmake/rules/linux64Gcc/c++Debug
@@ -1,2 +1,4 @@
 c++DBUG    = -ggdb3 -DFULLDEBUG
 c++OPT      = -O0 -fdefault-inline
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/c++Opt b/wmake/rules/linux64Gcc/c++Opt
index a0fae531..5b0c3960 100644
--- a/wmake/rules/linux64Gcc/c++Opt
+++ b/wmake/rules/linux64Gcc/c++Opt
@@ -1,3 +1,6 @@
 c++DBUG     =
 c++OPT      = -O3
-# -fprefetch-loop-arrays
+
+ROUNDING_MATH = -frounding-math
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/c++Prof b/wmake/rules/linux64Gcc/c++Prof
index 3bda4dad..e2b16ef3 100644
--- a/wmake/rules/linux64Gcc/c++Prof
+++ b/wmake/rules/linux64Gcc/c++Prof
@@ -1,2 +1,4 @@
 c++DBUG    = -pg
 c++OPT     = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/cDebug b/wmake/rules/linux64Gcc/cDebug
index 72b638f4..4bd3224b 100644
--- a/wmake/rules/linux64Gcc/cDebug
+++ b/wmake/rules/linux64Gcc/cDebug
@@ -1,2 +1,4 @@
 cDBUG       = -ggdb -DFULLDEBUG
 cOPT        = -O1 -fdefault-inline -finline-functions
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/cOpt b/wmake/rules/linux64Gcc/cOpt
index 980f0ea4..0c2e03c5 100644
--- a/wmake/rules/linux64Gcc/cOpt
+++ b/wmake/rules/linux64Gcc/cOpt
@@ -1,3 +1,4 @@
 cDBUG       =
 cOPT        = -O3
-# -fprefetch-loop-arrays
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/cProf b/wmake/rules/linux64Gcc/cProf
index ca3ac9bf..864f043d 100644
--- a/wmake/rules/linux64Gcc/cProf
+++ b/wmake/rules/linux64Gcc/cProf
@@ -1,2 +1,4 @@
 cDBUG       = -pg
 cOPT        = -O2
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/general b/wmake/rules/linux64Gcc/general
index 243cb7d8..6065b130 100644
--- a/wmake/rules/linux64Gcc/general
+++ b/wmake/rules/linux64Gcc/general
@@ -4,5 +4,7 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/mplibHPMPI b/wmake/rules/linux64Gcc/mplibHPMPI
index 574492a2..57cba69c 100644
--- a/wmake/rules/linux64Gcc/mplibHPMPI
+++ b/wmake/rules/linux64Gcc/mplibHPMPI
@@ -1,3 +1,5 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc/mplibINTELMPI b/wmake/rules/linux64Gcc/mplibINTELMPI
index cf80ec2e..634628d1 100644
--- a/wmake/rules/linux64Gcc/mplibINTELMPI
+++ b/wmake/rules/linux64Gcc/mplibINTELMPI
@@ -1,3 +1,5 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
+
+#----------------------------- vi: set ft=make: -------------------------------
diff --git a/wmake/rules/linux64Gcc43/c b/wmake/rules/linux64Gcc43/c
deleted file mode 100644
index f4114be3..00000000
--- a/wmake/rules/linux64Gcc43/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m64
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linux64Gcc43/c++ b/wmake/rules/linux64Gcc43/c++
deleted file mode 100644
index 3ca193e2..00000000
--- a/wmake/rules/linux64Gcc43/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/linux64Gcc43/c++Debug b/wmake/rules/linux64Gcc43/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linux64Gcc43/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linux64Gcc43/c++Opt b/wmake/rules/linux64Gcc43/c++Opt
deleted file mode 100644
index 3446f7f5..00000000
--- a/wmake/rules/linux64Gcc43/c++Opt
+++ /dev/null
@@ -1,4 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
-#c++OPT      = -march=nocona -O3
-# -ftree-vectorize -ftree-vectorizer-verbose=3
diff --git a/wmake/rules/linux64Gcc43/cDebug b/wmake/rules/linux64Gcc43/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linux64Gcc43/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linux64Gcc43/cOpt b/wmake/rules/linux64Gcc43/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linux64Gcc43/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linux64Gcc44/c++ b/wmake/rules/linux64Gcc44/c++
deleted file mode 100644
index 3ca193e2..00000000
--- a/wmake/rules/linux64Gcc44/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/linux64Gcc44/c++Debug b/wmake/rules/linux64Gcc44/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linux64Gcc44/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linux64Gcc44/c++Opt b/wmake/rules/linux64Gcc44/c++Opt
deleted file mode 100644
index 3446f7f5..00000000
--- a/wmake/rules/linux64Gcc44/c++Opt
+++ /dev/null
@@ -1,4 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
-#c++OPT      = -march=nocona -O3
-# -ftree-vectorize -ftree-vectorizer-verbose=3
diff --git a/wmake/rules/linux64Gcc44/c++Prof b/wmake/rules/linux64Gcc44/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linux64Gcc44/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linux64Gcc44/cDebug b/wmake/rules/linux64Gcc44/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linux64Gcc44/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linux64Gcc44/cOpt b/wmake/rules/linux64Gcc44/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linux64Gcc44/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linux64Gcc44/cProf b/wmake/rules/linux64Gcc44/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linux64Gcc44/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linux64Gcc44/mplibINTELMPI b/wmake/rules/linux64Gcc44/mplibINTELMPI
deleted file mode 100644
index cf80ec2e..00000000
--- a/wmake/rules/linux64Gcc44/mplibINTELMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
-PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64Gcc45/c b/wmake/rules/linux64Gcc45/c
deleted file mode 100644
index f4114be3..00000000
--- a/wmake/rules/linux64Gcc45/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m64
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linux64Gcc45/c++ b/wmake/rules/linux64Gcc45/c++
deleted file mode 100644
index 98b25ed1..00000000
--- a/wmake/rules/linux64Gcc45/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linux64Gcc45/c++Debug b/wmake/rules/linux64Gcc45/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linux64Gcc45/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linux64Gcc45/c++Opt b/wmake/rules/linux64Gcc45/c++Opt
deleted file mode 100644
index 3446f7f5..00000000
--- a/wmake/rules/linux64Gcc45/c++Opt
+++ /dev/null
@@ -1,4 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
-#c++OPT      = -march=nocona -O3
-# -ftree-vectorize -ftree-vectorizer-verbose=3
diff --git a/wmake/rules/linux64Gcc45/c++Prof b/wmake/rules/linux64Gcc45/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linux64Gcc45/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linux64Gcc45/cDebug b/wmake/rules/linux64Gcc45/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linux64Gcc45/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linux64Gcc45/cOpt b/wmake/rules/linux64Gcc45/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linux64Gcc45/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linux64Gcc45/cProf b/wmake/rules/linux64Gcc45/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linux64Gcc45/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linux64Gcc45/general b/wmake/rules/linux64Gcc45/general
deleted file mode 100644
index 4a42b11b..00000000
--- a/wmake/rules/linux64Gcc45/general
+++ /dev/null
@@ -1,8 +0,0 @@
-CPP        = cpp -traditional-cpp
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linux64Gcc45/mplibINTELMPI b/wmake/rules/linux64Gcc45/mplibINTELMPI
deleted file mode 100644
index cf80ec2e..00000000
--- a/wmake/rules/linux64Gcc45/mplibINTELMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
-PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64Gcc46/c b/wmake/rules/linux64Gcc46/c
deleted file mode 100644
index f4114be3..00000000
--- a/wmake/rules/linux64Gcc46/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m64
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linux64Gcc46/c++ b/wmake/rules/linux64Gcc46/c++
deleted file mode 100644
index 98b25ed1..00000000
--- a/wmake/rules/linux64Gcc46/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m64
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linux64Gcc46/c++Debug b/wmake/rules/linux64Gcc46/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linux64Gcc46/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linux64Gcc46/c++Opt b/wmake/rules/linux64Gcc46/c++Opt
deleted file mode 100644
index 3446f7f5..00000000
--- a/wmake/rules/linux64Gcc46/c++Opt
+++ /dev/null
@@ -1,4 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
-#c++OPT      = -march=nocona -O3
-# -ftree-vectorize -ftree-vectorizer-verbose=3
diff --git a/wmake/rules/linux64Gcc46/c++Prof b/wmake/rules/linux64Gcc46/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linux64Gcc46/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linux64Gcc46/cDebug b/wmake/rules/linux64Gcc46/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linux64Gcc46/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linux64Gcc46/cOpt b/wmake/rules/linux64Gcc46/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linux64Gcc46/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linux64Gcc46/cProf b/wmake/rules/linux64Gcc46/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linux64Gcc46/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linux64Gcc46/general b/wmake/rules/linux64Gcc46/general
deleted file mode 100644
index 4a42b11b..00000000
--- a/wmake/rules/linux64Gcc46/general
+++ /dev/null
@@ -1,8 +0,0 @@
-CPP        = cpp -traditional-cpp
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linux64Gcc46/mplibHPMPI b/wmake/rules/linux64Gcc46/mplibHPMPI
deleted file mode 100644
index 574492a2..00000000
--- a/wmake/rules/linux64Gcc46/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Gcc46/mplibINTELMPI b/wmake/rules/linux64Gcc46/mplibINTELMPI
deleted file mode 100644
index cf80ec2e..00000000
--- a/wmake/rules/linux64Gcc46/mplibINTELMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
-PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64Gcc47/c b/wmake/rules/linux64Gcc47/c
deleted file mode 100644
index f4114be3..00000000
--- a/wmake/rules/linux64Gcc47/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m64
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linux64Gcc47/c++Debug b/wmake/rules/linux64Gcc47/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linux64Gcc47/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linux64Gcc47/c++Opt b/wmake/rules/linux64Gcc47/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linux64Gcc47/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linux64Gcc47/c++Prof b/wmake/rules/linux64Gcc47/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linux64Gcc47/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linux64Gcc47/cDebug b/wmake/rules/linux64Gcc47/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linux64Gcc47/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linux64Gcc47/cOpt b/wmake/rules/linux64Gcc47/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linux64Gcc47/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linux64Gcc47/cProf b/wmake/rules/linux64Gcc47/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linux64Gcc47/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linux64Gcc47/general b/wmake/rules/linux64Gcc47/general
deleted file mode 100644
index 4a42b11b..00000000
--- a/wmake/rules/linux64Gcc47/general
+++ /dev/null
@@ -1,8 +0,0 @@
-CPP        = cpp -traditional-cpp
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linux64Gcc47/mplibHPMPI b/wmake/rules/linux64Gcc47/mplibHPMPI
deleted file mode 100644
index 574492a2..00000000
--- a/wmake/rules/linux64Gcc47/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Gcc47/mplibINTELMPI b/wmake/rules/linux64Gcc47/mplibINTELMPI
deleted file mode 100644
index cf80ec2e..00000000
--- a/wmake/rules/linux64Gcc47/mplibINTELMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
-PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64Gcc44/c b/wmake/rules/linux64GccKNL/c
similarity index 56%
rename from wmake/rules/linux64Gcc44/c
rename to wmake/rules/linux64GccKNL/c
index f4114be3..a1cd9d66 100644
--- a/wmake/rules/linux64Gcc44/c
+++ b/wmake/rules/linux64GccKNL/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
-cc          = gcc -m64
+cc          = gcc -m64 -march=knl -DvectorMachine -DKNL
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linux64GccKNL/c++ b/wmake/rules/linux64GccKNL/c++
new file mode 100644
index 00000000..ed1ad0de
--- /dev/null
+++ b/wmake/rules/linux64GccKNL/c++
@@ -0,0 +1,24 @@
+SUFFIXES += .C
+
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
+
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
+
+CC          = g++ -std=c++0x -m64 -march=knl -DvectorMachine -DKNL
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
+
+ptFLAGS     = -DNoRepository -ftemplate-depth-100
+
+c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
+
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
+cxxtoo      = $(Ctoo)
+cctoo       = $(Ctoo)
+cpptoo      = $(Ctoo)
+
+LINK_LIBS   = $(c++DBUG)
+
+LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
+LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/SiCortex64Gcc/c++Debug b/wmake/rules/linux64GccKNL/c++Debug
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/c++Debug
rename to wmake/rules/linux64GccKNL/c++Debug
diff --git a/wmake/rules/linux64GccKNL/c++Opt b/wmake/rules/linux64GccKNL/c++Opt
new file mode 100644
index 00000000..599e6aba
--- /dev/null
+++ b/wmake/rules/linux64GccKNL/c++Opt
@@ -0,0 +1,4 @@
+c++DBUG     =
+c++OPT      = -O3
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/SiCortex64Gcc/c++Prof b/wmake/rules/linux64GccKNL/c++Prof
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/c++Prof
rename to wmake/rules/linux64GccKNL/c++Prof
diff --git a/wmake/rules/SiCortex64Gcc/cDebug b/wmake/rules/linux64GccKNL/cDebug
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/cDebug
rename to wmake/rules/linux64GccKNL/cDebug
diff --git a/wmake/rules/SiCortex64Gcc/cOpt b/wmake/rules/linux64GccKNL/cOpt
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/cOpt
rename to wmake/rules/linux64GccKNL/cOpt
diff --git a/wmake/rules/SiCortex64Gcc/cProf b/wmake/rules/linux64GccKNL/cProf
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/cProf
rename to wmake/rules/linux64GccKNL/cProf
diff --git a/wmake/rules/linux64Gcc43/general b/wmake/rules/linux64GccKNL/general
similarity index 67%
rename from wmake/rules/linux64Gcc43/general
rename to wmake/rules/linux64GccKNL/general
index 243cb7d8..1002cb16 100644
--- a/wmake/rules/linux64Gcc43/general
+++ b/wmake/rules/linux64GccKNL/general
@@ -4,5 +4,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linux64Gcc45/mplibHPMPI b/wmake/rules/linux64GccKNL/mplibHPMPI
similarity index 53%
rename from wmake/rules/linux64Gcc45/mplibHPMPI
rename to wmake/rules/linux64GccKNL/mplibHPMPI
index 574492a2..d7c4b0cf 100644
--- a/wmake/rules/linux64Gcc45/mplibHPMPI
+++ b/wmake/rules/linux64GccKNL/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Gcc++0x/mplibINTELMPI b/wmake/rules/linux64GccKNL/mplibINTELMPI
similarity index 61%
rename from wmake/rules/linux64Gcc++0x/mplibINTELMPI
rename to wmake/rules/linux64GccKNL/mplibINTELMPI
index cf80ec2e..278e0b0f 100644
--- a/wmake/rules/linux64Gcc++0x/mplibINTELMPI
+++ b/wmake/rules/linux64GccKNL/mplibINTELMPI
@@ -1,3 +1,3 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64Icc/c b/wmake/rules/linux64Icc/c
index 1085d504..14a3a231 100644
--- a/wmake/rules/linux64Icc/c
+++ b/wmake/rules/linux64Icc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        =
 
 cc          = icc
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG) -L$(IA32ROOT)/lib
 
diff --git a/wmake/rules/linux64Icc/c++ b/wmake/rules/linux64Icc/c++
index 51cb6a38..1cf106e2 100644
--- a/wmake/rules/linux64Icc/c++
+++ b/wmake/rules/linux64Icc/c++
@@ -1,16 +1,20 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -wd327,525,654,819,1125,1476,1505,1572
+c++WARN     = -Wall -Wextra -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof \
+              -diag-disable 654,1125,2304
 
-CC          = icpc -std=c++0x
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -diag-disable 1224,2026,2305
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = icpc -std=c++0x -fp-trap=common -fp-model precise
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linux64Icc/c++Opt b/wmake/rules/linux64Icc/c++Opt
index 2e2380ee..2aedabd6 100644
--- a/wmake/rules/linux64Icc/c++Opt
+++ b/wmake/rules/linux64Icc/c++Opt
@@ -1,2 +1,2 @@
 c++DBUG     =
-c++OPT      = -xHost -O2 -no-prec-div
+c++OPT      = -O3
diff --git a/wmake/rules/linux64Icc/cOpt b/wmake/rules/linux64Icc/cOpt
index b5349135..17318709 100644
--- a/wmake/rules/linux64Icc/cOpt
+++ b/wmake/rules/linux64Icc/cOpt
@@ -1,2 +1,2 @@
 cDBUG       =
-cOPT        = -O3 -no-prec-div
+cOPT        = -O3
diff --git a/wmake/rules/linux64Icc/general b/wmake/rules/linux64Icc/general
index 45c285f1..52b0e177 100644
--- a/wmake/rules/linux64Icc/general
+++ b/wmake/rules/linux64Icc/general
@@ -4,5 +4,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linux64Icc/mplibHPMPI b/wmake/rules/linux64Icc/mplibHPMPI
index 574492a2..d7c4b0cf 100644
--- a/wmake/rules/linux64Icc/mplibHPMPI
+++ b/wmake/rules/linux64Icc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Icc/mplibINTELMPI b/wmake/rules/linux64Icc/mplibINTELMPI
index cf80ec2e..278e0b0f 100644
--- a/wmake/rules/linux64Icc/mplibINTELMPI
+++ b/wmake/rules/linux64Icc/mplibINTELMPI
@@ -1,3 +1,3 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linux64IccKNL/c b/wmake/rules/linux64IccKNL/c
new file mode 100644
index 00000000..14a3a231
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/c
@@ -0,0 +1,16 @@
+SUFFIXES += .c
+
+cWARN        =
+
+cc          = icc
+
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
+
+cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
+
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
+
+LINK_LIBS   = $(cDBUG) -L$(IA32ROOT)/lib
+
+LINKLIBSO   = $(cc) $(cFLAGS) -shared
+LINKEXE     = $(cc) $(cFLAGS) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linux64IccKNL/c++ b/wmake/rules/linux64IccKNL/c++
new file mode 100644
index 00000000..1cef0333
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/c++
@@ -0,0 +1,25 @@
+SUFFIXES += .C
+
+c++WARN     = -Wall -Wextra -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof \
+              -diag-disable 654,1125,2304
+
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -diag-disable 1224,2026,2305
+
+CC          = icpc -std=c++0x -fp-trap=common -fp-model precise -fp-speculation=safe -DKNL
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
+
+ptFLAGS     = -DNoRepository
+
+c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
+
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
+cxxtoo      = $(Ctoo)
+cctoo       = $(Ctoo)
+cpptoo      = $(Ctoo)
+
+LINK_LIBS   = $(c++DBUG) -L$(IA64ROOT)/lib
+
+LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
+LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linux64IccKNL/c++Debug b/wmake/rules/linux64IccKNL/c++Debug
new file mode 100644
index 00000000..0aec1fbf
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/c++Debug
@@ -0,0 +1,2 @@
+c++DBUG    = -g -DFULLDEBUG -O0
+c++OPT     =
diff --git a/wmake/rules/linux64IccKNL/c++Opt b/wmake/rules/linux64IccKNL/c++Opt
new file mode 100644
index 00000000..6f634480
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/c++Opt
@@ -0,0 +1,2 @@
+c++DBUG     =
+c++OPT      = -O3 -DvectorMachine -xmic-avx512
diff --git a/wmake/rules/SunOS64Gcc/c++Prof b/wmake/rules/linux64IccKNL/c++Prof
similarity index 100%
rename from wmake/rules/SunOS64Gcc/c++Prof
rename to wmake/rules/linux64IccKNL/c++Prof
diff --git a/wmake/rules/linux64IccKNL/cDebug b/wmake/rules/linux64IccKNL/cDebug
new file mode 100644
index 00000000..73dce0df
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/cDebug
@@ -0,0 +1,2 @@
+cDBUG       = -g -DFULLDEBUG -O0
+cOPT        =
diff --git a/wmake/rules/linux64IccKNL/cOpt b/wmake/rules/linux64IccKNL/cOpt
new file mode 100644
index 00000000..b5349135
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/cOpt
@@ -0,0 +1,2 @@
+cDBUG       =
+cOPT        = -O3 -no-prec-div
diff --git a/wmake/rules/SunOS64Gcc/cProf b/wmake/rules/linux64IccKNL/cProf
similarity index 100%
rename from wmake/rules/SunOS64Gcc/cProf
rename to wmake/rules/linux64IccKNL/cProf
diff --git a/wmake/rules/linux64IccKNL/general b/wmake/rules/linux64IccKNL/general
new file mode 100644
index 00000000..52b0e177
--- /dev/null
+++ b/wmake/rules/linux64IccKNL/general
@@ -0,0 +1,8 @@
+CPP        = /lib/cpp -traditional-cpp $(GFLAGS)
+
+PROJECT_LIBS = -l$(WM_PROJECT) -ldl
+
+include $(GENERAL_RULES)/standard
+
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linux64Gcc44/mplibHPMPI b/wmake/rules/linux64IccKNL/mplibHPMPI
similarity index 53%
rename from wmake/rules/linux64Gcc44/mplibHPMPI
rename to wmake/rules/linux64IccKNL/mplibHPMPI
index 574492a2..d7c4b0cf 100644
--- a/wmake/rules/linux64Gcc44/mplibHPMPI
+++ b/wmake/rules/linux64IccKNL/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/linux64Gcc43/mplibINTELMPI b/wmake/rules/linux64IccKNL/mplibINTELMPI
similarity index 61%
rename from wmake/rules/linux64Gcc43/mplibINTELMPI
rename to wmake/rules/linux64IccKNL/mplibINTELMPI
index cf80ec2e..278e0b0f 100644
--- a/wmake/rules/linux64Gcc43/mplibINTELMPI
+++ b/wmake/rules/linux64IccKNL/mplibINTELMPI
@@ -1,3 +1,3 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linuxARM7Gcc/c b/wmake/rules/linuxARM7Gcc/c
index 5be3206f..dfae4add 100644
--- a/wmake/rules/linuxARM7Gcc/c
+++ b/wmake/rules/linuxARM7Gcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linuxARM7Gcc/c++ b/wmake/rules/linuxARM7Gcc/c++
index 10d6b9cb..80fccf27 100644
--- a/wmake/rules/linuxARM7Gcc/c++
+++ b/wmake/rules/linuxARM7Gcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxARM7Gcc/c++Opt b/wmake/rules/linuxARM7Gcc/c++Opt
index a9c0f512..4b21a760 100644
--- a/wmake/rules/linuxARM7Gcc/c++Opt
+++ b/wmake/rules/linuxARM7Gcc/c++Opt
@@ -1,3 +1,5 @@
 c++DBUG     =
 #c++OPT      = -O3 -floop-optimize -falign-loops -falign-labels -falign-functions -falign-jumps -fprefetch-loop-arrays -mcpu=cortex-a9 -mfpu=vfpv3-d16 -mfloat-abi=hard
 c++OPT      = -O3 -floop-optimize -falign-loops -falign-labels -falign-functions -falign-jumps -fprefetch-loop-arrays -mcpu=cortex-a9 -mfpu=vfpv3-d16 -mfloat-abi=softfp
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/linuxARM7Gcc/general b/wmake/rules/linuxARM7Gcc/general
index 376c6148..1e51dcc4 100644
--- a/wmake/rules/linuxARM7Gcc/general
+++ b/wmake/rules/linuxARM7Gcc/general
@@ -5,5 +5,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxARM7Gcc/mplibHPMPI b/wmake/rules/linuxARM7Gcc/mplibHPMPI
index 8aff4063..c44b3dd3 100644
--- a/wmake/rules/linuxARM7Gcc/mplibHPMPI
+++ b/wmake/rules/linuxARM7Gcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxClang/c b/wmake/rules/linuxClang/c
index 99b32383..2c8e8a7f 100644
--- a/wmake/rules/linuxClang/c
+++ b/wmake/rules/linuxClang/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = clang -m32
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linuxClang/c++ b/wmake/rules/linuxClang/c++
index 7ae53634..b029fbcf 100644
--- a/wmake/rules/linuxClang/c++
+++ b/wmake/rules/linuxClang/c++
@@ -1,17 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-# -Woverloaded-virtual may produce spurious warnings, disable for now
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast -Wnon-virtual-dtor -Wno-overloaded-virtual -Wno-unused-comparison
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof -Wno-c++11-extensions
 
-CC          = clang++ -m32
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedef -Wno-tautological-undefined-compare -Wno-shift-negative-value
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = clang++ -std=c++0x -m32
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxClang/general b/wmake/rules/linuxClang/general
index fa1eb5b9..e3427c31 100644
--- a/wmake/rules/linuxClang/general
+++ b/wmake/rules/linuxClang/general
@@ -5,5 +5,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxClang/mplibHPMPI b/wmake/rules/linuxClang/mplibHPMPI
index 8aff4063..c44b3dd3 100644
--- a/wmake/rules/linuxClang/mplibHPMPI
+++ b/wmake/rules/linuxClang/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc/c b/wmake/rules/linuxGcc/c
index d914fcd3..8eddde04 100644
--- a/wmake/rules/linuxGcc/c
+++ b/wmake/rules/linuxGcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc -m32
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linuxGcc/c++ b/wmake/rules/linuxGcc/c++
index 357f4106..c1c34a84 100644
--- a/wmake/rules/linuxGcc/c++
+++ b/wmake/rules/linuxGcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++ -m32
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x -m32
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxGcc/c++Opt b/wmake/rules/linuxGcc/c++Opt
index 2aedabd6..599e6aba 100644
--- a/wmake/rules/linuxGcc/c++Opt
+++ b/wmake/rules/linuxGcc/c++Opt
@@ -1,2 +1,4 @@
 c++DBUG     =
 c++OPT      = -O3
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/linuxGcc/general b/wmake/rules/linuxGcc/general
index fa1eb5b9..e3427c31 100644
--- a/wmake/rules/linuxGcc/general
+++ b/wmake/rules/linuxGcc/general
@@ -5,5 +5,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxGcc/mplibHPMPI b/wmake/rules/linuxGcc/mplibHPMPI
index 8aff4063..c44b3dd3 100644
--- a/wmake/rules/linuxGcc/mplibHPMPI
+++ b/wmake/rules/linuxGcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc43/c b/wmake/rules/linuxGcc43/c
deleted file mode 100644
index d914fcd3..00000000
--- a/wmake/rules/linuxGcc43/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m32
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linuxGcc43/c++ b/wmake/rules/linuxGcc43/c++
deleted file mode 100644
index e862181f..00000000
--- a/wmake/rules/linuxGcc43/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m32
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/linuxGcc43/c++Debug b/wmake/rules/linuxGcc43/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linuxGcc43/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linuxGcc43/c++Opt b/wmake/rules/linuxGcc43/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linuxGcc43/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linuxGcc43/c++Prof b/wmake/rules/linuxGcc43/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linuxGcc43/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linuxGcc43/cDebug b/wmake/rules/linuxGcc43/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linuxGcc43/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linuxGcc43/cOpt b/wmake/rules/linuxGcc43/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linuxGcc43/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linuxGcc43/cProf b/wmake/rules/linuxGcc43/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linuxGcc43/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linuxGcc43/general b/wmake/rules/linuxGcc43/general
deleted file mode 100644
index fa1eb5b9..00000000
--- a/wmake/rules/linuxGcc43/general
+++ /dev/null
@@ -1,9 +0,0 @@
-CPP        = cpp -traditional-cpp $(GFLAGS)
-LD         = ld -melf_i386
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linuxGcc43/mplibHPMPI b/wmake/rules/linuxGcc43/mplibHPMPI
deleted file mode 100644
index 8aff4063..00000000
--- a/wmake/rules/linuxGcc43/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc44/c b/wmake/rules/linuxGcc44/c
deleted file mode 100644
index d914fcd3..00000000
--- a/wmake/rules/linuxGcc44/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m32
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linuxGcc44/c++ b/wmake/rules/linuxGcc44/c++
deleted file mode 100644
index e862181f..00000000
--- a/wmake/rules/linuxGcc44/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m32
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed
diff --git a/wmake/rules/linuxGcc44/c++Debug b/wmake/rules/linuxGcc44/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linuxGcc44/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linuxGcc44/c++Opt b/wmake/rules/linuxGcc44/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linuxGcc44/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linuxGcc44/c++Prof b/wmake/rules/linuxGcc44/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linuxGcc44/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linuxGcc44/cDebug b/wmake/rules/linuxGcc44/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linuxGcc44/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linuxGcc44/cOpt b/wmake/rules/linuxGcc44/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linuxGcc44/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linuxGcc44/cProf b/wmake/rules/linuxGcc44/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linuxGcc44/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linuxGcc44/general b/wmake/rules/linuxGcc44/general
deleted file mode 100644
index fa1eb5b9..00000000
--- a/wmake/rules/linuxGcc44/general
+++ /dev/null
@@ -1,9 +0,0 @@
-CPP        = cpp -traditional-cpp $(GFLAGS)
-LD         = ld -melf_i386
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linuxGcc44/mplibHPMPI b/wmake/rules/linuxGcc44/mplibHPMPI
deleted file mode 100644
index 8aff4063..00000000
--- a/wmake/rules/linuxGcc44/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc45/c b/wmake/rules/linuxGcc45/c
deleted file mode 100644
index d914fcd3..00000000
--- a/wmake/rules/linuxGcc45/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m32
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linuxGcc45/c++ b/wmake/rules/linuxGcc45/c++
deleted file mode 100644
index 357f4106..00000000
--- a/wmake/rules/linuxGcc45/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m32
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linuxGcc45/c++Debug b/wmake/rules/linuxGcc45/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linuxGcc45/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linuxGcc45/c++Opt b/wmake/rules/linuxGcc45/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linuxGcc45/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linuxGcc45/c++Prof b/wmake/rules/linuxGcc45/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linuxGcc45/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linuxGcc45/cDebug b/wmake/rules/linuxGcc45/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linuxGcc45/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linuxGcc45/cOpt b/wmake/rules/linuxGcc45/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linuxGcc45/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linuxGcc45/cProf b/wmake/rules/linuxGcc45/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linuxGcc45/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linuxGcc45/general b/wmake/rules/linuxGcc45/general
deleted file mode 100644
index 4b051e6b..00000000
--- a/wmake/rules/linuxGcc45/general
+++ /dev/null
@@ -1,9 +0,0 @@
-CPP        = cpp -traditional-cpp
-LD         = ld -melf_i386
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linuxGcc45/mplibHPMPI b/wmake/rules/linuxGcc45/mplibHPMPI
deleted file mode 100644
index 8aff4063..00000000
--- a/wmake/rules/linuxGcc45/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc46/c b/wmake/rules/linuxGcc46/c
deleted file mode 100644
index d914fcd3..00000000
--- a/wmake/rules/linuxGcc46/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m32
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linuxGcc46/c++ b/wmake/rules/linuxGcc46/c++
deleted file mode 100644
index 357f4106..00000000
--- a/wmake/rules/linuxGcc46/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m32
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linuxGcc46/c++Debug b/wmake/rules/linuxGcc46/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linuxGcc46/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linuxGcc46/c++Opt b/wmake/rules/linuxGcc46/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linuxGcc46/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linuxGcc46/c++Prof b/wmake/rules/linuxGcc46/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linuxGcc46/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linuxGcc46/cDebug b/wmake/rules/linuxGcc46/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linuxGcc46/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linuxGcc46/cOpt b/wmake/rules/linuxGcc46/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linuxGcc46/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linuxGcc46/cProf b/wmake/rules/linuxGcc46/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linuxGcc46/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linuxGcc46/general b/wmake/rules/linuxGcc46/general
deleted file mode 100644
index 4b051e6b..00000000
--- a/wmake/rules/linuxGcc46/general
+++ /dev/null
@@ -1,9 +0,0 @@
-CPP        = cpp -traditional-cpp
-LD         = ld -melf_i386
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linuxGcc46/mplibHPMPI b/wmake/rules/linuxGcc46/mplibHPMPI
deleted file mode 100644
index 8aff4063..00000000
--- a/wmake/rules/linuxGcc46/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxGcc47/c b/wmake/rules/linuxGcc47/c
deleted file mode 100644
index d914fcd3..00000000
--- a/wmake/rules/linuxGcc47/c
+++ /dev/null
@@ -1,16 +0,0 @@
-.SUFFIXES: .c .h
-
-cWARN        = -Wall
-
-cc          = gcc -m32
-
-include $(RULES)/c$(WM_COMPILE_OPTION)
-
-cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
-
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
-
-LINK_LIBS   = $(cDBUG)
-
-LINKLIBSO   = $(cc) -shared
-LINKEXE     = $(cc) -Xlinker --add-needed -Xlinker -z -Xlinker nodefs
diff --git a/wmake/rules/linuxGcc47/c++ b/wmake/rules/linuxGcc47/c++
deleted file mode 100644
index 357f4106..00000000
--- a/wmake/rules/linuxGcc47/c++
+++ /dev/null
@@ -1,21 +0,0 @@
-.SUFFIXES: .C .cxx .cc .cpp
-
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
-
-CC          = g++ -m32
-
-include $(RULES)/c++$(WM_COMPILE_OPTION)
-
-ptFLAGS     = -DNoRepository -ftemplate-depth-100
-
-c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
-
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
-cxxtoo      = $(Ctoo)
-cctoo       = $(Ctoo)
-cpptoo      = $(Ctoo)
-
-LINK_LIBS   = $(c++DBUG)
-
-LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
-LINKEXE     = $(CC) $(c++FLAGS) -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linuxGcc47/c++Debug b/wmake/rules/linuxGcc47/c++Debug
deleted file mode 100644
index 19bdb9c3..00000000
--- a/wmake/rules/linuxGcc47/c++Debug
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -ggdb3 -DFULLDEBUG
-c++OPT      = -O0 -fdefault-inline
diff --git a/wmake/rules/linuxGcc47/c++Opt b/wmake/rules/linuxGcc47/c++Opt
deleted file mode 100644
index 2aedabd6..00000000
--- a/wmake/rules/linuxGcc47/c++Opt
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG     =
-c++OPT      = -O3
diff --git a/wmake/rules/linuxGcc47/c++Prof b/wmake/rules/linuxGcc47/c++Prof
deleted file mode 100644
index 3bda4dad..00000000
--- a/wmake/rules/linuxGcc47/c++Prof
+++ /dev/null
@@ -1,2 +0,0 @@
-c++DBUG    = -pg
-c++OPT     = -O2
diff --git a/wmake/rules/linuxGcc47/cDebug b/wmake/rules/linuxGcc47/cDebug
deleted file mode 100644
index 72b638f4..00000000
--- a/wmake/rules/linuxGcc47/cDebug
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -ggdb -DFULLDEBUG
-cOPT        = -O1 -fdefault-inline -finline-functions
diff --git a/wmake/rules/linuxGcc47/cOpt b/wmake/rules/linuxGcc47/cOpt
deleted file mode 100644
index 17318709..00000000
--- a/wmake/rules/linuxGcc47/cOpt
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       =
-cOPT        = -O3
diff --git a/wmake/rules/linuxGcc47/cProf b/wmake/rules/linuxGcc47/cProf
deleted file mode 100644
index ca3ac9bf..00000000
--- a/wmake/rules/linuxGcc47/cProf
+++ /dev/null
@@ -1,2 +0,0 @@
-cDBUG       = -pg
-cOPT        = -O2
diff --git a/wmake/rules/linuxGcc47/general b/wmake/rules/linuxGcc47/general
deleted file mode 100644
index 4b051e6b..00000000
--- a/wmake/rules/linuxGcc47/general
+++ /dev/null
@@ -1,9 +0,0 @@
-CPP        = cpp -traditional-cpp
-LD         = ld -melf_i386
-
-PROJECT_LIBS = -l$(WM_PROJECT) -ldl
-
-include $(GENERAL_RULES)/standard
-
-include $(RULES)/c
-include $(RULES)/c++
diff --git a/wmake/rules/linuxGcc47/mplibHPMPI b/wmake/rules/linuxGcc47/mplibHPMPI
deleted file mode 100644
index 8aff4063..00000000
--- a/wmake/rules/linuxGcc47/mplibHPMPI
+++ /dev/null
@@ -1,3 +0,0 @@
-PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
-PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxIA64Gcc/c b/wmake/rules/linuxIA64Gcc/c
index 5be3206f..dfae4add 100644
--- a/wmake/rules/linuxIA64Gcc/c
+++ b/wmake/rules/linuxIA64Gcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linuxIA64Gcc/c++ b/wmake/rules/linuxIA64Gcc/c++
index b258455b..6d152ecd 100644
--- a/wmake/rules/linuxIA64Gcc/c++
+++ b/wmake/rules/linuxIA64Gcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxIA64Gcc/general b/wmake/rules/linuxIA64Gcc/general
index 480ea1b9..182ee7f9 100644
--- a/wmake/rules/linuxIA64Gcc/general
+++ b/wmake/rules/linuxIA64Gcc/general
@@ -4,6 +4,6 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxIA64Gcc/mplibHPMPI b/wmake/rules/linuxIA64Gcc/mplibHPMPI
index 4e4e54c8..cd11010d 100644
--- a/wmake/rules/linuxIA64Gcc/mplibHPMPI
+++ b/wmake/rules/linuxIA64Gcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia64 -lmpi
diff --git a/wmake/rules/linuxIA64Icc/c b/wmake/rules/linuxIA64Icc/c
index d05b1486..2b19596b 100644
--- a/wmake/rules/linuxIA64Icc/c
+++ b/wmake/rules/linuxIA64Icc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        =
 
 cc          = icc
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG) -L$(IA32ROOT)/lib
 
diff --git a/wmake/rules/linuxIA64Icc/c++ b/wmake/rules/linuxIA64Icc/c++
index 625cbd18..a8a9341e 100644
--- a/wmake/rules/linuxIA64Icc/c++
+++ b/wmake/rules/linuxIA64Icc/c++
@@ -1,16 +1,20 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -wd327,654,819,1125,1476,1505,1572
+c++WARN     = -Wall -Wextra -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof \
+              -diag-disable 2304
 
-CC          = icpc
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -diag-disable 1224,2026,2305
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = icpc -std=c++0x
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxIA64Icc/general b/wmake/rules/linuxIA64Icc/general
index 9dc446d4..09a38966 100644
--- a/wmake/rules/linuxIA64Icc/general
+++ b/wmake/rules/linuxIA64Icc/general
@@ -4,6 +4,6 @@ GLIBS      =
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxIA64Icc/mplibHPMPI b/wmake/rules/linuxIA64Icc/mplibHPMPI
index 4e4e54c8..cd11010d 100644
--- a/wmake/rules/linuxIA64Icc/mplibHPMPI
+++ b/wmake/rules/linuxIA64Icc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia64 -lmpi
diff --git a/wmake/rules/linuxIA64Icc/mplibINTELMPI b/wmake/rules/linuxIA64Icc/mplibINTELMPI
index cf80ec2e..278e0b0f 100644
--- a/wmake/rules/linuxIA64Icc/mplibINTELMPI
+++ b/wmake/rules/linuxIA64Icc/mplibINTELMPI
@@ -1,3 +1,3 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include64
+PINC       = -isystem $(MPI_ARCH_PATH)/include64
 PLIBS      = -L$(MPI_ARCH_PATH)/lib64 -lmpi
diff --git a/wmake/rules/linuxIcc/c b/wmake/rules/linuxIcc/c
index e8059d9d..c9f75c90 100644
--- a/wmake/rules/linuxIcc/c
+++ b/wmake/rules/linuxIcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        =
 
 cc          = icc -gcc-version=400
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -KPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG) -L$(IA32ROOT)/lib
 
diff --git a/wmake/rules/linuxIcc/c++ b/wmake/rules/linuxIcc/c++
index 314cd3cd..88976144 100644
--- a/wmake/rules/linuxIcc/c++
+++ b/wmake/rules/linuxIcc/c++
@@ -1,22 +1,24 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -wd327,525,654,819,1125,1476,1505,1572
+c++WARN     = -Wall -Wextra -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof \
+              -diag-disable 2304
 
-#CC          = icpc -gcc-version=400
-CC          = icpc -std=c++0x
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -diag-disable 1224,2026,2305
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = icpc -std=c++0x -fp-trap=common -fp-model precise
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -KPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
 
-#LINK_LIBS   = $(c++DBUG) -lstdc++
 LINK_LIBS   = $(c++DBUG) -L$(IA32ROOT)/lib
 
 LINKLIBSO   = $(CC) $(c++FLAGS) -shared -Xlinker --add-needed -Xlinker --no-as-needed
diff --git a/wmake/rules/linuxIcc/c++Opt b/wmake/rules/linuxIcc/c++Opt
index 2e2380ee..2aedabd6 100644
--- a/wmake/rules/linuxIcc/c++Opt
+++ b/wmake/rules/linuxIcc/c++Opt
@@ -1,2 +1,2 @@
 c++DBUG     =
-c++OPT      = -xHost -O2 -no-prec-div
+c++OPT      = -O3
diff --git a/wmake/rules/linuxIcc/cOpt b/wmake/rules/linuxIcc/cOpt
index b5349135..17318709 100644
--- a/wmake/rules/linuxIcc/cOpt
+++ b/wmake/rules/linuxIcc/cOpt
@@ -1,2 +1,2 @@
 cDBUG       =
-cOPT        = -O3 -no-prec-div
+cOPT        = -O3
diff --git a/wmake/rules/linuxIcc/general b/wmake/rules/linuxIcc/general
index 8a38ddf6..5c94cad4 100644
--- a/wmake/rules/linuxIcc/general
+++ b/wmake/rules/linuxIcc/general
@@ -5,5 +5,5 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxIcc/mplibHPMPI b/wmake/rules/linuxIcc/mplibHPMPI
index 8aff4063..c44b3dd3 100644
--- a/wmake/rules/linuxIcc/mplibHPMPI
+++ b/wmake/rules/linuxIcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_ia32 -lmpi
diff --git a/wmake/rules/linuxPPC64Gcc/c b/wmake/rules/linuxPPC64Gcc/c
index 1269da8e..f9734170 100644
--- a/wmake/rules/linuxPPC64Gcc/c
+++ b/wmake/rules/linuxPPC64Gcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc -m64 -mcpu=power5+
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linuxPPC64Gcc/c++ b/wmake/rules/linuxPPC64Gcc/c++
index b8e735a5..7c330793 100644
--- a/wmake/rules/linuxPPC64Gcc/c++
+++ b/wmake/rules/linuxPPC64Gcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++ -m64 -mcpu=power5+
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x -m64 -mcpu=power5+
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linuxPPC64Gcc/c++Opt b/wmake/rules/linuxPPC64Gcc/c++Opt
index 2aedabd6..599e6aba 100644
--- a/wmake/rules/linuxPPC64Gcc/c++Opt
+++ b/wmake/rules/linuxPPC64Gcc/c++Opt
@@ -1,2 +1,4 @@
 c++DBUG     =
 c++OPT      = -O3
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/linuxPPC64Gcc/general b/wmake/rules/linuxPPC64Gcc/general
index fa717f96..a590cc29 100644
--- a/wmake/rules/linuxPPC64Gcc/general
+++ b/wmake/rules/linuxPPC64Gcc/general
@@ -5,6 +5,6 @@ PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linuxPPC64Gcc/mplibHPMPI b/wmake/rules/linuxPPC64Gcc/mplibHPMPI
index 574492a2..d7c4b0cf 100644
--- a/wmake/rules/linuxPPC64Gcc/mplibHPMPI
+++ b/wmake/rules/linuxPPC64Gcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/SiCortex64Gcc/X b/wmake/rules/linuxPPC64leGcc/X
similarity index 100%
rename from wmake/rules/SiCortex64Gcc/X
rename to wmake/rules/linuxPPC64leGcc/X
diff --git a/wmake/rules/SunOS64Gcc/c b/wmake/rules/linuxPPC64leGcc/c
similarity index 58%
rename from wmake/rules/SunOS64Gcc/c
rename to wmake/rules/linuxPPC64leGcc/c
index f4114be3..c5e3c73e 100644
--- a/wmake/rules/SunOS64Gcc/c
+++ b/wmake/rules/linuxPPC64leGcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
-cc          = gcc -m64
+cc          = gcc -m64 -mcpu=power8
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linux64Gcc47/c++ b/wmake/rules/linuxPPC64leGcc/c++
similarity index 50%
rename from wmake/rules/linux64Gcc47/c++
rename to wmake/rules/linuxPPC64leGcc/c++
index 98b25ed1..805f8218 100644
--- a/wmake/rules/linux64Gcc47/c++
+++ b/wmake/rules/linuxPPC64leGcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++ -m64
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN = -Wno-old-style-cast -Wno-unused-local-typedefs -Wno-array-bounds
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x -m64 -mcpu=power8
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/SunOS64Gcc/c++Debug b/wmake/rules/linuxPPC64leGcc/c++Debug
similarity index 100%
rename from wmake/rules/SunOS64Gcc/c++Debug
rename to wmake/rules/linuxPPC64leGcc/c++Debug
diff --git a/wmake/rules/linuxPPC64leGcc/c++Opt b/wmake/rules/linuxPPC64leGcc/c++Opt
new file mode 100644
index 00000000..599e6aba
--- /dev/null
+++ b/wmake/rules/linuxPPC64leGcc/c++Opt
@@ -0,0 +1,4 @@
+c++DBUG     =
+c++OPT      = -O3
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/linux64Gcc++0x/c++Prof b/wmake/rules/linuxPPC64leGcc/c++Prof
similarity index 100%
rename from wmake/rules/linux64Gcc++0x/c++Prof
rename to wmake/rules/linuxPPC64leGcc/c++Prof
diff --git a/wmake/rules/SunOS64Gcc/cDebug b/wmake/rules/linuxPPC64leGcc/cDebug
similarity index 100%
rename from wmake/rules/SunOS64Gcc/cDebug
rename to wmake/rules/linuxPPC64leGcc/cDebug
diff --git a/wmake/rules/SunOS64Gcc/cOpt b/wmake/rules/linuxPPC64leGcc/cOpt
similarity index 100%
rename from wmake/rules/SunOS64Gcc/cOpt
rename to wmake/rules/linuxPPC64leGcc/cOpt
diff --git a/wmake/rules/linux64Gcc++0x/cProf b/wmake/rules/linuxPPC64leGcc/cProf
similarity index 100%
rename from wmake/rules/linux64Gcc++0x/cProf
rename to wmake/rules/linuxPPC64leGcc/cProf
diff --git a/wmake/rules/linux64Gcc44/general b/wmake/rules/linuxPPC64leGcc/general
similarity index 51%
rename from wmake/rules/linux64Gcc44/general
rename to wmake/rules/linuxPPC64leGcc/general
index 243cb7d8..7867cbde 100644
--- a/wmake/rules/linux64Gcc44/general
+++ b/wmake/rules/linuxPPC64leGcc/general
@@ -1,8 +1,10 @@
 CPP        = cpp -traditional-cpp $(GFLAGS)
+LD         = ld -m elf64lppc
 
 PROJECT_LIBS = -l$(WM_PROJECT) -ldl
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/linux64Gcc43/mplibHPMPI b/wmake/rules/linuxPPC64leGcc/mplibHPMPI
similarity index 53%
rename from wmake/rules/linux64Gcc43/mplibHPMPI
rename to wmake/rules/linuxPPC64leGcc/mplibHPMPI
index 574492a2..d7c4b0cf 100644
--- a/wmake/rules/linux64Gcc43/mplibHPMPI
+++ b/wmake/rules/linuxPPC64leGcc/mplibHPMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include -D_MPICC_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include -D_MPICC_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/linux_amd64 -lmpi
diff --git a/wmake/rules/SunOS64Gcc/X b/wmake/rules/solaris64Gcc/X
similarity index 100%
rename from wmake/rules/SunOS64Gcc/X
rename to wmake/rules/solaris64Gcc/X
diff --git a/wmake/rules/linux64Gcc++0x/c b/wmake/rules/solaris64Gcc/c
similarity index 67%
rename from wmake/rules/linux64Gcc++0x/c
rename to wmake/rules/solaris64Gcc/c
index f4114be3..1097b3a5 100644
--- a/wmake/rules/linux64Gcc++0x/c
+++ b/wmake/rules/solaris64Gcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc -m64
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/linux64Gcc++0x/c++ b/wmake/rules/solaris64Gcc/c++
similarity index 50%
rename from wmake/rules/linux64Gcc++0x/c++
rename to wmake/rules/solaris64Gcc/c++
index ff7cf481..324522f1 100644
--- a/wmake/rules/linux64Gcc++0x/c++
+++ b/wmake/rules/solaris64Gcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter -Wold-style-cast -Wnon-virtual-dtor
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++ -m64 -std=c++0x
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN =
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x -m64
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/linux64Gcc++0x/c++Debug b/wmake/rules/solaris64Gcc/c++Debug
similarity index 100%
rename from wmake/rules/linux64Gcc++0x/c++Debug
rename to wmake/rules/solaris64Gcc/c++Debug
diff --git a/wmake/rules/solaris64Gcc/c++Opt b/wmake/rules/solaris64Gcc/c++Opt
new file mode 100644
index 00000000..599e6aba
--- /dev/null
+++ b/wmake/rules/solaris64Gcc/c++Opt
@@ -0,0 +1,4 @@
+c++DBUG     =
+c++OPT      = -O3
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/linux64Gcc43/c++Prof b/wmake/rules/solaris64Gcc/c++Prof
similarity index 100%
rename from wmake/rules/linux64Gcc43/c++Prof
rename to wmake/rules/solaris64Gcc/c++Prof
diff --git a/wmake/rules/linux64Gcc++0x/cDebug b/wmake/rules/solaris64Gcc/cDebug
similarity index 100%
rename from wmake/rules/linux64Gcc++0x/cDebug
rename to wmake/rules/solaris64Gcc/cDebug
diff --git a/wmake/rules/linux64Gcc++0x/cOpt b/wmake/rules/solaris64Gcc/cOpt
similarity index 100%
rename from wmake/rules/linux64Gcc++0x/cOpt
rename to wmake/rules/solaris64Gcc/cOpt
diff --git a/wmake/rules/linux64Gcc43/cProf b/wmake/rules/solaris64Gcc/cProf
similarity index 100%
rename from wmake/rules/linux64Gcc43/cProf
rename to wmake/rules/solaris64Gcc/cProf
diff --git a/wmake/rules/SunOS64Gcc/general b/wmake/rules/solaris64Gcc/general
similarity index 65%
rename from wmake/rules/SunOS64Gcc/general
rename to wmake/rules/solaris64Gcc/general
index 83b7ebf4..bbf1b69b 100644
--- a/wmake/rules/SunOS64Gcc/general
+++ b/wmake/rules/solaris64Gcc/general
@@ -5,6 +5,6 @@ PROJECT_LIBS = -l$(WM_PROJECT) -lnsl -lsocket -L$(FOAM_LIBBIN)/dummy -lPstream
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/SunOS64Gcc/mplibFJMPI b/wmake/rules/solaris64Gcc/mplibFJMPI
similarity index 71%
rename from wmake/rules/SunOS64Gcc/mplibFJMPI
rename to wmake/rules/solaris64Gcc/mplibFJMPI
index 2d6c1679..1755f22b 100644
--- a/wmake/rules/SunOS64Gcc/mplibFJMPI
+++ b/wmake/rules/solaris64Gcc/mplibFJMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ARCH_PATH)/include/sparcv9/mpi -DMPIPP_H
+PINC       = -isystem $(MPI_ARCH_PATH)/include/sparcv9/mpi -DMPIPP_H
 PLIBS      = -L$(MPI_ARCH_PATH)/lib/sparcv9 -lmpi_f -L/opt/FSUNf90/lib/sparcv9 -lfjgmp64 -L/opt/FJSVpnidt/lib -lfjidt -ljrm -lfj90i -lfj90f -lfj90fmt  -lelf
diff --git a/wmake/rules/solarisGcc/c b/wmake/rules/solarisGcc/c
index 5be3206f..dfae4add 100644
--- a/wmake/rules/solarisGcc/c
+++ b/wmake/rules/solarisGcc/c
@@ -1,14 +1,14 @@
-.SUFFIXES: .c .h
+SUFFIXES += .c
 
 cWARN        = -Wall
 
 cc          = gcc
 
-include $(RULES)/c$(WM_COMPILE_OPTION)
+include $(DEFAULT_RULES)/c$(WM_COMPILE_OPTION)
 
 cFLAGS      = $(GFLAGS) $(cWARN) $(cOPT) $(cDBUG) $(LIB_HEADER_DIRS) -fPIC
 
-ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $$SOURCE -o $@
+ctoo        = $(WM_SCHEDULER) $(cc) $(cFLAGS) -c $< -o $@
 
 LINK_LIBS   = $(cDBUG)
 
diff --git a/wmake/rules/solarisGcc/c++ b/wmake/rules/solarisGcc/c++
index 667b00c8..d8e968fb 100644
--- a/wmake/rules/solarisGcc/c++
+++ b/wmake/rules/solarisGcc/c++
@@ -1,16 +1,19 @@
-.SUFFIXES: .C .cxx .cc .cpp
+SUFFIXES += .C
 
-c++WARN     = -Wall -Wextra -Wno-unused-parameter
+c++WARN     = -Wall -Wextra -Wold-style-cast -Wnon-virtual-dtor -Wno-unused-parameter -Wno-invalid-offsetof
 
-CC          = g++
+# Suppress some warnings for flex++ and CGAL
+c++LESSWARN =
 
-include $(RULES)/c++$(WM_COMPILE_OPTION)
+CC          = g++ -std=c++0x
+
+include $(DEFAULT_RULES)/c++$(WM_COMPILE_OPTION)
 
 ptFLAGS     = -DNoRepository -ftemplate-depth-100
 
 c++FLAGS    = $(GFLAGS) $(c++WARN) $(c++OPT) $(c++DBUG) $(ptFLAGS) $(LIB_HEADER_DIRS) -fPIC
 
-Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $$SOURCE -o $@
+Ctoo        = $(WM_SCHEDULER) $(CC) $(c++FLAGS) -c $< -o $@
 cxxtoo      = $(Ctoo)
 cctoo       = $(Ctoo)
 cpptoo      = $(Ctoo)
diff --git a/wmake/rules/solarisGcc/c++Opt b/wmake/rules/solarisGcc/c++Opt
index 18428f18..b277f819 100644
--- a/wmake/rules/solarisGcc/c++Opt
+++ b/wmake/rules/solarisGcc/c++Opt
@@ -1,2 +1,4 @@
-c++DBUG       =
-c++OPT        = -O3 -fno-schedule-insns
+c++DBUG     =
+c++OPT      = -O3 -fno-schedule-insns
+
+ROUNDING_MATH = -frounding-math
diff --git a/wmake/rules/solarisGcc/general b/wmake/rules/solarisGcc/general
index cda7ba86..2e6e7b1f 100644
--- a/wmake/rules/solarisGcc/general
+++ b/wmake/rules/solarisGcc/general
@@ -4,6 +4,6 @@ PROJECT_LIBS = -l$(WM_PROJECT) -lnsl -lsocket -L$(FOAM_LIBBIN)/dummy -lPstream
 
 include $(GENERAL_RULES)/standard
 
-include $(RULES)/X
-include $(RULES)/c
-include $(RULES)/c++
+include $(DEFAULT_RULES)/X
+include $(DEFAULT_RULES)/c
+include $(DEFAULT_RULES)/c++
diff --git a/wmake/rules/solarisGcc/mplibMPI b/wmake/rules/solarisGcc/mplibMPI
index 0d79c1d7..1d65b13f 100644
--- a/wmake/rules/solarisGcc/mplibMPI
+++ b/wmake/rules/solarisGcc/mplibMPI
@@ -1,3 +1,3 @@
 PFLAGS     =
-PINC       = -I$(MPI_ROOT)/include
+PINC       = -isystem $(MPI_ROOT)/include
 PLIBS      = -L$(MPI_ROOT)/lib/$(MPI_ARCH) -lmpi
diff --git a/wmake/rules/solarisGcc/mplibMPICH b/wmake/rules/solarisGcc/mplibMPICH
index c4ef548d..767acf1e 100644
--- a/wmake/rules/solarisGcc/mplibMPICH
+++ b/wmake/rules/solarisGcc/mplibMPICH
@@ -1,3 +1,3 @@
 PFLAGS     = -DMPICH_SKIP_MPICXX
-PINC       = -I$(MPI_ARCH_PATH)/include
+PINC       = -isystem $(MPI_ARCH_PATH)/include
 PLIBS      = -L$(MPI_ARCH_PATH)/lib -lmpich -lrt -laio
diff --git a/wmake/scripts/AllwmakeParseArguments b/wmake/scripts/AllwmakeParseArguments
new file mode 100644
index 00000000..c1722e48
--- /dev/null
+++ b/wmake/scripts/AllwmakeParseArguments
@@ -0,0 +1,184 @@
+#----------------------------------*-sh-*--------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2014-2016 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# File
+#     wmake/scripts/AllwmakeParseArguments
+#
+# Description
+#     Allwmake argument parser
+#
+# Usage
+#     # Declare the targetType and set to default for library building
+#     targetType=libso      # lib, libo or libso
+#
+#     # Declare genDoc and set to default if documentation building is supported
+#     genDoc=0              # 0 or 1
+#
+#     # Parse the arguments by sourcing this script
+#     . $WM_PROJECT_DIR/wmake/scripts/AllwmakeParseArguments
+#
+#------------------------------------------------------------------------------
+Script=${0##*/}
+
+usage() {
+    exec 1>&2
+    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
+
+    # Print normal usage options
+    cat<<USAGE
+
+Usage: $Script [OPTIONS]
+
+options:
+  -h or -help       Print list of Allwmake options
+  -k or -non-stop   Compile without stopping when errors occur
+  -j                Compile using all local cores/hyperthreads
+  -jN or -j N       Compile using N cores/hyperthreads
+  -no-scheduler     Compile without wmakeScheduler
+  -update           Update lnInclude directories, dep files, remove deprecated
+                    files and directories
+USAGE
+
+    # Print options for building code documentation
+    test -n "$genDoc" && cat<<USAGE_DOC
+  doc               Compile code documentation (requires Doxygen)
+USAGE_DOC
+
+    # Print options for building libraries
+    test -n "$targetType" && cat<<USAGE_LIB
+  lib               Compile statically linked archive lib (.a)
+  libo              Compile statically linked lib (.o)
+  libso             Compile dynamically linked lib (.so)
+  dep               Compile dependency files
+USAGE_LIB
+
+    exit 1
+}
+
+
+#------------------------------------------------------------------------------
+# Set WM_NCOMPPROCS to number of cores on local machine
+#------------------------------------------------------------------------------
+
+setWM_NCOMPPROCS()
+{
+    if [ -r /proc/cpuinfo ]
+    then
+        WM_NCOMPPROCS=$(egrep "^processor" /proc/cpuinfo | wc -l)
+    elif [ -x /usr/sbin/sysctl -a -n "$(sysctl -q -n hw.ncpu)" ]
+    then
+        WM_NCOMPPROCS=$(sysctl -n hw.ncpu)
+    else
+        WM_NCOMPPROCS=1
+    fi
+
+    export WM_NCOMPPROCS
+}
+
+
+#------------------------------------------------------------------------------
+# Parse the arguments and options
+#------------------------------------------------------------------------------
+
+while [ "$#" -gt 0 ]
+do
+    case "$1" in
+        # Print help
+        -h | -help)
+            usage
+            ;;
+        # Parallel compilation on all cores of local machine
+        -j)
+            setWM_NCOMPPROCS
+            test $# -ge 2 && expr $2 + 1 > /dev/null 2>&1 \
+                && shift && export WM_NCOMPPROCS=$1
+            echo "Compiling enabled on $WM_NCOMPPROCS cores"
+            ;;
+        # Parallel compilation on specified number of cores
+        -j*)
+            export WM_NCOMPPROCS=${1#-j}
+            echo "Compiling enabled on $WM_NCOMPPROCS cores"
+            ;;
+        # Non-stop compilation, ignoring errors
+        -k | -non-stop)
+            export WM_CONTINUE_ON_ERROR=1
+            ;;
+        # Disable scheduled parallel compilation
+        -no-scheduler)
+            unset WM_SCHEDULER
+            ;;
+        # Meant to be used following a pull, this will:
+        # - remove dep files that depend on deleted files;
+        # - remove stale dep files;
+        # - update lnInclude directories;
+        # - remove empty directories, along with deprecated object directories
+        #   and respective binaries.
+        -update)
+            wrmdep -update
+            wrmdep -old
+            wmakeLnIncludeAll
+            wclean empty
+
+            # Set WM_UPDATE_DEPENDENCIES, so that wmake will pick up on it
+            export WM_UPDATE_DEPENDENCIES=yes
+            ;;
+        # Generate documentation
+        doc)
+            test -n "$genDoc" || usage "invalid option '$1'"
+            genDoc=1
+            ;;
+        # Specify target type
+        lib | libo | libso | dep)
+            test -n "$targetType" || usage "invalid option '$1'"
+            targetType=$1
+            ;;
+        --)
+            shift
+            break
+            ;;
+        -* | *)
+            usage "invalid option '$1'"
+            ;;
+    esac
+    shift
+done
+
+
+#------------------------------------------------------------------------------
+# If WM_CONTINUE_ON_ERROR not set activate the shell option "stop on error"
+#------------------------------------------------------------------------------
+
+if [ -z "${WM_CONTINUE_ON_ERROR}" ]
+then
+    set -e
+fi
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage setWM_NCOMPPROCS
+
+
+#------------------------------------------------------------------------------
diff --git a/wmake/scripts/addCompile b/wmake/scripts/addCompile
deleted file mode 100755
index 63a5b262..00000000
--- a/wmake/scripts/addCompile
+++ /dev/null
@@ -1,64 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     addCompile
-#
-# Description
-#     Cleans up the dependency list and add the compilation statement.
-#
-#     Usage: wmkdep <fileName> | addCompile <fileName>
-#
-#------------------------------------------------------------------------------
-
-sourceName=${1##*/}
-objectName=${sourceName%.*}.o
-className=${sourceName%.*}.class
-sub=${1##*.}
-depName=${1%.*}.dep
-
-sourceDir=${1%/*}
-
-if [ "$sourceDir" = "$sourceName" ]
-then
-    sourceDir=.
-fi
-
-if [ "$WM_PROJECT_DIR" ]
-then
-    sed -e s%$WM_PROJECT_DIR%'$(WM_PROJECT_DIR)'% > $depName
-else
-    cat > $depName
-fi
-
-sed -e s%".*.o.*:"%'$(OBJECTS_DIR)/'"$objectName\:"%  \
-    -e s%$WM_PROJECT_DIR%'$(WM_PROJECT_DIR)'%         \
-    >> $depName
-
-echo '$(OBJECTS_DIR)/'$objectName': $(EXE_DEP)' >> $depName
-echo '$(OBJECTS_DIR)/'$objectName':' >> $depName
-echo '	@SOURCE_DIR='$sourceDir >> $depName
-echo '	SOURCE='$1' ; $('$sub'too)' >> $depName
-
-#------------------------------------------------------------------------------
diff --git a/wmake/scripts/makeDerivedFiles b/wmake/scripts/makeDerivedFiles
deleted file mode 100755
index 28eaf89f..00000000
--- a/wmake/scripts/makeDerivedFiles
+++ /dev/null
@@ -1,133 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#-------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     makeDerivedFiles
-#
-# Description
-#     Constructs all the file list for make given the source file list,
-#     written by hand or using makeFilesAndOptions.
-#
-#------------------------------------------------------------------------------
-
-[ -d "$WM_OPTIONS" ] || {
-    echo "The '$WM_OPTIONS' directory does not exist, exiting" 1>&2
-    exit 1
-}
-
-# change to the $WM_OPTIONS directory
-cd "$WM_OPTIONS" 2>/dev/null || {
-    echo "Could not change to directory '$WM_OPTIONS'" 1>&2
-    exit 1
-}
-
-# Find and keep macro definitions in files list
-grep "=" files > filesMacros
-
-# Remove all macro definitions from the files list
-grep -v "=" files > filesPlusBlank
-
-# Add a newline to files to ensure the last line is followed by a newline
-echo "" >> filesPlusBlank
-
-
-# Remove commented lines, blank lines, and trailing blanks from files
-# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-sed -e '/^#/ d'         \
-    -e '/^[ \t]*$/ d'   \
-    -e 's/[ \t]*$//'    \
-    filesPlusBlank > files.$$
-
-rm filesPlusBlank
-
-
-# make sourceFiles
-# ~~~~~~~~~~~~~~~~
-echo "SOURCE = " > tmpSourceFile
-cat files.$$ >> tmpSourceFile
-
-sed -e 's/$/\\/'    \
-    -e '$s/\\//'    \
-    tmpSourceFile > sourceFiles
-
-rm tmpSourceFile
-
-
-# make objectFiles
-# ~~~~~~~~~~~~~~~~
-sed -e 's%.*/%%'               \
-    -e 's%^%$(OBJECTS_DIR)/%'  \
-    -e 's%\.[a-zA-Z]*$%\.o%'   \
-    files.$$ > tmpObjectFiles
-
-echo "OBJECTS = " > tmpObjectFiles2
-cat tmpObjectFiles >> tmpObjectFiles2
-
-sed -e 's/$/\\/'    \
-    -e '$s/\\//'    \
-    tmpObjectFiles2 > objectFiles
-
-rm tmpObjectFiles tmpObjectFiles2
-
-
-# make localObjectFiles
-# ~~~~~~~~~~~~~~~~~~~~~
-sed -e 's%.*/%%'               \
-    -e 's%\.[a-zA-Z]*$%\.o%'   \
-    files.$$ > tmpLocalObjectFiles
-
-echo "LOCAL_OBJECTS = " > tmpLocalObjectFiles2
-cat tmpLocalObjectFiles >> tmpLocalObjectFiles2
-
-sed -e 's/$/\\/'    \
-    -e '$s/\\//'    \
-    tmpLocalObjectFiles2 > localObjectFiles
-
-rm tmpLocalObjectFiles tmpLocalObjectFiles2
-
-
-# make dependencyFiles
-# ~~~~~~~~~~~~~~~~~~~~
-sed 's/\.[a-zA-Z]*$/\.dep/' \
-     files.$$ > tmpDependencyFiles
-
-echo "DEPENDENCIES = " > tmpDependencyFiles2
-cat tmpDependencyFiles >> tmpDependencyFiles2
-
-sed -e 's/$/\\/'    \
-    -e '$s/\\//'    \
-    tmpDependencyFiles2 > dependencyFiles
-
-rm tmpDependencyFiles tmpDependencyFiles2
-
-
-# make includeDeps
-# ~~~~~~~~~~~~~~~~
-sed -e 's/\.[a-zA-Z]*$/.dep/'   \
-    -e 's/^/include /'          \
-    files.$$ > includeDeps
-
-rm files.$$
-
-#------------------------------------------------------------------------------
diff --git a/wmake/scripts/makeDir b/wmake/scripts/makeDir
deleted file mode 100755
index 19ab86b7..00000000
--- a/wmake/scripts/makeDir
+++ /dev/null
@@ -1,40 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#-------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     makeDir
-#
-# Description
-#     Script to make directories that do not already exist
-#     Usage : makeDir <dir> [.. <dirN>]
-#
-#------------------------------------------------------------------------------
-
-for dir
-do
-    [ -d "$dir" ] || mkdir -p "$dir"
-done
-
-
-#------------------------------------------------------------------------------
diff --git a/wmake/scripts/makeFiles b/wmake/scripts/makeFiles
index c5b99db9..62f21baf 100755
--- a/wmake/scripts/makeFiles
+++ b/wmake/scripts/makeFiles
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #------------------------------------------------------------------------------
 # License
@@ -47,7 +47,7 @@ for dir in `find . -type d -print`
 do
     case "$dir" in
     . | ./Make | ./lnInclude )
-        # skip special directories
+        # Skip special directories
         ;;
     *)
         baseDir=`echo $dir | sed 's%^\./%%'`
diff --git a/wmake/scripts/wmakeFunctions b/wmake/scripts/wmakeFunctions
new file mode 100755
index 00000000..9828ee4e
--- /dev/null
+++ b/wmake/scripts/wmakeFunctions
@@ -0,0 +1,113 @@
+#!/bin/sh
+#------------------------------------------------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2015-2016 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#-------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Script
+#     wmakeFunctions
+#
+# Description
+#     Functions to check wmake environment and find .dep and .o files
+#------------------------------------------------------------------------------
+
+#------------------------------------------------------------------------------
+# Check environment variables
+#------------------------------------------------------------------------------
+
+checkEnv()
+{
+    for envar in WM_OPTIONS WM_DIR WM_PROJECT_DIR
+    do
+        eval test "\$$envar" || {
+            echo "$Script error: environment variable \$$envar not set" 1>&2
+            exit 1
+        }
+    done
+}
+
+
+#------------------------------------------------------------------------------
+# Search up directories tree for the Make sub-directory
+#------------------------------------------------------------------------------
+
+expandPath()
+{
+    if [ -d "$1" ]
+    then
+        exPath=$(cd "$1" && pwd -P)
+    else
+        exPath=$(cd $(dirname "$1") && pwd -P)
+    fi
+}
+
+findTarget()
+{
+    expandPath $WM_PROJECT_DIR
+    wmpdir=$exPath
+    expandPath $1
+
+    if [ "$exPath" = "$wmpdir" \
+                   -o "$exPath" = "$HOME" \
+                   -o "$exPath" = "/" \
+       ]
+    then
+        echo "$Script error: could not find Make directory" 1>&2
+        exit 1
+    elif [ -d "$1/Make" ]; then
+        dir=$1
+    else
+        findTarget "$1/.."
+    fi
+}
+
+findObjectDir()
+{
+    expandPath $WM_PROJECT_DIR
+    wmpdir=$exPath
+    expandPath $1
+
+    if echo $exPath | grep --colour=never "$wmpdir" > /dev/null
+    then
+        platformPath=$WM_PROJECT_DIR/platforms/${WM_OPTIONS}
+        objectsDir=$platformPath$(echo $exPath | sed s%$wmpdir%% )
+    else
+        path=$exPath
+        dir=.
+        if [ ! -d Make ]
+        then
+            findTarget .
+        fi
+        appDir=$dir
+        expandPath $appDir/.
+        objectsDir=$appDir/Make/${WM_OPTIONS}$(echo $path | sed s%$exPath%% )
+    fi
+}
+
+depToSource()
+{
+    sourceFile=$(echo ${depFile%.dep} | \
+        sed -e s%platforms/${WM_OPTIONS}/%% -e s%Make/${WM_OPTIONS}/%% \
+            -e s%platforms/${WM_OPTIONS}${WM_MPLIB}/%% \
+            -e s%Make/${WM_OPTIONS}${WM_MPLIB}/%% )
+}
+
+#------------------------------------------------------------------------------
diff --git a/wmake/src/Makefile b/wmake/src/Makefile
index 328f3e53..eb7e2734 100644
--- a/wmake/src/Makefile
+++ b/wmake/src/Makefile
@@ -2,7 +2,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #------------------------------------------------------------------------------
 # License
@@ -36,30 +36,34 @@
 SHELL      = /bin/sh
 
 #------------------------------------------------------------------------------
-# Initialise suffices list
+# Unset suffices list (suffix rules are not used)
 #------------------------------------------------------------------------------
 
 .SUFFIXES:
-.SUFFIXES: .o
 
 
 #------------------------------------------------------------------------------
-# set compilation and dependency building rules
+# Set compilation and dependency building rules
 #------------------------------------------------------------------------------
 
-GENERAL_RULES = $(WM_DIR)/rules/General
-RULES         = $(WM_DIR)/rules/$(WM_ARCH)$(WM_COMPILER)
-WMAKE_BIN     = $(WM_DIR)/platforms/$(WM_ARCH)$(WM_COMPILER)
+# Locally set optimized compilation
+WM_COMPILE_OPTION = Opt
 
-include $(RULES)/general
-include $(RULES)/$(WM_LINK_LANGUAGE)
+V = 1
+ifneq ("$(WM_QUIET_RULES)","")
+V = 0
+endif
 
+GENERAL_RULES   = $(WM_DIR)/rules/General
+include $(GENERAL_RULES)/general
+
+cFLAGS += -Wno-unused-function
 
 #------------------------------------------------------------------------------
-# targets
+# Targets
 #------------------------------------------------------------------------------
 
-all:  $(WMAKE_BIN)/dirToString $(WMAKE_BIN)/wmkdep $(WMAKE_BIN)/wmkdepend
+all:  $(WMAKE_BIN)/dirToString $(WMAKE_BIN)/wmkdep
 
 clean:
 	rm -f $(WMAKE_BIN)/* 2>/dev/null
@@ -67,23 +71,16 @@ clean:
 
 $(WMAKE_BIN)/dirToString: dirToString.c
 	@mkdir -p $(WMAKE_BIN)
-	$(cc) $(cFLAGS) dirToString.c -o $(WMAKE_BIN)/dirToString
+	$(call WM_MESSAGE,cc,dirToString.c)
+	$(AT)$(cc) $(cFLAGS) dirToString.c -o $(WMAKE_BIN)/dirToString
 
 
 $(WMAKE_BIN)/wmkdep: wmkdep.l
 	@mkdir -p $(WMAKE_BIN)
-	flex wmkdep.l
-	$(cc) $(cFLAGS) lex.yy.c -o $(WMAKE_BIN)/wmkdep
+	$(call WM_MESSAGE,ll,$<)
+	$(AT)flex $<
+	$(AT)$(cc) $(cFLAGS) lex.yy.c -o $(WMAKE_BIN)/wmkdep
 	@rm -f lex.yy.c 2>/dev/null
 
 
-# for bootstrapping - use generated files directly (instead of from .atg file)
-$(WMAKE_BIN)/wmkdepend: wmkdepend.cpp \
-    wmkdependParser.cpp wmkdependScanner.cpp \
-    wmkdependParser.h   wmkdependScanner.h
-	@mkdir -p $(WMAKE_BIN)
-	$(CC) $(c++FLAGS) \
-	     wmkdepend.cpp wmkdependParser.cpp wmkdependScanner.cpp \
-	    -o $(WMAKE_BIN)/wmkdepend
-
 #------------------------------------------------------------------------------
diff --git a/wmake/src/makeParserCode b/wmake/src/makeParserCode
deleted file mode 100755
index 161d5af4..00000000
--- a/wmake/src/makeParserCode
+++ /dev/null
@@ -1,54 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     makeParserCode
-#
-# Description
-#     Use coco-cpp to create parser code
-#
-#------------------------------------------------------------------------------
-cd ${0%/*} || exit 1    # run from this directory
-
-
-bindir=$WM_THIRD_PARTY_DIR/platforms/$WM_ARCH$WM_COMPILER/coco-cpp/bin
-frames=$bindir/../share/coco-cpp
-
-[ -d "$bindir" -a -x "$bindir/coco-cpp" ] || {
-    echo "no coco-cpp binary found"
-    exit 1
-}
-
-[ -d "$frames" -a -f "$frames/Parser.frame" -a -f "$frames/Scanner.frame" ] || {
-    echo "no coco-cpp frames found"
-    exit 1
-}
-
-# run coco-cpp:
-$bindir/coco-cpp wmkdependParser.atg
-
-echo
-echo Done
-
-#------------------------------------------------------------------------------
diff --git a/wmake/src/wmkdep.l b/wmake/src/wmkdep.l
index 86c6f64e..d5ad12f2 100644
--- a/wmake/src/wmkdep.l
+++ b/wmake/src/wmkdep.l
@@ -3,7 +3,7 @@
  =========                   |
  \\      /   F ield          | OpenFOAM: The Open Source CFD Toolbox
   \\    /    O peration      |
-   \\  /     A nd            | Copyright (C) 2011 OpenFOAM Foundation
+   \\  /     A nd            | Copyright (C) 2011-2016 OpenFOAM Foundation
     \\/      M anipulation   |
 ------------------------------------------------------------------------------
 License
@@ -46,12 +46,14 @@ Usage
 #include <string.h>
 #include <sys/types.h>
 #include <dirent.h>
+#include <errno.h>
+#include <libgen.h>
 
 void nextFile(const char* fileName);
 void importFile(const char* fileName);
 void importDir(const char* dirName);
 
-#   undef yywrap        /* sometimes a macro by default */
+#undef yywrap        /* sometimes a macro by default */
 
 %}
 
@@ -67,16 +69,6 @@ void importDir(const char* dirName);
 ^[ \t]*#[ \t]*include[ \t]+\"   BEGIN(CFNAME);  /* c-file name */
 <CFNAME>[^"\n ]*        { BEGIN(INITIAL); nextFile(yytext); } /*"*/
 
-^[ \t]*import[ \t]+       BEGIN(JFNAME);  /* java-file name */
-<JFNAME>java.*;           BEGIN(INITIAL);
-<JFNAME>org.*;            BEGIN(INITIAL);
-<JFNAME>com.*;            BEGIN(INITIAL);
-<JFNAME>sunw.*;           BEGIN(INITIAL);
-<JFNAME>sun.*;            BEGIN(INITIAL);
-<JFNAME>launcher.*;       BEGIN(INITIAL);
-<JFNAME>[^"\n*]*;       { BEGIN(INITIAL); importFile(yytext); } /*"*/
-<JFNAME>[^"\n]*\*;      { BEGIN(INITIAL); importDir(yytext); } /*"*/
-
 "      "include[ \t]+\'   BEGIN(FFNAME);  /* FORTRAN-file name */
 <FFNAME>[^']*           { BEGIN(INITIAL); nextFile(yytext); } /*'*/
 
@@ -133,7 +125,6 @@ int lookUp(struct HashEntry** hashTable, const char* p)
 
 /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 
-
 int nDirectories = 0;
 char** directories;
 char* sourceFile = NULL;
@@ -142,8 +133,14 @@ char* depFile = NULL;
 /* Set of files already visited */
 struct HashEntry* visitedFiles[HASH_TABLE_SIZE];
 
-/* Set of (java) directories already visited */
-struct HashEntry* visitedDirs[HASH_TABLE_SIZE];
+/* Buffer pointer stack counter */
+int currentBuffer = 0;
+
+/* Buffer pointer stack */
+YY_BUFFER_STATE buffers[FILE_STACK_SIZE];
+
+/* Directory paths for the loaded files */
+const char* bufferPaths[FILE_STACK_SIZE];
 
 
 int main(int argc, char* argv[])
@@ -158,7 +155,18 @@ int main(int argc, char* argv[])
     }
 
     sourceFile = strdup(argv[argc-1]);
-    fprintf(stderr, "Making dependency list for source file %s\n", sourceFile);
+/*
+    verbose = (strncmp(argv[1], "-v", 2) == 0);
+    if (verbose)
+    {
+        fprintf(stderr, "Making dependency list for source file %s\n",
+	        sourceFile);
+    }
+    else
+    {
+        fprintf(stderr, " [DEP] %s\n", basename(sourceFile));
+    }
+*/
 
 
     if ((basePos = strrchr(sourceFile, '/')) == NULL)
@@ -225,31 +233,26 @@ int main(int argc, char* argv[])
      * because there is a bug in the SGI strncat that if 0 preceeds the '.'
      * it inserts a space
      */
-    depFile = (char*)malloc(strlen(sourceFile) + 3);
+    depFile = (char*)malloc(strlen(sourceFile) + 20);
     depFile[0] = 0;
-    strncat(depFile, sourceFile, (dotPos - sourceFile)/sizeof(char));
+    strcat(depFile, "$(OBJECTS_DIR)/");
+    strcat(depFile, sourceFile);
     strcat(depFile, ".dep");
 
-    if (strcmp(dotPos, ".java") == 0)
-    {
-        char *classFile = strdup(sourceFile);
-        classFile[(dotPos - sourceFile)/sizeof(char)] = 0;
+    char *objectFile = strdup(basePos);
+    objectFile[(dotPos - basePos)/sizeof(char)] = 0;
 
-        printf("$(CLASSES_DIR)/%s.class: %s\n", classFile, depFile);
-        free(classFile);
-    }
-    else
-    {
-        char *objectFile = strdup(basePos);
-        objectFile[(dotPos - basePos)/sizeof(char)] = 0;
+    /* printf("$(OBJECTS_DIR)/%s.o: %s\n", objectFile, depFile); */
+    printf("%s: \\\n", depFile);
+    free(objectFile);
 
-        printf("$(OBJECTS_DIR)/%s.o: %s\n", objectFile, depFile);
-        free(objectFile);
-    }
+    /* Initialize buffer path for currentBuffer */
+    bufferPaths[currentBuffer] = NULL;
 
     nextFile(sourceFile);
     yylex();
 
+    puts("\n");
 
     for (i = 0; i < nDirectories; i++)
     {
@@ -264,10 +267,6 @@ int main(int argc, char* argv[])
 }
 
 
-int currentBuffer = 0;                     /* Buffer pointer stack counter */
-YY_BUFFER_STATE buffers[FILE_STACK_SIZE];  /* Buffer pointer stack */
-
-
 /*
  * Add a directory name to the file name
  */
@@ -312,6 +311,28 @@ void nextFile(const char* fileName)
     /* Pointer to new file which is set if the file is successfully opened */
     FILE* newyyin = NULL;
 
+    /* Check if the file has same path as the file in the current buffer */
+    if (bufferPaths[currentBuffer] != NULL)
+    {
+        char* pathName = addDirectoryName(bufferPaths[currentBuffer], fileName);
+
+        if ((newyyin = fopen(pathName, "r")))
+        {
+            printf("%s \\\n", pathName);
+
+            buffers[currentBuffer++] = YY_CURRENT_BUFFER;
+            bufferPaths[currentBuffer] = bufferPaths[currentBuffer-1];
+
+            yy_switch_to_buffer(yy_create_buffer(newyyin, YY_BUF_SIZE));
+
+            free(pathName);
+
+            return;
+        }
+
+        free(pathName);
+    }
+
     if (!(newyyin = fopen(fileName, "r")))
     {
         int d;
@@ -321,8 +342,11 @@ void nextFile(const char* fileName)
 
             if ((newyyin = fopen(pathName, "r")))
             {
-                printf("%s: %s\n", depFile, pathName);
+                printf("%s \\\n", pathName);
+
                 buffers[currentBuffer++] = YY_CURRENT_BUFFER;
+                bufferPaths[currentBuffer] = directories[d];
+
                 yy_switch_to_buffer(yy_create_buffer(newyyin, YY_BUF_SIZE));
 
                 free(pathName);
@@ -333,12 +357,24 @@ void nextFile(const char* fileName)
             free(pathName);
         }
 
-        fprintf
-        (
-            stderr,
-            "could not open file %s for source file %s\n",
-            fileName, sourceFile
-        );
+        if (nDirectories == 0)
+        {
+            fprintf
+            (
+                stderr,
+                "could not open file %s for source file %s\n",
+                fileName, sourceFile
+            );
+        }
+        else
+        {
+            fprintf
+            (
+                stderr,
+                "could not open file %s for source file %s due to %s\n",
+                fileName, sourceFile, strerror(errno)
+            );
+        }
 
         fflush(stdout);
         fflush(stderr);
@@ -348,10 +384,12 @@ void nextFile(const char* fileName)
     }
     else
     {
-        printf("%s: %s\n", depFile, fileName);
+        printf("%s \\\n", fileName);
         fflush(stdout);
 
         buffers[currentBuffer++] = YY_CURRENT_BUFFER;
+        bufferPaths[currentBuffer] = NULL;
+
         yy_switch_to_buffer(yy_create_buffer(newyyin, YY_BUF_SIZE));
     }
 }
@@ -373,77 +411,6 @@ void dotToSlash(char* fileName)
 
 
 /*
- * Import (java) file
- */
-void importFile(const char* fileName)
-{
-    char* javaFileName;
-    int fileNameLen;
-
-    fileNameLen = strlen(fileName);
-    javaFileName = (char*)malloc(fileNameLen + 6);
-    javaFileName[0] = 0;
-    strncat(javaFileName, fileName, fileNameLen - 1);
-    dotToSlash(javaFileName);
-    strcat(javaFileName, ".java");
-
-    nextFile(javaFileName);
-
-    free(javaFileName);
-}
-
-
-/*
- * Import (java) directories
- */
-void importDir(const char* dirName)
-{
-    char *uDirName;
-    DIR *source;
-
-    if (lookUp(visitedDirs, dirName))
-    {
-        return;   /* already existed (did not insert) */
-    }
-
-    uDirName = strdup(dirName);
-    dotToSlash(uDirName);
-
-    uDirName[strlen(dirName)-2] = 0;
-
-    if ((source = opendir(uDirName)) == NULL)
-    {
-        fprintf
-        (
-            stderr,
-            "could not open directory %s\n",
-            uDirName
-        );
-    }
-    else
-    {
-        /* Read and parse all the entries in the directory */
-        struct dirent *list;
-
-        while ((list = readdir(source)) != NULL)
-        {
-            char* dotPos = strrchr(list->d_name, '.');
-
-            if (dotPos != NULL && strcmp(dotPos, ".java") == 0)
-            {
-                char* pathName = addDirectoryName(uDirName, list->d_name);
-                nextFile(pathName);
-                free(pathName);
-            }
-        }
-
-        closedir(source);
-    }
-    free(uDirName);
-}
-
-
-/*
  * The lexer calls yywrap to handle EOF conditions
  */
 int yywrap()
diff --git a/wmake/src/wmkdepend.cpp b/wmake/src/wmkdepend.cpp
deleted file mode 100644
index e4fe46c8..00000000
--- a/wmake/src/wmkdepend.cpp
+++ /dev/null
@@ -1,176 +0,0 @@
-/*---------------------------------------------------------------------------*\
- =========                   |
- \\      /   F ield          | OpenFOAM: The Open Source CFD Toolbox
-  \\    /    O peration      |
-   \\  /     A nd            | Copyright (C) 2011 OpenFOAM Foundation
-    \\/      M anipulation   |
-------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-Application
-    wmkdepend
-
-Description
-    A fast dependency list generator that emulates the behaviour and
-    output of cpp -M. However, the output contains no duplications and
-    is ~40% faster than cpp.
-
-    The algorithm uses flex to scan for includes and searches the files
-    found.  Each file is entered into a hash table so that files are scanned
-    only once.  This is why this program is faster than cpp.
-
-Usage
-    wmkdepend [ -Idir ... -Idir ] [ -iheader .. -iheader ] filename
-
-\*---------------------------------------------------------------------------*/
-
-#include <cstdio>
-#include <cstdlib>
-#include <cstring>
-
-#include "wmkdependParser.h"
-
-// Note: since we use the Coco/R default error messages, we must use
-// wide streams for stderr.
-
-void printUsage(const char* message = NULL)
-{
-    if (message)
-    {
-        fwprintf(stderr, L"\nError: %s\n\n", message);
-    }
-
-    fwprintf
-    (
-        stderr,
-        L"Usage: wmkdepend %s filename\nOptions:\n%s\n",
-        "[ -Idir ... -Idir ] [ -iheader .. -iheader ]",
-        "  -Idir        specify include directory\n"
-        "  -iheader     specify header name to ignore\n"
-    );
-}
-
-
-int main(int argc, char* argv[])
-{
-    if (argc == 1)
-    {
-        printUsage("input file not supplied");
-        ::exit(1);
-    }
-
-    for (int i=1; i < argc; i++)
-    {
-        if (strncmp(argv[i], "-I", 2) == 0)
-        {
-            if (strlen(argv[i]) > 2)
-            {
-                std::string dirName(argv[i] + 2);
-
-                // add trailing slash if required
-                if (dirName.rfind('/') != dirName.size()-1)
-                {
-                    dirName += '/';
-                }
-
-                wmake::Parser::includeDirs.push_back(dirName);
-            }
-        }
-        else if (strncmp(argv[i], "-i", 2) == 0)
-        {
-            if (strlen(argv[i]) > 2)
-            {
-                wmake::Parser::visitedFiles.insert(argv[i] + 2);
-            }
-        }
-    }
-
-    std::string sourceFile(argv[argc-1]);
-
-    fwprintf
-    (
-        stderr,
-        L"Making dependency list for source file %s\n",
-        sourceFile.c_str()
-    );
-
-    std::string::size_type basePos = sourceFile.rfind('/');
-    if (basePos == std::string::npos)
-    {
-        basePos = 0;
-    }
-    else
-    {
-        basePos++;
-    }
-
-    std::string::size_type dotPos = sourceFile.rfind('.');
-    if
-    (
-        dotPos == std::string::npos
-     || dotPos == sourceFile.size()-1
-     || dotPos <= basePos
-    )
-    {
-        fwprintf
-        (
-            stderr,
-            L"cannot find extension in source file name %s\n",
-            sourceFile.c_str()
-        );
-        ::exit(1);
-    }
-
-    std::string depFile = sourceFile.substr(0, dotPos);
-    depFile += ".dep";
-
-    const std::string sourceExt = sourceFile.substr(dotPos);
-    if (sourceExt == ".java")
-    {
-        // import directories to ignore
-        wmake::Parser::ignoreDir("java.*");
-        wmake::Parser::ignoreDir("org.*");
-        wmake::Parser::ignoreDir("com.*");
-        wmake::Parser::ignoreDir("sunw.*");
-        wmake::Parser::ignoreDir("sun.*");
-        wmake::Parser::ignoreDir("launcher.*");
-
-        std::cout
-            << "$(CLASSES_DIR)/"
-            << sourceFile.substr(basePos, dotPos - basePos) << ".class: "
-            << depFile << "\n";
-    }
-    else
-    {
-        std::cout
-            << "$(OBJECTS_DIR)/"
-            << sourceFile.substr(basePos, dotPos - basePos) << ".o: "
-            << depFile << "\n";
-    }
-
-
-    wmake::Parser::sourceFile = sourceFile;
-    wmake::Parser::depFile = depFile;
-
-    wmake::Parser::includeFile(sourceFile);
-
-    return 0;
-}
-
-
-
-/*****************************************************************************/
diff --git a/wmake/src/wmkdependParser.atg b/wmake/src/wmkdependParser.atg
deleted file mode 100644
index bf2df41f..00000000
--- a/wmake/src/wmkdependParser.atg
+++ /dev/null
@@ -1,366 +0,0 @@
-/*---------------------------------------------------------------------------*\
-    Attributed Grammar for Coco/R  (-*- C++ -*- version)
-    compile with:
-        coco-cpp wmkdependParser.atg
-\*---------------------------------------------------------------------------*/
-[copy]
-/*---------------------------------*- C++ -*---------------------------------*\
-  =========                 |
-  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-   \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-     \\/     M anipulation  |
--------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-@file wmkdependParser.atg
-
-Description
-    An attributed Coco/R grammar to parse C/C++, Fortran and Java files
-    for include and import statements.
-
-SourceFiles
-    generated
-
-\*---------------------------------------------------------------------------*/
-[/copy]
-#include <iostream>
-#include <string>
-#include <list>
-#include <set>
-
-/*---------------------------------------------------------------------------*/
-
-COMPILER wmkdepend
-    // grammar pragmas:
-    $namespace=wmake
-    $prefix=wmkdepend
-    $define=FORCE_UTF8
-
-/*---------------------------------------------------------------------------*/
-private:
-
-    //! Set of (java) directories already visited
-    static std::set<std::string> visitedDirs_;
-
-    //! Replace all '.' with '/'
-    static void dotToSlash(std::string& name);
-
-    //! Import (java) directories
-    static void importDir(const std::string& dirName);
-
-    //! Import (java) file
-    static void importFile(const std::string& name);
-
-public:
-    //! Set of files already visited
-    static std::set<std::string> visitedFiles;
-
-    //! Include directories to search
-    static std::list<std::string> includeDirs;
-
-    //! The name of the top-level source file
-    static std::string sourceFile;
-
-    //! The name of the top-level dep file
-    static std::string depFile;
-
-    //! Add directory to list of visited dirs, thus effectively ignoring it
-    static void ignoreDir(const std::string& name);
-
-    //! Include file
-    static void includeFile(const std::string& name);
-
-/*---------------------------------------------------------------------------*/
-[code]
-#include <sys/types.h>
-#include <dirent.h>
-
-std::set<std::string> Parser::visitedDirs_;
-
-std::set<std::string> Parser::visitedFiles;
-std::list<std::string> Parser::includeDirs;
-std::string Parser::sourceFile;
-std::string Parser::depFile;
-
-
-void Parser::dotToSlash(std::string& name)
-{
-    std::string::size_type start = 0;
-
-    while ((start = name.find('.', start)) != std::string::npos)
-    {
-        name.replace(start, 1, 1, '/');
-        start++;
-    }
-}
-
-
-void Parser::ignoreDir(const std::string& name)
-{
-    visitedDirs_.insert(name);
-}
-
-
-void Parser::includeFile(const std::string& name)
-{
-    if (!visitedFiles.insert(name).second)
-    {
-        return;   // already existed (did not insert)
-    }
-
-    // use stdio and buffering within Coco/R -- (faster)
-    FILE *fh = fopen(name.c_str(), "r");
-    if (fh)
-    {
-        std::cout << depFile << ": " << name << "\n";
-    }
-    else
-    {
-        for
-        (
-            std::list<std::string>::const_iterator iter = includeDirs.begin();
-            iter != includeDirs.end();
-            ++iter
-        )
-        {
-            const std::string pathName = *iter + name;
-
-            fh = fopen(pathName.c_str(), "r");
-            if (fh)
-            {
-                std::cout << depFile << ": " << pathName << "\n";
-                break;
-            }
-        }
-    }
-
-    if (fh)
-    {
-        Scanner scanner(fh);
-        Parser  parser(&scanner);
-
-        parser.Parse();
-        fclose(fh);
-    }
-    else
-    {
-        fwprintf
-        (
-            stderr,
-            L"could not open file %s for source file %s\n",
-            name.c_str(), sourceFile.c_str()
-        );
-
-        // only report the first occurance
-        visitedFiles.insert(name);
-    }
-}
-
-
-void Parser::importFile(const std::string& name)
-{
-    // check if a globbed form was already visited
-    std::string::size_type dotPos = name.find('.');
-    if (dotPos != std::string::npos)
-    {
-        std::string dirGlob = name.substr(0, dotPos);
-        dirGlob += ".*";
-
-        if (visitedDirs_.find(dirGlob) != visitedDirs_.end())
-        {
-            return;
-        }
-    }
-
-    std::string javaFileName = name;
-
-    dotToSlash(javaFileName);
-    javaFileName += ".java";
-
-    includeFile(javaFileName);
-}
-
-
-void Parser::importDir(const std::string& name)
-{
-    if (!visitedDirs_.insert(name).second)
-    {
-        return;   // already existed (did not insert)
-    }
-
-    std::string dirName = name;
-    dotToSlash(dirName);
-
-    DIR *source = opendir(dirName.c_str());
-
-    if (source)
-    {
-        struct dirent *list;
-
-        // Read and parse all the entries in the directory
-        while ((list = readdir(source)) != NULL)
-        {
-            const char* ext = strstr(list->d_name, ".java");
-
-            // avoid matching on something like '.java~'
-            if (ext && strlen(ext) == 5)
-            {
-                std::string pathName = dirName + list->d_name;
-                includeFile(pathName);
-            }
-        }
-
-        closedir(source);
-    }
-    else
-    {
-        fwprintf
-        (
-            stderr,
-            L"could not open directory %s\n",
-            dirName.c_str()
-        );
-        return;
-    }
-}
-
-[/code]
-
-
-/*---------------------------------------------------------------------------*/
-
-CHARACTERS
-    letter    = 'A'..'Z' + 'a'..'z' + '_'.
-    digit     = "0123456789".
-    cr        = '\r'.
-    lf        = '\n'.
-    tab       = '\t'.
-    stringCh  = ANY - '"' - '\\' - cr - lf.
-    printable = '\u0020' .. '\u007e'.
-    java_letter = letter + '$'.
-
-// * * * * * * * * * * * * * * * *  TOKENS * * * * * * * * * * * * * * * * * //
-
-TOKENS
-
-// string
-string =
-    '"' { stringCh | '\\' printable } '"'.
-
-// single-quoted string (eg, Fortran)
-sqstring =
-    '\'' { stringCh | '\\' printable } '\''.
-
-// for java import
-package_name =
-    java_letter { java_letter | digit }
-    { '.' java_letter { java_letter | digit } } .
-
-// for java import
-package_dir =
-    java_letter { java_letter | digit }
-    { '.' java_letter { java_letter | digit } } ".*" .
-
-
-// * * * * * * * * * * *  PRAGMAS / COMMENTS / IGNORE  * * * * * * * * * * * //
-
-COMMENTS FROM "/*" TO "*/" NESTED
-COMMENTS FROM "//" TO lf
-
-IGNORE tab
-
-// * * * * * * * * * * * * * * *  PRODUCTIONS  * * * * * * * * * * * * * * * //
-
-PRODUCTIONS
-
-wmkdepend
-=
-{
-    // C/C++-style includes
-    '#'
-    [
-        "include"
-        [
-            string      (.
-                           if (isUTF8())
-                           {
-                               includeFile(t->toStringUTF8(1, t->length()-2));
-                           }
-                           else
-                           {
-                               includeFile(t->toString(1, t->length()-2));
-                           }
-                         .)
-        ]
-    ]
-    [ ANY { ANY } ] '\n'    // skip trailing junk
-
-    // Fortran-style includes
-  | "include"
-    [
-        sqstring        (.
-                           if (isUTF8())
-                           {
-                               includeFile(t->toStringUTF8(1, t->length()-2));
-                           }
-                           else
-                           {
-                               includeFile(t->toString(1, t->length()-2));
-                           }
-                         .)
-    ]
-    [ ANY { ANY } ] '\n'    // skip trailing junk
-
-        // Java imports
-  | "import"
-    (
-        package_dir     (.
-                           if (isUTF8())
-                           {
-                               importDir(t->toStringUTF8());
-                           }
-                           else
-                           {
-                               importDir(t->toString());
-                           }
-                         .)
-      | package_name    (.
-                           if (isUTF8())
-                           {
-                               importFile(t->toStringUTF8());
-                           }
-                           else
-                           {
-                               importFile(t->toString());
-                           }
-                         .)
-    )
-    ';'
-    [ ANY { ANY } ] '\n'    // skip trailing junk
-
-  | [ ANY { ANY } ] '\n'    // skip any other lines
-
-}
-.
-
-
-/*---------------------------------------------------------------------------*/
-
-END wmkdepend.
-
-// ************************************************************************* //
diff --git a/wmake/src/wmkdependParser.cpp b/wmake/src/wmkdependParser.cpp
deleted file mode 100644
index 0984a56c..00000000
--- a/wmake/src/wmkdependParser.cpp
+++ /dev/null
@@ -1,575 +0,0 @@
-/*---------------------------------*- C++ -*---------------------------------*\
-  =========                 |
-  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-   \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-     \\/     M anipulation  |
--------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-@file wmkdependParser.atg
-
-Description
-    An attributed Coco/R grammar to parse C/C++, Fortran and Java files
-    for include and import statements.
-
-SourceFiles
-    generated
-
-\*---------------------------------------------------------------------------*/
-// This file was generated with Coco/R C++ (10 Mar 2010)
-// http://www.ssw.uni-linz.ac.at/coco/
-// with these defines:
-//     - FORCE_UTF8
-
-
-#include <cstdio>
-#include <cstdlib>
-#include <cstring>
-#include <cwchar>
-#include <sstream>
-
-#include "wmkdependParser.h"
-
-namespace wmake {
-
-
-#include <sys/types.h>
-#include <dirent.h>
-
-std::set<std::string> Parser::visitedDirs_;
-
-std::set<std::string> Parser::visitedFiles;
-std::list<std::string> Parser::includeDirs;
-std::string Parser::sourceFile;
-std::string Parser::depFile;
-
-
-void Parser::dotToSlash(std::string& name)
-{
-    std::string::size_type start = 0;
-
-    while ((start = name.find('.', start)) != std::string::npos)
-    {
-        name.replace(start, 1, 1, '/');
-        start++;
-    }
-}
-
-
-void Parser::ignoreDir(const std::string& name)
-{
-    visitedDirs_.insert(name);
-}
-
-
-void Parser::includeFile(const std::string& name)
-{
-    if (!visitedFiles.insert(name).second)
-    {
-        return;   // already existed (did not insert)
-    }
-
-    // use stdio and buffering within Coco/R -- (faster)
-    FILE *fh = fopen(name.c_str(), "r");
-    if (fh)
-    {
-        std::cout << depFile << ": " << name << "\n";
-    }
-    else
-    {
-        for
-        (
-            std::list<std::string>::const_iterator iter = includeDirs.begin();
-            iter != includeDirs.end();
-            ++iter
-        )
-        {
-            const std::string pathName = *iter + name;
-
-            fh = fopen(pathName.c_str(), "r");
-            if (fh)
-            {
-                std::cout << depFile << ": " << pathName << "\n";
-                break;
-            }
-        }
-    }
-
-    if (fh)
-    {
-        Scanner scanner(fh);
-        Parser  parser(&scanner);
-
-        parser.Parse();
-        fclose(fh);
-    }
-    else
-    {
-        fwprintf
-        (
-            stderr,
-            L"could not open file %s for source file %s\n",
-            name.c_str(), sourceFile.c_str()
-        );
-
-        // only report the first occurance
-        visitedFiles.insert(name);
-    }
-}
-
-
-void Parser::importFile(const std::string& name)
-{
-    // check if a globbed form was already visited
-    std::string::size_type dotPos = name.find('.');
-    if (dotPos != std::string::npos)
-    {
-        std::string dirGlob = name.substr(0, dotPos);
-        dirGlob += ".*";
-
-        if (visitedDirs_.find(dirGlob) != visitedDirs_.end())
-        {
-            return;
-        }
-    }
-
-    std::string javaFileName = name;
-
-    dotToSlash(javaFileName);
-    javaFileName += ".java";
-
-    includeFile(javaFileName);
-}
-
-
-void Parser::importDir(const std::string& name)
-{
-    if (!visitedDirs_.insert(name).second)
-    {
-        return;   // already existed (did not insert)
-    }
-
-    std::string dirName = name;
-    dotToSlash(dirName);
-
-    DIR *source = opendir(dirName.c_str());
-
-    if (source)
-    {
-        struct dirent *list;
-
-        // Read and parse all the entries in the directory
-        while ((list = readdir(source)) != NULL)
-        {
-            const char* ext = strstr(list->d_name, ".java");
-
-            // avoid matching on something like '.java~'
-            if (ext && strlen(ext) == 5)
-            {
-                std::string pathName = dirName + list->d_name;
-                includeFile(pathName);
-            }
-        }
-
-        closedir(source);
-    }
-    else
-    {
-        fwprintf
-        (
-            stderr,
-            L"could not open directory %s\n",
-            dirName.c_str()
-        );
-        return;
-    }
-}
-
-
-
-
-//! @cond fileScope
-//
-//  Create by copying str - only used locally
-inline static wchar_t* coco_string_create(const wchar_t* str)
-{
-	const int len = wcslen(str);
-	wchar_t* dst = new wchar_t[len + 1];
-	wcsncpy(dst, str, len);
-	dst[len] = 0;
-	return dst;
-}
-
-
-// Free storage and nullify the argument
-inline static void coco_string_delete(wchar_t* &str)
-{
-	delete[] str;
-	str = NULL;
-}
-//
-//! @endcond
-
-
-// ----------------------------------------------------------------------------
-// Parser Implementation
-// ----------------------------------------------------------------------------
-
-void Parser::SynErr(int n)
-{
-	if (errDist >= minErrDist) errors->SynErr(la->line, la->col, n);
-	errDist = 0;
-}
-
-
-void Parser::SemErr(const std::wstring& msg)
-{
-	if (errDist >= minErrDist) errors->Error(t->line, t->col, msg);
-	errDist = 0;
-}
-
-
-bool Parser::isUTF8() const
-{
-	return scanner && scanner->buffer && scanner->buffer->isUTF8();
-}
-
-
-void Parser::Get()
-{
-	for (;;)
-	{
-		t = la;
-		la = scanner->Scan();
-		if (la->kind <= maxT)
-		{
-			++errDist;
-			break;
-		}
-		if (dummyToken != t)
-		{
-			dummyToken->kind = t->kind;
-			dummyToken->pos = t->pos;
-			dummyToken->col = t->col;
-			dummyToken->line = t->line;
-			dummyToken->next = NULL;
-			coco_string_delete(dummyToken->val);
-			dummyToken->val = coco_string_create(t->val);
-			t = dummyToken;
-		}
-		la = t;
-	}
-}
-
-
-void Parser::Expect(int n)
-{
-	if (la->kind == n)
-	{
-		Get();
-	}
-	else
-	{
-		SynErr(n);
-	}
-}
-
-
-void Parser::ExpectWeak(int n, int follow)
-{
-	if (la->kind == n)
-	{
-		Get();
-	}
-	else
-	{
-		SynErr(n);
-		while (!StartOf(follow))
-		{
-			Get();
-		}
-	}
-}
-
-
-bool Parser::WeakSeparator(int n, int syFol, int repFol)
-{
-	if (la->kind == n)
-	{
-		Get();
-		return true;
-	}
-	else if (StartOf(repFol))
-	{
-		return false;
-	}
-	else
-	{
-		SynErr(n);
-		while (!(StartOf(syFol) || StartOf(repFol) || StartOf(0)))
-		{
-			Get();
-		}
-		return StartOf(syFol);
-	}
-}
-
-
-void Parser::wmkdepend()
-{
-	while (StartOf(1)) {
-		if (la->kind == 5) {
-			Get();
-			if (la->kind == 6) {
-				Get();
-				if (la->kind == 1) {
-					Get();
-					if (isUTF8())
-					{
-					    includeFile(t->toStringUTF8(1, t->length()-2));
-					}
-					else
-					{
-					    includeFile(t->toString(1, t->length()-2));
-					}
-
-				}
-			}
-			if (StartOf(2)) {
-				Get();
-				while (StartOf(3)) {
-					Get();
-				}
-			}
-			Expect(7);
-		} else if (la->kind == 6) {
-			Get();
-			if (la->kind == 2) {
-				Get();
-				if (isUTF8())
-				{
-				    includeFile(t->toStringUTF8(1, t->length()-2));
-				}
-				else
-				{
-				    includeFile(t->toString(1, t->length()-2));
-				}
-
-			}
-			if (StartOf(4)) {
-				Get();
-				while (StartOf(3)) {
-					Get();
-				}
-			}
-			Expect(7);
-		} else if (la->kind == 8) {
-			Get();
-			if (la->kind == 4) {
-				Get();
-				if (isUTF8())
-				{
-				    importDir(t->toStringUTF8());
-				}
-				else
-				{
-				    importDir(t->toString());
-				}
-
-			} else if (la->kind == 3) {
-				Get();
-				if (isUTF8())
-				{
-				    importFile(t->toStringUTF8());
-				}
-				else
-				{
-				    importFile(t->toString());
-				}
-
-			} else SynErr(11);
-			Expect(9);
-			if (StartOf(3)) {
-				Get();
-				while (StartOf(3)) {
-					Get();
-				}
-			}
-			Expect(7);
-		} else {
-			if (StartOf(5)) {
-				Get();
-				while (StartOf(3)) {
-					Get();
-				}
-			}
-			Expect(7);
-		}
-	}
-}
-
-
-
-void Parser::Parse()
-{
-	t = NULL;
-	// might call Parse() twice
-	if (dummyToken) {
-		coco_string_delete(dummyToken->val);
-		delete dummyToken;
-	}
-	dummyToken = new Token(coco_string_create(L"Dummy Token"));
-	la = dummyToken;
-	Get();
-	wmkdepend();
-	Expect(0);  // expect end-of-file automatically added
-}
-
-
-Parser::Parser(Scanner* scan, Errors* err)
-:
-	dummyToken(NULL),
-	deleteErrorsDestruct_(!err),
-	errDist(minErrDist),
-	scanner(scan),
-	errors(err),
-	t(NULL),
-	la(NULL)
-{
-	if (!errors)    // add in default error handling
-	{
-		errors = new Errors();
-	}
-	// user-defined initializations:
-}
-
-
-bool Parser::StartOf(int s)
-{
-	const bool T = true;
-	const bool x = false;
-
-	static const bool set[6][12] =
-	{
-		{T,x,x,x, x,x,x,x, x,x,x,x},
-		{x,T,T,T, T,T,T,T, T,T,T,x},
-		{x,x,T,T, T,T,x,x, T,T,T,x},
-		{x,T,T,T, T,T,T,x, T,T,T,x},
-		{x,T,x,T, T,T,T,x, T,T,T,x},
-		{x,T,T,T, T,x,x,x, x,T,T,x}
-	};
-
-	return set[s][la->kind];
-}
-
-
-Parser::~Parser()
-{
-	if (deleteErrorsDestruct_) { delete errors; } // delete default error handling
-	if (dummyToken) {
-		coco_string_delete(dummyToken->val);
-		delete dummyToken;
-	}
-	// user-defined destruction:
-}
-
-
-// ----------------------------------------------------------------------------
-// Errors Implementation
-// ----------------------------------------------------------------------------
-
-Errors::Errors()
-:
-	count(0)
-{}
-
-
-Errors::~Errors()
-{}
-
-
-void Errors::clear()
-{
-	count = 0;
-}
-
-
-std::wstring Errors::strerror(int n)
-{
-	switch (n) {
-		case 0: return L"EOF expected"; break;
-		case 1: return L"string expected"; break;
-		case 2: return L"sqstring expected"; break;
-		case 3: return L"package_name expected"; break;
-		case 4: return L"package_dir expected"; break;
-		case 5: return L"\"#\" expected"; break;
-		case 6: return L"\"include\" expected"; break;
-		case 7: return L"\"\\n\" expected"; break;
-		case 8: return L"\"import\" expected"; break;
-		case 9: return L"\";\" expected"; break;
-		case 10: return L"??? expected"; break;
-		case 11: return L"invalid wmkdepend"; break;
-		default:
-		{
-			// std::wostringstream buf;  (this typedef might be missing)
-			std::basic_ostringstream<wchar_t> buf;
-			buf << "error " << n;
-			return buf.str();
-		}
-		break;
-	}
-}
-
-
-void Errors::Warning(const std::wstring& msg)
-{
-	fwprintf(stderr, L"%ls\n", msg.c_str());
-}
-
-
-void Errors::Warning(int line, int col, const std::wstring& msg)
-{
-	fwprintf(stderr, L"-- line %d col %d: %ls\n", line, col, msg.c_str());
-}
-
-
-void Errors::Error(int line, int col, const std::wstring& msg)
-{
-	fwprintf(stderr, L"-- line %d col %d: %ls\n", line, col, msg.c_str());
-	count++;
-}
-
-
-void Errors::SynErr(int line, int col, int n)
-{
-	this->Error(line, col, this->strerror(n));
-}
-
-
-void Errors::Exception(const std::wstring& msg)
-{
-	fwprintf(stderr, L"%ls", msg.c_str());
-	::exit(1);
-}
-
-
-// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
-
-} // End namespace
-
-// ************************************************************************* //
diff --git a/wmake/src/wmkdependParser.h b/wmake/src/wmkdependParser.h
deleted file mode 100644
index 2285efaa..00000000
--- a/wmake/src/wmkdependParser.h
+++ /dev/null
@@ -1,176 +0,0 @@
-/*---------------------------------*- C++ -*---------------------------------*\
-  =========                 |
-  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-   \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-     \\/     M anipulation  |
--------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-@file wmkdependParser.atg
-
-Description
-    An attributed Coco/R grammar to parse C/C++, Fortran and Java files
-    for include and import statements.
-
-SourceFiles
-    generated
-
-\*---------------------------------------------------------------------------*/
-// This file was generated with Coco/R C++ (10 Mar 2010)
-// http://www.ssw.uni-linz.ac.at/coco/
-// with these defines:
-//     - FORCE_UTF8
-
-
-#ifndef COCO_wmkdependPARSER_H__
-#define COCO_wmkdependPARSER_H__
-
-#include <iostream>
-#include <string>
-#include <list>
-#include <set>
-
-/*---------------------------------------------------------------------------*/
-
-
-
-#include "wmkdependScanner.h"
-
-namespace wmake {
-
-
-/*---------------------------------------------------------------------------*\
-                           Class Errors Declaration
-\*---------------------------------------------------------------------------*/
-//! Parser error handling
-class Errors
-{
-public:
-	int count;      //!< The number of errors detected
-
-	//! Return a string describing the given error code.
-	static std::wstring strerror(int n);
-
-	Errors();               //!< Construct null - start with no errors
-	virtual ~Errors();      //!< Destructor
-	virtual void clear();   //!< Clear the error count
-
-	//! Handle a general warning 'msg'
-	virtual void Warning(const std::wstring& msg);
-	//! Handle a general warning 'msg'
-	virtual void Warning(int line, int col, const std::wstring& msg);
-	//! Handle general error 'msg' (eg, a semantic error)
-	virtual void Error(int line, int col, const std::wstring& msg);
-	//! Handle syntax error 'n', uses strerror for the message, calls Error()
-	virtual void SynErr(int line, int col, int n);
-	//! Handle a general exception 'msg'
-	virtual void Exception(const std::wstring& msg);
-
-}; // Errors
-
-
-
-/*---------------------------------------------------------------------------*\
-                           Class Parser Declaration
-\*---------------------------------------------------------------------------*/
-//! A Coco/R Parser
-class Parser
-{
-	enum {
-		_EOF=0,
-		_string=1,
-		_sqstring=2,
-		_package_name=3,
-		_package_dir=4,
-		maxT = 10    //<! max term (w/o pragmas)
-	};
-	static const int minErrDist = 2; //!< min. distance before reporting errors
-
-	Token *dummyToken;
-	bool deleteErrorsDestruct_; //!< delete the 'errors' member in destructor
-	int  errDist;
-
-	void SynErr(int n);         //!< Handle syntax error 'n'
-	void Get();
-	void Expect(int n);
-	bool StartOf(int s);
-	void ExpectWeak(int n, int follow);
-	bool WeakSeparator(int n, int syFol, int repFol);
-
-public:
-	Scanner *scanner;
-	Errors  *errors;
-
-	Token *t;                   //!< last recognized token
-	Token *la;                  //!< lookahead token
-
-private:
-
-    //! Set of (java) directories already visited
-    static std::set<std::string> visitedDirs_;
-
-    //! Replace all '.' with '/'
-    static void dotToSlash(std::string& name);
-
-    //! Import (java) directories
-    static void importDir(const std::string& dirName);
-
-    //! Import (java) file
-    static void importFile(const std::string& name);
-
-public:
-    //! Set of files already visited
-    static std::set<std::string> visitedFiles;
-
-    //! Include directories to search
-    static std::list<std::string> includeDirs;
-
-    //! The name of the top-level source file
-    static std::string sourceFile;
-
-    //! The name of the top-level dep file
-    static std::string depFile;
-
-    //! Add directory to list of visited dirs, thus effectively ignoring it
-    static void ignoreDir(const std::string& name);
-
-    //! Include file
-    static void includeFile(const std::string& name);
-
-/*---------------------------------------------------------------------------*/
-
-	//! Construct for the specified scanner
-	/*!
-	 * Use the default error handling, or optionally provide an error
-	 * handler, which will not be deleted upon destruction.
-	 */
-	Parser(Scanner* scan, Errors* err = 0);
-	~Parser();
-	void Parse();                          //!< Execute the parse operation
-	void SemErr(const std::wstring& msg);  //!< Handle semantic error
-	bool isUTF8() const;   //!< Return true if scanner buffer is UTF8
-
-	void wmkdepend();
-
-}; // end Parser
-
-} // End namespace
-
-#endif // COCO_wmkdependPARSER_H__
-
-// ************************************************************************* //
diff --git a/wmake/src/wmkdependScanner.cpp b/wmake/src/wmkdependScanner.cpp
deleted file mode 100644
index 5a18f0de..00000000
--- a/wmake/src/wmkdependScanner.cpp
+++ /dev/null
@@ -1,1021 +0,0 @@
-/*---------------------------------*- C++ -*---------------------------------*\
-  =========                 |
-  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-   \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-     \\/     M anipulation  |
--------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-@file wmkdependParser.atg
-
-Description
-    An attributed Coco/R grammar to parse C/C++, Fortran and Java files
-    for include and import statements.
-
-SourceFiles
-    generated
-
-\*---------------------------------------------------------------------------*/
-// This file was generated with Coco/R C++ (10 Mar 2010)
-// http://www.ssw.uni-linz.ac.at/coco/
-// with these defines:
-//     - FORCE_UTF8
-
-
-#include <sstream>
-
-// io.h and fcntl are used to ensure binary read from streams on windows
-#ifdef _WIN32
-# include <io.h>
-# include <fcntl.h>
-#endif
-
-#include <climits>
-
-#include "wmkdependScanner.h"
-
-// values for the file stream buffering
-#define MIN_BUFFER_LENGTH 1024        // 1KB
-#define MAX_BUFFER_LENGTH (64*MIN_BUFFER_LENGTH)   // 64KB
-// value for the heap management
-#define HEAP_BLOCK_SIZE   (64*1024)   // 64KB
-
-
-namespace wmake {
-
-// * * * * * * * * * * * Miscellaneous String Routines * * * * * * * * * * * //
-
-//
-// string handling, byte character
-//
-
-std::string coco_stdString(const wchar_t* str)
-{
-    return str ? coco_stdString(str, 0, wcslen(str)) : std::string();
-}
-
-
-std::string coco_stdString(const wchar_t* str, unsigned length)
-{
-    return coco_stdString(str, 0, length);
-}
-
-
-std::string coco_stdString(const wchar_t* str, unsigned index, unsigned length)
-{
-    const unsigned len = (str && *str) ? length : 0;
-    std::string dst;
-    dst.reserve(len);
-
-    for (unsigned i = 0; i < len; ++i)
-    {
-        dst += char(str[index+i] & 0xFF);
-    }
-
-    return dst;
-}
-
-
-std::string coco_stdStringUTF8(const wchar_t* str)
-{
-    return str ? coco_stdStringUTF8(str, 0, wcslen(str)) : std::string();
-}
-
-
-std::string coco_stdStringUTF8(const wchar_t* str, unsigned length)
-{
-    return coco_stdStringUTF8(str, 0, length);
-}
-
-
-std::string coco_stdStringUTF8(const wchar_t* str, unsigned index, unsigned length)
-{
-    const unsigned len = (str && *str) ? length : 0;
-    std::string dst;
-    dst.reserve(len);
-
-    for (unsigned i = 0; i < len; ++i)
-    {
-        wchar_t wc = str[index+i];
-
-        if (!(wc & ~0x0000007F))
-        {
-            // 0x00000000 - 0x0000007F [min. 8bit storage, 1-byte encoding)
-            // 0aaaaaaa
-            dst += char(wc);
-        }
-        else if (!(wc & ~0x000007FF))
-        {
-            // 0x00000080 - 0x000007FF [min. 16bit storage, 2-byte encoding]
-            // 110bbbaa 10aaaaaa
-            dst += char(0xC0 | ((wc >> 6) & 0x1F));
-            dst += char(0x80 | ((wc) & 0x3F));
-        }
-        else if (!(wc & ~0x0000FFFF))
-        {
-            // 0x00000800 - 0x0000FFFF [min. 16bit storage, 3-byte encoding]
-            // 1110bbbb 10bbbbaa 10aaaaaa
-            dst += char(0xE0 | ((wc >> 12) & 0x0F));
-            dst += char(0x80 | ((wc >> 6) & 0x3F));
-            dst += char(0x80 | ((wc) & 0x3F));
-        }
-        else if (!(wc & ~0x001FFFFF))
-        {
-            // 0x00010000 - 0x001FFFFF [min. 24bit storage, 4-byte encoding]
-            // 11110ccc 10ccbbbb 10bbbbaa 10aaaaaa
-            dst += char(0xF0 | ((wc >> 18) & 0x07));
-            dst += char(0x80 | ((wc >> 12) & 0x3F));
-            dst += char(0x80 | ((wc >> 6) & 0x3F));
-            dst += char(0x80 | ((wc) & 0x3F));
-        }
-//
-// Not (yet) used - wchar_t storage is limited to 16bit on windows
-// This also corresponds to the unicode BMP (Basic Multilingual Plane)
-//
-//        else if (!(wc & ~0x03FFFFFF))
-//        {
-//            // 0x00200000 - 0x03FFFFFF [min. 32bit storage, 5-byte encoding]
-//            // 111110dd 10cccccc 10ccbbbb 10bbbbaa 10aaaaaa
-//            dst += char(0xF8 | ((wc >> 24) & 0x03));
-//            dst += char(0x80 | ((wc >> 18) & 0x3F));
-//            dst += char(0x80 | ((wc >> 12) & 0x3F));
-//            dst += char(0x80 | ((wc >> 6) & 0x3F));
-//            dst += char(0x80 | ((wc) & 0x3F));
-//        }
-//        else if (!(wc & ~0x7FFFFFFF))
-//        {
-//            // 0x04000000 - 0x7FFFFFFF [min. 32bit storage, 6-byte encoding]
-//            // 1111110d 10dddddd 10cccccc 10ccbbbb 10bbbbaa 10aaaaaa
-//            dst += char(0xFC | ((wc >> 30) & 0x01));
-//            dst += char(0x80 | ((wc >> 24) & 0x3F));
-//            dst += char(0x80 | ((wc >> 18) & 0x3F));
-//            dst += char(0x80 | ((wc >> 12) & 0x3F));
-//            dst += char(0x80 | ((wc >> 6) & 0x3F));
-//            dst += char(0x80 | ((wc) & 0x3F));
-//        }
-//
-        else
-        {
-            // report anything unknown/invalid as replacement character U+FFFD
-            dst += char(0xEF);
-            dst += char(0xBF);
-            dst += char(0xBD);
-        }
-    }
-
-    return dst;
-}
-
-
-// * * * * * * * * * * * *  End of String Routines * * * * * * * * * * * * * //
-
-
-Token::Token(wchar_t* value)
-:
-    kind(0),
-    pos(0),
-    col(0),
-    line(0),
-    val(value),
-    next(NULL)
-{}
-
-
-Token::~Token()
-{}
-
-
-int Token::length() const
-{
-    return val ? wcslen(val) : 0;
-}
-
-
-// ----------------------------------------------------------------------------
-// Buffer Implementation
-// ----------------------------------------------------------------------------
-
-Buffer::Buffer(Buffer* b)
-:
-	buf(b->buf),
-	bufCapacity(b->bufCapacity),
-	bufLen(b->bufLen),
-	bufPos(b->bufPos),
-	bufStart(b->bufStart),
-	fileLen(b->fileLen),
-	cStream(b->cStream),
-	stdStream(b->stdStream),
-	isUserStream_(b->isUserStream_)
-{
-	// avoid accidental deletion on any of these members
-	b->buf = NULL;
-	b->cStream = NULL;
-	b->stdStream = NULL;
-}
-
-
-Buffer::Buffer(const char* chars, int len)
-:
-	buf(new unsigned char[len]),
-	bufCapacity(len),
-	bufLen(len),
-	bufPos(0),
-	bufStart(0),
-	fileLen(len),
-	cStream(NULL),
-	stdStream(NULL),
-	isUserStream_(false)
-{
-	memcpy(this->buf, chars, len*sizeof(char));
-}
-
-
-Buffer::Buffer(const unsigned char* chars, int len)
-:
-	buf(new unsigned char[len]),
-	bufCapacity(len),
-	bufLen(len),
-	bufPos(0),
-	bufStart(0),
-	fileLen(len),
-	cStream(NULL),
-	stdStream(NULL),
-	isUserStream_(false)
-{
-	memcpy(this->buf, chars, len*sizeof(char));
-}
-
-
-Buffer::Buffer(FILE* ifh, bool isUserStream)
-:
-	buf(NULL),
-	bufCapacity(0),
-	bufLen(0),
-	bufPos(0),
-	bufStart(0),
-	fileLen(0),
-	cStream(ifh),
-	stdStream(NULL),
-	isUserStream_(isUserStream)
-{
-// ensure binary read on windows
-#ifdef _WIN32
-	_setmode(_fileno(cStream), _O_BINARY);
-#endif
-
-	if (CanSeek())
-	{
-		fseek(cStream, 0, SEEK_END);
-		fileLen = ftell(cStream);
-		fseek(cStream, 0, SEEK_SET);
-		bufLen = (fileLen < MAX_BUFFER_LENGTH) ? fileLen : MAX_BUFFER_LENGTH;
-		bufStart = INT_MAX; // nothing in the buffer so far
-	}
-
-	bufCapacity = (bufLen > 0) ? bufLen : MIN_BUFFER_LENGTH;
-	buf = new unsigned char[bufCapacity];
-	if (fileLen > 0) SetPos(0);          // setup buffer to position 0 (start)
-	else bufPos = 0; // index 0 is already after the file, thus Pos = 0 is invalid
-	if (bufLen == fileLen && CanSeek()) Close();
-}
-
-
-Buffer::Buffer(std::istream* istr, bool isUserStream)
-:
-	buf(NULL),
-	bufCapacity(0),
-	bufLen(0),
-	bufPos(0),
-	bufStart(0),
-	fileLen(0),
-	cStream(NULL),
-	stdStream(istr),
-	isUserStream_(isUserStream)
-{
-#if _WIN32
-	// TODO: ensure binary read on windows?
-#endif
-}
-
-
-Buffer::~Buffer()
-{
-	Close();
-	if (buf)
-	{
-		delete[] buf;
-		buf = NULL;
-	}
-}
-
-
-void Buffer::Close()
-{
-	if (!isUserStream_)
-	{
-		if (cStream)
-		{
-			fclose(cStream);
-			cStream = NULL;
-		}
-		if (stdStream)
-		{
-			delete stdStream;
-			stdStream = 0;
-		}
-	}
-}
-
-
-int Buffer::Read()
-{
-	if (stdStream)
-	{
-		int ch = stdStream->get();
-		if (stdStream->eof())
-		{
-			return EoF;
-		}
-		return ch;
-	}
-
-	if (bufPos < bufLen) {
-		return buf[bufPos++];
-	}
-	else if (GetPos() < fileLen) {
-		SetPos(GetPos()); // shift buffer start to Pos
-		return buf[bufPos++];
-	}
-	else if (cStream && !CanSeek() && (ReadNextStreamChunk() > 0)) {
-		return buf[bufPos++];
-	}
-
-	return EoF;
-}
-
-bool Buffer::isUTF8() const
-{
-	return false;
-}
-
-int UTF8Buffer::Read()
-{
-	int ch;
-	do {
-		ch = Buffer::Read();
-		// until we find a utf8 start (0xxxxxxx or 11xxxxxx)
-	} while (ch != EoF && ch >= 128 && ((ch & 0xC0) != 0xC0));
-	if (ch < 128 || ch == EoF) {
-		// nothing to do, first 127 chars are identical in ASCII and UTF8
-		// 0xxxxxxx or end of file character
-	}
-	else if ((ch & 0xF0) == 0xF0) {
-		// 0x00010000 - 0x001FFFFF [min. 24bit storage, 4-byte encoding]
-		// 11110ccc 10ccbbbb 10bbbbaa 10aaaaaa
-		// CAUTION: this should probably be disallowed since it overflows
-		// wchar_t on windows and overflows the max (0xFFFF) used here
-		int c1 = ch & 0x07; ch = Buffer::Read();
-		int c2 = ch & 0x3F; ch = Buffer::Read();
-		int c3 = ch & 0x3F; ch = Buffer::Read();
-		int c4 = ch & 0x3F;
-		ch = (((((c1 << 6) | c2) << 6) | c3) << 6) | c4;
-	}
-	else if ((ch & 0xE0) == 0xE0) {
-		// 0x00000800 - 0x0000FFFF [min. 16bit storage, 3-byte encoding]
-		// 1110bbbb 10bbbbaa 10aaaaaa
-		int c1 = ch & 0x0F; ch = Buffer::Read();
-		int c2 = ch & 0x3F; ch = Buffer::Read();
-		int c3 = ch & 0x3F;
-		ch = (((c1 << 6) | c2) << 6) | c3;
-	}
-	else if ((ch & 0xC0) == 0xC0) {
-		// 0x00000080 - 0x000007FF [min. 16bit storage, 2-byte encoding]
-		// 110bbbaa 10aaaaaa
-		int c1 = ch & 0x1F; ch = Buffer::Read();
-		int c2 = ch & 0x3F;
-		ch = (c1 << 6) | c2;
-	}
-	return ch;
-}
-
-
-bool UTF8Buffer::isUTF8() const
-{
-	return true;
-}
-
-
-int Buffer::Peek()
-{
-	int curPos = GetPos();
-	int ch = Read();
-	SetPos(curPos);
-	return ch;
-}
-
-
-int Buffer::GetPos() const
-{
-	if (stdStream)
-	{
-		return stdStream->tellg();
-	}
-
-	return bufPos + bufStart;
-}
-
-
-void Buffer::SetPos(int value)
-{
-	if (stdStream)
-	{
-		stdStream->seekg(value, std::ios::beg);
-		return;
-	}
-
-	if ((value >= fileLen) && cStream && !CanSeek())
-	{
-		// Wanted position is after buffer and the stream
-		// is not seek-able e.g. network or console,
-		// thus we have to read the stream manually till
-		// the wanted position is in sight.
-		while ((value >= fileLen) && (ReadNextStreamChunk() > 0))
-		{}
-	}
-
-	if ((value < 0) || (value > fileLen))
-	{
-		fwprintf(stderr, L"--- buffer out of bounds access, position: %d\n", value);
-		::exit(1);
-	}
-
-	if ((value >= bufStart) && (value < (bufStart + bufLen))) // already in buffer
-	{
-		bufPos = value - bufStart;
-	}
-	else if (cStream) // must be swapped in
-	{
-		fseek(cStream, value, SEEK_SET);
-		bufLen = fread(buf, sizeof(char), bufCapacity, cStream);
-		bufStart = value; bufPos = 0;
-	}
-	else
-	{
-		bufPos = fileLen - bufStart; // make Pos return fileLen
-	}
-}
-
-
-//
-// Read the next chunk of bytes from the stream, increases the buffer
-// if needed and updates the fields fileLen and bufLen.
-// Returns the number of bytes read.
-//
-int Buffer::ReadNextStreamChunk()
-{
-	int freeLen = bufCapacity - bufLen;
-	if (freeLen == 0)
-	{
-		// in the case of a growing input stream
-		// we can neither seek in the stream, nor can we
-		// foresee the maximum length, thus we must adapt
-		// the buffer size on demand.
-		bufCapacity = bufLen * 2;
-		unsigned char *newBuf = new unsigned char[bufCapacity];
-		memcpy(newBuf, buf, bufLen*sizeof(char));
-		delete[] buf;
-		buf = newBuf;
-		freeLen = bufLen;
-	}
-	int read = fread(buf + bufLen, sizeof(char), freeLen, cStream);
-	if (read > 0)
-	{
-		fileLen = bufLen = (bufLen + read);
-		return read;
-	}
-	// end of stream reached
-	return 0;
-}
-
-
-bool Buffer::CanSeek() const
-{
-	return cStream && (ftell(cStream) != -1);
-}
-
-// ----------------------------------------------------------------------------
-// Scanner Implementation
-// ----------------------------------------------------------------------------
-
-Scanner::Scanner(const char* buf, int len)
-:
-	buffer(new Buffer(buf, len))
-{
-	Init();
-}
-
-
-Scanner::Scanner(const unsigned char* buf, int len)
-:
-	buffer(new Buffer(buf, len))
-{
-	Init();
-}
-
-
-Scanner::Scanner(FILE* ifh)
-:
-	buffer(new Buffer(ifh, true))
-{
-	Init();
-}
-
-
-#ifdef _WIN32
-Scanner::Scanner(const std::wstring& fileName)
-{
-	FILE* ifh;
-
-	if ((ifh = _wfopen(fileName.c_str(), L"rb")) == NULL)
-	{
-		fwprintf(stderr, L"--- Cannot open file %ls\n", fileName.c_str());
-		::exit(1);
-	}
-	buffer = new Buffer(ifh, false);
-	Init();
-}
-#endif
-
-
-Scanner::Scanner(const std::string& fileName)
-{
-	FILE* ifh;
-	if ((ifh = fopen(fileName.c_str(), "rb")) == NULL)
-	{
-		fwprintf(stderr, L"--- Cannot open file %s\n", fileName.c_str());
-		::exit(1);
-	}
-	buffer = new Buffer(ifh, false);
-	Init();
-}
-
-
-Scanner::Scanner(std::istream& istr)
-:
-	buffer(new Buffer(&istr, true))
-{
-	Init();
-}
-
-
-Scanner::~Scanner()
-{
-	char* cur = reinterpret_cast<char*>(firstHeap);
-
-#ifdef COCO_DEBUG_HEAP
-	fwprintf(stderr, L"~Scanner:\n");
-#endif
-
-	while (cur)
-	{
-		cur = *(reinterpret_cast<char**>(cur + HEAP_BLOCK_SIZE));
-		free(firstHeap);
-#ifdef COCO_DEBUG_HEAP
-		fwprintf
-		(
-			stderr, L"    free %p -> %p\n",
-			firstHeap,
-			reinterpret_cast<char*>(firstHeap) + HEAP_BLOCK_SIZE
-		);
-#endif
-		firstHeap = cur;
-	}
-	delete[] tval;
-	delete buffer;
-}
-
-
-void Scanner::Init()
-{
-	for (int i = 36; i <= 36; ++i) start.set(i, 7);
-	for (int i = 65; i <= 90; ++i) start.set(i, 7);
-	for (int i = 95; i <= 95; ++i) start.set(i, 7);
-	for (int i = 97; i <= 122; ++i) start.set(i, 7);
-	start.set(34, 1);
-	start.set(39, 4);
-	start.set(35, 11);
-	start.set(10, 12);
-	start.set(59, 13);
-	start.set(Buffer::EoF, -1);
-
-	keywords.set(L"include", 6);
-	keywords.set(L"import", 8);
-
-	tvalLength = 128;
-	tval = new wchar_t[tvalLength]; // text of current token
-	tlen = 0;
-	tval[tlen] = 0;
-
-	// HEAP_BLOCK_SIZE byte heap + pointer to next heap block
-	heap = malloc(HEAP_BLOCK_SIZE + sizeof(void*));
-	firstHeap = heap;
-	heapEnd =
-		reinterpret_cast<void**>
-		(reinterpret_cast<char*>(heap) + HEAP_BLOCK_SIZE);
-	*heapEnd = 0;
-	heapTop = heap;
-	if (sizeof(Token) > HEAP_BLOCK_SIZE)
-	{
-		fwprintf(stderr, L"--- Too small HEAP_BLOCK_SIZE\n");
-		::exit(1);
-	}
-#ifdef COCO_DEBUG_HEAP
-	fwprintf
-	(
-		stderr, L"Scanner::init: firstHeap %p -> %p\n",
-		firstHeap,
-		reinterpret_cast<char*>(firstHeap) + HEAP_BLOCK_SIZE
-	);
-#endif
-
-	pos = -1; line = 1; col = 0;
-	oldEols = 0;
-	NextCh();
-	if (ch == 0xEF)   // check optional byte order mark for UTF-8
-	{                 // Windows-specific magic
-		NextCh(); int ch1 = ch;
-		NextCh(); int ch2 = ch;
-		if (ch1 != 0xBB || ch2 != 0xBF)
-		{
-			fwprintf(stderr, L"Illegal byte order mark at start of file");
-			::exit(1);
-		}
-		Buffer *oldBuf = buffer;
-		buffer = new UTF8Buffer(oldBuf); col = 0;
-		delete oldBuf; oldBuf = NULL;
-		NextCh();
-	}
-	else
-	{
-		// FORCE_UTF8 was defined
-		// use UTF8Buffer without relying on a byte order mark.
-		Buffer *oldBuf = buffer;
-		buffer = new UTF8Buffer(oldBuf); col = 0;
-		delete oldBuf; oldBuf = NULL;
-	}
-
-	pt = tokens = CreateToken(); // first token is a dummy
-}
-
-
-void Scanner::NextCh()
-{
-	if (oldEols > 0)
-	{
-		ch = EOL;
-		oldEols--;
-	}
-	else
-	{
-		pos = buffer->GetPos();
-		ch = buffer->Read(); col++;
-		// replace isolated '\r' by '\n' in order to make
-		// eol handling uniform across Windows, Unix and Mac
-		if (ch == '\r' && buffer->Peek() != '\n') ch = EOL;
-		if (ch == EOL) { line++; col = 0; }
-	}
-}
-
-
-void Scanner::AddCh()
-{
-	if (tlen >= tvalLength)
-	{
-		tvalLength *= 2;
-		wchar_t *newBuf = new wchar_t[tvalLength];
-		memcpy(newBuf, tval, tlen*sizeof(wchar_t));
-		delete[] tval;
-		tval = newBuf;
-	}
-	if (ch != Buffer::EoF)
-	{
-		tval[tlen++] = ch;
-		NextCh();
-	}
-}
-
-
-
-bool Scanner::Comment0() {
-	int level = 1, pos0 = pos, line0 = line, col0 = col;
-	NextCh();
-	if (ch == '/') {
-		NextCh();
-		while (true) {
-			if (ch == 10) {
-				level--;
-				if (level == 0) { oldEols = line - line0; NextCh(); return true; }
-				NextCh();
-			} else if (ch == buffer->EoF) return false;
-			else NextCh();
-		}
-	} else {
-		buffer->SetPos(pos0); NextCh(); line = line0; col = col0;
-	}
-	return false;
-}
-
-bool Scanner::Comment1() {
-	int level = 1, pos0 = pos, line0 = line, col0 = col;
-	NextCh();
-	if (ch == '*') {
-		NextCh();
-		while (true) {
-			if (ch == '*') {
-				NextCh();
-				if (ch == '/') {
-					level--;
-					if (level == 0) { oldEols = line - line0; NextCh(); return true; }
-					NextCh();
-				}
-			} else if (ch == '/') {
-				NextCh();
-				if (ch == '*') {
-					level++; NextCh();
-				}
-			} else if (ch == buffer->EoF) return false;
-			else NextCh();
-		}
-	} else {
-		buffer->SetPos(pos0); NextCh(); line = line0; col = col0;
-	}
-	return false;
-}
-
-void Scanner::CreateHeapBlock()
-{
-	char* cur = reinterpret_cast<char*>(firstHeap);
-
-#ifdef COCO_DEBUG_HEAP
-	fwprintf(stderr, L"CreateHeapBlock: tokens %p\n", tokens);
-#endif
-
-	// release unused blocks
-	while
-	(
-	    (reinterpret_cast<char*>(tokens) < cur)
-	 || (reinterpret_cast<char*>(tokens) > (cur + HEAP_BLOCK_SIZE))
-	)
-	{
-		cur = *(reinterpret_cast<char**>(cur + HEAP_BLOCK_SIZE));
-#ifdef COCO_DEBUG_HEAP
-		fwprintf
-		(
-			stderr, L"    free %p -> %p\n",
-			firstHeap,
-			reinterpret_cast<char*>(firstHeap) + HEAP_BLOCK_SIZE
-		);
-#endif
-		free(firstHeap);
-		firstHeap = cur;
-	}
-
-	// HEAP_BLOCK_SIZE byte heap + pointer to next heap block
-	void* newHeap = malloc(HEAP_BLOCK_SIZE + sizeof(void*));
-	*heapEnd = newHeap;
-	heapEnd =
-		reinterpret_cast<void**>
-		(reinterpret_cast<char*>(newHeap) + HEAP_BLOCK_SIZE);
-	*heapEnd = 0;
-	heap = newHeap;
-	heapTop = heap;
-#ifdef COCO_DEBUG_HEAP
-	fwprintf
-	(
-		stderr, L"    malloc %p -> %p\n",
-		newHeap,
-		reinterpret_cast<char*>(newHeap) + HEAP_BLOCK_SIZE
-	);
-#endif
-}
-
-
-Token* Scanner::CreateToken()
-{
-	const int reqMem = sizeof(Token);
-	if
-	(
-	    (reinterpret_cast<char*>(heapTop) + reqMem)
-	 >= reinterpret_cast<char*>(heapEnd)
-	)
-	{
-		CreateHeapBlock();
-	}
-	// token 'occupies' heap starting at heapTop
-	Token* tok = reinterpret_cast<Token*>(heapTop);
-	// increment past this part of the heap, which is now used
-	heapTop =
-		reinterpret_cast<void*>
-		(reinterpret_cast<char*>(heapTop) + reqMem);
-	tok->val  = NULL;
-	tok->next = NULL;
-	return tok;
-}
-
-
-void Scanner::AppendVal(Token* tok)
-{
-	const int reqMem = (tlen + 1) * sizeof(wchar_t);
-	if
-	(
-	    (reinterpret_cast<char*>(heapTop) + reqMem)
-	 >= reinterpret_cast<char*>(heapEnd)
-	)
-	{
-		if (reqMem > HEAP_BLOCK_SIZE)
-		{
-			fwprintf(stderr, L"--- Too long token value\n");
-			::exit(1);
-		}
-		CreateHeapBlock();
-	}
-
-	// add text value from heap
-	tok->val = reinterpret_cast<wchar_t*>(heapTop);
-
-	// increment past this part of the heap, which is now used
-	heapTop =
-		reinterpret_cast<void*>
-		(reinterpret_cast<char*>(heapTop) + reqMem);
-
-	// copy the currently parsed tval into the token
-	wcsncpy(tok->val, tval, tlen);
-	tok->val[tlen] = '\0';
-}
-
-
-Token* Scanner::NextToken()
-{
-	while
-	(
-	    ch == ' '
-	 || ch == 9
-	) NextCh();
-	if ((ch == '/' && Comment0()) || (ch == '/' && Comment1())) return NextToken();
-	int recKind = noSym;
-	int recEnd = pos;
-	t = CreateToken();
-	t->pos = pos; t->col = col; t->line = line;
-	int state = start.state(ch);
-	tlen = 0; AddCh();
-
-	switch (state)
-	{
-		case -1: { t->kind = eofSym; break; } // NextCh already done
-		case 0: {
-			case_0:
-			if (recKind != noSym) {
-				tlen = recEnd - t->pos;
-				SetScannerBehindT();
-			}
-			t->kind = recKind; break;
-		} // NextCh already done
-		case 1:
-			case_1:
-			if (ch <= 9 || (ch >= 11 && ch <= 12) || (ch >= 14 && ch <= '!') || (ch >= '#' && ch <= '[') || (ch >= ']' && ch <= 65535)) {AddCh(); goto case_1;}
-			else if (ch == '"') {AddCh(); goto case_3;}
-			else if (ch == 92) {AddCh(); goto case_2;}
-			else {goto case_0;}
-		case 2:
-			case_2:
-			if ((ch >= ' ' && ch <= '~')) {AddCh(); goto case_1;}
-			else {goto case_0;}
-		case 3:
-			case_3:
-			{t->kind = 1; break;}
-		case 4:
-			case_4:
-			if (ch <= 9 || (ch >= 11 && ch <= 12) || (ch >= 14 && ch <= '!') || (ch >= '#' && ch <= '&') || (ch >= '(' && ch <= '[') || (ch >= ']' && ch <= 65535)) {AddCh(); goto case_4;}
-			else if (ch == 39) {AddCh(); goto case_8;}
-			else if (ch == 92) {AddCh(); goto case_5;}
-			else {goto case_0;}
-		case 5:
-			case_5:
-			if ((ch >= ' ' && ch <= '~')) {AddCh(); goto case_4;}
-			else {goto case_0;}
-		case 6:
-			case_6:
-			{t->kind = 4; break;}
-		case 7:
-			case_7:
-			recEnd = pos; recKind = 3;
-			if (ch == '$' || (ch >= '0' && ch <= '9') || (ch >= 'A' && ch <= 'Z') || ch == '_' || (ch >= 'a' && ch <= 'z')) {AddCh(); goto case_7;}
-			else if (ch == '.') {AddCh(); goto case_9;}
-			else {t->kind = 3; std::wstring literal(tval, tlen); t->kind = keywords.get(literal, t->kind); break;}
-		case 8:
-			case_8:
-			recEnd = pos; recKind = 2;
-			if (ch <= 9 || (ch >= 11 && ch <= 12) || (ch >= 14 && ch <= '!') || (ch >= '#' && ch <= '&') || (ch >= '(' && ch <= '[') || (ch >= ']' && ch <= 65535)) {AddCh(); goto case_4;}
-			else if (ch == 39) {AddCh(); goto case_8;}
-			else if (ch == 92) {AddCh(); goto case_5;}
-			else {t->kind = 2; break;}
-		case 9:
-			case_9:
-			if (ch == '$' || (ch >= 'A' && ch <= 'Z') || ch == '_' || (ch >= 'a' && ch <= 'z')) {AddCh(); goto case_10;}
-			else if (ch == '*') {AddCh(); goto case_6;}
-			else {goto case_0;}
-		case 10:
-			case_10:
-			recEnd = pos; recKind = 3;
-			if (ch == '$' || (ch >= '0' && ch <= '9') || (ch >= 'A' && ch <= 'Z') || ch == '_' || (ch >= 'a' && ch <= 'z')) {AddCh(); goto case_10;}
-			else if (ch == '.') {AddCh(); goto case_9;}
-			else {t->kind = 3; std::wstring literal(tval, tlen); t->kind = keywords.get(literal, t->kind); break;}
-		case 11:
-			{t->kind = 5; break;}
-		case 12:
-			{t->kind = 7; break;}
-		case 13:
-			{t->kind = 9; break;}
-	}
-	AppendVal(t);
-	return t;
-}
-
-
-void Scanner::SetScannerBehindT()
-{
-	buffer->SetPos(t->pos);
-	NextCh();
-	line = t->line; col = t->col;
-	for (int i = 0; i < tlen; i++) NextCh();
-}
-
-
-// get the next token (possibly a token already seen during peeking)
-Token* Scanner::Scan()
-{
-	if (tokens->next == NULL) {
-		pt = tokens = NextToken();
-	}
-	else {
-		pt = tokens = tokens->next;
-	}
-	return tokens;
-}
-
-
-// peek for the next token, ignore pragmas
-Token* Scanner::Peek()
-{
-	do
-	{
-		if (pt->next == NULL)
-		{
-			pt->next = NextToken();
-		}
-		pt = pt->next;
-	} while (pt->kind > maxT);   // skip pragmas
-
-	return pt;
-}
-
-
-// make sure that peeking starts at the current scan position
-void Scanner::ResetPeek()
-{
-	pt = tokens;
-}
-
-
-int Scanner::Line() const
-{
-	return line;
-}
-
-
-void Scanner::Line(int lineNo)
-{
-	line = lineNo;
-}
-
-
-// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //
-
-} // End namespace
-
-// ************************************************************************* //
diff --git a/wmake/src/wmkdependScanner.h b/wmake/src/wmkdependScanner.h
deleted file mode 100644
index e82771f6..00000000
--- a/wmake/src/wmkdependScanner.h
+++ /dev/null
@@ -1,476 +0,0 @@
-/*---------------------------------*- C++ -*---------------------------------*\
-  =========                 |
-  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-   \\    /   O peration     |
-    \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-     \\/     M anipulation  |
--------------------------------------------------------------------------------
-License
-    This file is part of OpenFOAM.
-
-    OpenFOAM is free software: you can redistribute it and/or modify it
-    under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-    for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-
-@file wmkdependParser.atg
-
-Description
-    An attributed Coco/R grammar to parse C/C++, Fortran and Java files
-    for include and import statements.
-
-SourceFiles
-    generated
-
-\*---------------------------------------------------------------------------*/
-// This file was generated with Coco/R C++ (10 Mar 2010)
-// http://www.ssw.uni-linz.ac.at/coco/
-// with these defines:
-//     - FORCE_UTF8
-
-
-#ifndef COCO_wmkdependSCANNER_H__
-#define COCO_wmkdependSCANNER_H__
-
-#include <cstdio>
-#include <cstdlib>
-#include <cstring>
-#include <cwchar>
-#include <string>
-#include <fstream>
-#include <iostream>
-
-namespace wmake {
-
-// * * * * * * * * * * * Miscellaneous String Routines * * * * * * * * * * * //
-
-//! Simple lower-case string transformation
-template<class StringT>
-inline void coco_string_toLower(StringT& str)
-{
-	for
-	(
-		typename StringT::iterator iter = str.begin();
-		iter != str.end();
-		++iter
-	)
-	{
-		if (*iter >= 'A' && *iter <= 'Z')
-		{
-			*iter += ('a' - 'A');   // lower-case
-		}
-	}
-}
-
-
-//! Simple string hashing function
-template<class StringT>
-inline int coco_string_hash(const StringT& str)
-{
-	int h = 0;
-	for
-	(
-		typename StringT::const_iterator iter = str.begin();
-		iter != str.end();
-		++iter
-	)
-	{
-		h = (h * 7) ^ *iter;
-	}
-	return h < 0 ? -h : h;
-}
-
-
-//
-// String conversions
-// ~~~~~~~~~~~~~~~~~~
-
-//! Convert wide string to double
-inline double coco_string_toDouble(const wchar_t* str)
-{
-	return str ? wcstod(str, NULL) : 0;
-}
-
-
-//! Convert wide string to long
-inline long coco_string_toLong(const wchar_t* str)
-{
-	return str ? wcstol(str, NULL, 10) : 0;
-}
-
-
-//! A byte string (restricted to 8bit values) by copying str
-std::string coco_stdString(const wchar_t* str);
-
-//! A byte string (restricted to 8bit values) by copying str,
-//! up to length characters long
-std::string coco_stdString(const wchar_t* str, unsigned length);
-
-//! A byte substring (restricted to 8bit values) of str,
-//! starting at index and length characters long
-std::string coco_stdString(const wchar_t* str, unsigned index, unsigned length);
-
-//! A UTF8 byte string by copying str
-std::string coco_stdStringUTF8(const wchar_t* str);
-
-//! A UTF8 byte string by copying str, up to length characters long
-std::string coco_stdStringUTF8(const wchar_t* str, unsigned length);
-
-//! A UTF8 byte substring, starting at index and length characters long
-std::string coco_stdStringUTF8(const wchar_t* str, unsigned index, unsigned length);
-
-// * * * * * * * * * * * *  End of String Routines * * * * * * * * * * * * * //
-
-
-
-/*---------------------------------------------------------------------------*\
-                            Class Token Declaration
-\*---------------------------------------------------------------------------*/
-/*!
- * @brief Scanner Token
- *
- * @note since each Token is allocated by the internal heap mechanism,
- * the destructor does not clean up the val member.
- */
-class Token
-{
-public:
-	int kind;       //!< token kind
-	int pos;        //!< token position in the source text (starting at 0)
-	int col;        //!< token column (starting at 1)
-	int line;       //!< token line (starting at 1)
-	wchar_t* val;   //!< token value (normally allocated from the internal heap)
-	Token *next;    //!< Peek tokens are kept in linked list
-
-	int length() const;    //!< The length of val, or 0 if val is NULL
-
-	//! Construct null Token, optionally with pointer to a string value
-	Token(wchar_t* value = 0);
-	~Token();       //!< Destructor - does not cleanup val member
-
-	//! Token val as byte string (restricted to 8bit values)
-	inline std::string toString() const
-	{
-		return coco_stdString(val);
-	}
-
-	//! Token val as byte string (restricted to 8bit values), up to length characters long
-	inline std::string toString(unsigned length) const
-	{
-		return coco_stdString(val, length);
-	}
-
-	//! Token val as byte string (restricted to 8bit values), starting at index and length characters long
-	inline std::string toString(unsigned index, unsigned length) const
-	{
-		return coco_stdString(val, index, length);
-	}
-
-	//! Token val as UTF8 byte string
-	inline std::string toStringUTF8() const
-	{
-		return coco_stdStringUTF8(val);
-	}
-
-	//! Token val as UTF8 byte string, up to length characters long
-	inline std::string toStringUTF8(unsigned length) const
-	{
-		return coco_stdStringUTF8(val, length);
-	}
-
-	//! Token val as UTF8 byte substring, starting at index and length characters long
-	inline std::string toStringUTF8(unsigned index, unsigned length) const
-	{
-		return coco_stdStringUTF8(this->val, index, length);
-	}
-
-};
-
-
-/*---------------------------------------------------------------------------*\
-                           Class Buffer Declaration
-\*---------------------------------------------------------------------------*/
-/*!
- * @brief Scanner Buffer
- *
- * This Buffer supports the following cases:
- * -# seekable stream (file)
- *    -# whole stream in buffer
- *    -# part of stream in buffer
- * -# non seekable stream (network, console)
- */
-class Buffer
-{
-	unsigned char *buf; //!< input buffer
-	int bufCapacity;    //!< capacity of buf
-	int bufLen;         //!< length of buffer
-	int bufPos;         //!< current position in buffer
-	int bufStart;       //!< position of first byte in buffer relative to input stream
-	int fileLen;        //!< length of input stream (may change if the stream is no file)
-	FILE* cStream;      //!< input stdio stream (normally seekable)
-	std::istream* stdStream;  //!< STL std stream (seekable)
-	bool isUserStream_;       //!< was the stream opened by the user?
-
-	int ReadNextStreamChunk();
-	bool CanSeek() const; //!< true if stream can be seeked otherwise false
-
-protected:
-	Buffer(Buffer*);    //!< for the UTF8Buffer
-
-public:
-	//! max unicode characters is 0xFFFF (16bit storage)
-	static const int MaxChar = 65535;
-	static const int EoF = MaxChar + 1;
-
-	//! Copy buffer contents from constant character string
-	Buffer(const char* chars, int len);
-
-	//! Copy buffer contents from constant character string
-	Buffer(const unsigned char* chars, int len);
-
-	//! @brief Attach buffer to a stdio stream.
-	//! User streams are not closed in the destructor
-	Buffer(FILE*, bool isUserStream = true);
-
-	//! @brief Attach buffer to an STL standard stream
-	//! User streams are not closed in the destructor
-	explicit Buffer(std::istream*, bool isUserStream = true);
-
-	//! Close stream (but not user streams) and free buf (if any)
-	virtual ~Buffer();
-
-	virtual void Close();   //!< Close stream (but not user streams)
-	virtual int Read();     //!< Get character from stream or buffer
-	virtual int Peek();     //!< Peek character from stream or buffer
-
-	virtual int GetPos() const;
-	virtual void SetPos(int value);
-	virtual bool isUTF8() const;  //!< Return false - buffer is not UTF8
-};
-
-
-/*---------------------------------------------------------------------------*\
-                         Class UTF8Buffer Declaration
-\*---------------------------------------------------------------------------*/
-//! A Scanner Buffer variant that decodes UTF-8 characters into 16bit unicode
-class UTF8Buffer : public Buffer
-{
-public:
-	UTF8Buffer(Buffer* b) : Buffer(b) {}
-	virtual int Read();
-	virtual bool isUTF8() const;  //!< Return true - buffer is UTF8
-};
-
-
-/*---------------------------------------------------------------------------*\
-                         Class StartStates Declaration
-\*---------------------------------------------------------------------------*/
-//! maps characters (integers) to start states of tokens as a HashTable
-class StartStates
-{
-	//! HashTable entry
-	struct Entry
-	{
-		int key;        //<! The lookup key
-		int val;        //<! The data
-		Entry *next;    //<! Pointer next Entry in sub-list
-
-		Entry(int k, int v, Entry *n=0)
-		:
-			key(k), val(v), next(n)
-		{}
-	};
-
-	static const int size_ = 128;   //<! fixed HashTable size
-	Entry **table_;
-
-public:
-	StartStates()
-	:
-		table_(new Entry*[size_])
-	{
-		memset(table_, 0, size_*sizeof(Entry*));
-	}
-
-	virtual ~StartStates()
-	{
-		for (int i = 0; i < size_; ++i)
-		{
-			Entry *e = table_[i];
-			while (e)
-			{
-				Entry *next = e->next;
-				delete e;
-				e = next;
-			}
-		}
-		delete[] table_;
-	}
-
-	void set(int key, int val)
-	{
-		const int hashIndex = unsigned(key) % size_;
-		table_[hashIndex] = new Entry(key, val, table_[hashIndex]);
-	}
-
-	int state(int key)
-	{
-		Entry *e = table_[unsigned(key) % size_];
-		while (e && e->key != key) e = e->next;
-		return e ? e->val : 0;
-	}
-};
-
-
-/*---------------------------------------------------------------------------*\
-                         Class KeywordMap Declaration
-\*---------------------------------------------------------------------------*/
-//! maps strings to integers (identifiers to keyword kinds) as a HashTable
-class KeywordMap
-{
-	//! HashTable entry
-	struct Entry
-	{
-		const std::wstring key;  //<! The lookup key
-		int val;                 //<! The data
-		Entry *next;             //<! Pointer next Entry in sub-list
-
-		Entry(const std::wstring& k, int v, Entry *n=0)
-		:
-			key(k), val(v), next(n)
-		{}
-	};
-
-	static const int size_ = 128;   //<! fixed HashTable size
-	Entry **table_;
-
-public:
-	KeywordMap()
-	:
-		table_(new Entry*[size_])
-	{
-		memset(table_, 0, size_*sizeof(Entry*));
-	}
-
-	virtual ~KeywordMap()
-	{
-		for (int i = 0; i < size_; ++i)
-		{
-			Entry *e = table_[i];
-			while (e)
-			{
-				Entry *next = e->next;
-				delete e;
-				e = next;
-			}
-		}
-		delete[] table_;
-	}
-
-	void set(const std::wstring& key, int val)
-	{
-		const int hashIndex = coco_string_hash(key) % size_;
-		table_[hashIndex] = new Entry(key, val, table_[hashIndex]);
-	}
-
-	int get(const std::wstring& key, int defaultVal)
-	{
-		Entry *e = table_[coco_string_hash(key) % size_];
-		while (e && e->key != key) e = e->next;
-		return e ? e->val : defaultVal;
-	}
-};
-
-
-/*---------------------------------------------------------------------------*\
-                           Class Scanner Declaration
-\*---------------------------------------------------------------------------*/
-//! A Coco/R Scanner
-class Scanner
-{
-	static const int maxT = 10;
-	static const int noSym = 10;
-	static const int eofSym = 0;    //!< end-of-file token id
-	static const char EOL = '\n';   //!< end-of-line character
-
-	void *firstHeap;  //!< the start of the heap management
-	void *heap;       //!< the currently active block
-	void *heapTop;    //!< the top of the heap
-	void **heapEnd;   //!< the end of the last heap block
-
-	StartStates start;   //!< A map of start states for particular characters
-	KeywordMap keywords; //!< A hash of keyword literals to token kind
-
-	Token *t;         //!< current token
-	wchar_t *tval;    //!< text of current token
-	int tvalLength;   //!< maximum capacity (length) for tval
-	int tlen;         //!< length of tval
-
-	Token *tokens;    //!< list of tokens already peeked (first token is a dummy)
-	Token *pt;        //!< current peek token
-
-	int ch;           //!< current input character
-	int pos;          //!< byte position of current character
-	int line;         //!< line number of current character
-	int col;          //!< column number of current character
-	int oldEols;      //!< the number of EOLs that appeared in a comment
-
-	void CreateHeapBlock();       //!< add a heap block, freeing unused ones
-	Token* CreateToken();         //!< fit token on the heap
-	void AppendVal(Token* tok);   //!< adjust tok->val to point to the heap and copy tval into it
-	void SetScannerBehindT();
-
-	void Init();      //!< complete the initialization for the constructors
-	void NextCh();    //!< get the next input character into ch
-	void AddCh();     //!< append the character ch to tval
-	bool Comment0();
-	bool Comment1();
-	Token* NextToken();  //!< get the next token
-
-public:
-	//! The scanner buffer
-	Buffer *buffer;
-
-	//! Attach scanner to an existing character buffer
-	Scanner(const char* chars, int len);
-
-	//! Attach scanner to an existing character buffer
-	Scanner(const unsigned char* chars, int len);
-
-	//! Attach scanner to an existing open file handle
-	Scanner(FILE*);
-
-#ifdef _WIN32
-	//! Open a file for reading and attach scanner - Windows only
-	explicit Scanner(const std::wstring& fileName);
-#endif
-
-	//! Open a file for reading and attach scanner
-	explicit Scanner(const std::string& fileName);
-
-	//! Attach scanner to an existing open STL standard stream
-	explicit Scanner(std::istream&);
-
-	~Scanner();        //!< free heap and allocated memory
-	Token* Scan();     //!< get the next token (possibly a token already seen during peeking)
-	Token* Peek();     //!< peek for the next token, ignore pragmas
-	void ResetPeek();  //!< ensure that peeking starts at the current scan position
-
-	int  Line() const;     //!< Return the current line
-	void Line(int lineNo); //!< Define the starting line for reporting errors
-
-}; // end Scanner
-
-} // End namespace
-
-#endif // COCO_wmkdependSCANNER_H__
-
-// ************************************************************************* //
diff --git a/wmake/wclean b/wmake/wclean
index 2427511f..996777d0 100755
--- a/wmake/wclean
+++ b/wmake/wclean
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,6 +25,10 @@
 # Script
 #     wclean
 #
+# Usage
+#     wclean [OPTION] [dir]
+#     wclean [OPTION] target [dir [MakeDir]]
+#
 # Description
 #     Clean up the wmake control directory Make/\$WM_OPTIONS and remove the
 #     lnInclude directories generated for libraries.
@@ -32,6 +36,9 @@
 #------------------------------------------------------------------------------
 Script=${0##*/}
 
+# Source the wmake functions
+. ${0%/*}/scripts/wmakeFunctions
+
 usage() {
     while [ "$#" -ge 1 ]; do echo "$1"; shift; done
     cat<<USAGE
@@ -40,31 +47,38 @@ Usage: $Script [OPTION] [dir]
        $Script [OPTION] target [dir [MakeDir]]
 
 options:
-  -s | -silent      ignored - for compatibility with wmake
-  -help             print the usage
+  -s | -silent      Ignored - for compatibility with wmake
+  -help             Print the usage
 
 Clean up the wmake control directory Make/\$WM_OPTIONS and remove the
 lnInclude directories generated for libraries.
 
 The targets correspond to a subset of the 'wmake' special targets:
-  all               all subdirectories, uses any Allwclean or Allclean
+  all               All subdirectories, uses any Allwclean or Allclean
                     files if they exist
   exe | lib | libo | libso
-                    clean Make, any *.dep files and lnInclude directories
+                    Clean Make, any *.dep files and lnInclude directories
+  empty             Remove empty sub-directories for the requested dir.
+                    If executed in the main project directory, it will also
+                    remove deprecated object directories and respective binaries
+                    that refer to no-longer-existing source code.
 
 USAGE
     exit 1
 }
 
 
-# parse options
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
 while [ "$#" -gt 0 ]
 do
     case "$1" in
     -h | -help)
         usage
         ;;
-    -s | -silent)    # ignored - for compatibility with wmake
+    -s | -silent)    # Ignored - for compatibility with wmake
         shift
         ;;
     -*)
@@ -78,10 +92,10 @@ done
 
 
 #------------------------------------------------------------------------------
-# check arguments and change to the directory in which to run wclean
+# Check arguments and change to the directory in which to run wclean
 #------------------------------------------------------------------------------
 
-unset dir makeType
+unset dir targetType
 MakeDir=Make
 
 if [ $# -ge 1 ]
@@ -91,13 +105,13 @@ then
     then
         dir=$1
     else
-        makeType=$1
+        targetType=$1
     fi
 
-    # specified directory name:
+    # Specified directory name:
     [ $# -ge 2 ] && dir=$2
 
-    # specified alternative name for the Make sub-directory:
+    # Specified alternative name for the Make sub-directory:
     [ $# -ge 3 ] && MakeDir=$3
 
     if [ "$dir" ]
@@ -108,58 +122,156 @@ then
         }
     fi
 
-    # provide some feedback
+    # Provide some feedback
     echo "$Script ${dir:-./}"
 fi
 
+
+#------------------------------------------------------------------------------
+# Remove empty sub-directories and exit
+#------------------------------------------------------------------------------
+
+if [ "$targetType" = empty ]
+then
+    # First pass: clean up empty source code directories
+
+    echo "Searching for empty directories..."
+
+    # Get sub-directories avoiding particular directories
+    for dir in $(find . -mindepth 1 -maxdepth 1 \
+                        -type d \( -name .git -prune -o -print \) )
+    do
+        echo "check dir: $dir"
+        find $dir -depth -type d -empty -exec rmdir {} \; -print
+    done
+
+    echo "Search for empty directories complete."
+
+    # Second pass: clean up object directories with WM_PROJECT_DIR that don't
+    # have respective source code folders, along with the respective binaries
+
+    expandPath $PWD
+    if [ "$exPath" = "$WM_PROJECT_DIR" ]
+    then
+        findObjectDir $PWD
+
+        if [ -d $objectsDir ]
+        then
+            echo "Searching for deprecated object directories at: $objectsDir"
+
+            find $objectsDir -name 'variables' -print | \
+            while read variablesFile
+            do
+                # Hack'ish way of getting the original source code path
+                depFile=$(dirname $variablesFile)
+                depToSource $depFile
+
+                # Check if the original source code directory exists
+                if [ ! -r "$sourceFile" ]
+                then
+                    # Delete the respective binary first
+                    binaryFile=$(cat $variablesFile |
+                                grep --colour=never -e '^ *\(EXE\|LIB\) *= *' )
+
+                    # Catch all file extension (o,a,so,?+) for libraries
+                    if echo $binaryFile | grep --colour=never -qe '^ *LIB *= *'
+                    then
+                        binaryFile="${binaryFile}.*"
+                    fi
+
+                    # Isolate path and translate environment variables
+                    binaryFile=$(echo $binaryFile | \
+                                 sed -e 's/^ *\(EXE\|LIB\) *= *//' \
+                                     -e 's/(/{/g' -e 's/)/}/g' )
+
+                    # Expand environment variables for path
+                    binaryFile=$(eval echo $binaryFile)
+
+                    # Verbosely remove binary file
+                    if [ -n "$binaryFile" -a -e "$binaryFile" ]
+                    then
+                        rm -vf $binaryFile 2>/dev/null
+                    fi
+
+                    # Remove the deprecated object directory
+                    rm -rvf $depFile 2>/dev/null
+                fi
+            done
+
+            echo "Search for deprecated object directories complete."
+        fi
+    fi
+
+    exit 0
+fi
+
+
 #------------------------------------------------------------------------------
 # Recurse the directories tree
 #------------------------------------------------------------------------------
 
-if [ "$makeType" = all ]
+if [ "$targetType" = all ]
 then
-    if [ -e Allwclean ]       # consistent with Allwmake
+    if [ -e Allwclean ]       # Consistent with Allwmake
     then
         ./Allwclean
         exit $?
-    elif [ -e Allclean ]      # often used for tutorial cases
+    elif [ -e Allclean ]      # Often used for tutorial cases
     then
         ./Allclean
         exit $?
-    elif [ ! -d $MakeDir ]
-    then
+    else
+        # For all the sub-directories containing a 'Make' directory
         for dir in `find . \( -type d -a -name Make \)`
         do
-            $0 ${dir%/Make}   # parent directory - trim /Make from the end
+            dir=${dir%/Make} # Parent directory - trim /Make from the end
+            echo $dir
+            # If Allwclean exists execute otherwise wclean
+            if [ -e "$dir/Allwclean" ]
+            then
+                $dir/Allwclean
+            else
+                $0 $dir
+            fi
         done
-        exit 0
     fi
 fi
 
-# makeType is not needed beyond this point
-unset makeType
+# targetType is not needed beyond this point
+unset targetType
 
 
 #------------------------------------------------------------------------------
-# Require the existence of the 'Make' directory
+# Clean the 'Make' directory if present
 #------------------------------------------------------------------------------
 
-[ -d $MakeDir ] || {
-    echo "$Script error: '$MakeDir' directory does not exist" 1>&2
-    exit 1
-}
+if [ -d $MakeDir ]
+then
+    objectsDir=$MakeDir/$WM_OPTIONS
+    if echo $PWD | grep --colour=never "$WM_PROJECT_DIR"
+    then
+        platformPath=$WM_PROJECT_DIR/platforms/${WM_OPTIONS}
+        objectsDir=$platformPath$(echo $PWD | sed s%$WM_PROJECT_DIR%% )
+    fi
+    rm -rf $objectsDir 2>/dev/null
+fi
 
 
-# -----------------------------------------------------------------------------
+#------------------------------------------------------------------------------
+# Remove the lnInclude directory if present
+#------------------------------------------------------------------------------
+
+if [ -d lnInclude ]
+then
+    rm -rf lnInclude 2>/dev/null
+fi
 
-rm -rf $MakeDir/$WM_OPTIONS $MakeDir/classes 2>/dev/null
 
-find . -name "*.dep" -exec rm {} \;
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
 
-# always safe to remove lnInclude
-rm -rf lnInclude 2>/dev/null
+unset Script usage
 
-rm -rf ii_files Templates.DB 2>/dev/null
-rm -f so_locations 2>/dev/null
 
 #------------------------------------------------------------------------------
diff --git a/wmake/wcleanAll b/wmake/wcleanAll
deleted file mode 100755
index 499b95eb..00000000
--- a/wmake/wcleanAll
+++ /dev/null
@@ -1,80 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#-------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     wcleanAll
-#
-# Description
-#     search all the directories below the current for the object file
-#     directories of all machines and delete them.
-#
-#------------------------------------------------------------------------------
-usage() {
-    exec 1>&2
-    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
-    cat<<USAGE
-usage: ${0##*/}
-
-    Remove all object files and *.dep files
-
-USAGE
-    exit 1
-}
-
-# parse options
-while [ "$#" -gt 0 ]
-do
-    case "$1" in
-    -h | -help)
-        usage
-        ;;
-    *)
-        usage "unknown option/argument: '$*'"
-        ;;
-    esac
-done
-
-[ -d bin -a -d src ] || usage "not in the project top level directory"
-
-
-echo "Removing platforms/ subdirectores"
-rm -rf platforms/*
-
-echo "Removing *.dep files"
-find . -name '*.dep' -exec rm {} \;
-
-echo "Cleaning Make subdirectories"
-find . -depth \( -name Make -o -name "Make.[A-Za-z]*" \) -type d -print | \
-    xargs -i find '{}' -mindepth 1 -maxdepth 1 -type d -print | \
-    xargs rm -rf
-
-echo "Removing lnInclude and intermediate directories"
-find . -depth -type d \( -name lnInclude -o -name ii_files -o -name Templates.DB \) -exec rm -rf {} \;
-
-echo "Removing misc files"
-find . \( -name exe -o -name log -o -name so_locations \) -exec rm {} \;
-
-tutorials/Allclean
-
-#------------------------------------------------------------------------------
diff --git a/wmake/wcleanLnIncludeAll b/wmake/wcleanLnIncludeAll
index 06707e8b..a1673d53 100755
--- a/wmake/wcleanLnIncludeAll
+++ b/wmake/wcleanLnIncludeAll
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2015 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,18 +25,22 @@
 # Script
 #     wcleanLnIncludeAll
 #
+# Usage
+#     wcleanLnIncludeAll [dir1] .. [dirN]
+#
 # Description
 #     Delete all the lnInclude directories in the tree.
 #
-#------------------------------------------------------------------------------
+##------------------------------------------------------------------------------
+Script=${0##*/}
 
-# default is pwd
+# Default to the CWD
 if [ "$#" -eq 0 ]
 then
     set -- .
 elif [ "$1" = "-h" -o "$1" = "-help" ]
 then
-    echo "Usage: ${0##*/} [dir1] .. [dirN]"
+    echo "Usage: $Script [dir1] .. [dirN]"
     echo
     echo "    Delete all the lnInclude directories in the tree"
     echo
@@ -44,15 +48,23 @@ then
 fi
 
 
-for i
+for dir
 do
-    if [ -d "$i" ]
+    if [ -d "$dir" ]
     then
-        echo "removing lnInclude directories: $i"
-        find $i -depth -type d -name lnInclude -exec rm -rf {} \;
+        echo "removing lnInclude directories: $dir"
+        find $dir -depth -type d -name lnInclude -exec rm -rf {} \;
     else
-        echo "no directory: $i" 1>&2
+        echo "no directory: $dir" 1>&2
     fi
 done
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wcleanMachine b/wmake/wcleanMachine
deleted file mode 100755
index 92d5072b..00000000
--- a/wmake/wcleanMachine
+++ /dev/null
@@ -1,80 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#-------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     wcleanMachine
-#
-# Description
-#     Searches the directories below the current directory for the object
-#     file directories of the specified machine type(s) and deletes them
-#
-#     Usage: wcleanMachine <machineType> [ .. <machineTypeN> ]
-#
-#------------------------------------------------------------------------------
-usage() {
-    exec 1>&2
-    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
-    cat<<USAGE
-usage: ${0##*/} machineType [... machineTypeN]
-
-  Searches the directories below the current directory for the object file
-  directories of the specified machine type(s) and deletes them
-
-Note:
-can also use '-current' for the current value of \$WM_OPTIONS
-
-USAGE
-    exit 1
-}
-
-
-# needs some machine types ... or provide immediate help
-if [ "$#" -lt 1 -o "$1" = "-h" -o "$1" = "-help" ]
-then
-    usage
-fi
-
-[ -d bin -a -d src ] || usage "not in the project top level directory"
-
-for machType
-do
-    if [ "$machType" = "-current" ]
-    then
-        machType="$WM_OPTIONS"
-        echo "Using current = $machType"
-        [ -n "$machType" ] || continue
-    fi
-
-    echo "Cleaning machine type: $machType"
-
-    find . -depth \( -name Make -o -name "Make.[A-Za-z]*" \) -type d -print | \
-        xargs -i find '{}' -mindepth 1 -maxdepth 1 \
-           \( -type d -name "*$machType" -o -name "*$machType$WM_MPLIB" \) -print |
-        xargs rm -rf
-
-    rm -rf platforms/$machType
-
-done
-
-#------------------------------------------------------------------------------
diff --git a/wmake/wcleanPlatform b/wmake/wcleanPlatform
new file mode 100755
index 00000000..a9d20cee
--- /dev/null
+++ b/wmake/wcleanPlatform
@@ -0,0 +1,127 @@
+#!/bin/sh
+#------------------------------------------------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2015 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#-------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Script
+#     wcleanPlatform
+#
+# Usage
+#    wcleanPlatform [ -current | -all ]
+#    wcleanPlatform <platform> [ ... <platformN> ]
+#
+# Description
+#     Deletes the specified platforms object files directories from the
+#     the project top-level platforms directory $WM_PROJECT_DIR.
+#
+#     You need to be in the project top-level directory to run this script.
+#
+#     Options
+#         -current: clean the current platform
+#         -all: clean all platforms
+#
+#     If either -current or no platform is specified then the current platform
+#     $WM_OPTIONS is deleted.
+#
+#     If the -all option is specified all platforms and lnInclude directories
+#     are deleted
+#
+#------------------------------------------------------------------------------
+Script=${0##*/}
+
+usage() {
+    exec 1>&2
+    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
+    cat<<USAGE
+Usage: $Script [ -current | -all ]
+       $Script <platform> [ ... <platformN> ]
+
+  Deletes the specified platforms object files directories from the
+  the project top-level platforms directory $WM_PROJECT_DIR.
+
+  You need to be in the project top-level directory to run this script.
+
+  If either -current or no platform is specified then the current platform
+  $WM_OPTIONS is deleted.
+
+  If the -all option is specified all platforms and lnInclude directories
+  are deleted.
+
+USAGE
+    exit 1
+}
+
+# Print help message
+if [ "$1" = "-h" -o "$1" = "-help" ]; then
+    usage
+fi
+
+# Check the script is executed from the project top-level directory
+[ "$PWD" = "$WM_PROJECT_DIR" ] || \
+    usage "Not in the project top-level directory " $WM_PROJECT_DIR
+
+# Get the platforms from the arguments
+platforms="$@"
+
+# If no arguments are provided select the current platform
+if [ "$#" -lt 1 ]; then
+    platforms="-current"
+fi
+
+if [ "$platforms" = "-all" ]; then
+    echo "Removing all platforms/sub-directories"
+    rm -rf platforms/*
+
+    echo "Removing lnInclude directories"
+    find . -depth -type d \( -name lnInclude \) | xargs rm -rf
+
+    tutorials/Allclean
+else
+    # Loop over the platforms specified and delete the object directories
+    for platform in $platforms
+    do
+        if [ "$platform" = "-current" ]
+        then
+            platform="$WM_OPTIONS"
+            echo "Current platform $platform"
+            [ -n "$platform" ] || continue
+        fi
+
+        if [ -d platforms/${platform} ]
+        then
+            echo "Cleaning platform $platform"
+            rm -rf platforms/${platform}*
+        else
+            echo "Platform $platform not built"
+        fi
+    done
+fi
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script platforms
+
+
+#------------------------------------------------------------------------------
diff --git a/wmake/wdep b/wmake/wdep
new file mode 100755
index 00000000..916ef72c
--- /dev/null
+++ b/wmake/wdep
@@ -0,0 +1,118 @@
+#!/bin/sh
+#------------------------------------------------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2014-2015 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#-------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Script
+#     wdep
+#
+# Usage
+#     wdep <file>
+#     cat `wdep <file>`
+#
+# Description
+#     Find the .dep file corresponding to <file> and print the path.
+#     If <file> is not in the current directory the tree is searched for
+#     the first occurrence.
+#
+#------------------------------------------------------------------------------
+Script=${0##*/}
+
+# Source the wmake functions
+. ${0%/*}/scripts/wmakeFunctions
+
+usage() {
+    exec 1>&2
+    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
+    cat<<USAGE
+
+Usage: $Script <file>
+
+Find the dep-file corresponding to <file> in the current directory
+and print the path.
+
+USAGE
+    exit 1
+}
+
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
+while [ "$#" -gt 0 ]
+do
+    case "$1" in
+    -h | -help)
+        usage
+        ;;
+    -*)
+        usage "unknown option: '$*'"
+        ;;
+    *)
+        break
+        ;;
+    esac
+done
+
+# Check environment variables
+checkEnv
+
+
+#------------------------------------------------------------------------------
+# Check <file> is is the current directory,
+# otherwise search tree for first occurrance
+#------------------------------------------------------------------------------
+
+sourceFile=$1
+
+if [ ! -e $1 ]
+then
+    sourceFile=$(find . -name $sourceFile -print -quit)
+    if [ -z "$sourceFile" ]
+    then
+        echo "$Script: cannot find source file $1" 1>&2
+        exit 1
+    fi
+fi
+
+
+#------------------------------------------------------------------------------
+# Search up directories tree for the Make sub-directory containing dep files
+# and echo path for the dep file corresponding to the specified source file
+#------------------------------------------------------------------------------
+
+findObjectDir $sourceFile
+
+fileName=${1##*/}
+
+echo $objectsDir/$fileName.dep
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
+
+#------------------------------------------------------------------------------
diff --git a/wmake/wmake b/wmake/wmake
index ebcd38cb..9756386b 100755
--- a/wmake/wmake
+++ b/wmake/wmake
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011-2013 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -26,7 +26,31 @@
 #     wmake
 #
 # Description
-#     General, easy to use make system for multi-platform development.
+#     General, easy to use make system for multi-platform development
+#     with support for local and network parallel compilation.
+#
+#     This updated wmake supports out-of-tree object and dependency files to
+#     avoid the clutter which accumulates in the source-tree with the original
+#     wmake system.  Now when building the OpenFOAM package both the object and
+#     dependency files are now located in a tree with the same structure as the
+#     source tree but in the platforms/$WM_OPTIONS sub-directory of
+#     $WM_PROJECT_DIR.
+#
+#     When building user libraries and applications which are not located in the
+#     OpenFOAM source-tree the object and dependency files are located in a tree
+#     with the same structure as the source tree but in the Make/$WM_OPTIONS
+#     sub-directory.
+#
+#     The disadvantage of the out-of-tree compilation is that the dependency
+#     files are harder to find but are sometimes useful to study which header
+#     files are included.  For those who need access to the dependency files the
+#     new wdep script is provided to locate them.  See the wdep script header or
+#     run:
+#         wdep -h
+#
+# See also
+#     wmakeLnInclude, wmakeLnIncludeAll, wdep, wrmdep, wrmo,
+#     wclean, wcleanPlatform, wcleanLnIncludeAll
 #
 #------------------------------------------------------------------------------
 Script=${0##*/}
@@ -40,41 +64,63 @@ Usage: $Script [OPTION] [dir]
        $Script [OPTION] target [dir [MakeDir]]
 
 options:
-  -s | -silent      invoke make in 'silent' mode (do not echo commands)
-  -help             print the usage
+  -q | -quiet       Be quiet (use more terse output)
+  -s | -silent      Run make in 'silent' mode (do not echo commands)
+  -a | -all         Run wmake in all subdirectories
+  -h | -help        Print the usage
 
 
 A general, easy-to-use make system for multi-platform development
+with support for local and network parallel compilation.
 
 The 'target' is a Makefile target:
-  e.g., Make/linux64GccDPOpt/fvMesh.o
+  e.g., platforms/linux64GccDPOpt/.../fvMesh.o
 
 or a special target:
-  all               all subdirectories, uses any Allwmake files if they exist
-  exe               build statically linked executable
-  lib               build statically linked archive lib (.a)
-  libo              build statically linked lib (.o)
-  libso             build dynamically linked lib (.so)
-  jar               build Java jar
+  all               wmake all subdirectories, running Allwmake files if present
+  exe               Compile statically linked executable
+  lib               Compile statically linked archive lib (.a)
+  libo              Compile statically linked lib (.o)
+  libso             Compile dynamically linked lib (.so)
+  dep               Compile lnInclude and dependencies only
+  updatedep         Compile dependencies only (in case of broken dependencies)
 
 USAGE
     exit 1
 }
 
-# normally use "make"
+
+# Default make is the "make" in the path
 make="make"
 
-# parse options
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
+# Default to compiling the local target only
+all=
+# Default to be noisy if WM_QUIET_RULES is not set
+quiet=
+[ -n "$WM_QUIET_RULES" ] && quiet="V=0"
+
 while [ "$#" -gt 0 ]
 do
     case "$1" in
     -h | -help)
         usage
         ;;
+    -q | -quiet)
+        quiet="V=0"
+        ;;
     -s | -silent)
         make="$make -s"
         shift
         ;;
+    -a | -all | all)
+        all="all"
+        shift
+        ;;
     -*)
         usage "unknown option: '$*'"
         ;;
@@ -84,33 +130,36 @@ do
     esac
 done
 
-#
-# check environment variables
-#
-for check in WM_OPTIONS WM_LINK_LANGUAGE WM_DIR
+
+#------------------------------------------------------------------------------
+# Check environment variables
+#------------------------------------------------------------------------------
+
+for envar in WM_OPTIONS WM_LINK_LANGUAGE WM_DIR
 do
-    eval test "\$$check" || {
-        echo "$Script error: environment variable \$$check not set" 1>&2
+    eval test "\$$envar" || {
+        echo "$Script error: environment variable \$$envar not set" 1>&2
         exit 1
     }
 done
 
 
-# when compiling anything but a standalone exe:
-# WM_PROJECT and WM_PROJECT_DIR must be set
+# When compiling anything but a standalone exe WM_PROJECT and WM_PROJECT_DIR
+# must be set
 [ "$1" = exe -o \( "$WM_PROJECT" -a "$WM_PROJECT_DIR" \) ] || {
     echo "$Script error:" 1>&2
-    echo "    environment variable \$WM_PROJECT or \$WM_PROJECT_DIR not set" 1>&2
-    echo  "   while building project library" 1>&2
+    echo "    environment variable \$WM_PROJECT or " \
+         "\$WM_PROJECT_DIR not set" 1>&2
+    echo "    while building project library" 1>&2
     exit 1
 }
 
 
 #------------------------------------------------------------------------------
-# Select the version of make to be used
+# Setup parallel compilation
 #------------------------------------------------------------------------------
 
-# set WM_NCOMPPROCS automatically when both WM_HOSTS and WM_SCHEDULER are set
+# Set WM_NCOMPPROCS automatically when both WM_HOSTS and WM_SCHEDULER are set
 if [ -z "$WM_NCOMPPROCS" -a -n "$WM_HOSTS" -a -n "$WM_SCHEDULER" ]
 then
     WM_NCOMPPROCS=$(wmakeScheduler -count)
@@ -136,10 +185,10 @@ fi
 
 
 #------------------------------------------------------------------------------
-# check arguments and change to the directory in which to run wmake
+# Check arguments and change to the directory in which to run wmake
 #------------------------------------------------------------------------------
 
-unset dir makeType
+unset dir targetType
 MakeDir=Make
 
 if [ $# -ge 1 ]
@@ -148,13 +197,13 @@ then
     then
         dir=$1
     else
-        makeType=$1
+        targetType=$1
     fi
 
-    # specified directory name:
+    # Specified directory name:
     [ $# -ge 2 ] && dir=$2
 
-    # specified alternative name for the Make sub-directory:
+    # Specified alternative name for the Make sub-directory:
     [ $# -ge 3 ] && MakeDir=$3
 
     if [ "$dir" ]
@@ -168,71 +217,154 @@ fi
 
 
 #------------------------------------------------------------------------------
-# Recurse the application directories tree
+# Recurse the source tree to compile "all" targets
 #------------------------------------------------------------------------------
 
-if [ "$makeType" = all ]
+if [ "$all" = "all" ]
 then
     if [ -e Allwmake ]
     then
         ./Allwmake
         exit $?
-    elif [ ! -d $MakeDir ]
-    then
-        # FOAM_APPS=$(find . -maxdepth 1 \( -type d -a ! -name "." -a ! -name Optional -a ! -name Make \)  -printf "%f ")
-        # avoid 'find' with '-printf' ... not entirely portable
-        FOAM_APPS=$(for d in *; do [ -d "$d" -a "$d" != Optional -a "$d" != Make ] && echo "$d"; done | xargs)
-        $make -k -f $WM_DIR/MakefileApps FOAM_APPS="$FOAM_APPS"
-        exit $?
+    else
+        # Have to keep track of the main exit code for the call to "make"
+        makeExitCode=0
+
+        # Find all the sub-directories containing a 'Make' directory
+        FOAM_APPS=$(\
+                       for d in *; \
+                       do [ -d "$d" -a "$d" != Optional -a "$d" != Make ] \
+                          && echo "$d"; \
+                       done | xargs \
+                 )
+        if [ ! "$FOAM_APPS" = "" ]
+        then
+            # Compile all applications in sub-directories
+            $make ${WM_CONTINUE_ON_ERROR:+-k} \
+                  -f $WM_DIR/makefiles/apps \
+                  TARGET="$targetType" FOAM_APPS="$FOAM_APPS" $quiet
+            makeExitCode=$?
+        fi
+        # If the current directory contains a 'Make' directory continue
+        # otherwise exit, or always exit in case of error
+        if [ ! -d $MakeDir -o $makeExitCode -ne 0 ]
+        then
+            exit $makeExitCode
+        fi
+
+        # Clean up tracking variable
+        unset makeExitCode
     fi
 fi
 
 
 #------------------------------------------------------------------------------
-# Require the existence of the 'Make' directory and 'files' file
+# Search up the directory tree for the Make sub-directory,
+# check the existance of the 'files' file and build there if present
 #------------------------------------------------------------------------------
 
-[ -d $MakeDir ] || {
-    echo "$Script error: '$MakeDir' directory does not exist in $PWD" 1>&2
-    exit 1
+unset dir
+
+expandPath()
+{
+    dir=$(dirname $1)
+    cwd=$PWD
+    cd $dir
+    exPath=$PWD
+    cd $cwd
 }
 
+findTarget()
+{
+    expandPath $1
+
+    if [ "$exPath" = "$WM_PROJECT_DIR" \
+                   -o "$exPath" = "$HOME" \
+                   -o "$exPath" = "/" \
+       ]
+    then
+        echo "$Script error: could not find Make directory" 1>&2
+    elif [ -d "$1/Make" ]; then
+        echo "    Found target directory " $1
+        dir=$1
+    else
+        findTarget "$1/.."
+    fi
+}
+
+if [ ! -d $MakeDir ]
+then
+    echo "$Script: '$MakeDir' directory does not exist in $PWD" 1>&2
+    echo "    Searching up directories tree for Make directory"
+
+    findTarget .
+    targetType=
+
+    if [ "$dir" ]
+    then
+        cd $dir 2>/dev/null || {
+            echo "$Script error: could not change to directory '$dir'" 1>&2
+            exit 1
+        }
+    fi
+fi
+
+
 [ -r $MakeDir/files ] || {
     echo "$Script error: file '$MakeDir/files' does not exist in $PWD" 1>&2
     exit 1
 }
 
-# transform "all" or no option to "libso" if that looks appropriate or remove it
+
+#------------------------------------------------------------------------------
+# Transform options
+#------------------------------------------------------------------------------
+
+# Transform no option to "libso" if that looks appropriate or remove it
 # so that the call to make builds the application
-if [ "$makeType" = all -o "$makeType" = "" ]
+if [ "$targetType" = "" ]
 then
-    unset makeType
-    if grep -e '^ *LIB *=' "$MakeDir/files" >/dev/null 2>&1
+    unset targetType
+    if grep --colour=never -e '^ *LIB *=' "$MakeDir/files" >/dev/null 2>&1
     then
-        makeType=libso
+        targetType=libso
     fi
 fi
 
 
+#------------------------------------------------------------------------------
 # Spawn a sub-shell and unset MAKEFLAGS in that sub-shell to avoid
 # files and options being built in parallel
+#------------------------------------------------------------------------------
+
+objectsDir=$MakeDir/$WM_OPTIONS
+if echo $PWD | grep --colour=never "$WM_PROJECT_DIR"
+then
+    platformPath=$WM_PROJECT_DIR/platforms/${WM_OPTIONS}
+    objectsDir=$platformPath$(echo $PWD | sed s%$WM_PROJECT_DIR%% )
+fi
+
 (
-    cd $MakeDir
     unset MAKEFLAGS
-    make -s -f $WM_DIR/MakefileOptions
-    make -s -f $WM_DIR/MakefileFiles allFiles
+    mkdir -p $objectsDir
+
+    # Pre-build the $WM_OPTIONS/options file
+    # which is included when building the $WM_OPTIONS/files file
+    $make -s -f $WM_DIR/makefiles/files MAKE_DIR=$MakeDir \
+          OBJECTS_DIR=$objectsDir $quiet $objectsDir/options
+
+    $make -s -f $WM_DIR/makefiles/files MAKE_DIR=$MakeDir \
+          OBJECTS_DIR=$objectsDir $quiet
 )
 
 
 #------------------------------------------------------------------------------
-# Check the $OBJECTS_DIR = $MakeDir/$WM_OPTIONS/objectFiles file
-# was created successfully
+# Check the $objectsDir/sourceFiles file was created successfully
 #------------------------------------------------------------------------------
 
-OBJECTS_DIR=$MakeDir/$WM_OPTIONS
-
-[ -r $OBJECTS_DIR/objectFiles ] || {
-    echo "$Script error: file '$OBJECTS_DIR/objectFiles' could not be created in $PWD" 1>&2
+[ -r $objectsDir/sourceFiles ] || {
+    echo "$Script error: file '$objectsDir/sourceFiles'" \
+         "could not be created in $PWD" 1>&2
     exit 1
 }
 
@@ -241,25 +373,52 @@ OBJECTS_DIR=$MakeDir/$WM_OPTIONS
 # Make the dependency files
 #------------------------------------------------------------------------------
 
-touch $OBJECTS_DIR/dontIncludeDeps
-
-case "$makeType" in
-lib | libo | libso )
-    $make -s -f $WM_DIR/Makefile MAKE_DIR=$MakeDir INCLUDE_DEPS=$OBJECTS_DIR/dontIncludeDeps lnInclude/uptodate
-    ;;
+# For libraries create lnInclude ...
+case "$targetType" in
+    lib | libo | libso | dep )
+        # ... but only if 'LIB' is declared in 'Make/files'
+        if grep --colour=never -e '^ *LIB *=' "$MakeDir/files" >/dev/null 2>&1
+        then
+            $make -s -f $WM_DIR/makefiles/general MAKE_DIR=$MakeDir \
+                  OBJECTS_DIR=$objectsDir $quiet lnInclude
+        fi
+        ;;
 esac
 
-$make -s -f $WM_DIR/Makefile MAKE_DIR=$MakeDir INCLUDE_DEPS=$OBJECTS_DIR/dontIncludeDeps $OBJECTS_DIR/dependencies
 
-rc=$?
-[ $rc -eq 0 ] || exit $rc
+#------------------------------------------------------------------------------
+# When WM_UPDATE_DEPENDENCIES is set, use forced dependency files update
+#------------------------------------------------------------------------------
+
+if [ -n "$WM_UPDATE_DEPENDENCIES" ]
+then
+
+    $make -f $WM_DIR/makefiles/general MAKE_DIR=$MakeDir \
+        OBJECTS_DIR=$objectsDir $quiet updatedep
+    makeExitCode=$?
+
+    if [ $makeExitCode -ne 0 ]
+    then
+        exit $makeExitCode
+    fi
+
+    unset makeExitCode
+fi
+
+
+#------------------------------------------------------------------------------
+# Make the dependency files or object files and link
+#------------------------------------------------------------------------------
+
+exec $make -f $WM_DIR/makefiles/general MAKE_DIR=$MakeDir \
+     OBJECTS_DIR=$objectsDir $quiet $targetType
+
 
 #------------------------------------------------------------------------------
-# make the object files and link
+# Cleanup local variables and functions
 #------------------------------------------------------------------------------
 
-cmd="$make -f $WM_DIR/Makefile MAKE_DIR=$MakeDir INCLUDE_DEPS=$OBJECTS_DIR/includeDeps $makeType"
-# echo "cmd=$cmd"
-exec $cmd
+unset Script usage expandPath findTarget
+
 
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeCheckPwd b/wmake/wmakeCheckPwd
index 8de18be3..f10b6d23 100755
--- a/wmake/wmakeCheckPwd
+++ b/wmake/wmakeCheckPwd
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2015 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,11 +25,15 @@
 # Script
 #     wmakeCheckPwd
 #
+# Usage
+#     wmakeCheckPwd <dir>
+#
 # Description
-#     Check that the current working directory is equal to a particular
-#     target directory, resolving the absolute path as required
+#     Check that the current working directory is the directory <dir>
 #
 #-------------------------------------------------------------------------------
+Script=${0##*/}
+
 unset quietOpt
 
 usage() {
@@ -38,13 +42,12 @@ usage() {
     while [ "$#" -ge 1 ]; do echo "$1"; shift; done
     cat<<USAGE
 
-usage: ${0##*/} [OPTION] dirName
+Usage: $Script [OPTION] dirName
 
 options:
   -q | -quiet   suppress all normal output
 
-  Check that the current working directory is equal to a particular
-  target directory, resolving the absolute path as required
+  Check that the current working directory is the directory <dir>
 
   Exit status 0 when the directories are identical
   Exit status 1 on error
@@ -54,7 +57,10 @@ USAGE
 }
 
 
-# parse options
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
 while [ "$#" -gt 0 ]
 do
     case "$1" in
@@ -76,27 +82,40 @@ done
 
 
 [ "$#" -eq 1 ] || usage
-dirName="$1"
 
+# Set dirName to <dir>
+dirName="$1"
 
-# trivial checks first
+# Simple check against $PWD
 [ "$PWD" = "$dirName" ] && exit 0
 
+# Check existance of <dir>
 [ -d "$dirName" ] || {
-    [ "$quietOpt" = true ] || echo "Error: Directory does not exist $dirName"
+    [ "$quietOpt" = true ] || {
+        echo "$Script error: Directory does not exist $dirName"
+    }
     exit 1
 }
 
-
-# use /bin/pwd to get the absolute path (could be linked)
+# Use /bin/pwd to get the absolute path (could be linked)
 thisDir=$(/bin/pwd)
 target=$(cd $dirName 2>/dev/null && /bin/pwd)
 
-# okay
+# Return 0 if this directory is <dir>
 [ "$thisDir" = "$target" ] && exit 0
 
-# some other error
-[ "$quietOpt" = true ] || echo "Error: Current directory is not $dirName"
+# This directory is not <dir>
+[ "$quietOpt" = true ] || {
+    echo "$Script error: Current directory is not $dirName"
+}
 exit 1
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeFilesAndOptions b/wmake/wmakeFilesAndOptions
index d43d8bf5..488c211a 100755
--- a/wmake/wmakeFilesAndOptions
+++ b/wmake/wmakeFilesAndOptions
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,12 +25,13 @@
 # Script
 #     wmakeFilesAndOptions
 #
+# Usage
+#     wmakeFilesAndOptions
+#
 # Description
 #     Scan current directory for directories and source files
 #     and construct Make/files and Make/options
 #
-#     Usage : wmakeFilesAndOptions
-#
 #------------------------------------------------------------------------------
 Script=${0##*/}
 
@@ -38,7 +39,7 @@ usage() {
     while [ "$#" -ge 1 ]; do echo "$1"; shift; done
     cat<<USAGE
 
-usage: ${0##*/}
+Usage: $Script
 
     Scan current directory for directories and source files
     and construct 'Make/files' and 'Make/options'
@@ -48,11 +49,14 @@ USAGE
 }
 
 
-# simple parse options
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
 while [ "$#" -gt 0 ]
 do
     case "$1" in
-    -h | -help)   # provide immediate help
+    -h | -help)   # Provide immediate help
         usage
         ;;
     -*)
@@ -64,12 +68,13 @@ do
     esac
 done
 
-# no arguments
+# No arguments
 [ "$#" -eq 0 ] || usage "unexpected arguments: '$*'"
 
-#
-# check environment variables
-#
+
+#------------------------------------------------------------------------------
+# Check environment variables
+#------------------------------------------------------------------------------
 for check in WM_OPTIONS WM_LINK_LANGUAGE WM_DIR
 do
     eval test "\$$check" || {
@@ -96,4 +101,12 @@ fi
     $WM_DIR/scripts/makeOptions
 }
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeFindEmptyMake b/wmake/wmakeFindEmptyMake
deleted file mode 100755
index d41b5267..00000000
--- a/wmake/wmakeFindEmptyMake
+++ /dev/null
@@ -1,87 +0,0 @@
-#!/bin/sh
-#------------------------------------------------------------------------------
-# =========                 |
-# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
-#  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
-#    \\/     M anipulation  |
-#-------------------------------------------------------------------------------
-# License
-#     This file is part of OpenFOAM.
-#
-#     OpenFOAM is free software: you can redistribute it and/or modify it
-#     under the terms of the GNU General Public License as published by
-#     the Free Software Foundation, either version 3 of the License, or
-#     (at your option) any later version.
-#
-#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
-#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
-#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
-#     for more details.
-#
-#     You should have received a copy of the GNU General Public License
-#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
-#
-# Script
-#     wmakeFindEmptyMake
-#
-# Description
-#     Find 'Make/' directories without 'files' or 'options'.
-#     These typically correspond to (partially) removed applications.
-#
-#------------------------------------------------------------------------------
-usage() {
-    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
-    cat<<USAGE
-
-usage: ${0##*/} [dir1 .. dirN]
-
-    Find 'Make/' directories without 'files' or 'options'.
-    These typically correspond to (partially) removed applications.
-
-USAGE
-    exit 1
-}
-
-#------------------------------------------------------------------------------
-findName=lnInclude
-
-# simple parse options
-while [ "$#" -gt 0 ]
-do
-    case "$1" in
-    -h | -help)   # provide immediate help
-        usage
-        ;;
-    -*)
-        usage "unknown option: '$*'"
-        ;;
-    *)
-        break
-        ;;
-    esac
-done
-
-
-# default to searching from pwd
-[ "$#" -gt 0 ] || set -- .
-
-for checkDir
-do
-    if [ -d $checkDir ]
-    then
-        echo "searching: $checkDir for 'Make' directories without 'files' or 'options'" 1>&2
-        echo "---------" 1>&2
-    else
-        echo "skipping non-dir: $checkDir" 1>&2
-        echo "----------------" 1>&2
-        continue
-    fi
-
-    find $checkDir -depth -type d -name Make -print | while read MakeDir
-    do
-        [ -f "$MakeDir/files" -o -f "$MakeDir/options" ] || echo $MakeDir
-    done
-done
-
-#------------------------------------------------------------------------------
diff --git a/wmake/wmakeLnInclude b/wmake/wmakeLnInclude
index fa8dc97f..37532885 100755
--- a/wmake/wmakeLnInclude
+++ b/wmake/wmakeLnInclude
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,17 +25,18 @@
 # Script
 #     wmakeLnInclude
 #
+# Usage
+#     wmakeLnInclude [-u | -update] [-s | -silent] <dir>
+#
 # Description
 #     Link all the source files in the <dir> directory into <dir>/lnInclude
 #
-#     Usage: wmakeLnInclude [-f] <dir>
-#
 #     The desired source files:
 #         *.C *.H *.h *.cpp *.cxx *.hpp *.hxx
 #
 #     Avoid
 #         *.c (C source)
-#         .#* (cvs recovered files)
+#
 #------------------------------------------------------------------------------
 Script=${0##*/}
 
@@ -47,39 +48,41 @@ usage() {
 Usage: $Script [OPTION] dir
 
 options:
-  -f | -force       force update
+  -u | -update      update
   -s | -silent      use 'silent' mode (do not echo command)
   -help             print the usage
 
     Link all the source files in the <dir> into <dir>/lnInclude
 
 Note
-    The '-f' option forces an update when the lnInclude directory already exists
+    The '-u' option forces an update when the lnInclude directory already exists
     and changes the default linking from 'ln -s' to 'ln -sf'.
 
 USAGE
     exit 1
 }
 
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
 #------------------------------------------------------------------------------
 
-# default 'find' option
+# Default 'find' option
 unset findOpt
 
-# default 'ln' option
+# Default 'ln' option
 lnOpt="-s"
 
-unset forceUpdate silentOpt
+unset update silentOpt
 
-# simple parse options
 while [ "$#" -gt 0 ]
 do
     case "$1" in
-    -h | -help)   # provide immediate help
+    -h | -help)   # Provide immediate help
         usage
         ;;
-    -f | -force)
-        forceUpdate=true
+    -u | -update)
+        update=true
         lnOpt="-sf"
         shift
         ;;
@@ -100,11 +103,11 @@ if [ $# -eq 1 ]
 then
     baseDir=$1
 else
-    usage "ERROR: incorrect number of arguments"
+    usage "Error: incorrect number of arguments"
 fi
 
 
-# convert incorrect path/dir/lnInclude to something sensible
+# Convert incorrect path/dir/lnInclude to something sensible
 while [ "${baseDir##*/}" = lnInclude ]
 do
     baseDir="${baseDir%/*}"
@@ -123,7 +126,7 @@ incDir=$baseDir/lnInclude
 
 if [ -d $incDir ]
 then
-    [ "$forceUpdate" = true ] || {
+    [ "$update" = true ] || {
         # echo "$Script error: include directory $incDir already exists" 1>&2
         exit 0
     }
@@ -138,25 +141,44 @@ fi
 
 cd $incDir || exit 1
 
-#------------------------------------------------------------------------------
-
 if [ "$silentOpt" != true ]
 then
-    echo "$Script: linking include files to $incDir" 1>&2
+    if [ -n "$WM_QUIET_RULES" ]
+    then
+        echo "  LN	$incDir" 1>&2
+    else
+        echo "$Script: linking include files to $incDir" 1>&2
+    fi
 fi
 
-#
-# remove any broken links first (this helps when file locations have moved)
-#
-find -L . -type l -exec rm {} \;
 
-#
-# create links, avoid recreating links unless necessary
+#------------------------------------------------------------------------------
+# Remove any broken links first (this helps when file locations have moved)
+#------------------------------------------------------------------------------
+find -L . -type l | xargs rm -f
+
+
+#------------------------------------------------------------------------------
+# Create links, avoid recreating links unless necessary
 # things placed in the 'noLink' directory are skipped
-#
+#------------------------------------------------------------------------------
 find .. $findOpt \
-    \( -name lnInclude -o -name Make -o -name config -o -name noLink \) -prune \
- -o \( -name '*.[CHh]' -o -name '*.[ch]xx' -o -name '*.[ch]pp' -o -name '*.type' \)  \
- -exec ln $lnOpt {} . \;
+     \( -name lnInclude -o -name Make -o -name config -o -name noLink \) \
+     -prune \
+     -o \( \
+     -name '*.[CHh]' \
+     -o -name '*.[ch]xx' \
+     -o -name '*.[ch]pp' \
+     -o -name '*.type' \
+     \)  \
+     -exec ln $lnOpt {} . \;
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
 
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeLnIncludeAll b/wmake/wmakeLnIncludeAll
index 1c396678..12062ac5 100755
--- a/wmake/wmakeLnIncludeAll
+++ b/wmake/wmakeLnIncludeAll
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,32 +25,40 @@
 # Script
 #     wmakeLnIncludeAll
 #
+# Usage
+#     wmakeLnIncludeAll [dir1 .. dirN]
+#
 # Description
 #     Find directories with a 'Make/files' that contains a 'LIB =' directive
-#     and execute 'wmakeLnInclude -f' for each one
+#     and execute 'wmakeLnInclude -update' for each one
 #
 #------------------------------------------------------------------------------
+Script=${0##*/}
+
 usage() {
     while [ "$#" -ge 1 ]; do echo "$1"; shift; done
     cat<<USAGE
 
-usage: ${0##*/} [dir1 .. dirN]
+Usage: $Script [dir1 .. dirN]
 
     Find directories with a 'Make/files' that contains a 'LIB =' directive
-    and execute 'wmakeLnInclude -f' for each one
+    and execute 'wmakeLnInclude -update' for each one
 
 USAGE
     exit 1
 }
 
+
 #------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
 findName=lnInclude
 
-# simple parse options
 while [ "$#" -gt 0 ]
 do
     case "$1" in
-    -h | -help)   # provide immediate help
+    -h | -help)   # Provide immediate help
         usage
         ;;
     -*)
@@ -63,17 +71,17 @@ do
 done
 
 
-# default to searching from pwd
+# Default to searching from CWD
 [ "$#" -gt 0 ] || set -- .
 
 for checkDir
 do
     if [ -d $checkDir ]
     then
-        echo "searching: $checkDir for 'Make' directories"
+        echo "Searching: $checkDir for 'Make' directories"
         echo "---------"
     else
-        echo "skipping non-dir: $checkDir"
+        echo "Skipping non-dir: $checkDir"
         echo "----------------"
         continue
     fi
@@ -83,9 +91,9 @@ do
         topDir=${MakeDir%/Make}    # trim /Make from the end
         if [ -d "$topDir" ]
         then
-            if grep -e '^ *LIB *=' "$MakeDir/files" >/dev/null 2>&1
+            if grep --colour=never -e '^ *LIB *=' "$MakeDir/files" >/dev/null 2>&1
             then
-                wmakeLnInclude -f $topDir
+                wmakeLnInclude -update $topDir
             elif [ -d "$topDir/lnInclude" ]
             then
                 echo "removing spurious $topDir/lnInclude"
@@ -95,4 +103,12 @@ do
     done
 done
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakePrintBuild b/wmake/wmakePrintBuild
index 26cd5ef6..c23e63d3 100755
--- a/wmake/wmakePrintBuild
+++ b/wmake/wmakePrintBuild
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2015 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,19 +25,21 @@
 # Script
 #     wmakePrintBuild
 #
+# Usage
+#     wmakePrintBuild [OPTION]
+#
 # Description
 #     Print the version used when building the project
 #
 #------------------------------------------------------------------------------
-# persistent build tag
-build="$WM_PROJECT_DIR/.build"
+Script=${0##*/}
 
 usage() {
     exec 1>&2
 
     while [ "$#" -ge 1 ]; do echo "$1"; shift; done
     cat<<USAGE
-usage: ${0##*/} [OPTION]
+Usage: $Script [OPTION]
 options:
   -check          check the git head commit vs. \$WM_PROJECT_DIR/.build
                   (exit code 0 for no changes)
@@ -55,11 +57,13 @@ Print the version used when building the project, in this order of precedence:
 USAGE
     exit 1
 }
-#------------------------------------------------------------------------------
 
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
 unset checkOnly update package version shortOpt
 
-# parse options
 while [ "$#" -gt 0 ]
 do
     case "$1" in
@@ -80,7 +84,7 @@ do
         ;;
     -pkg | -package)
         [ "$#" -ge 2 ] || usage "'$1' option requires an argument"
-        # mark empty as 'none', disallow '!' in string
+        # Mark empty as 'none', disallow '!' in string
         package=$(echo "${2:-none}" | sed -e 's/!//g')
         shift 2
         ;;
@@ -101,10 +105,14 @@ done
 
 #------------------------------------------------------------------------------
 
-#
-# retrieve old values from the $WM_PROJECT_DIR/.build cache, stored as
+# Persistent build tag
+build="$WM_PROJECT_DIR/.build"
+
+
+#------------------------------------------------------------------------------
+# Retrieve old values from the $WM_PROJECT_DIR/.build cache, stored as
 #     version [packager]
-#
+#------------------------------------------------------------------------------
 unset oldPackage oldVersion
 getOldValues()
 {
@@ -115,10 +123,9 @@ getOldValues()
     [ "${oldPackage:-none}" = none ] && unset oldPackage
 }
 
-#
-# printTag - output the build tag
-# reuses the old -package tag if needed
-#
+#------------------------------------------------------------------------------
+# printTag - output the build tag, reuses the old -package tag if needed
+#------------------------------------------------------------------------------
 printTag()
 {
     if [ "${package:-${oldPackage:-none}}" = none ]
@@ -130,13 +137,16 @@ printTag()
 }
 
 
+#------------------------------------------------------------------------------
+# Get the version
+#------------------------------------------------------------------------------
 
 if [ -n "$version" ]
 then
-    # specified a version - no error possible
+    # Specified a version - no error possible
     rc=0
 else
-    # get the head SHA1 when building under git
+    # Get the head SHA1 when building under git
     # if there are multiple values (eg, HEAD, origin/HEAD, ...)
     # only take the first one, which is 'HEAD'
     version=$(
@@ -146,17 +156,17 @@ else
 
     if [ -n "$version" ]
     then
-        # mark as success and prefix with WM_PROJECT_VERSION
+        # Mark as success and prefix with WM_PROJECT_VERSION
         rc=0
         version="${WM_PROJECT_VERSION}-$version"
     else
-        # mark as failure
+        # Mark as failure
         rc=1
     fi
 fi
 
 
-# retrieve old values
+# Retrieve old values
 getOldValues
 
 if [ "$shortOpt" = true ]
@@ -164,9 +174,10 @@ then
     unset package oldPackage
 fi
 
-#
-# update persistent build tag if possible
-#
+
+#------------------------------------------------------------------------------
+# Update persistent build tag if possible
+#------------------------------------------------------------------------------
 if [ $rc -eq 0 -a -n "$update" ]
 then
     if [ "$version:$package" != "$oldVersion:$oldPackage" ]
@@ -178,16 +189,10 @@ then
     fi
 fi
 
-# cat<< DEBUG 1>&2
-# Debug information
-#     version='$version'
-#     package='$package'
-#     oldVersion='$oldVersion'
-#     oldPackage='$oldPackage'
-# DEBUG
 
-
-# check git vs. persistent build tag
+#------------------------------------------------------------------------------
+# Check git vs. persistent build tag
+#------------------------------------------------------------------------------
 if [ -n "$checkOnly" ]
 then
     if [ $rc -eq 0 ]
@@ -207,23 +212,26 @@ then
 fi
 
 
-#
-# cannot get git information or  -version version
-#
+#------------------------------------------------------------------------------
+# Cannot get git information or  -version version
+#------------------------------------------------------------------------------
 if [ $rc -ne 0 ]
 then
     if [ -n "$oldVersion" ]
     then
-        # use previous version info
+        # Use previous version info
         version="$oldVersion"
     else
-        # fallback to WM_PROJECT_VERSION alone
+        # Fallback to WM_PROJECT_VERSION alone
         version="${WM_PROJECT_VERSION:-unknown}"
     fi
 fi
 
 
-# output the tag
+#------------------------------------------------------------------------------
+# Output the tag
+#------------------------------------------------------------------------------
 printTag
 
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeScheduler b/wmake/wmakeScheduler
index c079883c..a927af7a 100755
--- a/wmake/wmakeScheduler
+++ b/wmake/wmakeScheduler
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011-2013 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,13 +25,21 @@
 # Script
 #     wmakeScheduler
 #
+# Usage
+#     wmakeScheduler COMMAND
+#         run 'COMMAND' on one of the slots listed in WM_HOSTS
+#
+#     wmakeScheduler -count
+#         count the total number of slots available in WM_HOSTS
+#         eg,  export WM_NCOMPPROCS=$(wmakeScheduler -count)
+#
 # Description
 #     Scheduler for network distributed compilations using wmake.
 #     - WM_HOSTS contains a list of hosts and number of concurrent processes
 #     eg,
-#        export WM_HOSTS="hostA:1 hostB:2 hostC:1"
+#         export WM_HOSTS="hostA:1 hostB:2 hostC:1"
 #     - WM_COLOURS contains a list of colours to cycle through
-#        export WM_COLOURS="black blue green cyan red magenta yellow"
+#         export WM_COLOURS="black blue green cyan red magenta yellow"
 #
 #     Sources the relevant cshrc/bashrc if not set.
 #
@@ -39,25 +47,18 @@
 #     before calling this routine.
 #     FOAM_INST_DIR may possibly have been set (to find installation)
 #
-# Usage
-#     wmakeScheduler COMMAND
-#         run 'COMMAND' on one of the slots listed in WM_HOSTS
-#
-#     wmakeScheduler -count
-#         count the total number of slots available in WM_HOSTS
-#         eg,  export WM_NCOMPPROCS=$(wmakeScheduler -count)
-#
 #-------------------------------------------------------------------------------
+Script=${0##*/}
 
 # csh sets HOST, bash sets HOSTNAME
 : ${HOST:=$HOSTNAME}
 
-
 lockDir=$HOME/.$WM_PROJECT/.wmake
-# fallback - 1 core on current host
+
+# Fallback - 1 core on current host
 : ${WM_HOSTS:=$HOST:1}
 
-# count the total number of slots available and exit
+# Count the total number of slots available and exit
 if [ "$1" = "-count" ]
 then
     expr $(
@@ -71,12 +72,12 @@ then
     exit 0
 fi
 
-# where to source WM_PROJECT settings in a remote shell
+# Where to source WM_PROJECT settings in a remote shell
 # This code tries to figure out which cshrc or bashrc to execute.
 # !! Assumes remote computer running same shell and startup files
 # in same location
 
-sourceFoam=false    # fallback command
+sourceFoam=false    # Fallback command
 case $SHELL in
 */csh | */tcsh )    # [t]csh vs bash|ksh|sh
     shellRc=cshrc
@@ -86,9 +87,9 @@ case $SHELL in
     ;;
 esac
 
-# check ~/.$WM_PROJECT/$WM_PROJECT_VERSION/
-# check ~/.$WM_PROJECT/
-# check <installedProject>/etc/
+# Check ~/.$WM_PROJECT/$WM_PROJECT_VERSION/
+# Check ~/.$WM_PROJECT/
+# Check <installedProject>/etc/
 if [ "$WM_PROJECT" ]
 then
     for i in \
@@ -107,8 +108,8 @@ fi
 
 # Construct test string for remote execution.
 # Source WM_PROJECT settings if WM_PROJECT environment not set.
-# attempt to preserve the installation directory 'FOAM_INST_DIR'
-# use FOAM_SETTINGS to pass command-line settings
+# Attempt to preserve the installation directory 'FOAM_INST_DIR'
+# Use FOAM_SETTINGS to pass command-line settings
 case $sourceFoam in
 */bashrc)
     if [ "$FOAM_INST_DIR" ]
@@ -125,9 +126,9 @@ case $sourceFoam in
     ;;
 esac
 
-# quote double-quotes for remote command line
+# Quote double-quotes for remote command line
 rcmd=$(echo $* | sed -e s/\"/\'\"\'/g)
-## the same, without forking (not ksh, maybe not /bin/sh either)
+# The same, without forking (not ksh, maybe not /bin/sh either)
 # rcmd=$(while [ "$#" -gt 0 ]; do echo "${1//\"/'\"'}"; shift; done)
 
 
@@ -146,9 +147,9 @@ done
 set -o pipefail
 
 
-#
-# colour output by argument 1
-#
+#------------------------------------------------------------------------------
+# Colour output by argument 1
+#------------------------------------------------------------------------------
 colourPipe()
 {
 
@@ -173,7 +174,7 @@ colourIndex=0
 # Check for existence of lockfile binary
 if ! type -p lockfile >/dev/null
 then
-    echo "Could not find executable 'lockfile'"
+    echo "$Script: Could not find executable 'lockfile'"
     exit 1
 fi
 
@@ -181,7 +182,7 @@ while :
 do
     for slotGroup in $WM_HOSTS
     do
-        # split 'host:N', but catch 'host:' and 'host' too
+        # Split 'host:N', but catch 'host:' and 'host' too
         host=${slotGroup%%:*}
         n=${slotGroup##*:}
         [ "$n" = "$host" ] && n=1  # missing ':'
@@ -201,14 +202,16 @@ do
                     if [ "$host" = "$HOST" ]; then
                         eval $* 2>&1 | colourPipe "$colour"
                     else
-                        ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" 2>&1 | colourPipe "$colour"
+                        ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" \
+                            2>&1 | colourPipe "$colour"
                     fi
                     retval=$?
                 else
                     if [ "$host" = "$HOST" ]; then
                         eval $* 2>&1
                     else
-                        ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" 2>&1
+                        ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" \
+                            2>&1
                     fi
                     retval=$?
                 fi
@@ -234,4 +237,12 @@ then
     setterm -foreground default
 fi
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wmakeSchedulerUptime b/wmake/wmakeSchedulerUptime
index 06442045..6239f9e6 100755
--- a/wmake/wmakeSchedulerUptime
+++ b/wmake/wmakeSchedulerUptime
@@ -3,7 +3,7 @@
 # =========                 |
 # \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
 #  \\    /   O peration     |
-#   \\  /    A nd           | Copyright (C) 2011 OpenFOAM Foundation
+#   \\  /    A nd           | Copyright (C) 2011-2016 OpenFOAM Foundation
 #    \\/     M anipulation  |
 #-------------------------------------------------------------------------------
 # License
@@ -25,6 +25,14 @@
 # Script
 #     wmakeSchedulerUptime
 #
+# Usage
+#     wmakeSchedulerUptime COMMAND
+#         run 'COMMAND' on one of the slots listed in WM_HOSTS
+#
+#     wmakeScheduler -count
+#         count the total number of slots available in WM_HOSTS
+#         eg,  export WM_NCOMPPROCS=$(wmakeScheduler -count)
+#
 # Description
 #     Scheduler for network distributed compilations using wmake.
 #     - WM_HOSTS contains a list of hosts and number of concurrent processes
@@ -39,44 +47,36 @@
 #     before calling this routine.
 #     FOAM_INST_DIR may possibly have been set (to find installation)
 #
-# Usage
-#     wmakeSchedulerUptime COMMAND
-#         run 'COMMAND' on one of the slots listed in WM_HOSTS
-#
-#     wmakeScheduler -count
-#         count the total number of slots available in WM_HOSTS
-#         eg,  export WM_NCOMPPROCS=$(wmakeScheduler -count)
-#
 #-------------------------------------------------------------------------------
+Script=${0##*/}
 
 # csh sets HOST, bash sets HOSTNAME
 : ${HOST:=$HOSTNAME}
 
-
 lockDir=$HOME/.$WM_PROJECT/.wmake
-# fallback - 1 core on current host
+# Fallback - 1 core on current host
 : ${WM_HOSTS:=$HOST:1}
 
-# count the total number of slots available and exit
+# Count the total number of slots available and exit
 if [ "$1" = "-count" ]
 then
     expr $(
         for slotGroup in $WM_HOSTS
         do
             n=${slotGroup##*:}
-            [ "$n" = "${slotGroup%%:*}" ] && n=1  # missing ':'
+            [ "$n" = "${slotGroup%%:*}" ] && n=1  # Missing ':'
             echo "+ ${n:-1}"
         done
     )
     exit 0
 fi
 
-# where to source WM_PROJECT settings in a remote shell
+# Where to source WM_PROJECT settings in a remote shell
 # This code tries to figure out which cshrc or bashrc to execute.
 # !! Assumes remote computer running same shell and startup files
 # in same location
 
-sourceFoam=false    # fallback command
+sourceFoam=false    # Fallback command
 case $SHELL in
 */csh | */tcsh )    # [t]csh vs bash|ksh|sh
     shellRc=cshrc
@@ -86,9 +86,9 @@ case $SHELL in
     ;;
 esac
 
-# check ~/.$WM_PROJECT/$WM_PROJECT_VERSION/
-# check ~/.$WM_PROJECT/
-# check <installedProject>/etc/
+# Check ~/.$WM_PROJECT/$WM_PROJECT_VERSION/
+# Check ~/.$WM_PROJECT/
+# Check <installedProject>/etc/
 if [ "$WM_PROJECT" ]
 then
     for i in \
@@ -107,8 +107,8 @@ fi
 
 # Construct test string for remote execution.
 # Source WM_PROJECT settings if WM_PROJECT environment not set.
-# attempt to preserve the installation directory 'FOAM_INST_DIR'
-# use FOAM_SETTINGS to pass command-line settings
+# Attempt to preserve the installation directory 'FOAM_INST_DIR'
+# Use FOAM_SETTINGS to pass command-line settings
 case $sourceFoam in
 */bashrc)
     if [ "$FOAM_INST_DIR" ]
@@ -125,9 +125,9 @@ case $sourceFoam in
     ;;
 esac
 
-# quote double-quotes for remote command line
+# Quote double-quotes for remote command line
 rcmd=$(echo $* | sed -e s/\"/\'\"\'/g)
-## the same, without forking (not ksh, maybe not /bin/sh either)
+# The same, without forking (not ksh, maybe not /bin/sh either)
 # rcmd=$(while [ "$#" -gt 0 ]; do echo "${1//\"/'\"'}"; shift; done)
 
 
@@ -147,7 +147,7 @@ set -o pipefail
 
 
 #
-# colour output by argument 1
+# Colour output by argument 1
 #
 colourPipe()
 {
@@ -168,7 +168,7 @@ colourPipe()
 
 
 
-# parse options
+# Parse options
 nprocs=1
 while [ "$#" -gt 0 ]
 do
@@ -194,10 +194,10 @@ while :
 do
     for slotGroup in $WM_HOSTS
     do
-        # split 'host:N', but catch 'host:' and 'host' too
+        # Split 'host:N', but catch 'host:' and 'host' too
         host=${slotGroup%%:*}
         n=${slotGroup##*:}
-        [ "$n" = "$host" ] && n=1  # missing ':'
+        [ "$n" = "$host" ] && n=1  # Missing ':'
         : ${n:=1}
 
 
@@ -210,7 +210,7 @@ do
         load=`echo "$stat" | sed -e 's/.*average:[^0-9.]*\([0-9.]*\).*/\1/'`
 
 
-        #echo "Machine:$host  load:$load  allowed:$WM_NCOMPPROCS  nprocs:$nprocs"
+        #echo "$Script: Machine:$host  load:$load  allowed:$WM_NCOMPPROCS  nprocs:$nprocs"
 
 
         # Check if adding nprocs to load causes overload
@@ -220,16 +220,17 @@ do
             then
                 # Set colour
                 colour="${colourList[$colourIndex]}"
-                echo "Machine:$host  Starting:$*"
+                echo "$Script: Machine:$host  Starting:$*"
 
                 if [ "$host" = "$HOST" ]; then
                     eval $* 2>&1 | colourPipe "$colour"
                 else
-                    ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" 2>&1 | colourPipe "$colour"
+                    ssh $host "$sourceFoam 2>/dev/null; cd $PWD && $rcmd" 2>&1 \
+                        | colourPipe "$colour"
                 fi
                 retval=$?
             else
-                echo "Machine:$host  Starting:$*"
+                echo "$Script: Machine:$host  Starting:$*"
                 if [ "$host" = "$HOST" ]; then
                     eval $* 2>&1
                 else
@@ -248,8 +249,15 @@ do
     done
 
     # Did not find any free machines. Rest a bit.
-    #echo "Too much load. Waiting"
     sleep 1
 done
 
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script
+
+
 #------------------------------------------------------------------------------
diff --git a/wmake/wrmdep b/wmake/wrmdep
new file mode 100755
index 00000000..8fab8cf8
--- /dev/null
+++ b/wmake/wrmdep
@@ -0,0 +1,230 @@
+#!/bin/sh
+#------------------------------------------------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2015-2016 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#-------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Script wrmdep
+#
+# Usage
+#     wrmdep [-a | -all | all] [file]
+#     wrmdep [-o | -old] [dir1 .. dirN]
+#     wrmdep -update
+#
+# Description
+#     This is a catch-all script for pruning .dep files, depending on the
+#     provided arguments.
+#
+#     [-a | -all | all] [file]:
+#     Remove all .dep files from the object directory tree corresponding to the
+#     current source derectory or remove only the .dep files referring to the
+#     optionally specified [file].  With the -a/-all/all option the .dep files
+#     are removed for all platforms rather than just the current platform.
+#
+#     [-o | -old] [dir1 .. dirN]:
+#     Remove *.dep files that are without a corresponding .C or .L source file.
+#     This occurs when a directory has been moved.
+#         - prints the questionable directory and *.dep file
+#
+#     -update:
+#     Search all the "src" and "application" directories of the project for
+#     broken symbolic links for source code files and then remove all .dep
+#     files that relate to files that no longer exist.
+#     Must be executed in the project top-level directory: $WM_PROJECT_DIR.
+#
+#------------------------------------------------------------------------------
+Script=${0##*/}
+
+# Source the wmake functions
+. ${0%/*}/scripts/wmakeFunctions
+
+usage() {
+    exec 1>&2
+    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
+    cat<<USAGE
+Usage:
+
+    $Script [-a | -all | all] [file]
+
+        Remove all .dep files or remove .dep files referring to <file>
+        With the -a/-all/all option the .dep files are removed for all
+        platform rather than just the current platform.
+
+    $Script [-o | -old] [dir1 .. dirN]
+
+        Remove *.dep files that are without a corresponding .C or .L file.
+        This occurs when a directory has been moved.
+          - prints the questionable directory and *.dep file
+
+        Note: to remove empty directories, run: wclean empty
+
+    $Script -update
+
+        Search all the "src" and "application" directories of the project for
+        broken symbolic links for source code files and then remove all .dep
+        files that relate to files that no longer exist.
+        Must be executed in the project top-level directory: $WM_PROJECT_DIR
+
+USAGE
+    exit 1
+}
+
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
+# Default is for removing all .dep files in the current directory
+rmdepMode="files"
+
+# Default to processing only the current platform
+all=
+
+while [ "$#" -gt 0 ]
+do
+    case "$1" in
+    # Print help
+    -h | -help)
+        usage
+        ;;
+    # Non-stop compilation, ignoring errors
+    -a | -all | all)
+        all="all"
+        shift
+        ;;
+    -o | -old)
+        rmdepMode="oldFolders"
+        shift
+        ;;
+    -update)
+        rmdepMode="updateMode"
+        shift
+        ;;
+    -*)
+       usage "unknown option: '$*'"
+       ;;
+    *)
+       break
+       ;;
+    esac
+done
+
+# Check environment variables
+checkEnv
+
+
+case "$rmdepMode" in
+files)
+
+    #-------------------------------------------------------------------------
+    # Remove the selected .dep files from the object tree
+    #-------------------------------------------------------------------------
+
+    findObjectDir .
+
+    # With the -a/-all option replace the current platform with a wildcard
+    if [ "$all" = "all" ]
+    then
+        objectsDir=$(echo $objectsDir | sed s%$WM_OPTIONS%*% )
+    fi
+
+    if [ "$#" -eq 0 ]
+    then
+        echo "removing all .dep files ..."
+        find $objectsDir -name '*.dep' -print | xargs -t rm 2>/dev/null
+    else
+        echo "removing .dep files referring to $1 ..."
+        find $objectsDir -name '*.dep' -exec grep --colour=never -q "$1" '{}' \; \
+             -exec rm '{}' \; -print
+    fi
+
+    ;;
+
+oldFolders)
+
+    # Default is the current directory
+    [ "$#" -gt 0 ] || set -- .
+
+    for checkDir
+    do
+        findObjectDir $checkDir
+
+        if [ -d $objectsDir ]
+        then
+            echo "Searching: $objectsDir"
+        else
+            echo "Skipping non-dir: $objectsDir"
+            continue
+        fi
+
+        find $objectsDir -name '*.dep' -print | while read depFile
+        do
+            depToSource $depFile
+
+            # Check C++ or Flex source file exists
+            if [ ! -r "$sourceFile" ];
+            then
+                echo "rm $depFile"
+                rm -f $depFile 2>/dev/null
+            fi
+        done
+    done
+
+    ;;
+
+updateMode)
+
+    [ "$PWD" = "$WM_PROJECT_DIR" ] \
+        || usage "Not in the project top-level directory"
+
+    echo "Purging all dep files that relate to files that no longer exist..."
+    fileNameList=$(find -L src applications -name '*.[CHL]' -type l)
+
+    for filePathAndName in $fileNameList
+    do
+        fileName=$(basename $filePathAndName)
+        echo "Purging from 'src': $fileName"
+        cd src
+        $Script -a $fileName
+
+        echo "Purging from 'applications': $fileName"
+        cd ../applications
+        $Script -a $fileName
+
+        cd ..
+
+        # Just in case, remove the symbolic link as the last step
+        unlink $filePathAndName
+    done
+
+    ;;
+
+esac
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage rmdepMode all
+
+
+#------------------------------------------------------------------------------
diff --git a/wmake/wrmo b/wmake/wrmo
new file mode 100755
index 00000000..b7cab9bf
--- /dev/null
+++ b/wmake/wrmo
@@ -0,0 +1,116 @@
+#!/bin/sh
+#------------------------------------------------------------------------------
+# =========                 |
+# \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
+#  \\    /   O peration     |
+#   \\  /    A nd           | Copyright (C) 2015 OpenFOAM Foundation
+#    \\/     M anipulation  |
+#-------------------------------------------------------------------------------
+# License
+#     This file is part of OpenFOAM.
+#
+#     OpenFOAM is free software: you can redistribute it and/or modify it
+#     under the terms of the GNU General Public License as published by
+#     the Free Software Foundation, either version 3 of the License, or
+#     (at your option) any later version.
+#
+#     OpenFOAM is distributed in the hope that it will be useful, but WITHOUT
+#     ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+#     FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+#     for more details.
+#
+#     You should have received a copy of the GNU General Public License
+#     along with OpenFOAM.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Script
+#     wrmo
+#
+# Usage
+#     wrmo [-a | -all | all] [file]
+#
+# Description
+#     Remove all .o files from the object directory tree corresponding to the
+#     current source derectory or remove only the .o file corresponding to the
+#     optionally specified [file].  With the -a/-all/all option the .o files
+#     are removed for all platforms rather than just the current platform.
+#
+#------------------------------------------------------------------------------
+Script=${0##*/}
+
+# Source the wmake functions
+. ${0%/*}/scripts/wmakeFunctions
+
+usage() {
+    exec 1>&2
+    while [ "$#" -ge 1 ]; do echo "$1"; shift; done
+    cat<<USAGE
+Usage: $Script [file]
+
+Remove all .o files or remove .o file corresponding to <file>
+
+USAGE
+    exit 1
+}
+
+
+#------------------------------------------------------------------------------
+# Parse arguments and options
+#------------------------------------------------------------------------------
+
+# Default to processing only the current platform
+all=
+
+while [ "$#" -gt 0 ]
+do
+    case "$1" in
+    -h | -help)
+        usage
+        ;;
+    # Non-stop compilation, ignoring errors
+    -a | -all | all)
+        all="all"
+        shift
+        ;;
+    -*)
+       usage "unknown option: '$*'"
+       ;;
+    *)
+       break
+       ;;
+    esac
+done
+
+# Check environment variables
+checkEnv
+
+
+#------------------------------------------------------------------------------
+# Remove the selected .o files from the object tree
+#------------------------------------------------------------------------------
+
+findObjectDir .
+
+# With the -a/-all option replace the current platform with a wildcard
+if [ "$all" = "all" ]
+then
+    objectsDir=$(echo $objectsDir | sed s%$WM_OPTIONS%*% )
+fi
+
+if [ "$#" -eq 0 ]
+then
+    echo "removing all .o files ..."
+    find $objectsDir -name '*.o' -print | xargs -t rm 2>/dev/null
+else
+    echo "removing .o files corresponding to $1 ..."
+    rm $objectsDir/${1%%.*}.o
+fi
+
+
+#------------------------------------------------------------------------------
+# Cleanup local variables and functions
+#------------------------------------------------------------------------------
+
+unset Script usage
+
+
+#------------------------------------------------------------------------------
